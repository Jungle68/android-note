<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.47">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>性能优化相关工具 | Android Notes</title><meta name="description" content="一个 Android 技术记录文档">
    <link rel="modulepreload" href="/android-note/assets/app.e2a3b496.js"><link rel="modulepreload" href="/android-note/assets/性能优化相关工具.html.ebe8409a.js"><link rel="modulepreload" href="/android-note/assets/性能优化相关工具.html.49b62c31.js"><link rel="prefetch" href="/android-note/assets/index.html.fff2aa76.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.261ddca4.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.518850bc.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.d9910bec.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.dff63630.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.f29a403a.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.dc69d7fd.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.7be45349.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.d78f651d.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.a07e9d8a.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.75fdf471.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.7e81f1f2.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.103e5176.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.6e607fde.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.29df35d8.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.6014594b.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.2a53d290.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.d19ee784.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.43ec2966.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.0afb9bec.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.7b3bfc5f.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.b99bf27c.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.c8895c23.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.3fdb02c5.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.f0becde3.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.8ca1aed1.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.eb73aa59.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.6799221d.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.9f737361.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.eab7452f.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.82e665f3.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.659d7444.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.26e47455.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.cbf93a65.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.7c42765a.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.696ea85d.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.ae3ef80a.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.186ba84a.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.0a30a4bc.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.161eb2a1.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.42e7fa9a.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.02a55fca.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.025745a3.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.9e95d7d7.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.1d87d268.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.3e311c7b.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.1396114e.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.0b924706.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.1b6d020f.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.da94471c.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.4322b77a.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.a580533a.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.0d501025.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.c374045d.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.3691aec0.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.c2883070.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.bb92c86c.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.05a63ed7.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.3f42e962.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.3d385a0b.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.0b6f4401.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.f2310aae.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.6a7abbed.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.8dd2e53f.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.bf36afb3.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.99106e24.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.1f642fe4.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.75bf928e.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.e4ee636e.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.7bfa0f27.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.3cd85193.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.4653eac1.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.5baf68fb.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.67f51c74.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.46b3e9fe.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.072d0f77.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.64e84f7f.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.6aca8bc8.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.e628cefe.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.d5eb1b47.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.e063f731.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.d48d5aed.js"><link rel="prefetch" href="/android-note/assets/病毒.html.5c217cee.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.31f82ea1.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.ffc29463.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.fb6b9fb3.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.b0ad1ca1.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.24e72ac9.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.396f8926.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.6e7387ea.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.48ca2361.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.92583f07.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.b42b2b32.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.9735c882.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.b7572111.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.6aeb286a.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.4be18e44.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.1b6d8302.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.7072c065.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.28e1d009.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.562e3ff3.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.adf99661.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.701b6583.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.8e9c74db.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.a390a303.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.9316ab84.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.d24d23a1.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.f8555457.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.d207af8e.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.a69a3d66.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.48d0886d.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.5f2d4f42.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.39e89308.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.9b0ff02d.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.f7c14739.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.3d5cdd7a.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.522bbd31.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.79e59d3a.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.0c16f110.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.fe56a9af.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.d4f1aed1.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.20acb3b8.js"><link rel="prefetch" href="/android-note/assets/单链表.html.bf62db54.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.6deb38fc.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.b46be9ac.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.513c7a20.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.c4c4dcc3.js"><link rel="prefetch" href="/android-note/assets/死锁.html.99ba4a89.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.1b7c653d.js"><link rel="prefetch" href="/android-note/assets/算法.html.9d4e0aef.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.537ece5d.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.d6be503e.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.90a2793b.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.7d77fbc3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.b1be9fff.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.e19fc3f0.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.605ed319.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.a5a68958.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.011717f3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.ef802fd5.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.f1520e1f.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.3f7548ca.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.766c9e14.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.e37403f2.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.86d3c34a.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.8b7d82ae.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.14c41b41.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.7939bdd8.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.6e0ecf53.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.ee42d351.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.50780cae.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.6f55660e.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.45a2578f.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.8a6fec11.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.dc751b15.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.3b0d9330.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.9e48a859.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.1c2bdb90.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.967a0203.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.f37c7aff.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.0e2aaf0e.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.9fd639b3.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.55bd9526.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.2a20a491.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.f03f6006.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.baa87ac6.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.d2862232.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.5bef6c29.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.e75759f0.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.67635b46.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.b4b4741f.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.84ce4ed4.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.96115c87.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.37e80618.js"><link rel="prefetch" href="/android-note/assets/404.html.93146c89.js"><link rel="prefetch" href="/android-note/assets/index.html.a3b2c356.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.593d518f.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.1f126c97.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.a5ba8c6b.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.ca8b1ccd.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.d0272eba.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.187c5ed4.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.56b02a10.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.64aef548.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.164306fd.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.3f4b1857.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.22df54ee.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.649f129f.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.fa20e530.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.a1a10337.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.e761907d.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.48720165.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.be35e4a9.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.2ba5a7aa.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.58919723.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.6ddb95e6.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.fdf20e86.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.8e054392.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.414cb35a.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.13675508.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.d6d4b951.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.b98f8285.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.5346a958.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.1b23c403.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.48bf4f17.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.00c828d1.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.f1757cb9.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.8521978d.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.b1900bf7.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.b0686769.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.5283befd.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.c819f916.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.ff577025.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.5636ef45.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.ef8a6333.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.c749c345.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.44210aa0.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.31cc83ad.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.9dfecddb.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.acf1dc16.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.b863d19a.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.ccbe3768.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.d7a77f6f.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.e345b3a9.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.1c81b7f8.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.c35eb2fc.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.6c7ff613.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.3ae6b882.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.5ff8b11c.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.8bb54a97.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.a6164902.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.09ce9c48.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.665dba40.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.33108888.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.562c0f22.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.7e555978.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.a5b5dc81.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.6b1638d3.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.2b0db888.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.3988e4e5.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.a958fc42.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.e34bdbe5.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.6e540a45.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.d2d7c9b1.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.674d0b48.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.b6ce9885.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.f406015e.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.e717f114.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.f9420718.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.04da3193.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.12db7ee7.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.b25bda0f.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.9e008ea8.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.f34946bf.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.91e7515b.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.927862c8.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.89709d55.js"><link rel="prefetch" href="/android-note/assets/病毒.html.dfdf570b.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.08bb7427.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.0ae81f02.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.d3bf5ba6.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.958ad9fd.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.3d0fcc1c.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.091df93c.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.cb73d038.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.76947534.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.e776dd24.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.8c46b7ff.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.b9ca8c91.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.7b085d61.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.a597a6b0.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.152b4577.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.bbe32974.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.82c852a9.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.4d107d95.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.53598b60.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.235979e1.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.c14f1fd9.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.79c074c0.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.1e80f727.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.46ff5834.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.4f649ea3.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.1afb41c6.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.77fd44d2.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.f67e6cf2.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.87e02d9e.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.dcfdc432.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.924476e1.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.043d41ed.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.56507109.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.9b64eb77.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.7ea26885.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.182d318a.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.73b388a2.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.08ed1a50.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.02faa77d.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.ff9f67fa.js"><link rel="prefetch" href="/android-note/assets/单链表.html.816ccbf3.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.81be9d3a.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.5979ef3a.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.d3a34d4d.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.f871bc28.js"><link rel="prefetch" href="/android-note/assets/死锁.html.05fcf641.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.124be265.js"><link rel="prefetch" href="/android-note/assets/算法.html.a5d32479.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.0447b400.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.23d92421.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.1f70a7af.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.0aca5205.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.c64ac1eb.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.259d5746.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.2d7e84b0.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.f80d0190.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.cb3b0dd9.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.5eba2fc6.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.f95797de.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.af807638.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.af237da0.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.c7354991.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.2c386862.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.502b69b2.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.4cf1fc11.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.0d0ec937.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.1a5daf97.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.49cca9fa.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.6bf6b961.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.957f7aff.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.8e6935a4.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.db0f2341.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.28394ba6.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.e37f15c5.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.4900e197.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.d17a443e.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.6d4b95b6.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.7617b5a1.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.d8336de6.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.51987a1b.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.4040429e.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.fc34230c.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.8310dbe0.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.a609e06b.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.92fc9cbb.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.6f0bcff8.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.3d8a0779.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.88c6186b.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.2513ea33.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.d0778e46.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.bfc12cf1.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.45995d69.js"><link rel="prefetch" href="/android-note/assets/404.html.bf6755d7.js"><link rel="prefetch" href="/android-note/assets/404.0f84ac09.js"><link rel="prefetch" href="/android-note/assets/Layout.c5c30828.js">
    <link rel="stylesheet" href="/android-note/assets/style.1f7fd01d.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/android-note/" class=""><!----><span class="site-name">Android Notes</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">性能优化相关工具 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/android-note/Tools&amp;Library/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7.html#ddms-百宝箱" class="router-link-active router-link-exact-active sidebar-item" aria-label="DDMS(百宝箱)"><!--[--><!--]--> DDMS(百宝箱) <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/android-note/Tools&amp;Library/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7.html#systrace" class="router-link-active router-link-exact-active sidebar-item" aria-label="Systrace"><!--[--><!--]--> Systrace <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/android-note/Tools&amp;Library/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7.html#traceview" class="router-link-active router-link-exact-active sidebar-item" aria-label="Traceview"><!--[--><!--]--> Traceview <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/android-note/Tools&amp;Library/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7.html#monitors" class="router-link-active router-link-exact-active sidebar-item" aria-label="Monitors"><!--[--><!--]--> Monitors <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/android-note/Tools&amp;Library/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7.html#hierarchy-viewer" class="router-link-active router-link-exact-active sidebar-item" aria-label="Hierarchy Viewer"><!--[--><!--]--> Hierarchy Viewer <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/android-note/Tools&amp;Library/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7.html#过度绘制" class="router-link-active router-link-exact-active sidebar-item" aria-label="过度绘制"><!--[--><!--]--> 过度绘制 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/android-note/Tools&amp;Library/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E5%B7%A5%E5%85%B7.html#hardware-acceleration" class="router-link-active router-link-exact-active sidebar-item" aria-label="Hardware Acceleration"><!--[--><!--]--> Hardware Acceleration <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="性能优化相关工具" tabindex="-1"><a class="header-anchor" href="#性能优化相关工具" aria-hidden="true">#</a> 性能优化相关工具</h1><p>有关性能优化的文章请参考<a href="https://github.com/CharonChui/AndroidNote/blob/master/AdavancedPart/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96.md" title="性能优化" target="_blank" rel="noopener noreferrer">性能优化<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>和<a href="https://github.com/CharonChui/AndroidNote/blob/master/AdavancedPart/%E5%B8%83%E5%B1%80%E4%BC%98%E5%8C%96.md" title="布局优化" target="_blank" rel="noopener noreferrer">布局优化<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="ddms-百宝箱" tabindex="-1"><a class="header-anchor" href="#ddms-百宝箱" aria-hidden="true">#</a> DDMS(百宝箱)</h3><h5 id="查看进程的内存使用" tabindex="-1"><a class="header-anchor" href="#查看进程的内存使用" aria-hidden="true">#</a> 查看进程的内存使用</h5><p><code>DDMS</code>可以让你查看到一个进程使用的堆内存。</p><ol><li>在<code>Device</code>了表选择你想查看的进程。</li><li>点击<code>Update Heap</code>按钮来开启查看进程堆内存信息。</li><li>在<code>Heap</code>页面，点击<code>Cause GC</code>来执行垃圾回收。</li><li>在列表中点击一个对象类型来查看它所分配的内存大小。</li></ol><h5 id="追踪对象的内存分配情况" tabindex="-1"><a class="header-anchor" href="#追踪对象的内存分配情况" aria-hidden="true">#</a> 追踪对象的内存分配情况</h5><ol><li>在<code>Device</code>了表选择你想查看的进程。</li><li>在<code>Allocation Tracker</code>页面，点击<code>Start Tracking</code>按钮来开始追踪。</li><li>点击<code>Get Allocations</code>来查看从你点击<code>Start Tracking</code>之后分配内存的对象列表。 你可以再次点击<code>Get Allocations</code>来添加新分配内存的对象列表。</li><li>停止追踪或者清除数据可以点击<code>Stop Tracking</code>按钮。</li><li>在列表中单独点击一行来查看详细的信息。</li></ol><h5 id="使用文件系统" tabindex="-1"><a class="header-anchor" href="#使用文件系统" aria-hidden="true">#</a> 使用文件系统</h5><p><code>DDMS</code>提供了一个文件浏览器来供你查看、拷贝、删除文件。</p><ol><li>在<code>Device</code>页面，选中你想要查看的设备。</li><li>从设备中拷贝文件，用文件浏览器选择文件后点击<code>Pull file</code>按钮。</li><li>拷贝文件到设备中，点击<code>Push file</code>按钮。</li></ol><h5 id="检查线程信息" tabindex="-1"><a class="header-anchor" href="#检查线程信息" aria-hidden="true">#</a> 检查线程信息</h5><p><code>Thread</code>页面可以显示指定进程中当前正在运行的线程。</p><ol><li>在<code>Device</code>页面，选择想要查看的进程。</li><li>点击<code>Update Threads</code>按钮。</li><li>在<code>Thread</code>页面，你可以查看对应的线程信息。</li></ol><h5 id="启动方法分析" tabindex="-1"><a class="header-anchor" href="#启动方法分析" aria-hidden="true">#</a> 启动方法分析</h5><p>方法分析可以追踪一个方法的特定信息，例如调用数量，执行时间、耗时等。如果想要更精确的控制想要收集的数据，可以使用<code>startMethodTracing()</code>和<code>stopMethodTracing()</code>方法。</p><p>在你开始使用方法分析之前请知晓如下限制:</p><ul><li>在<code>Android 2.1</code>及以前的设备必须有<code>SD</code>卡，并且你的应用必须有写入<code>SD</code>卡的权限。</li><li>在<code>Android 2.2</code>及以后的设备中不需要<code>SD</code>卡，<code>trace log</code>文件会直接被导入到开发机上。</li></ul><p>开启方法分析:</p><ol><li>在<code>Device</code>页面，选择想要开启方法分析的进程。</li><li>点击<code>Start Method Profiling</code>按钮。</li><li>在<code>Android 4.4</code>及以后，可以选择<code>trace_based profiling</code>或者基本的<code>sample-based profiling</code>选项。在之前的版本智能使用<code>trace-based profiling</code>。</li><li>在应用中操作界面来执行你想要分析的方法。</li><li>点击<code>Stop Method Profiling</code>按钮。<code>DDMS</code>会停止分析并且将在<code>Start Method Profiling</code>和<code>Stop Method Profiling</code>中间手机的方法分析数据使用<code>Traceview</code>打开。</li></ol><h5 id="使用网络流量工具" tabindex="-1"><a class="header-anchor" href="#使用网络流量工具" aria-hidden="true">#</a> 使用网络流量工具</h5><p>从<code>Android 4.0</code>开始,<code>DDMS</code>包含了一个网络使用情况的页面来支持跟踪应用的网络请求。</p><p>如图:</p><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/ddms-network.png?raw=true" alt="image">。</p><p>通过检测数据交互的频繁性以及在每次连接中数据的传递量，你可以知道应用中具体可以做的更好更高效的地方。 想要更好的查看引起数据交互的地方，可以使用<code>TrafficsStats</code>这个<code>API</code>，它也可以使用<code>setThreadStatsTag()</code>方法来设置数据使用情况的<code>tag</code>，</p><p>首先要讲到的是<code>Systrace</code>，之前在淘宝面试的时候被问到，如有查找<code>UI</code>绘制卡顿的问题，我没答上来。早点知道<code>Systrace</code>就好了(当然只知道工具是不够的，也要懂得里面的原理)。</p><h3 id="systrace" tabindex="-1"><a class="header-anchor" href="#systrace" aria-hidden="true">#</a> Systrace</h3><p><code>Systrace</code>有什么用呢？官方文档中有一片文章的标题是：使用<code>Systrace</code>进行<code>UI</code>性能分析。</p><p>在应用程序开发的过程中，你需要检查用户交互是否平滑流畅，运行在稳定的60fps。如果中间出了些问题，导致某一帧延迟，我们想要解决该问题的第一步就是理解系统如何操作的。</p><p><code>Systrace</code>工具可以让你来手机和观察整个<code>android</code>设备的时间信息，也称为<code>trace</code>。它会显示每个时间点上的<code>CPU</code>消耗图，显示每个线程在显示的内容以及每个进程当时在做的操作。</p><p>在使用<code>Systracv</code>来分析应用之前，你需要手机应用的<code>trace log</code>信息。生成的<code>trace</code>能够让你清晰的观察系统在该时间内所做的任何事情。</p><h5 id="生成trace" tabindex="-1"><a class="header-anchor" href="#生成trace" aria-hidden="true">#</a> 生成Trace</h5><p>为了能创建一个<code>trace</code>，你必须要执行如下几个操作。 首先，你要有一个<code>Android 4.1</code>及以上的设备。将该设备设置为<code>debugging</code>，连接你的设备并且安装应用。有些类型的信息，特别是一些硬盘的活动和内核工作队列，需要设备获取<code>root</code>权限才可以。 然而，大多数的<code>Systrace log</code>的数据只需要设备开启开发者<code>debugging</code>就可以了。</p><p><code>Systrace</code>可以通过命令行或者图形化界面的方式来运行，在<code>Studio</code>中打开<code>Android Device Monitor</code>然后选择<code>Systracv</code>图标<img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/systrace-button.png?raw=true" alt="image">。</p><p>下面以命令行的方式为例，这里只讲解一下<code>Android 4.3</code>及以上的使用方式:</p><ul><li>确保设备已经通过<code>USB</code>连接并且开启了<code>debugging</code>模式。</li><li>设置一些参数并执行<code>trace</code>命令，例如:<div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>$ cd android-sdk/platform-tools/systrace
$ python systrace.py --time=10 -o mynewtrace.html sched gfx view wm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div>执行完上面的命令后就会在<code>sdk/platform-tools/systrace/mynewtrace.html</code>生成对应的<code>html</code>文件。</li><li>在设备上执行一些你想要<code>trace</code>的过程。</li></ul><p>悲剧了，生成了对应的<code>html</code>文件，但是我死活打不开。打开是白屏，折腾了我半天，最后终于找到了解决方法:</p><blockquote><p>Firstly, if anyone is using Chrome v50.0+ on OS X, just try this please.</p></blockquote><blockquote><p>open chrome browser and go to &quot;chrome://tracing&quot; in the tracing page, click load and select the systrace generated html file. Secondly, I think it&#39;s a bug which is confirmed by Google.</p></blockquote><p><code>OK</code>了。</p><p>![image](https://raw.githubusercontent.com/CharonChui/Pictures/master/systrace_file.png?raw=true =)。</p><p>看不懂！！！</p><h5 id="分析trace" tabindex="-1"><a class="header-anchor" href="#分析trace" aria-hidden="true">#</a> 分析Trace</h5><p>用浏览器打开上面生成的<code>mynewtrace.html</code>。 下面为了能明显的说明，我就用官网提供的例子来说明了。</p><h6 id="查看frames" tabindex="-1"><a class="header-anchor" href="#查看frames" aria-hidden="true">#</a> 查看Frames</h6><p>从打开的文件中我们能看到每个应用都有一行<code>frame</code>的圆圈来标示渲染的帧，通常都是绿色的。黄色或者红的圆圈标示超过了我们对保障60fps所需的16毫秒绘制时间。。 可以在文件上面按<code>w</code>键来放大文件以便能更好的观看查找。</p><blockquote><p>***提示:***在文件上面按<code>?</code>键可以查看对应的快捷键。</p></blockquote><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/frame-unselected.png?raw=true" alt="image">。</p><p>在<code>Android 5.0</code>以上的设备上，显示工作呗分为<code>UI Thread</code>和<code>Render Thread</code>。在之前的版本，所有工作都是在<code>UI Thread</code>进行的。 点击某个单独的<code>frame</code>图标来查看它们所需的时间。</p><h6 id="观看alerts" tabindex="-1"><a class="header-anchor" href="#观看alerts" aria-hidden="true">#</a> 观看Alerts</h6><p><code>Systracv</code>会自动分析<code>trace</code>过程的时间，并且通过<code>alerts</code>提示该展现问题，以及建议如何处理。</p><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/frame-selected.png?raw=true" alt="image"></p><p>如上图所示，在你点击一个比较慢的<code>frame</code>时，下面就会显示一个<code>alert</code>。在这种情况下，它直说可能是<code>ListView</code>服用以及重复渲染的问题。 如果你发现<code>UI Thread</code>做了太多的工作，你可以使用<code>TraceView</code>进行代码分析，来找到具体哪些操作导致了消耗时间。</p><p>如下，你也可以通过点击窗口右边的<code>Alerts</code>来查看当前所有的<code>alert</code>。这样会直接展开<code>Alert</code>窗口。</p><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/frame-selected-alert-tab.png?raw=true" alt="image"></p><p>下面我们以另外一个例子来分析一下它的<code>Frame</code>：</p><p>我们点击某一红色<code>frame</code>来查看这一阵的一些相关警告:<br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/systrace-frame-zoomin.png?raw=true" alt="image"> 可以看到这里说耗时32毫秒，这已经远远超过了16毫秒的绘制时间。 我们可以通过<code>Description</code>来查看描述内容。<br> 下面是另外一个渲染过慢的例子:</p><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/systrace-2-frame.png?raw=true" alt="image"> 从上图，我们发现了<code>Scheduling delay</code>的警告，加起来能看到总的绘制时间大约是19毫秒。<br><code>Scheduling delay</code>的意思是调度延迟，也就是说一个县城在处理这部分操作时，在很长时间内没有被分配到<code>CPU</code>上面进行运算，这样就导致了很长时间内没有完成操作。 我们选择这一帧中最长的一块，来观察下:<br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/systrace-2-slice.png?raw=true" alt="image"></p><p>我们在上图看到了<code>Wall duration</code>，他代表着这一块开始到结束的总耗时。而在<code>CPU Duration</code>这里显示了<code>CPU</code>在处理该部分消耗的时间。 很明显，真个区域用了18毫秒，但是<code>CPU</code>实际处理只用了4毫秒，也就是说剩下的14毫秒就可能有问题了。<br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/systrace-2-cpu.png?raw=true" alt="image"></p><p>可以看到，4个线程都比较忙。</p><p>选择其中一个线程来查看是哪个应用在使用它，这里看到了一个包名为<code>com.udinic.keepbusyapp</code>的应用。也就是说由于另外一个应用占用了<code>CPU</code>,，导致了我们的应用未能获取到足够的<code>CPU</code>资源。</p><h5 id="追踪代码" tabindex="-1"><a class="header-anchor" href="#追踪代码" aria-hidden="true">#</a> 追踪代码</h5><p>在<code>Android 4.3</code>以上你可以使用<code>Trace</code>类来在代码中添加(很熟悉有木有，在看源码的时候经常看到)。这样能查看到此时你的应用线程都做了哪些操作。 下面的代码展示了如何使用<code>Trace</code>类来追踪两个代码块部分:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">ProcessPeople</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Trace</span><span class="token punctuation">.</span><span class="token function">beginSection</span><span class="token punctuation">(</span><span class="token string">&quot;ProcessPeople&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">Trace</span><span class="token punctuation">.</span><span class="token function">beginSection</span><span class="token punctuation">(</span><span class="token string">&quot;Processing Jane&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// code for Jane task...</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token class-name">Trace</span><span class="token punctuation">.</span><span class="token function">endSection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ends &quot;Processing Jane&quot;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Trace</span><span class="token punctuation">.</span><span class="token function">beginSection</span><span class="token punctuation">(</span><span class="token string">&quot;Processing John&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// code for John task...</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token class-name">Trace</span><span class="token punctuation">.</span><span class="token function">endSection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ends &quot;Processing John&quot;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token class-name">Trace</span><span class="token punctuation">.</span><span class="token function">endSection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ends &quot;ProcessPeople&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="traceview" tabindex="-1"><a class="header-anchor" href="#traceview" aria-hidden="true">#</a> Traceview</h3><p><code>Traceview</code>是一个性能测试工具，展示了所有方法的运行时间。</p><blockquote><p>Traceview is a graphical viewer for execution logs that you create by using the Debug class to log tracing information in your code. Traceview can help you debug your application and profile its performance.</p></blockquote><h5 id="创建trace文件" tabindex="-1"><a class="header-anchor" href="#创建trace文件" aria-hidden="true">#</a> 创建Trace文件</h5><p>想要使用<code>Traceview</code>你需要创建一个包含你想分析部分的<code>trace</code>信息的<code>log</code>文件。 有两种方式来生成<code>trace logs</code>：</p><ul><li><p>在你测试的类中添加<code>startMethodTracing()</code>和<code>stopMethodTracing()</code>的代码，来指定开始和结束获取<code>trace</code>信息。这种方式是非常精确的，因为你可以在代码中指定开始和结束的位置。</p></li><li><p>使用<code>DDMS</code>中的方法来生成。这种方式就不太精确。虽然这种方式不能精确的指定起始和结束位置，但是如果在你无法修改源代码或者不需要精确时间的时候是非常有用的。</p></li></ul><p>在开始生成<code>trace log</code>信息时，你需要知道如下的限制条件:</p><ul><li><p>如果你在测试代码中使用，你的应用必须要用<code>WRITE_EXTERNAL_STORAGE</code>的权限。</p></li><li><p>如果你使用<code>DDMS</code>生成:</p><ul><li><code>Android 2.1</code>之前必须有<code>SD</code>卡，并且你的应用也要有写入<code>SD</code>卡的权限。</li><li><code>Android 2.2</code>之后不需要<code>SD</code>卡，<code>trace log</code>文件会直接生成到你的开发机上。</li></ul></li></ul><p>在测试代码中调用<code>startMethodTracing()</code>方法的时候，你可以指定系统生成<code>trace</code>文件的名字。结束的时候调用<code>stopMethodTracing()</code>方法。这些方法开始和结束时贯穿整个虚拟中的。例如你可以在你<code>activity</code>的<code>onCreate()</code>方法中调用<code>startMethodTracing()</code>方法，然后在<code>activity</code>的<code>onDestroy()</code>方法中调用<code>stopMethodTracing()</code>方法。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token comment">// start tracing to &quot;/sdcard/calc.trace&quot;</span>
    <span class="token class-name">Debug</span><span class="token punctuation">.</span><span class="token function">startMethodTracing</span><span class="token punctuation">(</span><span class="token string">&quot;calc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
    <span class="token comment">// stop tracing</span>
    <span class="token class-name">Debug</span><span class="token punctuation">.</span><span class="token function">stopMethodTracing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在调用<code>startMethodTracing()</code>方法的时候，系统创建一个名为<code>&lt;trace-base-name&gt;.trace</code>的文件。它包含方法的二进制<code>trace</code>数据和一个线程与方法名的对应集合。<br> 然后系统就开始生成<code>trace</code>数据，直到调用<code>stopMethodTracing()</code>方法。如果在你调用<code>stopMethodTracing()</code>方法之前系统已经达到了最大的缓冲大小，系统就会停止<code>trace</code>并且在控制台发出一个通知。</p><h5 id="拷贝trace文件到电脑上" tabindex="-1"><a class="header-anchor" href="#拷贝trace文件到电脑上" aria-hidden="true">#</a> 拷贝Trace文件到电脑上</h5><p>在模拟器或者机器上生成<code>&lt;trace-base-name&gt;.trace</code>文件后，你需要拷贝他们到你的电脑上，你可以使用<code>adb pull</code>命令来拷贝：<br><code>adb pull /sdcard/calc.trace /tmp</code></p><h5 id="在traceview中查看trace文件" tabindex="-1"><a class="header-anchor" href="#在traceview中查看trace文件" aria-hidden="true">#</a> 在Traceview中查看trace文件</h5><p>运行<code>Traceview</code>并且查看<code>trace</code>文件:</p><ol><li>打开<code>Android Device Monitor</code>。</li><li>在<code>Android Device Monitor</code>的状态栏中点击<code>DDMS</code>并且选择一个进程。</li><li>点击<code>Start Method Profiling</code>图标开始查看。</li><li>在查看完后点击<code>Stop Method Profiling</code>图标来显示<code>traceview</code>。</li></ol><p>大体的样子如下:</p><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/traceview_1.png?raw=true" alt="image"></p><h5 id="traceview-layout" tabindex="-1"><a class="header-anchor" href="#traceview-layout" aria-hidden="true">#</a> Traceview Layout</h5><p>如果你有一个<code>trace log</code>文件(通过添加<code>tracing</code>代码或者用DDMS生成)，你可以把该文件加载到<code>Traceview</code>中，这将会把<code>log</code>数据显示为两部分:</p><ul><li><code>timeline panel</code>-展示了每个线程和方法的起始和结束</li><li><code>profile panel</code>-提供了一个方法中的执行内容的简述</li></ul><h5 id="timeline-panel" tabindex="-1"><a class="header-anchor" href="#timeline-panel" aria-hidden="true">#</a> Timeline Panel</h5><p>每个线程都会以时间从左往右递增的方式在单独的一行中显示它的执行情况，</p><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/traceview_timeline.png?raw=true" alt="image"></p><h5 id="profile-panel" tabindex="-1"><a class="header-anchor" href="#profile-panel" aria-hidden="true">#</a> Profile Panel</h5><p>显示了一个方法所消耗的时间的概要情况。在表格中会同时显示<code>inclusive</code>和<code>exclusive</code>的时间。<code>Exclusive</code>的时间是该方法所消耗的时间。<code>InClusive</code>的时间是该方法消耗的时间加上任何调的方法所消耗的时间。我们简单的将调用的方法叫做<code>parents</code>，被调用的方法叫做<code>children</code>。如果一个方法被调用，它会显示对应的<code>parents</code>和<code>children</code>。<code>parents</code>会显示一个紫色的背景，<code>children</code>会显示一个黄色的背景。最后一列显示了该方法所调用的总数的调用数。在下面的图中我们能看到一共有14个地方调用了<code>LoadListener.nativeFinished()</code> .</p><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/traceview_profile.png?raw=true" alt="image"></p><ul><li>Name 方法名</li><li>Inclusive CPU Time， CPU在处理该方法以及所有子方法(被它调用的所有方法)所消耗的时间。</li><li>Exlusive CPU Time, CPU在处理该方法的耗时。</li><li>Inclusive/Exclusive Real Time， 从方法开始执行到执行结束的耗时。</li><li>Cal+Rec, 这个方法被调用的次数，以及递归被调用的次数。</li><li>CPU/Real time per Call, 在处理这个方法时的<code>CPU</code>耗时的平均值。</li></ul><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/traceview-getview.png?raw=true" alt="image"></p><p>上图中<code>getView</code>方法被调用了12次，每次<code>CPU</code>消耗2.8秒，但是每次调用的总耗时是162秒，这里肯定有问题。 而看看这个方法的children，我们可以看到这其中的每个方法在耗时方面是如何分布的。Thread.join()方法战局了98%的inclusive real time。这个方法在等待另一个线程结束的时候被调用。在Children中另外一个方法就是Tread.start()方法，而之所以整个方法耗时很长，我猜测是因为在getView()方法中启动了线程并且在等待它的结束。</p><p>但是这个线程在哪儿？</p><p>我们在getView()方法中并不能看到这个线程做了什么，因为这段逻辑不在getView()方法之中。于是我找到了Thread.run()方法，就是在线程被创建出来时候所运行的方法。而跟随这个方法一路向下，我找到了问题的元凶。</p><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/traceview-thread.png?raw=true" alt="image"></p><p>我发现了BgService.doWork()方法的每次调用花费了将近14毫秒，并且有四十个这东西！而且getView()中还有可能调用多次这个方法，这就解释了为什么getView()方法执行时间如此之长。这个方法让CPU长时间的保持在了繁忙状态。而看看Exclusive CPU time，我们可以看到他占据了80%的CPU时间！此外，根据Exclusive CPU time排序，可以帮我们更好的定位那些耗时很长的方法，而他们很有可能就是造成性能问题的罪魁祸首。</p><p>关注这些耗时方法，例如getView()，View#onDraw()等方法，可以很好的帮助我们寻找为什么应用运行缓慢的原因。但有些时候，还会有一些其他的东西来占用宝贵的CPU资源，而这些资源如果被运用在UI的绘制上，也许我们的应用会更加流畅。Garbage Collector垃圾回收机制会不时的运行，回收那些没用的对象，通常来讲这不会影响我们在前台运行的程序。但如果GC被运行的过于频繁，他同样可以影响我们应用的执行效率。而我们该如何知道回收的是否过于频繁了呢…</p><h3 id="monitors" tabindex="-1"><a class="header-anchor" href="#monitors" aria-hidden="true">#</a> Monitors</h3><p>在<code>Android Studio</code>中下方的<code>Android Monitor</code>中可以看到<code>Monitors</code>工具栏，它能不断的去检测内存、网络、CPU的消耗情况。</p><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/monitor.png?raw=true" alt="image"></p><p>我们可以直接点击<code>Dump Java Heap</code>或者<code>Call GC</code>等按钮，以便更好的去观察内存的使用情况。点击后会生成一个<code>.hprof</code>的文件。生成后直接使用<code>Studio</code>打开<code>.hprof</code>文件即可。</p><p>说到这里插一嘴,<a href="https://github.com/CharonChui/AndroidNote/blob/master/JavaKnowledge/JVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6.md" title="有关Java垃圾回收机制请参考" target="_blank" rel="noopener noreferrer">有关Java垃圾回收机制请参考<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/dump_href.png?raw=true" alt="image"> 在左边能看到所有堆内存中的实例。后面会显示他所占用的内存大小。</p><p>对于内存泄漏的分析可以使用<code>MAT</code>或者<code>LeakCanary</code>来进行。这里就不仔细说了。</p><h5 id="不同虚拟机的内存管理" tabindex="-1"><a class="header-anchor" href="#不同虚拟机的内存管理" aria-hidden="true">#</a> 不同虚拟机的内存管理</h5><p><code>Android Monitor</code>使用的<code>Virtual Machine(VM)</code>:</p><ul><li><code>Android 4.3(API Level 18)</code>及以前的版本使用<code>Dalvik VM</code> .</li><li><code>Android 4.4(API Level 19)</code>默认使用<code>Dalvik VM</code>，<code>Android RunTime(ART)</code>是可选的。</li><li><code>Android 4.3(API Level 18)</code>及更高的版本使用<code>ART VM</code>.</li></ul><p>虚拟之执行垃圾回收。Dalvik虚拟机使用一个标记和清除垃圾收集方案。<code>ART</code>虚拟机使用分代收集算法与标记和清楚手机算法相结合的方式。 <code>Logcat</code>会显示一些垃圾回收相关的信息。</p><h5 id="gpu使用情况" tabindex="-1"><a class="header-anchor" href="#gpu使用情况" aria-hidden="true">#</a> GPU使用情况</h5><p>上面也显示了<code>GPU</code>的使用情况，这里要说一句，如果想要显示它，必须要在手机的开发者中心中开启<code>GPU显示配置文件</code>选项，将其设置为显示与<code>adb shell dumpsys gfxinfo</code>。然后再点击<code>Studio</code>中的按钮重新开始就可以看到了。 每一条线意味着一帧被绘制出来了。而线的颜色又代表不同的阶段：</p><ul><li><p>Draw(蓝色)代表着<code>View.onDraw()</code>方法。如果这个值很高就说明可能是该<code>View</code>比较复杂。 在这个环节会创建/刷新DisplayList中的对象，这些对象在后面会被转换成GPU可以明白的OpenGL命令。而这个值比较高可能是因为view比较复杂，需要更多的时间去创建他们的display list，或者是因为有太多的view在很短的时间内被创建。</p></li><li><p>Prepare(紫色)，从<code>Android 6.0</code>开始，一个新的线程被引进来帮助<code>UI</code>线程进行绘制。 这个线程叫做<code>Render Thread</code>。它负责转换它负责转换display list到OpenGL命令并且送至GPU。在这过程中，UI线程可以继续开始处理后面的帧。而在UI线程将所有资源传递给RenderThread过程中所消耗的时间，就是紫色阶段所消耗的时间。如果在这过程中有很多的资源都要进行传递，display list会变得过多过于沉重，从而导致在这一阶段过长的耗时。</p></li><li><p>Process(红色) 执行Display list中的内容并创建OpenGL命令。如果有过多或者过于复杂的display list需要执行的话，那么这阶段会消耗较长的时间，因为这样的话会有很多的view被重绘。而重绘往往发生在界面的刷新或是被移动出了被覆盖的区域。</p></li><li><p>Execute (黄色) – 发送OpenGL命令到GPU。这个阶段是一个阻塞调用，因为CPU在这里只会发送一个含有一些OpenGL命令的缓冲区给GPU，并且等待GPU返回空的缓冲区以便再次传递下一帧的OpenGL命令。而这些缓冲区的总量是一定的，如果GPU太过于繁忙，那么CPU则会去等待下一个空缓冲区。所以，如果我们看到这一阶段耗时比较长，那可能是因为GPU过于繁忙的绘制UI，而造成这个的原因则可能是在短时间内绘制了过于复杂的view。</p></li><li><p>Measure/Layout(绿色) 代表<code>Measure</code>和<code>Layout</code>的时间。</p></li></ul><h3 id="hierarchy-viewer" tabindex="-1"><a class="header-anchor" href="#hierarchy-viewer" aria-hidden="true">#</a> Hierarchy Viewer</h3><p>布局分析工具，非常常用。</p><p>在<code>Android Device Monitor</code>中打开<code>Hierarchy Viewer</code>即可。</p><ul><li>连接你的手机或者模拟器。 出于安全性考虑，<code>Hierarchy Viewer</code>只能连接开发者版的系统的手机。</li><li>运行程序，并且让界面显示出来。</li><li>启动<code>hierarchy view</code>工具，接着就能看到左边栏显示出了对应的设备，展开后可以看到一些组件的名称。这个页面包含了应用的界面以及系统的界面。选择你的应用中想要查看的界面直接双击就可以了。</li></ul><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/gettingstarted_image005.png?raw=true" alt="image"> 如果你的界面显示的不是这个样子，少一些东西的话，你可以使用<code>Window&gt;Reset Perspective</code>来重置样式。</p><p>但是我并打不开。<br> 如果你的手机是<code>Android 4.1</code>及以上版本你必须要在你的电脑上设置一个<code>ANDROID_HVPROTO</code>DE 环境变量才可以。</p><ul><li>Windows 增加一个名为<code>ANDROID_HVPROTO</code>值为<code>ddm</code>的环境变量就可以了。</li><li>Mac <ul><li>打开<code>.bash_profile</code><ul><li><code>touch .bash_profile</code>创建</li><li><code>open -e .bash_profile</code>打开</li></ul></li><li>添加<div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>#<span class="token class-name">Hierarchy</span> <span class="token class-name">Viewer</span> <span class="token class-name">Variable</span>              
export ANDROID_HVPROTO<span class="token operator">=</span>ddm
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><code>source .bash_profile</code></li></ul></li></ul><p>如果配置完成后仍然不能用的话，你可以:</p><ul><li>关闭<code>Android Studio</code>.</li><li>执行<code>add kill-server</code>，然后<code>adb start-server</code>.</li><li>通过命令行开始<code>hierarchyviewer</code>.</li></ul><p>好了，我们直接打开自己的页面进行查看布局吧(有点慢)。<br> 它是介个样子滴 ：<br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/hierarchy_vierwe_page.png?raw=true" alt="image"></p><p>我们可以看到所有结构，点击对一个的节点，能直接看到该界面的<code>UI</code>效果，并展示该布局包含多少个<code>View</code>，以及该布局<code>measure,draw,layout</code>所消耗的时间。选中<code>Show Extras</code>选项可以看到在右下角看到界面效果。</p><p>选中要查看的节点后点击<code>Profile Node</code>选项，可以看到如下界面:</p><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/hierarchy_profile_node.png?raw=true" alt="image"></p><p>可以看到每个布局都出现了三个点。有不同的颜色,从左到右这三个点分别表示:</p><ul><li>左边的点代表<code>Draw</code>阶段。</li><li>中间的点代表了<code>Layout</code>阶段。</li><li>右边的点代表了<code>Execute</code>阶段。</li></ul><p>这三个点有分别对应了<code>pipeline</code>中的不同阶段，如下图:<br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/gettingstarted_image015.png?raw=true" alt="image"></p><p>不同的颜色代表不同的性能:</p><ul><li>绿色代表渲染的非常快，至少是其他<code>View</code>的一半。</li><li>黄色代表<code>View</code>渲染比最后那一半的<code>View</code>快。</li><li>红色代表<code>View</code>渲染是几乎是在最慢的那部分中间。</li></ul><p><code>Hierarchy Viewer</code>测量的是相对的表现能力，所以总会有一个红色的节点，它并不意味者该<code>View</code>一定是绘制的太慢。</p><h3 id="过度绘制" tabindex="-1"><a class="header-anchor" href="#过度绘制" aria-hidden="true">#</a> 过度绘制</h3><p>在开发者选项中将调试GPU过度绘制设置为显示过度绘制区域，就能看到程序的绘制情况。<br> 过度绘制往往发生在我们需要在一个东西上面绘制另外一个东西，例如在一个红色的背景上画一个黄色的按钮。那么GPU就需要先画出红色背景，再在他上面绘制黄色按钮，此时过度绘制就是不可避免的了。如果我们有太多层需要绘制，那么则会过度的占用GPU导致我们每帧消耗的时间超过16毫秒。 这些过度绘制可能发生在我们给Activity或Fragment设置了全屏的背景，同时又给ListView以及ListView的条目设置了背景色。而通过只设置一次背景色即可解决这样的问题。</p><p>注意：默认的主题会为你指定一个默认的全屏背景色，如果你的activity又一个不透平的背景盖住了默认的背景色，那么你可以移除主题默认的背景色，这样也会移除一层的过度绘制。这可以通过配置主题配置或是通过代码的方法，在onCreate()方法中调用getWindow().setBackgroundDrawable(null)方法来实现。 <img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/overdraw-gif.gif?raw=true" alt="image"></p><h3 id="hardware-acceleration" tabindex="-1"><a class="header-anchor" href="#hardware-acceleration" aria-hidden="true">#</a> Hardware Acceleration</h3><p>在Honeycomb版本中引入了硬件加速（Hardware Accleration）后，我们的应用在绘制的时候就有了全新的绘制模型。它引入了DisplayList结构，用来记录View的绘制命令，以便更快的进行渲染。但还有一些很好的功能开发者们往往会忽略或者使用不当——View layers。</p><p>使用View layers（硬件层），我们可以将view渲染入一个非屏幕区域缓冲区（off-screen buffer，前面透明度部分提到过），并且根据我们的需求来操控它。这个功能主要是针对动画，因为它能让复杂的动画效果更加的流畅。而不使用硬件层的话，View会在动画属性（例如coordinate, scale, alpha值等）改变之后进行一次刷新。而对于相对复杂的view，这一次刷新又会连带它所有的子view进行刷新，并各自重新绘制，相当的耗费性能。使用View layers，通过调用硬件层，GPU直接为我们的view创建一个结构，并且不会造成view的刷新。而我们可以在避免刷新的情况下对这个结构进行进行很多种的操作，例如x/y位置变换，旋转，透明度等等。总之，这意味着我们可以对一个让一个复杂view执行动画的同时，又不会刷新！这会让动画看起来更加的流畅。 在阅读了ViewPager的源码后，我发现了在滑动的时候会自动为左右两页启动一个硬件层，并且在滑动结束后移除掉。</p><p>在两页间滑动的时候创建硬件层也是可以理解的，但对我来说小有不幸。通常来讲加入硬件层是为了让ViewPager的滑动更加流畅，毕竟它们相对复杂。</p><p>是的，但是再使用硬件layers的时候还是有几点要牢记在心：</p><ul><li>回收 – 硬件层会占用GPU中的一块内存。只在必要的时候使用他们，比如动画，并且事后注意回收。例如在上面ObjectAnimator的例子中，我们增加了一个动画结束监听以便在动画结束后可以移除硬件层。而在Property animator的例子中，我们使用了withLayers()，这会在动画开始时候自动创建硬件层并且在结束的时候自动移除。</li><li>如果你在调用了硬件View layers后改变了View，那么会造成硬件硬件层的刷新并且再次重头渲染一遍view到非屏幕区域缓存中。这种情况通常发生在我们使用了硬件层暂时还不支持的属性（目前为止，硬件层只针对以下几种属性做了优化：otation、scale、x/y、translation、pivot和alpha）。例如，如果你另一个view执行动画，并且使用硬件层，在屏幕滑动他们的同时改变他的背景颜色，这就会造成硬件层的持续刷新。而以硬件层的持续刷新所造成的性能消耗来说，可能让它在这里的使用变得并不那么值。</li></ul><p>有关如何使用<code>Hardware Layer</code>请参考之前写的文章:<a href="https://github.com/CharonChui/AndroidNote/blob/master/AdavancedPart/%E9%80%9A%E8%BF%87Hardware%20Layer%E6%8F%90%E9%AB%98%E5%8A%A8%E7%94%BB%E6%80%A7%E8%83%BD.md" title="通过Hardware Layer提高动画性能" target="_blank" rel="noopener noreferrer">通过Hardware Layer提高动画性能<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><hr><ul><li>邮箱 ：charon.chui@gmail.com</li><li>Good Luck!</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 335891510@qq.com">Jungle68</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/android-note/assets/app.e2a3b496.js" defer></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.47">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Android WebRTC简介 | Android Notes</title><meta name="description" content="一个 Android 技术记录文档">
    <link rel="modulepreload" href="/android-note/assets/app.e2a3b496.js"><link rel="modulepreload" href="/android-note/assets/Android WebRTC简介.html.51987a1b.js"><link rel="modulepreload" href="/android-note/assets/Android WebRTC简介.html.9fd639b3.js"><link rel="prefetch" href="/android-note/assets/index.html.fff2aa76.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.261ddca4.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.518850bc.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.d9910bec.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.dff63630.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.f29a403a.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.dc69d7fd.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.7be45349.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.d78f651d.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.a07e9d8a.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.75fdf471.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.7e81f1f2.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.103e5176.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.6e607fde.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.29df35d8.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.6014594b.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.2a53d290.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.d19ee784.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.43ec2966.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.0afb9bec.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.7b3bfc5f.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.b99bf27c.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.c8895c23.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.3fdb02c5.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.f0becde3.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.8ca1aed1.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.eb73aa59.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.6799221d.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.9f737361.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.eab7452f.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.82e665f3.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.659d7444.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.26e47455.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.cbf93a65.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.7c42765a.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.696ea85d.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.ae3ef80a.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.186ba84a.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.0a30a4bc.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.161eb2a1.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.42e7fa9a.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.02a55fca.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.025745a3.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.9e95d7d7.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.1d87d268.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.3e311c7b.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.1396114e.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.0b924706.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.1b6d020f.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.da94471c.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.4322b77a.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.a580533a.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.0d501025.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.c374045d.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.3691aec0.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.c2883070.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.bb92c86c.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.05a63ed7.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.3f42e962.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.3d385a0b.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.0b6f4401.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.f2310aae.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.6a7abbed.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.8dd2e53f.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.bf36afb3.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.99106e24.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.1f642fe4.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.75bf928e.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.e4ee636e.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.7bfa0f27.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.3cd85193.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.4653eac1.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.5baf68fb.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.67f51c74.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.46b3e9fe.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.072d0f77.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.64e84f7f.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.6aca8bc8.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.e628cefe.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.d5eb1b47.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.e063f731.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.d48d5aed.js"><link rel="prefetch" href="/android-note/assets/病毒.html.5c217cee.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.31f82ea1.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.ffc29463.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.fb6b9fb3.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.b0ad1ca1.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.24e72ac9.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.396f8926.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.6e7387ea.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.48ca2361.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.92583f07.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.b42b2b32.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.9735c882.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.b7572111.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.6aeb286a.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.4be18e44.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.1b6d8302.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.7072c065.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.28e1d009.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.562e3ff3.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.adf99661.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.701b6583.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.8e9c74db.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.a390a303.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.9316ab84.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.d24d23a1.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.f8555457.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.d207af8e.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.a69a3d66.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.48d0886d.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.5f2d4f42.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.39e89308.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.9b0ff02d.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.f7c14739.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.3d5cdd7a.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.522bbd31.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.79e59d3a.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.0c16f110.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.fe56a9af.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.d4f1aed1.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.20acb3b8.js"><link rel="prefetch" href="/android-note/assets/单链表.html.bf62db54.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.6deb38fc.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.b46be9ac.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.513c7a20.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.c4c4dcc3.js"><link rel="prefetch" href="/android-note/assets/死锁.html.99ba4a89.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.1b7c653d.js"><link rel="prefetch" href="/android-note/assets/算法.html.9d4e0aef.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.537ece5d.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.d6be503e.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.90a2793b.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.7d77fbc3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.b1be9fff.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.e19fc3f0.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.605ed319.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.a5a68958.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.011717f3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.ef802fd5.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.f1520e1f.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.3f7548ca.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.766c9e14.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.e37403f2.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.86d3c34a.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.8b7d82ae.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.14c41b41.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.7939bdd8.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.6e0ecf53.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.ee42d351.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.50780cae.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.6f55660e.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.45a2578f.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.8a6fec11.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.dc751b15.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.3b0d9330.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.9e48a859.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.1c2bdb90.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.967a0203.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.f37c7aff.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.49b62c31.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.0e2aaf0e.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.55bd9526.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.2a20a491.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.f03f6006.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.baa87ac6.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.d2862232.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.5bef6c29.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.e75759f0.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.67635b46.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.b4b4741f.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.84ce4ed4.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.96115c87.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.37e80618.js"><link rel="prefetch" href="/android-note/assets/404.html.93146c89.js"><link rel="prefetch" href="/android-note/assets/index.html.a3b2c356.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.593d518f.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.1f126c97.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.a5ba8c6b.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.ca8b1ccd.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.d0272eba.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.187c5ed4.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.56b02a10.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.64aef548.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.164306fd.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.3f4b1857.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.22df54ee.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.649f129f.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.fa20e530.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.a1a10337.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.e761907d.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.48720165.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.be35e4a9.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.2ba5a7aa.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.58919723.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.6ddb95e6.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.fdf20e86.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.8e054392.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.414cb35a.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.13675508.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.d6d4b951.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.b98f8285.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.5346a958.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.1b23c403.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.48bf4f17.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.00c828d1.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.f1757cb9.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.8521978d.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.b1900bf7.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.b0686769.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.5283befd.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.c819f916.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.ff577025.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.5636ef45.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.ef8a6333.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.c749c345.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.44210aa0.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.31cc83ad.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.9dfecddb.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.acf1dc16.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.b863d19a.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.ccbe3768.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.d7a77f6f.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.e345b3a9.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.1c81b7f8.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.c35eb2fc.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.6c7ff613.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.3ae6b882.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.5ff8b11c.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.8bb54a97.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.a6164902.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.09ce9c48.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.665dba40.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.33108888.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.562c0f22.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.7e555978.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.a5b5dc81.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.6b1638d3.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.2b0db888.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.3988e4e5.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.a958fc42.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.e34bdbe5.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.6e540a45.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.d2d7c9b1.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.674d0b48.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.b6ce9885.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.f406015e.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.e717f114.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.f9420718.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.04da3193.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.12db7ee7.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.b25bda0f.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.9e008ea8.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.f34946bf.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.91e7515b.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.927862c8.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.89709d55.js"><link rel="prefetch" href="/android-note/assets/病毒.html.dfdf570b.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.08bb7427.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.0ae81f02.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.d3bf5ba6.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.958ad9fd.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.3d0fcc1c.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.091df93c.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.cb73d038.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.76947534.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.e776dd24.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.8c46b7ff.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.b9ca8c91.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.7b085d61.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.a597a6b0.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.152b4577.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.bbe32974.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.82c852a9.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.4d107d95.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.53598b60.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.235979e1.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.c14f1fd9.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.79c074c0.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.1e80f727.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.46ff5834.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.4f649ea3.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.1afb41c6.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.77fd44d2.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.f67e6cf2.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.87e02d9e.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.dcfdc432.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.924476e1.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.043d41ed.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.56507109.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.9b64eb77.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.7ea26885.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.182d318a.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.73b388a2.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.08ed1a50.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.02faa77d.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.ff9f67fa.js"><link rel="prefetch" href="/android-note/assets/单链表.html.816ccbf3.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.81be9d3a.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.5979ef3a.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.d3a34d4d.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.f871bc28.js"><link rel="prefetch" href="/android-note/assets/死锁.html.05fcf641.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.124be265.js"><link rel="prefetch" href="/android-note/assets/算法.html.a5d32479.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.0447b400.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.23d92421.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.1f70a7af.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.0aca5205.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.c64ac1eb.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.259d5746.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.2d7e84b0.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.f80d0190.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.cb3b0dd9.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.5eba2fc6.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.f95797de.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.af807638.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.af237da0.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.c7354991.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.2c386862.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.502b69b2.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.4cf1fc11.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.0d0ec937.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.1a5daf97.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.49cca9fa.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.6bf6b961.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.957f7aff.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.8e6935a4.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.db0f2341.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.28394ba6.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.e37f15c5.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.4900e197.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.d17a443e.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.6d4b95b6.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.7617b5a1.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.ebe8409a.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.d8336de6.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.4040429e.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.fc34230c.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.8310dbe0.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.a609e06b.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.92fc9cbb.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.6f0bcff8.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.3d8a0779.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.88c6186b.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.2513ea33.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.d0778e46.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.bfc12cf1.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.45995d69.js"><link rel="prefetch" href="/android-note/assets/404.html.bf6755d7.js"><link rel="prefetch" href="/android-note/assets/404.0f84ac09.js"><link rel="prefetch" href="/android-note/assets/Layout.c5c30828.js">
    <link rel="stylesheet" href="/android-note/assets/style.1f7fd01d.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/android-note/" class=""><!----><span class="site-name">Android Notes</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Android WebRTC简介 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/android-note/VideoDevelopment/Android%20WebRTC%E7%AE%80%E4%BB%8B.html#webrtc简介" class="router-link-active router-link-exact-active sidebar-item" aria-label="WebRTC简介"><!--[--><!--]--> WebRTC简介 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/android-note/VideoDevelopment/Android%20WebRTC%E7%AE%80%E4%BB%8B.html#peerconnectionfactory" class="router-link-active router-link-exact-active sidebar-item" aria-label="PeerConnectionFactory"><!--[--><!--]--> PeerConnectionFactory <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="android-webrtc简介" tabindex="-1"><a class="header-anchor" href="#android-webrtc简介" aria-hidden="true">#</a> Android WebRTC简介</h1><p><img src="https://github.com/CharonChui/Pictures/blob/master/webrtc-logo.png?raw=true" alt="image"></p><h2 id="webrtc简介" tabindex="-1"><a class="header-anchor" href="#webrtc简介" aria-hidden="true">#</a> WebRTC简介</h2><p><a href="https://webrtc.org/" target="_blank" rel="noopener noreferrer">WebRTC<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><code>WebRTC</code>名称源自网页实时通信(Web Real-Time Communication<code>)的缩写，是一个支持网页浏览器进行实时语音对话或视频对话的技术，是谷歌2010年以6820万美元收购</code>Global IP Solutions<code>公司而获得的一项技术。</code>Google<code>于2011年6月3日开源的即时通讯项目，旨在使其成为客户端视频通话的标准。其实在</code>Google<code>将</code>WebRTC<code>开源之前，微软和苹果各自的通讯产品已占用很大市场份额（如</code>Skype<code>），</code>Google`也是为了快速扩大市场，所以将他给开源。在行业内得到了广泛的支持和应用，成为下一代视频通话的标准。更多介绍可以去官网上看。</p><p><code>WebRTC</code>被誉为是<code>web</code>长期开源开发的一个新启元，是近年来<code>Web</code>开发的最重要创新。<code>WebRTC</code>允许<code>Web</code>开发者在其<code>web</code>应用中添加视频聊天或者点对点数据传输，不需要复杂的代码或者昂贵的配置。目前支持<code>Chrome</code>、<code>Firefox</code>和<code>Opera</code>，后续会支持更多的浏览器，它有能力达到数十亿的设备。</p><p>然而，<code>WebRTC</code>一直被误解为仅适合于浏览器。事实上，<code>WebRTC</code>最重要的一个特征是允许本地和<code>web</code>应用间的互操作，很少有人使用到这个特性。</p><p>本文主要以开源项目<a href="https://github.com/pchab/AndroidRTC" target="_blank" rel="noopener noreferrer">AndroidRTC<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>为例。 下载后通过<code>Android Studio</code>打开，打开的时候可能会报错，说找不到<code>org.json:json:20090211</code>，这时只要将<code>AndroidRTC/webrtc-client/build.gradle</code>中的</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>dependencies {
    compile (&#39;com.github.nkzawa:socket.io-client:0.4.1&#39;)
    compile &#39;io.pristine:libjingle:8871@aar&#39;
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>修改成</p><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>dependencies {
    compile (&#39;com.github.nkzawa:socket.io-client:0.4.1&#39;){ // //webSocket相关
        exclude group: &#39;org.json&#39;, module: &#39;json&#39; // 这句话是我新加的，不然会提示org.json:json:20090211找不到
    }

    compile &#39;io.pristine:libjingle:8871@aar&#39; // //webRTC官方aar包
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>就可以了。</p><p>运行一下你会发现进去会黑屏，这是因为需要依赖<code>node.js</code>服务。</p><p><code>WebRTC Live Streaming</code>:</p><ul><li><code>Node.js server</code></li><li><code>Desktop client</code></li><li><code>Android client</code></li></ul><p>如果电脑上没有安装<code>nodejs</code>需要先安装<code>nodejs</code>，因为需要依赖<code>node.js</code>所以我们要先安装<code>node.js</code>。去<a href="https://nodejs.org/en/#download" target="_blank" rel="noopener noreferrer">nodejs官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>下载安装。</p><p>然后是要本地下载<a href="https://github.com/pchab/ProjectRTC" target="_blank" rel="noopener noreferrer">ProjectRTC<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>项目:</p><ul><li><code>git clone https://github.com/pchab/ProjectRTC.git</code></li><li><code>cd ProjectRTC/</code></li><li><code>npm install</code></li><li><code>npm start</code> 服务默认会运行在3000端口，你可以在浏览器中打开<code>localhost:3000</code>。</li></ul><p><img src="https://github.com/CharonChui/Pictures/blob/master/webrtc_web_1.png?raw=true" alt="image"></p><p>如图就表示运行成功了。</p><p>接下来我们进行打开<code>android</code>客户端，你会发现，还是黑屏。 这是因为我们需要在项目中的<code>strings.xml</code>中将配置修改成本地电脑在局域网下的<code>ip</code>地址和运行<code>Node</code>服务端的端口。如下:</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app_name<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>AndroidRTC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>host<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>172.16.55.27<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>port<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>3000<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>string</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>action_settings<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Options<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>string</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>好了，现在再运行<code>android</code>项目，然后打开浏览器输入<code>localhost:3000</code>，在浏览器页面点击<code>start</code>，你就可以看到电脑摄像头获取的画面，如下图:</p><p><img src="https://github.com/CharonChui/Pictures/blob/master/webrtc_web_start.png?raw=true" alt="image"></p><p>然后点击左边的<code>call</code>，就会去申请连手机端，接下来你就可以在浏览器和手机端看到画面了，如下图:</p><p><img src="https://github.com/CharonChui/Pictures/blob/master/webrtc_web_call.png?raw=true" alt="image"></p><p>手机端的画面:</p><p><img src="https://github.com/CharonChui/Pictures/blob/master/webrtc_android.jpg?raw=true" alt="image"></p><p>既然连通了，下面就仔细分析一下代码:<br> 代码文件比较少，主要是三个类:</p><p><img src="https://github.com/CharonChui/Pictures/blob/master/webrtc_demo_file.png?raw=true" alt="image"></p><p>其中在<code>WebRtcClient</code>中实现的逻辑最为核心，我们就从他入手。</p><p><code>Android</code>相关的<code>API</code>有<code>VideoCapturerAndroid</code>,<code>VideoRenderer</code>,<code>MediaStream</code>,<code>PeerConnection</code>, 和<code>PeerConnectionFactory</code>。下面我们将逐一讲解。</p><p>在开始之前，需要创建<code>PeerConnectionFactory</code>，这是<code>Android</code>上使用<code>WebRTC</code>最核心的<code>API</code>。</p><h3 id="peerconnectionfactory" tabindex="-1"><a class="header-anchor" href="#peerconnectionfactory" aria-hidden="true">#</a> <code>PeerConnectionFactory</code></h3><p><code>Android WebRTC</code>最核心的类。理解这个类并了解它如何创建其他任何事情是深入了解<code>Android</code>中<code>WebRTC</code>的关键。 它和我们期望的方式还是有所不同的，所以我们开始深入挖掘它。</p><p>我们先到<code>WebRtcClient</code>文件中找到<code>PeerConnectionFactory</code>初始化的地方:</p><p><img src="https://github.com/CharonChui/Pictures/blob/master/webrtc_factory_code.png?raw=true" alt="image"></p><p><code>initializeAndroidGlobals</code>的参数分别是:</p><ul><li><code>context</code>:应用上下文</li><li><code>initializeAudio</code>:是否初始化音频的布尔值。</li><li><code>initializeVideo</code>:是否初始化视频的布尔值。跳过这两个就允许跳过请求<code>API</code>的相关权限，例如数据通道应用。</li><li><code>videoCodecHwAcceleration</code>:是否允许硬件加速的布尔值。</li><li><code>renderEGLContext</code>:用来提供支持硬件视频解码，可以在视频解码线程中创建共享<code>EGL</code>上下文。 可以为空——在本文例子中硬件视频解码将产生<code>yuv420</code>帧而非<code>texture</code>帧。</li><li><code>initializeAndroidGlobals</code>也是返回布尔值，<code>true</code>表示一切OK，<code>false</code>表示有失败。</li></ul><p>有了<code>peerConnectionFactory</code>实例，就可以从用户设备获取视频和音频，最终将其渲染到屏幕上。在<code>Android</code>中，我们需要了解<code>VideoCapturerAndroid</code>，<code>VideoSource</code>，<code>VideoTrack</code>和<code>VideoRenderer</code>。<br> 先从<code>VideoCapturerAndroid</code>开始:</p><h4 id="videocapturerandroid" tabindex="-1"><a class="header-anchor" href="#videocapturerandroid" aria-hidden="true">#</a> <code>VideoCapturerAndroid</code></h4><p><code>VideoCapturerAndroid</code>其实是一系列<code>Camera API</code>的封装，为访问摄像头设备的流信息提供了方便。它允许获取多个摄像头设备信息，包括前置摄像头，或者后置摄像头。</p><p>在<code>WebRtcClient</code>类中的代码为:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">setCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    localMS <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createLocalMediaStream</span><span class="token punctuation">(</span><span class="token string">&quot;ARDAMS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>pcParams<span class="token punctuation">.</span>videoCallEnabled<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">MediaConstraints</span> videoConstraints <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaConstraints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        videoConstraints<span class="token punctuation">.</span>mandatory<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MediaConstraints<span class="token punctuation">.</span>KeyValuePair</span><span class="token punctuation">(</span><span class="token string">&quot;maxHeight&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>pcParams<span class="token punctuation">.</span>videoHeight<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        videoConstraints<span class="token punctuation">.</span>mandatory<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MediaConstraints<span class="token punctuation">.</span>KeyValuePair</span><span class="token punctuation">(</span><span class="token string">&quot;maxWidth&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>pcParams<span class="token punctuation">.</span>videoWidth<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        videoConstraints<span class="token punctuation">.</span>mandatory<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MediaConstraints<span class="token punctuation">.</span>KeyValuePair</span><span class="token punctuation">(</span><span class="token string">&quot;maxFrameRate&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>pcParams<span class="token punctuation">.</span>videoFps<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        videoConstraints<span class="token punctuation">.</span>mandatory<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MediaConstraints<span class="token punctuation">.</span>KeyValuePair</span><span class="token punctuation">(</span><span class="token string">&quot;minFrameRate&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>pcParams<span class="token punctuation">.</span>videoFps<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        videoSource <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createVideoSource</span><span class="token punctuation">(</span><span class="token function">getVideoCapturer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> videoConstraints<span class="token punctuation">)</span><span class="token punctuation">;</span>
        localMS<span class="token punctuation">.</span><span class="token function">addTrack</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span><span class="token function">createVideoTrack</span><span class="token punctuation">(</span><span class="token string">&quot;ARDAMSv0&quot;</span><span class="token punctuation">,</span> videoSource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">AudioSource</span> audioSource <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createAudioSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MediaConstraints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    localMS<span class="token punctuation">.</span><span class="token function">addTrack</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span><span class="token function">createAudioTrack</span><span class="token punctuation">(</span><span class="token string">&quot;ARDAMSa0&quot;</span><span class="token punctuation">,</span> audioSource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    mListener<span class="token punctuation">.</span><span class="token function">onLocalStream</span><span class="token punctuation">(</span>localMS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">VideoCapturer</span> <span class="token function">getVideoCapturer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 获取前置摄像头的名称</span>
    <span class="token class-name">String</span> frontCameraDeviceName <span class="token operator">=</span> <span class="token class-name">VideoCapturerAndroid</span><span class="token punctuation">.</span><span class="token function">getNameOfFrontFacingDevice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建前置摄像头对象</span>
    <span class="token keyword">return</span> <span class="token class-name">VideoCapturerAndroid</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>frontCameraDeviceName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>有了包含摄像流信息的<code>VideoCapturerAndroid</code>实例，就可以创建从本地设备获取到的包含视频流信息的<code>MediaStream</code>，从而发送给另一端。但做这些之前，我们首先研究下如何将自己的视频显示到应用上面。</p><h4 id="videosource-videotrack" tabindex="-1"><a class="header-anchor" href="#videosource-videotrack" aria-hidden="true">#</a> <code>VideoSource/VideoTrack</code></h4><p>从<code>VideoCapturer</code>实例中获取一些有用信息，或者要达到最终目标————为连接端获取合适的媒体流，或者仅仅是将它渲染给用户，我们需要了解<code>VideoSource</code>和<code>VideoTrack</code>类。</p><p><code>VideoSource</code>允许方法开启、停止设备捕获视频。这在为了延长电池寿命而禁止视频捕获的情况下比较有用。 <code>VideoTrack</code>是简单的添加<code>VideoSource</code>到<code>MediaStream</code>对象的一个封装。</p><p>我们通过代码看看它们是如何一起工作的。<code>capturer</code>是<code>VideoCapturer</code>的实例，<code>videoConstraints</code>是<code>MediaConstraints</code>的实例。 代码还是在上面贴出的<code>setCamera()</code>方法中:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">setCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    localMS <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createLocalMediaStream</span><span class="token punctuation">(</span><span class="token string">&quot;ARDAMS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>pcParams<span class="token punctuation">.</span>videoCallEnabled<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">MediaConstraints</span> videoConstraints <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaConstraints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">// 创建VideoSource</span>
        videoSource <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createVideoSource</span><span class="token punctuation">(</span><span class="token function">getVideoCapturer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> videoConstraints<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建VideoTrack</span>
        localMS<span class="token punctuation">.</span><span class="token function">addTrack</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span><span class="token function">createVideoTrack</span><span class="token punctuation">(</span><span class="token string">&quot;ARDAMSv0&quot;</span><span class="token punctuation">,</span> videoSource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 创建AudioSource</span>
    <span class="token class-name">AudioSource</span> audioSource <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createAudioSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MediaConstraints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 创建AudioSource</span>
    localMS<span class="token punctuation">.</span><span class="token function">addTrack</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span><span class="token function">createAudioTrack</span><span class="token punctuation">(</span><span class="token string">&quot;ARDAMSa0&quot;</span><span class="token punctuation">,</span> audioSource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    mListener<span class="token punctuation">.</span><span class="token function">onLocalStream</span><span class="token punctuation">(</span>localMS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="audiosource-audiotrack" tabindex="-1"><a class="header-anchor" href="#audiosource-audiotrack" aria-hidden="true">#</a> <code>AudioSource/AudioTrack</code></h4><p><code>AudioSource</code>和<code>AudioTrack</code>与<code>VideoSource</code>和<code>VideoTrack</code>相似，只是不需要<code>AudioCapturer</code>来获取麦克风， 代码同上。</p><h4 id="videorenderer" tabindex="-1"><a class="header-anchor" href="#videorenderer" aria-hidden="true">#</a> <code>VideoRenderer</code></h4><p>进入<code>VideoRenderer</code>，<code>WebRTC</code>库允许通过<code>VideoRenderer.Callbacks</code>实现自己的渲染。另外， 它提供了一种非常好的默认方式<code>VideoRendererGui</code>。简而言之，<code>VideoRendererGui</code>是一个<code>GLSurfaceView</code>，使用它可以绘制自己的视频流。我们通过代码看一下它是如何工作的，以及如何添加<code>renderer</code>到<code>VideoTrack</code>。 因为他是渲染的类，所以代码就不是在<code>WebRtcClient</code>里面了，在<code>RtcActivity</code>中，我们看下代码:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Local preview screen position before call is connected.</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> LOCAL_X_CONNECTING <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> LOCAL_Y_CONNECTING <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> LOCAL_WIDTH_CONNECTING <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> LOCAL_HEIGHT_CONNECTING <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token comment">// Local preview screen position after call is connected.</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> LOCAL_X_CONNECTED <span class="token operator">=</span> <span class="token number">72</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> LOCAL_Y_CONNECTED <span class="token operator">=</span> <span class="token number">72</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> LOCAL_WIDTH_CONNECTED <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> LOCAL_HEIGHT_CONNECTED <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
<span class="token comment">// Remote video screen position</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> REMOTE_X <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> REMOTE_Y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> REMOTE_WIDTH <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> REMOTE_HEIGHT <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token class-name">VideoRendererGui<span class="token punctuation">.</span>ScalingType</span> scalingType <span class="token operator">=</span> <span class="token class-name">VideoRendererGui<span class="token punctuation">.</span>ScalingType</span><span class="token punctuation">.</span>SCALE_ASPECT_FILL<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">GLSurfaceView</span> vsv<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">VideoRenderer<span class="token punctuation">.</span>Callbacks</span> localRender<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">VideoRenderer<span class="token punctuation">.</span>Callbacks</span> remoteRender<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">WebRtcClient</span> client<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> mSocketAddress<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">String</span> callerId<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">requestWindowFeature</span><span class="token punctuation">(</span><span class="token class-name">Window</span><span class="token punctuation">.</span>FEATURE_NO_TITLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addFlags</span><span class="token punctuation">(</span>
            <span class="token class-name">LayoutParams</span><span class="token punctuation">.</span>FLAG_FULLSCREEN
                    <span class="token operator">|</span> <span class="token class-name">LayoutParams</span><span class="token punctuation">.</span>FLAG_KEEP_SCREEN_ON
                    <span class="token operator">|</span> <span class="token class-name">LayoutParams</span><span class="token punctuation">.</span>FLAG_DISMISS_KEYGUARD
                    <span class="token operator">|</span> <span class="token class-name">LayoutParams</span><span class="token punctuation">.</span>FLAG_SHOW_WHEN_LOCKED
                    <span class="token operator">|</span> <span class="token class-name">LayoutParams</span><span class="token punctuation">.</span>FLAG_TURN_SCREEN_ON<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>main<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mSocketAddress <span class="token operator">=</span> <span class="token string">&quot;http://&quot;</span> <span class="token operator">+</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mSocketAddress <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span> <span class="token operator">+</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>port<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 获取GLSurfaceView </span>
    vsv <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">GLSurfaceView</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>glview_call<span class="token punctuation">)</span><span class="token punctuation">;</span>
    vsv<span class="token punctuation">.</span><span class="token function">setPreserveEGLContextOnPause</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vsv<span class="token punctuation">.</span><span class="token function">setKeepScreenOn</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 设置给VideoRendererGui</span>
    <span class="token class-name">VideoRendererGui</span><span class="token punctuation">.</span><span class="token function">setView</span><span class="token punctuation">(</span>vsv<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 创建本地和远程的Render</span>
    <span class="token comment">// local and remote render</span>
    remoteRender <span class="token operator">=</span> <span class="token class-name">VideoRendererGui</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
            REMOTE_X<span class="token punctuation">,</span> REMOTE_Y<span class="token punctuation">,</span>
            REMOTE_WIDTH<span class="token punctuation">,</span> REMOTE_HEIGHT<span class="token punctuation">,</span> scalingType<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    localRender <span class="token operator">=</span> <span class="token class-name">VideoRendererGui</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>
            LOCAL_X_CONNECTING<span class="token punctuation">,</span> LOCAL_Y_CONNECTING<span class="token punctuation">,</span>
            LOCAL_WIDTH_CONNECTING<span class="token punctuation">,</span> LOCAL_HEIGHT_CONNECTING<span class="token punctuation">,</span> scalingType<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">final</span> <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token function">getIntent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> action <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span>ACTION_VIEW<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> segments <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPathSegments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        callerId <span class="token operator">=</span> segments<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>


<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLocalStream</span><span class="token punctuation">(</span><span class="token class-name">MediaStream</span> localStream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// 将Render添加到VideoTrack中</span>
    localStream<span class="token punctuation">.</span>videoTracks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addRenderer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VideoRenderer</span><span class="token punctuation">(</span>localRender<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">VideoRendererGui</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>localRender<span class="token punctuation">,</span>
            LOCAL_X_CONNECTING<span class="token punctuation">,</span> LOCAL_Y_CONNECTING<span class="token punctuation">,</span>
            LOCAL_WIDTH_CONNECTING<span class="token punctuation">,</span> LOCAL_HEIGHT_CONNECTING<span class="token punctuation">,</span>
            scalingType<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAddRemoteStream</span><span class="token punctuation">(</span><span class="token class-name">MediaStream</span> remoteStream<span class="token punctuation">,</span> <span class="token keyword">int</span> endPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    remoteStream<span class="token punctuation">.</span>videoTracks<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addRenderer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">VideoRenderer</span><span class="token punctuation">(</span>remoteRender<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">VideoRendererGui</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>remoteRender<span class="token punctuation">,</span>
            REMOTE_X<span class="token punctuation">,</span> REMOTE_Y<span class="token punctuation">,</span>
            REMOTE_WIDTH<span class="token punctuation">,</span> REMOTE_HEIGHT<span class="token punctuation">,</span> scalingType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">VideoRendererGui</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>localRender<span class="token punctuation">,</span>
            LOCAL_X_CONNECTED<span class="token punctuation">,</span> LOCAL_Y_CONNECTED<span class="token punctuation">,</span>
            LOCAL_WIDTH_CONNECTED<span class="token punctuation">,</span> LOCAL_HEIGHT_CONNECTED<span class="token punctuation">,</span>
            scalingType<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRemoveRemoteStream</span><span class="token punctuation">(</span><span class="token keyword">int</span> endPoint<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">VideoRendererGui</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>localRender<span class="token punctuation">,</span>
            LOCAL_X_CONNECTING<span class="token punctuation">,</span> LOCAL_Y_CONNECTING<span class="token punctuation">,</span>
            LOCAL_WIDTH_CONNECTING<span class="token punctuation">,</span> LOCAL_HEIGHT_CONNECTING<span class="token punctuation">,</span>
            scalingType<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="mediaconstraints" tabindex="-1"><a class="header-anchor" href="#mediaconstraints" aria-hidden="true">#</a> <code>MediaConstraints</code></h4><p><code>MediaConstraints</code>是支持不同约束的<code>WebRTC</code>库方式的类，可以加载到<code>MediaStream</code>中的音频和视频轨道。对于大多数需要<code>MediaConstraints</code>的方法，一个简单的<code>MediaConstraints</code>实例就可以做到。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">MediaConstraints</span> pcConstraints <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaConstraints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
pcConstraints<span class="token punctuation">.</span>mandatory<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MediaConstraints<span class="token punctuation">.</span>KeyValuePair</span><span class="token punctuation">(</span><span class="token string">&quot;OfferToReceiveAudio&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pcConstraints<span class="token punctuation">.</span>mandatory<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MediaConstraints<span class="token punctuation">.</span>KeyValuePair</span><span class="token punctuation">(</span><span class="token string">&quot;OfferToReceiveVideo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
pcConstraints<span class="token punctuation">.</span>optional<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MediaConstraints<span class="token punctuation">.</span>KeyValuePair</span><span class="token punctuation">(</span><span class="token string">&quot;DtlsSrtpKeyAgreement&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>pc <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createPeerConnection</span><span class="token punctuation">(</span>iceServers<span class="token punctuation">,</span> pcConstraints<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="mediastream" tabindex="-1"><a class="header-anchor" href="#mediastream" aria-hidden="true">#</a> <code>MediaStream</code></h4><p>本地看见自己后接下来就要想办法让对方看见自己。我们需要自己创建<code>MediaStream</code>。 接下来我们就研究如何添加本地的<code>VideoTrack</code>和<code>AudioTrack</code>来创建一个合适的<code>MediaStream</code>。 代码还是在前面分析的<code>setCamera()</code>方法中:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">MediaStream</span> localMS<span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">setCamera</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token comment">// 创建MediaStream</span>
	localMS <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createLocalMediaStream</span><span class="token punctuation">(</span><span class="token string">&quot;ARDAMS&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>pcParams<span class="token punctuation">.</span>videoCallEnabled<span class="token punctuation">)</span><span class="token punctuation">{</span>
	    <span class="token class-name">MediaConstraints</span> videoConstraints <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaConstraints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    videoConstraints<span class="token punctuation">.</span>mandatory<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MediaConstraints<span class="token punctuation">.</span>KeyValuePair</span><span class="token punctuation">(</span><span class="token string">&quot;maxHeight&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>pcParams<span class="token punctuation">.</span>videoHeight<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    videoConstraints<span class="token punctuation">.</span>mandatory<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MediaConstraints<span class="token punctuation">.</span>KeyValuePair</span><span class="token punctuation">(</span><span class="token string">&quot;maxWidth&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>pcParams<span class="token punctuation">.</span>videoWidth<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    videoConstraints<span class="token punctuation">.</span>mandatory<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MediaConstraints<span class="token punctuation">.</span>KeyValuePair</span><span class="token punctuation">(</span><span class="token string">&quot;maxFrameRate&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>pcParams<span class="token punctuation">.</span>videoFps<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    videoConstraints<span class="token punctuation">.</span>mandatory<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MediaConstraints<span class="token punctuation">.</span>KeyValuePair</span><span class="token punctuation">(</span><span class="token string">&quot;minFrameRate&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>pcParams<span class="token punctuation">.</span>videoFps<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	    videoSource <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createVideoSource</span><span class="token punctuation">(</span><span class="token function">getVideoCapturer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> videoConstraints<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token comment">// 添加VideoTrack</span>
	    localMS<span class="token punctuation">.</span><span class="token function">addTrack</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span><span class="token function">createVideoTrack</span><span class="token punctuation">(</span><span class="token string">&quot;ARDAMSv0&quot;</span><span class="token punctuation">,</span> videoSource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token class-name">AudioSource</span> audioSource <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createAudioSource</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MediaConstraints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 添加AudioTrack</span>
	localMS<span class="token punctuation">.</span><span class="token function">addTrack</span><span class="token punctuation">(</span>factory<span class="token punctuation">.</span><span class="token function">createAudioTrack</span><span class="token punctuation">(</span><span class="token string">&quot;ARDAMSa0&quot;</span><span class="token punctuation">,</span> audioSource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	mListener<span class="token punctuation">.</span><span class="token function">onLocalStream</span><span class="token punctuation">(</span>localMS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们现在有了包含视频流和音频流的<code>MediaStream</code>实例，而且在屏幕上显示了我们的预览画面。下面要做的就该把这些信息传送给对方了。 这篇文章不会介绍如何建立自己的信号流，我们直接介绍对应的<code>API</code>方法，以及它们如何与<code>web</code>关联的。 <code>AppRTC</code>使用<code>autobahn</code>使得<code>WebSocket</code>连接到信号端。</p><h4 id="peerconnection" tabindex="-1"><a class="header-anchor" href="#peerconnection" aria-hidden="true">#</a> <code>PeerConnection</code></h4><p>现在我们有了自己的<code>MediaStream</code>，就可以开始连接远端了。创建<code>PeerConnection</code>很简单，只需要<code>PeerConnectionFactory</code>的协助即可。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">PeerConnection</span> pc<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">PeerConnectionFactory</span> factory<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PeerConnection<span class="token punctuation">.</span>IceServer</span><span class="token punctuation">&gt;</span></span> iceServers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


iceServers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PeerConnection<span class="token punctuation">.</span>IceServer</span><span class="token punctuation">(</span><span class="token string">&quot;stun:23.21.150.121&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
iceServers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PeerConnection<span class="token punctuation">.</span>IceServer</span><span class="token punctuation">(</span><span class="token string">&quot;stun:stun.l.google.com:19302&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>pc <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createPeerConnection</span><span class="token punctuation">(</span>iceServers<span class="token punctuation">,</span> pcConstraints<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参数的作用如下：</p><p><code>iceServers</code>:连接到外部设备或者网络时需要用到这个参数。在这里添加STUN 和 TURN 服务器就允许进行连接，即使在网络条件很差的条件下。 <code>constraints</code>:前面介绍的<code>MediaConstraints</code>的实例，应该包含<code>offerToRecieveAudio</code>和<code>offerToRecieveVideo</code>。 <code>observer</code>:<code>PeerConnection.Observer</code>实例。</p><p><code>PeerConnection</code>和<code>web</code>上的对应<code>API</code>很相似，包含了<code>addStream</code>、<code>addIceCandidate</code>、<code>createOffer</code>、<code>createAnswer</code>、<code>getLocalDescription</code>、<code>setRemoteDescription</code>和其他类似方法。为了了解如何协调所有工作在两点之间建立起通讯通道，我们先看下下面的几个类:</p><h4 id="addstream" tabindex="-1"><a class="header-anchor" href="#addstream" aria-hidden="true">#</a> <code>addStream</code></h4><p>这个是用来将<code>MediaStream</code>添加到<code>PeerConnection</code>中的,如同它的命名一样。如果你想要对方看到你的视频、听到你的声音，就需要用到这个方法。</p><h4 id="addicecandidate" tabindex="-1"><a class="header-anchor" href="#addicecandidate" aria-hidden="true">#</a> <code>addIceCandidate</code></h4><p>一旦内部<code>IceFramework</code>发现有<code>candidates</code>允许其他方连接你时，就会创建<code>IceCandidates</code>。当通过<code>PeerConnectionObserver.onIceCandidate</code>传递数据到对方时，需要通过任何一个你选择的信号通道获取到对方的<code>IceCandidates</code>。使用<code>addIceCandidate</code>添加它们到<code>PeerConnection</code>，以便<code>PeerConnection</code>可以通过已有信息试图连接对方。</p><h4 id="createoffer-createanswer" tabindex="-1"><a class="header-anchor" href="#createoffer-createanswer" aria-hidden="true">#</a> <code>createOffer/createAnswer</code></h4><p>这两个方法用于原始通话的建立。在<code>WebRTC</code>中，已经有了<code>caller</code>和<code>callee</code>的概念，一个是呼叫，一个是应答。<code>createOffer</code>是<code>caller</code>使用的，它需要一个<code>sdpObserver</code>，它允许获取和传输会话描述协议<code>Session Description Protocol (SDP)</code>给对方，还需要一个<code>MediaConstraint</code>。一旦对方得到了这个请求，它将创建一个应答并将其传输给<code>caller</code>。<code>SDP</code>是用来给对方描述期望格式的数据（如<code>video</code>、<code>formats</code>、<code>codecs</code>、<code>encryption</code>、<code>resolution</code>、 <code>size</code>等）。一旦<code>caller</code>收到这个应答信息，双方就相互建立的通信需求达成了一致，如视频、音频、解码器等。</p><h4 id="setlocaldescription-setremotedescription" tabindex="-1"><a class="header-anchor" href="#setlocaldescription-setremotedescription" aria-hidden="true">#</a> <code>setLocalDescription/setRemoteDescription</code></h4><p>这个是用来设置<code>createOffer</code>和<code>createAnswer</code>产生的<code>SDP</code>数据的，包含从远端获取到的数据。它允许内部<code>PeerConnection</code>配置链接以便一旦开始传输音频和视频就可以开始真正工作。</p><h4 id="peerconnection-observer" tabindex="-1"><a class="header-anchor" href="#peerconnection-observer" aria-hidden="true">#</a> <code>PeerConnection.Observer</code></h4><p>这个接口提供了一种监测<code>PeerConnection</code>事件的方法，例如收到<code>MediaStream</code>时，或者发现<code>iceCandidates</code>时，或者需要重新建立通讯时。这个接口必须被实现，以便你可以有效处理收到的事件，例如当对方变为可见时，向他们发送信号<code>iceCandidates</code>。</p><p><code>WebRTC打开了人与人之间的通讯，对开发者免费，对终端用户免费。 它不仅仅提供了视频聊天，还有其他应用，比如健康服务、低延迟文件传输、种子下载、甚至游戏应用。 想要看到一个真正的</code>WebRTC`应用实例，请下载<a href="https://play.google.com/store/apps/details?id=appear.in.app&amp;referrer=utm_source=tech.appear.in&amp;utm_medium=blog&amp;utm_campaign=android-launch-may15" target="_blank" rel="noopener noreferrer">appear.in<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。它在浏览器和本地应用间运行的相当完美，在同一个房间内最多可以8个人免费使用。不需要安装和注册。</p><p>最后总结一下:</p><p>直播用的主流协议:</p><ul><li><p><code>RTMP</code>: (<code>Real Time Messaging Protocol</code>)实时消息传送协议是<code>Adobe Systems</code>公司为<code>Flash</code>播放器和服务器之间音频、视频和数据传输 开发的开放协议。目前直播的主流平台95%都是基于该协议做的。</p><ul><li>优点：成熟，稳定，效果好等等</li><li>缺点：有延迟，达不到实时互动等等</li></ul></li><li><p><code>WebRTC</code>: 名称源自网页实时通信（<code>Web Real-Time Communication</code>）的缩写，是一个支持网页浏览器进行实时语音对话或视频对话的技术，是谷歌2010年以6820万美元收购<code>Global IP Solutions</code>公司而获得的一项技术。2011年5月开放了工程的源代码，在行业内得到了广泛的支持和应用，成为下一代视频通话的标准。</p><ul><li>优点：实时互动，开发难度小等等</li><li>缺点：太实时，如果网络不好，视频质量会严重下降，体验不好；考研服务器等等</li></ul></li></ul><p>那既然<code>WebRTC</code>这么好，那直接用来做直播不就好了。结果往往并没有想象中的那么完美。</p><p><code>WebRTC</code>整体的技术并不适合做直播。<code>WebRTC</code>设计的初衷只是为了在两个浏览器/<code>native app</code>之间解决直接连接发送<code>media streaming/data</code>数据的，也就是所谓的<code>peer to peer</code>的通信，大多数的情况下不需要依赖于服务器的中转，因此一般在通信的逻辑上是一对一。而我们现在的直播服务大部分的情况下是一对多的通信，一个主播可能会有成千上万个接收端，这种方式用传统的<code>P2P</code>来实现是不可能的，所以目前直播的方案基本上都是会有直播服务器来做中央管理，主播的数据首先发送给直播服务器，直播服务器为了能够支持非常多用户的同事观看，还要通过边缘节点<code>CDN</code>的方式来做地域加速，所有的接收端都不会直接连接主播，而是从服务器上接收数据。</p><p><code>WebRtc</code>只适合小范围（8人以内）音视频会议，不适合做直播：</p><ol><li>视频部分：vpx的编码器太弱，专利原因不能用264，做的好的都要自己改264/265代码才行。</li><li>音频部分：音频只适合人声编码，对音乐和其他非人声的效果很糟糕。</li><li>网络部分：对国内各种奇葩网络适应性太低，网络糟糕点或者人多点就卡。</li><li>信号处理：同时用过<code>GIPS</code>和<code>WebRTC</code>进行对比，可以肯定目前开源的代码是<code>GIPS</code>阉割过的。</li><li>使用规模：10人以内使用，超过10人就挂了，</li></ol><p>现在的直播服务器请使用<code>nginx rtmp-module</code>架设，架设好了用<code>ffmpeg</code>命令行来测试播摄像头。主播客户端请使用<code>rtmp</code>进行推流给<code>rtmp-module</code>，粉丝请使用<code>rtmp/flv+http stream</code>进行观看，<code>PC-web</code>端的粉丝请使用<code>Flash NetStream</code>来观看，移动<code>web</code>端的粉丝请使用<code>hls/m3u8</code>来观看。如果你试验成功要上线了，出现压力了，那么把<code>nginx</code>分层（接入层+交换层），稍微改两行代码，如果资金不足以全国部署服务器，那么把<code>nginx-rtmp-module</code>换为<code>cdn</code>的标准直播服务，也可以直接调过<code>nginx</code>，一开始就用<code>cdn</code>的直播服务，比如网宿（斗鱼的直播服务提供商）。这是正道，别走弯路了。</p><p>那既然<code>WebRTC</code>不适合做直播，还写这么多干啥，<code>WebRTC</code>内部包含的技术模块是非常适合解决直播过程中存在的各种问题的，而且应该在大多数直播技术框架中都已经得到了部分应用，例如音视频数据的收发、音频处理回音消除降噪等。所以综上，可以使用<code>WebRTC</code>内部的技术模块来解决直播过程中存在的技术问题，但是不适合直接用<code>WebRTC</code>来实现直播的整体框架。</p><p>参考:</p><ul><li><a href="https://tech.appear.in/2015/05/25/Introduction-to-WebRTC-on-Android/" target="_blank" rel="noopener noreferrer">Introduction to WebRTC on Android<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://webrtc.org/native-code/android/" target="_blank" rel="noopener noreferrer">Android WebRTC 编译<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/pchab/AndroidRTC" target="_blank" rel="noopener noreferrer">Android WebRTC开源项目<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/pchab/ProjectRTC" target="_blank" rel="noopener noreferrer">ProjectRTC<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.html5rocks.com/en/tutorials/webrtc/basics/" target="_blank" rel="noopener noreferrer">Getting Started with WebRTC<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/webrtc" target="_blank" rel="noopener noreferrer">WebRTC Github<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://chromium.googlesource.com/external/webrtc" target="_blank" rel="noopener noreferrer">WebRTC GoogleSource<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://webrtc.org/native-code/android/" target="_blank" rel="noopener noreferrer">Android WebRTC<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/webrtc/samples/" target="_blank" rel="noopener noreferrer">Samples<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Media_Streams_API" target="_blank" rel="noopener noreferrer">WebRTC API<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://www.zhihu.com/question/25497090" target="_blank" rel="noopener noreferrer">WebRTC适合做直播吗？<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><hr><ul><li>邮箱 ：charon.chui@gmail.com</li><li>Good Luck!</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 335891510@qq.com">Jungle68</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/android-note/assets/app.e2a3b496.js" defer></script>
  </body>
</html>

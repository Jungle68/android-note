<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.47">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Activity界面绘制过程详解 | Android Notes</title><meta name="description" content="一个 Android 技术记录文档">
    <link rel="modulepreload" href="/android-note/assets/app.89e8a229.js"><link rel="modulepreload" href="/android-note/assets/Activity界面绘制过程详解.html.1026b60c.js"><link rel="modulepreload" href="/android-note/assets/Activity界面绘制过程详解.html.a8c42ae7.js"><link rel="prefetch" href="/android-note/assets/index.html.8bd0e776.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.7e59ca03.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.c477e23d.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.8ae3b627.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.d2e9fd43.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.c3aa8849.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.e39fb926.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.24d347d7.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.d974bc5d.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.e5751fb9.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.0e899c35.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.6ec105de.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.5d07c2c2.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.820183b1.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.ea867ee7.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.e0f11045.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.22b42870.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.61dfcc93.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.3cd2d991.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.ecfe19bd.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.570ee8a4.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.f8aba27b.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.1d392d64.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.9559fa68.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.ed0822f0.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.dc7889f9.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.3020c3be.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.073c39e0.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.8baf198e.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.51e0046b.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.5bd737af.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.1159aa8f.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.7c3e31b6.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.8ab8a2cc.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.e50646bb.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.f8bdc563.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.f120c888.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.1f8b3f62.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.96ecc87a.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.1b541a89.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.998dc7dc.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.0cbd4bdb.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.6cf7c851.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.d7db60a7.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.2f79a0af.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.f4db4c13.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.a286106e.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.de385267.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.b8bbd45f.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.2e8c4081.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.c39ce824.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.244019e6.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.7e587735.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.e625c50f.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.225da764.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.78211940.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.9c72d222.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.e192df98.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.9b54500d.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.f28a57f0.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.a093a882.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.2b0af47b.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.e441b7fd.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.7bc27bce.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.fbfbbb8a.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.4e2ae931.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.1319d9f7.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.e2f05584.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.9b6cca73.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.741df4a3.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.57a2cd66.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.57f05d22.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.722980d0.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.15a7fa24.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.cd786a69.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.7cd4845a.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.9db13890.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.819c1c88.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.4b8cb269.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.4ea9b161.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.844e0d9d.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.3bc9ff9e.js"><link rel="prefetch" href="/android-note/assets/病毒.html.7619f49a.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.4c49d5e1.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.2a88d555.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.8765e43b.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.cfb14486.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.fe974a62.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.00182d24.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.247dc68f.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.96572e52.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.653a3c88.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.eac67d7b.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.238e6553.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.27594cde.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.05e678bb.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.58f90a22.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.cdacbd38.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.e91c5d3e.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.fa9bacd0.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.94232b6c.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.8dbea4e8.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.20202cc3.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.40d0942f.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.2b05f9c3.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.f5b236bc.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.6952074c.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.323427b3.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.59a6c538.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.1b20bae5.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.3f8c1a56.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.fa61902d.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.b4741bb9.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.df8708de.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.0e6309ee.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.74b808b7.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.5e76b5d1.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.39b59b79.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.1041f4f4.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.4fcf5dcb.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.9a1e399b.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.52b2b04d.js"><link rel="prefetch" href="/android-note/assets/单链表.html.f419429a.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.db38b6c6.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.4e2b2a81.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.f0d24ad9.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.f7a3cc92.js"><link rel="prefetch" href="/android-note/assets/死锁.html.ec93d9d3.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.24e33318.js"><link rel="prefetch" href="/android-note/assets/算法.html.0a01e9ba.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.fbaeb1bd.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.1dff0557.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.e6733f54.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.a855a233.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.ddbbaf1e.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.8e0796a3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.18ccf0d4.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.e4c68b6e.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.afea2f74.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.e49e1c52.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.d2a307b1.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.9c599d21.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.d5da1eb6.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.80367240.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.0a73d443.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.ebaba068.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.13bba357.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.735f795b.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.8f2cca4a.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.22dab991.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.7018659f.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.f551bb7a.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.4b2076fc.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.cdc3013a.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.7835fb45.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.6109676b.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.14b9a7a7.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.7d96a52b.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.6aa91caa.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.f388a863.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.489c39d7.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.d64f0a72.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.9070678b.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.572b02f6.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.5f41a7d3.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.662b2630.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.5df647ad.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.892325da.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.76d8e5df.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.389a237c.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.b5905bd6.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.afbd099f.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.d24ca0e9.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.efba877c.js"><link rel="prefetch" href="/android-note/assets/404.html.93146c89.js"><link rel="prefetch" href="/android-note/assets/index.html.a3d1ed7b.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.a64d1991.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.34218e19.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.7b54b523.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.89bd0ab9.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.103f1200.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.c8e634bf.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.7624414c.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.98a6217e.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.e0cbd1b3.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.d07ae209.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.1a7412c1.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.fae25f98.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.a45462e1.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.0e42552a.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.fac83de9.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.946e9782.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.75dd3aa7.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.b99bea93.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.024e40a5.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.17601c25.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.e4dd3dff.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.b8f61c98.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.e4a0b5c1.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.5c2a56e3.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.771b598f.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.ec948576.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.968e5163.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.b91f279b.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.e5d334b3.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.16b555ba.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.38d70312.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.630ea31f.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.6a608b01.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.c7294606.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.d153b865.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.0788dd70.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.c4f2cabf.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.4ffa43cf.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.7160a49a.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.cdc28261.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.ca3b8f37.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.04dae4e9.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.b2eee048.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.43f5056a.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.7e9d24cb.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.fe0e18e4.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.9692f10a.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.a035f300.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.daf97b10.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.4b3a8a75.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.c9b0c208.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.f56d8adb.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.27b4fbd7.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.019759be.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.c6e22d33.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.ddae6365.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.89a53b41.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.4034729a.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.213d99fd.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.4a292186.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.26281ec4.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.711522c7.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.ca454c03.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.d2d568fe.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.2b23078a.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.e59debb3.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.96161766.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.faa1301d.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.37bcd8c4.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.037d5f51.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.20dd3611.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.8477f837.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.379af02f.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.46a9b2e4.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.2d58e745.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.c608688f.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.bfa9e3d0.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.5511f591.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.6e584085.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.6b73df63.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.fbac04fc.js"><link rel="prefetch" href="/android-note/assets/病毒.html.5cd88c03.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.b01be570.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.adc8af11.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.e5536922.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.ba3817b8.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.4496e01e.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.aa990bb9.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.b42b4b49.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.02d23272.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.971b5263.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.4ef9b35f.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.02696243.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.3dae42d2.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.b7da17de.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.49e56b2a.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.51a94c44.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.793bc62a.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.d0b4194f.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.3b5da204.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.f85478dc.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.c0b33ce0.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.9cf366a8.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.2db819bd.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.0df280d7.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.b857d0ab.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.6daec307.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.21b0f237.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.69e343c0.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.164e8303.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.124cdb1e.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.facc0566.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.f48859b0.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.2c4caa9a.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.1273fefc.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.f1e06473.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.52f84c68.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.ed4970f5.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.7bc7d93a.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.9e31d408.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.84866fc9.js"><link rel="prefetch" href="/android-note/assets/单链表.html.4400da11.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.757c2b22.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.28fdc49e.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.2ee7fbf3.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.ab0fdf74.js"><link rel="prefetch" href="/android-note/assets/死锁.html.2dfc5516.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.4ca60911.js"><link rel="prefetch" href="/android-note/assets/算法.html.18c6261d.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.665d4e8a.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.9917c0f8.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.a6e27633.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.592167e3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.6f6c5af5.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.dcd32d84.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.710e4efa.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.27f8d4ad.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.20c931ca.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.038bb020.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.44688c6c.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.49e88efd.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.1d7dfe42.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.e26fe642.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.c0efdbc5.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.96bbc22f.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.a3ea4f26.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.b836467c.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.ecb4c8c6.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.014a0e80.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.bf6c619f.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.43a40b19.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.1d72231a.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.39e338b7.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.42bac657.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.7b81876b.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.d5679c84.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.bf97314b.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.28934eff.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.dc598784.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.fe77a4c4.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.86d37938.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.b0173f04.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.da0db26d.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.e8bf8449.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.ed14c462.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.18900a2a.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.8aa50d61.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.9e991b58.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.747f298d.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.4a5af4a7.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.a26fa93a.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.d4e4b484.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.f24adf9a.js"><link rel="prefetch" href="/android-note/assets/404.html.8b61bad2.js"><link rel="prefetch" href="/android-note/assets/404.e8cf6e3a.js"><link rel="prefetch" href="/android-note/assets/Layout.36051849.js">
    <link rel="stylesheet" href="/android-note/assets/style.1f7fd01d.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/android-note/" class=""><!----><span class="site-name">Android Notes</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Activity界面绘制过程详解 <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="activity界面绘制过程详解" tabindex="-1"><a class="header-anchor" href="#activity界面绘制过程详解" aria-hidden="true">#</a> Activity界面绘制过程详解</h1><p>设置界面首先就是<code>Activity.setContentView()</code>方法：我们先看一下他的源码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Set the activity content from a layout resource.  The resource will be
 * inflated, adding all top-level views to the activity.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">layoutResID</span> Resource ID to be inflated.
 *
 * <span class="token keyword">@see</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span><span class="token punctuation">)</span></span>
 * <span class="token keyword">@see</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span><span class="token punctuation">,</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">ViewGroup</span><span class="token punctuation">.</span><span class="token class-name">LayoutParams</span><span class="token punctuation">)</span></span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token keyword">int</span> layoutResID<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setContentView</span><span class="token punctuation">(</span>layoutResID<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">initWindowDecorActionBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>getWindow()</code>就是获取该页面的窗体<code>Window</code>，该类是一个抽象类，他有一个唯一的子类<code>PhoneWindow</code>.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Retrieve the current <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">Window</span></span><span class="token punctuation">}</span> for the activity.
 * This can be used to directly access parts of the Window API that
 * are not available through Activity/Screen.
 *
 * <span class="token keyword">@return</span> Window The current window, or null if the activity is not
 *         visual.
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Window</span> <span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> mWindow<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来，我们看一下<code>PhoneWindow.setContentView()</code>方法。(简单的理解是<code>PhoneWindow</code>把<code>DectorView</code>(<code>FrameLayout</code>的子类)进行包装，将它作为窗口的根<code>View</code>)</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token keyword">int</span> layoutResID<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">// mContentParent 是当前window显示内容的父布局，它只能是mDecor或mDecor的子View,如果mContentParent为null，说明是第一次调用setContentView方法</span>
	<span class="token comment">// Note: FEATURE_CONTENT_TRANSITIONS may be set in the process of installing the window</span>
	<span class="token comment">// decor, when theme attributes and the like are crystalized. Do not check the feature</span>
	<span class="token comment">// before this happens.</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mContentParent <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 内部会创建mContentParent, 如果mDecor为null就创建，然后如果mContentParent为null，就根据当前要显示的主题去添加对应的布局，</span>
		<span class="token comment">// 并把该布局中id为content的ViewGroup赋值给mContentParent。</span>
		<span class="token function">installDecor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasFeature</span><span class="token punctuation">(</span>FEATURE_CONTENT_TRANSITIONS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 多次调用setContentView，可能是第二次、第三次，先把之前的页面内容移除</span>
		mContentParent<span class="token punctuation">.</span><span class="token function">removeAllViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasFeature</span><span class="token punctuation">(</span>FEATURE_CONTENT_TRANSITIONS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">final</span> <span class="token class-name">Scene</span> newScene <span class="token operator">=</span> <span class="token class-name">Scene</span><span class="token punctuation">.</span><span class="token function">getSceneForLayout</span><span class="token punctuation">(</span>mContentParent<span class="token punctuation">,</span> layoutResID<span class="token punctuation">,</span>
				<span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">transitionTo</span><span class="token punctuation">(</span>newScene<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 把布局inflate后添加到mContentParent中</span>
		mLayoutInflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>layoutResID<span class="token punctuation">,</span> mContentParent<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">final</span> <span class="token class-name">Callback</span> cb <span class="token operator">=</span> <span class="token function">getCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>cb <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isDestroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		cb<span class="token punctuation">.</span><span class="token function">onContentChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面简单的说明了<code>installDecor()</code>的作用，这里我们在源码中仔细说明一下, 通过这个源码 我们知道设置主题要在<code>setContentView()</code>之前去调用，如用代码设置<code>requestWindowFeature()</code>设置主题时要在<code>setContentView()</code>之前设置才有用.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">installDecor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mDecor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 内部就是new 一个 DecorView</span>
		mDecor <span class="token operator">=</span> <span class="token function">generateDecor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mDecor<span class="token punctuation">.</span><span class="token function">setDescendantFocusability</span><span class="token punctuation">(</span><span class="token class-name">ViewGroup</span><span class="token punctuation">.</span>FOCUS_AFTER_DESCENDANTS<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mDecor<span class="token punctuation">.</span><span class="token function">setIsRootNamespace</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mInvalidatePanelMenuPosted <span class="token operator">&amp;&amp;</span> mInvalidatePanelMenuFeatures <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mDecor<span class="token punctuation">.</span><span class="token function">postOnAnimation</span><span class="token punctuation">(</span>mInvalidatePanelMenuRunnable<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mContentParent <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 根据当前主题去选择对应的布局文件，然后把布局中的id=content(一般为FrameLayout)部分赋值给mContentParent.</span>
		mContentParent <span class="token operator">=</span> <span class="token function">generateLayout</span><span class="token punctuation">(</span>mDecor<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Set up decor part of UI to ignore fitsSystemWindows if appropriate.</span>
		mDecor<span class="token punctuation">.</span><span class="token function">makeOptionalFitsSystemWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">final</span> <span class="token class-name">DecorContentParent</span> decorContentParent <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">DecorContentParent</span><span class="token punctuation">)</span> mDecor<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span>
				<span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>decor_content_parent<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>decorContentParent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mDecorContentParent <span class="token operator">=</span> decorContentParent<span class="token punctuation">;</span>
			mDecorContentParent<span class="token punctuation">.</span><span class="token function">setWindowCallback</span><span class="token punctuation">(</span><span class="token function">getCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mDecorContentParent<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mDecorContentParent<span class="token punctuation">.</span><span class="token function">setWindowTitle</span><span class="token punctuation">(</span>mTitle<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">final</span> <span class="token keyword">int</span> localFeatures <span class="token operator">=</span> <span class="token function">getLocalFeatures</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> FEATURE_MAX<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>localFeatures <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					mDecorContentParent<span class="token punctuation">.</span><span class="token function">initFeature</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>

			mDecorContentParent<span class="token punctuation">.</span><span class="token function">setUiOptions</span><span class="token punctuation">(</span>mUiOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mResourcesSetFlags <span class="token operator">&amp;</span> FLAG_RESOURCE_SET_ICON<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">||</span>
					<span class="token punctuation">(</span>mIconRes <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mDecorContentParent<span class="token punctuation">.</span><span class="token function">hasIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mDecorContentParent<span class="token punctuation">.</span><span class="token function">setIcon</span><span class="token punctuation">(</span>mIconRes<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mResourcesSetFlags <span class="token operator">&amp;</span> FLAG_RESOURCE_SET_ICON<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
					mIconRes <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mDecorContentParent<span class="token punctuation">.</span><span class="token function">hasIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mDecorContentParent<span class="token punctuation">.</span><span class="token function">setIcon</span><span class="token punctuation">(</span>
						<span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDefaultActivityIcon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				mResourcesSetFlags <span class="token operator">|=</span> FLAG_RESOURCE_SET_ICON_FALLBACK<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mResourcesSetFlags <span class="token operator">&amp;</span> FLAG_RESOURCE_SET_LOGO<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">||</span>
					<span class="token punctuation">(</span>mLogoRes <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mDecorContentParent<span class="token punctuation">.</span><span class="token function">hasLogo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mDecorContentParent<span class="token punctuation">.</span><span class="token function">setLogo</span><span class="token punctuation">(</span>mLogoRes<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// Invalidate if the panel menu hasn&#39;t been created before this.</span>
			<span class="token comment">// Panel menu invalidation is deferred avoiding application onCreateOptionsMenu</span>
			<span class="token comment">// being called in the middle of onCreate or similar.</span>
			<span class="token comment">// A pending invalidation will typically be resolved before the posted message</span>
			<span class="token comment">// would run normally in order to satisfy instance state restoration.</span>
			<span class="token class-name">PanelFeatureState</span> st <span class="token operator">=</span> <span class="token function">getPanelState</span><span class="token punctuation">(</span>FEATURE_OPTIONS_PANEL<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isDestroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>st <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> st<span class="token punctuation">.</span>menu <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">invalidatePanelMenu</span><span class="token punctuation">(</span>FEATURE_ACTION_BAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			mTitleView <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TextView</span><span class="token punctuation">)</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mTitleView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mTitleView<span class="token punctuation">.</span><span class="token function">setLayoutDirection</span><span class="token punctuation">(</span>mDecor<span class="token punctuation">.</span><span class="token function">getLayoutDirection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">getLocalFeatures</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> FEATURE_NO_TITLE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token class-name">View</span> titleContainer <span class="token operator">=</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>
							<span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>title_container<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>titleContainer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						titleContainer<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span>GONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
						mTitleView<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span>GONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>mContentParent <span class="token keyword">instanceof</span> <span class="token class-name">FrameLayout</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">FrameLayout</span><span class="token punctuation">)</span>mContentParent<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setForeground</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					mTitleView<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span>mTitle<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>mDecor<span class="token punctuation">.</span><span class="token function">getBackground</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mBackgroundFallbackResource <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mDecor<span class="token punctuation">.</span><span class="token function">setBackgroundFallback</span><span class="token punctuation">(</span>mBackgroundFallbackResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Only inflate or create a new TransitionManager if the caller hasn&#39;t</span>
		<span class="token comment">// already set a custom one.</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasFeature</span><span class="token punctuation">(</span>FEATURE_ACTIVITY_TRANSITIONS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mTransitionManager <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">final</span> <span class="token keyword">int</span> transitionRes <span class="token operator">=</span> <span class="token function">getWindowStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResourceId</span><span class="token punctuation">(</span>
						<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowContentTransitionManager<span class="token punctuation">,</span>
						<span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>transitionRes <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">final</span> <span class="token class-name">TransitionInflater</span> inflater <span class="token operator">=</span> <span class="token class-name">TransitionInflater</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					mTransitionManager <span class="token operator">=</span> inflater<span class="token punctuation">.</span><span class="token function">inflateTransitionManager</span><span class="token punctuation">(</span>transitionRes<span class="token punctuation">,</span>
							mContentParent<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					mTransitionManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TransitionManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>

			mEnterTransition <span class="token operator">=</span> <span class="token function">getTransition</span><span class="token punctuation">(</span>mEnterTransition<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
					<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowEnterTransition<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mReturnTransition <span class="token operator">=</span> <span class="token function">getTransition</span><span class="token punctuation">(</span>mReturnTransition<span class="token punctuation">,</span> USE_DEFAULT_TRANSITION<span class="token punctuation">,</span>
					<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowReturnTransition<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mExitTransition <span class="token operator">=</span> <span class="token function">getTransition</span><span class="token punctuation">(</span>mExitTransition<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
					<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowExitTransition<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mReenterTransition <span class="token operator">=</span> <span class="token function">getTransition</span><span class="token punctuation">(</span>mReenterTransition<span class="token punctuation">,</span> USE_DEFAULT_TRANSITION<span class="token punctuation">,</span>
					<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowReenterTransition<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mSharedElementEnterTransition <span class="token operator">=</span> <span class="token function">getTransition</span><span class="token punctuation">(</span>mSharedElementEnterTransition<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
					<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowSharedElementEnterTransition<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mSharedElementReturnTransition <span class="token operator">=</span> <span class="token function">getTransition</span><span class="token punctuation">(</span>mSharedElementReturnTransition<span class="token punctuation">,</span>
					USE_DEFAULT_TRANSITION<span class="token punctuation">,</span>
					<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowSharedElementReturnTransition<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mSharedElementExitTransition <span class="token operator">=</span> <span class="token function">getTransition</span><span class="token punctuation">(</span>mSharedElementExitTransition<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
					<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowSharedElementExitTransition<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mSharedElementReenterTransition <span class="token operator">=</span> <span class="token function">getTransition</span><span class="token punctuation">(</span>mSharedElementReenterTransition<span class="token punctuation">,</span>
					USE_DEFAULT_TRANSITION<span class="token punctuation">,</span>
					<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowSharedElementReenterTransition<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mAllowEnterTransitionOverlap <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mAllowEnterTransitionOverlap <span class="token operator">=</span> <span class="token function">getWindowStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span>
						<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowAllowEnterTransitionOverlap<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mAllowReturnTransitionOverlap <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mAllowReturnTransitionOverlap <span class="token operator">=</span> <span class="token function">getWindowStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span>
						<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowAllowReturnTransitionOverlap<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mBackgroundFadeDurationMillis <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mBackgroundFadeDurationMillis <span class="token operator">=</span> <span class="token function">getWindowStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInteger</span><span class="token punctuation">(</span>
						<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowTransitionBackgroundFadeDuration<span class="token punctuation">,</span>
						DEFAULT_BACKGROUND_FADE_DURATION_MS<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mSharedElementsUseOverlay <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mSharedElementsUseOverlay <span class="token operator">=</span> <span class="token function">getWindowStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span>
						<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowSharedElementsUseOverlay<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们先看一下<code>generateLayout</code>的源码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">ViewGroup</span> <span class="token function">generateLayout</span><span class="token punctuation">(</span><span class="token class-name">DecorView</span> decor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token comment">// Apply data from current theme.</span>

	<span class="token class-name">TypedArray</span> a <span class="token operator">=</span> <span class="token function">getWindowStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;From style:&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token string">&quot;Attrs:&quot;</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			s <span class="token operator">=</span> s <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span>
					<span class="token operator">+</span> a<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	mIsFloating <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowIsFloating<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> flagsToUpdate <span class="token operator">=</span> <span class="token punctuation">(</span>FLAG_LAYOUT_IN_SCREEN<span class="token operator">|</span>FLAG_LAYOUT_INSET_DECOR<span class="token punctuation">)</span>
			<span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token function">getForcedWindowFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mIsFloating<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">setLayout</span><span class="token punctuation">(</span>WRAP_CONTENT<span class="token punctuation">,</span> WRAP_CONTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">setFlags</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> flagsToUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token function">setFlags</span><span class="token punctuation">(</span>FLAG_LAYOUT_IN_SCREEN<span class="token operator">|</span>FLAG_LAYOUT_INSET_DECOR<span class="token punctuation">,</span> flagsToUpdate<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowNoTitle<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">requestFeature</span><span class="token punctuation">(</span>FEATURE_NO_TITLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowActionBar<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Don&#39;t allow an action bar if there is no title.</span>
		<span class="token function">requestFeature</span><span class="token punctuation">(</span>FEATURE_ACTION_BAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowActionBarOverlay<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">requestFeature</span><span class="token punctuation">(</span>FEATURE_ACTION_BAR_OVERLAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowActionModeOverlay<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">requestFeature</span><span class="token punctuation">(</span>FEATURE_ACTION_MODE_OVERLAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowSwipeToDismiss<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">requestFeature</span><span class="token punctuation">(</span>FEATURE_SWIPE_TO_DISMISS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowFullscreen<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">setFlags</span><span class="token punctuation">(</span>FLAG_FULLSCREEN<span class="token punctuation">,</span> FLAG_FULLSCREEN <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token function">getForcedWindowFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowTranslucentStatus<span class="token punctuation">,</span>
			<span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">setFlags</span><span class="token punctuation">(</span>FLAG_TRANSLUCENT_STATUS<span class="token punctuation">,</span> FLAG_TRANSLUCENT_STATUS
				<span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token function">getForcedWindowFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowTranslucentNavigation<span class="token punctuation">,</span>
			<span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">setFlags</span><span class="token punctuation">(</span>FLAG_TRANSLUCENT_NAVIGATION<span class="token punctuation">,</span> FLAG_TRANSLUCENT_NAVIGATION
				<span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token function">getForcedWindowFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowOverscan<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">setFlags</span><span class="token punctuation">(</span>FLAG_LAYOUT_IN_OVERSCAN<span class="token punctuation">,</span> FLAG_LAYOUT_IN_OVERSCAN<span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token function">getForcedWindowFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowShowWallpaper<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">setFlags</span><span class="token punctuation">(</span>FLAG_SHOW_WALLPAPER<span class="token punctuation">,</span> FLAG_SHOW_WALLPAPER<span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token function">getForcedWindowFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowEnableSplitTouch<span class="token punctuation">,</span>
			<span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getApplicationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>targetSdkVersion
					<span class="token operator">&gt;=</span> <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Build</span><span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>HONEYCOMB<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">setFlags</span><span class="token punctuation">(</span>FLAG_SPLIT_TOUCH<span class="token punctuation">,</span> FLAG_SPLIT_TOUCH<span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token function">getForcedWindowFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	a<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowMinWidthMajor<span class="token punctuation">,</span> mMinWidthMajor<span class="token punctuation">)</span><span class="token punctuation">;</span>
	a<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowMinWidthMinor<span class="token punctuation">,</span> mMinWidthMinor<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">hasValue</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowFixedWidthMajor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mFixedWidthMajor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> mFixedWidthMajor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypedValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		a<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowFixedWidthMajor<span class="token punctuation">,</span>
				mFixedWidthMajor<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">hasValue</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowFixedWidthMinor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mFixedWidthMinor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> mFixedWidthMinor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypedValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		a<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowFixedWidthMinor<span class="token punctuation">,</span>
				mFixedWidthMinor<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">hasValue</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowFixedHeightMajor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mFixedHeightMajor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> mFixedHeightMajor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypedValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		a<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowFixedHeightMajor<span class="token punctuation">,</span>
				mFixedHeightMajor<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">hasValue</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowFixedHeightMinor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mFixedHeightMinor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> mFixedHeightMinor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypedValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		a<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowFixedHeightMinor<span class="token punctuation">,</span>
				mFixedHeightMinor<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowContentTransitions<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">requestFeature</span><span class="token punctuation">(</span>FEATURE_CONTENT_TRANSITIONS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowActivityTransitions<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">requestFeature</span><span class="token punctuation">(</span>FEATURE_ACTIVITY_TRANSITIONS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">final</span> <span class="token class-name">WindowManager</span> windowService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">WindowManager</span><span class="token punctuation">)</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span>
			<span class="token class-name">Context</span><span class="token punctuation">.</span>WINDOW_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>windowService <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">final</span> <span class="token class-name">Display</span> display <span class="token operator">=</span> windowService<span class="token punctuation">.</span><span class="token function">getDefaultDisplay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token keyword">boolean</span> shouldUseBottomOutset <span class="token operator">=</span>
				display<span class="token punctuation">.</span><span class="token function">getDisplayId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Display</span><span class="token punctuation">.</span>DEFAULT_DISPLAY
						<span class="token operator">||</span> <span class="token punctuation">(</span><span class="token function">getForcedWindowFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> FLAG_FULLSCREEN<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>shouldUseBottomOutset <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">.</span><span class="token function">hasValue</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowOutsetBottom<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mOutsetBottom <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> mOutsetBottom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypedValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			a<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowOutsetBottom<span class="token punctuation">,</span>
					mOutsetBottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">final</span> <span class="token class-name">Context</span> context <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> targetSdk <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getApplicationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>targetSdkVersion<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">boolean</span> targetPreHoneycomb <span class="token operator">=</span> targetSdk <span class="token operator">&lt;</span> <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Build</span><span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>HONEYCOMB<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">boolean</span> targetPreIcs <span class="token operator">=</span> targetSdk <span class="token operator">&lt;</span> <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Build</span><span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>ICE_CREAM_SANDWICH<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">boolean</span> targetPreL <span class="token operator">=</span> targetSdk <span class="token operator">&lt;</span> <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Build</span><span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>LOLLIPOP<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">boolean</span> targetHcNeedsOptions <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span>
			<span class="token class-name">R</span><span class="token punctuation">.</span>bool<span class="token punctuation">.</span>target_honeycomb_needs_options_menu<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">boolean</span> noActionBar <span class="token operator">=</span> <span class="token operator">!</span><span class="token function">hasFeature</span><span class="token punctuation">(</span>FEATURE_ACTION_BAR<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">hasFeature</span><span class="token punctuation">(</span>FEATURE_NO_TITLE<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>targetPreHoneycomb <span class="token operator">||</span> <span class="token punctuation">(</span>targetPreIcs <span class="token operator">&amp;&amp;</span> targetHcNeedsOptions <span class="token operator">&amp;&amp;</span> noActionBar<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">addFlags</span><span class="token punctuation">(</span><span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>FLAG_NEEDS_MENU_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token function">clearFlags</span><span class="token punctuation">(</span><span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>FLAG_NEEDS_MENU_KEY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Non-floating windows on high end devices must put up decor beneath the system bars and</span>
	<span class="token comment">// therefore must know about visibility changes of those.</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mIsFloating <span class="token operator">&amp;&amp;</span> <span class="token class-name">ActivityManager</span><span class="token punctuation">.</span><span class="token function">isHighEndGfx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>targetPreL <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span>
				<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowDrawsSystemBarBackgrounds<span class="token punctuation">,</span>
				<span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">setFlags</span><span class="token punctuation">(</span>FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS<span class="token punctuation">,</span>
					FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS <span class="token operator">&amp;</span> <span class="token operator">~</span><span class="token function">getForcedWindowFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mForcedStatusBarColor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mStatusBarColor <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_statusBarColor<span class="token punctuation">,</span> <span class="token number">0xFF000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mForcedNavigationBarColor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mNavigationBarColor <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_navigationBarColor<span class="token punctuation">,</span> <span class="token number">0xFF000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>mAlwaysReadCloseOnTouchAttr <span class="token operator">||</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getApplicationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>targetSdkVersion
			<span class="token operator">&gt;=</span> <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Build</span><span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>HONEYCOMB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span>
				<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowCloseOnTouchOutside<span class="token punctuation">,</span>
				<span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">setCloseOnTouchOutsideIfNotSet</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span> params <span class="token operator">=</span> <span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasSoftInputMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		params<span class="token punctuation">.</span>softInputMode <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>
				<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowSoftInputMode<span class="token punctuation">,</span>
				params<span class="token punctuation">.</span>softInputMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_backgroundDimEnabled<span class="token punctuation">,</span>
			mIsFloating<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">/* All dialogs should have the window dimmed */</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">getForcedWindowFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>FLAG_DIM_BEHIND<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			params<span class="token punctuation">.</span>flags <span class="token operator">|=</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>FLAG_DIM_BEHIND<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">haveDimAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			params<span class="token punctuation">.</span>dimAmount <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getFloat</span><span class="token punctuation">(</span>
					<span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_backgroundDimAmount<span class="token punctuation">,</span> <span class="token number">0.5f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>windowAnimations <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		params<span class="token punctuation">.</span>windowAnimations <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getResourceId</span><span class="token punctuation">(</span>
				<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowAnimationStyle<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// The rest are only done if this window is not embedded; otherwise,</span>
	<span class="token comment">// the values are inherited from our container.</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mBackgroundDrawable <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mBackgroundResource <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mBackgroundResource <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getResourceId</span><span class="token punctuation">(</span>
						<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowBackground<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mFrameResource <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mFrameResource <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getResourceId</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowFrame<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			mBackgroundFallbackResource <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getResourceId</span><span class="token punctuation">(</span>
					<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowBackgroundFallback<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Background: &quot;</span>
						<span class="token operator">+</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>mBackgroundResource<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; Frame: &quot;</span>
						<span class="token operator">+</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>mFrameResource<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		mElevation <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getDimension</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowElevation<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mClipToOutline <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowClipToOutline<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mTextColor <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_textColor<span class="token punctuation">,</span> <span class="token class-name">Color</span><span class="token punctuation">.</span>TRANSPARENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 上面的那一块都是对Activity中设置的主题进行判断。下面就是根据不同的主题，选择不同的布局文件。</span>
	<span class="token comment">// Inflate the window decor.</span>

	<span class="token keyword">int</span> layoutResource<span class="token punctuation">;</span>
	<span class="token keyword">int</span> features <span class="token operator">=</span> <span class="token function">getLocalFeatures</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// System.out.println(&quot;Features: 0x&quot; + Integer.toHexString(features));</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>features <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> FEATURE_SWIPE_TO_DISMISS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		layoutResource <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>screen_swipe_dismiss<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>features <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> FEATURE_LEFT_ICON<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> FEATURE_RIGHT_ICON<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mIsFloating<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">TypedValue</span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypedValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resolveAttribute</span><span class="token punctuation">(</span>
					<span class="token class-name">R</span><span class="token punctuation">.</span>attr<span class="token punctuation">.</span>dialogTitleIconsDecorLayout<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			layoutResource <span class="token operator">=</span> res<span class="token punctuation">.</span>resourceId<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			layoutResource <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>screen_title_icons<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// XXX Remove this once action bar supports these features.</span>
		<span class="token function">removeFeature</span><span class="token punctuation">(</span>FEATURE_ACTION_BAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// System.out.println(&quot;Title Icons!&quot;);</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>features <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> FEATURE_PROGRESS<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> FEATURE_INDETERMINATE_PROGRESS<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span>
			<span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>features <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> FEATURE_ACTION_BAR<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Special case for a window with only a progress bar (and title).</span>
		<span class="token comment">// XXX Need to have a no-title version of embedded windows.</span>
		layoutResource <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>screen_progress<span class="token punctuation">;</span>
		<span class="token comment">// System.out.println(&quot;Progress!&quot;);</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>features <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> FEATURE_CUSTOM_TITLE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Special case for a window with a custom title.</span>
		<span class="token comment">// If the window is floating, we need a dialog layout</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mIsFloating<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">TypedValue</span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypedValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resolveAttribute</span><span class="token punctuation">(</span>
					<span class="token class-name">R</span><span class="token punctuation">.</span>attr<span class="token punctuation">.</span>dialogCustomTitleDecorLayout<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			layoutResource <span class="token operator">=</span> res<span class="token punctuation">.</span>resourceId<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			layoutResource <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>screen_custom_title<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// XXX Remove this once action bar supports these features.</span>
		<span class="token function">removeFeature</span><span class="token punctuation">(</span>FEATURE_ACTION_BAR<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>features <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> FEATURE_NO_TITLE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// If no other features and not embedded, only need a title.</span>
		<span class="token comment">// If the window is floating, we need a dialog layout</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mIsFloating<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">TypedValue</span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TypedValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">resolveAttribute</span><span class="token punctuation">(</span>
					<span class="token class-name">R</span><span class="token punctuation">.</span>attr<span class="token punctuation">.</span>dialogTitleDecorLayout<span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			layoutResource <span class="token operator">=</span> res<span class="token punctuation">.</span>resourceId<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>features <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> FEATURE_ACTION_BAR<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			layoutResource <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getResourceId</span><span class="token punctuation">(</span>
					<span class="token class-name">R</span><span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>Window_windowActionBarFullscreenDecorLayout<span class="token punctuation">,</span>
					<span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>screen_action_bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			layoutResource <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>screen_title<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// System.out.println(&quot;Title!&quot;);</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>features <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> FEATURE_ACTION_MODE_OVERLAY<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		layoutResource <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>screen_simple_overlay_action_mode<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token comment">// Embedded, so no decoration is needed.</span>
		layoutResource <span class="token operator">=</span> <span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>screen_simple<span class="token punctuation">;</span>
		<span class="token comment">// System.out.println(&quot;Simple!&quot;);</span>
	<span class="token punctuation">}</span>

	mDecor<span class="token punctuation">.</span><span class="token function">startChanging</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// inflate对应的布局文件，并添加到mDecor中。</span>
	<span class="token class-name">View</span> in <span class="token operator">=</span> mLayoutInflater<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span>layoutResource<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	decor<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ViewGroup<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">(</span>MATCH_PARENT<span class="token punctuation">,</span> MATCH_PARENT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mContentRoot <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ViewGroup</span><span class="token punctuation">)</span> in<span class="token punctuation">;</span>

	<span class="token comment">// 找到布局中android:id=&quot;@android:id/content&quot;。的ViewGroup赋值给contentParent,一般是FrameLayout</span>
	<span class="token class-name">ViewGroup</span> contentParent <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ViewGroup</span><span class="token punctuation">)</span><span class="token function">findViewById</span><span class="token punctuation">(</span>ID_ANDROID_CONTENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>contentParent <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Window couldn&#39;t find content container view&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>features <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> FEATURE_INDETERMINATE_PROGRESS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">ProgressBar</span> progress <span class="token operator">=</span> <span class="token function">getCircularProgressBar</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>progress <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			progress<span class="token punctuation">.</span><span class="token function">setIndeterminate</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>features <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> FEATURE_SWIPE_TO_DISMISS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">registerSwipeCallbacks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Remaining setup -- of background and title -- that only applies</span>
	<span class="token comment">// to top-level windows.</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">final</span> <span class="token class-name">Drawable</span> background<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mBackgroundResource <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			background <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDrawable</span><span class="token punctuation">(</span>mBackgroundResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			background <span class="token operator">=</span> mBackgroundDrawable<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		mDecor<span class="token punctuation">.</span><span class="token function">setWindowBackground</span><span class="token punctuation">(</span>background<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">final</span> <span class="token class-name">Drawable</span> frame<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mFrameResource <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			frame <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDrawable</span><span class="token punctuation">(</span>mFrameResource<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			frame <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		mDecor<span class="token punctuation">.</span><span class="token function">setWindowFrame</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span><span class="token punctuation">;</span>

		mDecor<span class="token punctuation">.</span><span class="token function">setElevation</span><span class="token punctuation">(</span>mElevation<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mDecor<span class="token punctuation">.</span><span class="token function">setClipToOutline</span><span class="token punctuation">(</span>mClipToOutline<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>mTitle <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">setTitle</span><span class="token punctuation">(</span>mTitle<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>mTitleColor <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mTitleColor <span class="token operator">=</span> mTextColor<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token function">setTitleColor</span><span class="token punctuation">(</span>mTitleColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	mDecor<span class="token punctuation">.</span><span class="token function">finishChanging</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> contentParent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>	
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面看到有很多相应主题的布局文件，我们就以典型的<code>R.layout.screen_title</code>为例看一下。</p><div class="language-xml ext-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LinearLayout</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://schemas.android.com/apk/res/android<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>orientation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vertical<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>fitsSystemWindows</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- Popout bar for action modes --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ViewStub</span> <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/action_mode_bar_stub<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name"><span class="token namespace">android:</span>inflatedId</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@+id/action_mode_bar<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name"><span class="token namespace">android:</span>layout</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@layout/action_mode_bar<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wrap_content<span class="token punctuation">&quot;</span></span>
              <span class="token attr-name"><span class="token namespace">android:</span>theme</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>?attr/actionBarTheme<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
	// 标题
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FrameLayout</span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span> 
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>?android:attr/windowTitleSize<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>?android:attr/windowTitleBackgroundStyle<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span> <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@android:id/title<span class="token punctuation">&quot;</span></span> 
            <span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>?android:attr/windowTitleStyle<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>background</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@null<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>fadingEdge</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>horizontal<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>gravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>center_vertical<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>FrameLayout</span><span class="token punctuation">&gt;</span></span>
	// 页面内容
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FrameLayout</span> <span class="token attr-name"><span class="token namespace">android:</span>id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>@android:id/content<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>match_parent<span class="token punctuation">&quot;</span></span> 
        <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0dip<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>layout_weight</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>foregroundGravity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>fill_horizontal|top<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>foreground</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>?android:attr/windowContentOverlay<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LinearLayout</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看到这里基本差不多了，我们就以第一次调用<code>setContentView</code>方法为例总结一下整体的流程。</p><ul><li>第一次调用<code>setContentView()</code>方法时会去创建一个<code>DecorView</code>，这就是整个窗口的根布局。</li><li>接着回去根据我们设置的对应主题，来加载与之对应的布局文件并将其添加到<code>DecorView</code>中，然后找到该布局中<code>id=content</code>的<code>ViewGroup</code>赋值给<code>mContentParent</code>。</li><li>将我们要设置的<code>Activity</code>对应的布局添加到<code>mContentParent</code>中。</li></ul><hr><ul><li>邮箱 ：charon.chui@gmail.com</li><li>Good Luck!</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/android-note/assets/app.89e8a229.js" defer></script>
  </body>
</html>

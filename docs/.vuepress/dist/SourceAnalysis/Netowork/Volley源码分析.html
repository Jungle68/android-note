<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.47">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Android Notes</title><meta name="description" content="一个 Android 技术记录文档">
    <link rel="modulepreload" href="/android-note/assets/app.89e8a229.js"><link rel="modulepreload" href="/android-note/assets/Volley源码分析.html.d4e4b484.js"><link rel="modulepreload" href="/android-note/assets/Volley源码分析.html.d24ca0e9.js"><link rel="prefetch" href="/android-note/assets/index.html.8bd0e776.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.7e59ca03.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.c477e23d.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.8ae3b627.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.d2e9fd43.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.c3aa8849.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.e39fb926.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.24d347d7.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.d974bc5d.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.e5751fb9.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.0e899c35.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.6ec105de.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.5d07c2c2.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.820183b1.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.ea867ee7.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.e0f11045.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.22b42870.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.61dfcc93.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.3cd2d991.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.ecfe19bd.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.570ee8a4.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.f8aba27b.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.1d392d64.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.9559fa68.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.ed0822f0.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.dc7889f9.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.3020c3be.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.073c39e0.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.8baf198e.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.51e0046b.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.5bd737af.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.1159aa8f.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.7c3e31b6.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.8ab8a2cc.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.e50646bb.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.f8bdc563.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.f120c888.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.1f8b3f62.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.96ecc87a.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.1b541a89.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.998dc7dc.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.0cbd4bdb.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.6cf7c851.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.d7db60a7.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.2f79a0af.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.f4db4c13.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.a286106e.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.de385267.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.b8bbd45f.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.2e8c4081.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.c39ce824.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.244019e6.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.7e587735.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.e625c50f.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.225da764.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.78211940.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.9c72d222.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.e192df98.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.9b54500d.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.f28a57f0.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.a093a882.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.2b0af47b.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.e441b7fd.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.7bc27bce.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.fbfbbb8a.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.4e2ae931.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.1319d9f7.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.e2f05584.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.9b6cca73.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.741df4a3.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.57a2cd66.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.57f05d22.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.722980d0.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.15a7fa24.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.cd786a69.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.7cd4845a.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.9db13890.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.819c1c88.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.4b8cb269.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.4ea9b161.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.844e0d9d.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.3bc9ff9e.js"><link rel="prefetch" href="/android-note/assets/病毒.html.7619f49a.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.4c49d5e1.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.2a88d555.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.8765e43b.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.cfb14486.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.fe974a62.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.00182d24.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.247dc68f.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.96572e52.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.653a3c88.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.eac67d7b.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.238e6553.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.27594cde.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.05e678bb.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.58f90a22.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.cdacbd38.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.e91c5d3e.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.fa9bacd0.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.94232b6c.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.8dbea4e8.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.20202cc3.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.40d0942f.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.2b05f9c3.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.f5b236bc.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.6952074c.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.323427b3.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.59a6c538.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.1b20bae5.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.3f8c1a56.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.fa61902d.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.b4741bb9.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.df8708de.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.0e6309ee.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.74b808b7.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.5e76b5d1.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.39b59b79.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.1041f4f4.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.4fcf5dcb.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.9a1e399b.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.52b2b04d.js"><link rel="prefetch" href="/android-note/assets/单链表.html.f419429a.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.db38b6c6.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.4e2b2a81.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.f0d24ad9.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.f7a3cc92.js"><link rel="prefetch" href="/android-note/assets/死锁.html.ec93d9d3.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.24e33318.js"><link rel="prefetch" href="/android-note/assets/算法.html.0a01e9ba.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.fbaeb1bd.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.1dff0557.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.e6733f54.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.a855a233.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.ddbbaf1e.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.8e0796a3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.18ccf0d4.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.e4c68b6e.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.afea2f74.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.e49e1c52.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.d2a307b1.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.9c599d21.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.d5da1eb6.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.80367240.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.0a73d443.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.ebaba068.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.13bba357.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.a8c42ae7.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.735f795b.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.8f2cca4a.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.22dab991.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.7018659f.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.f551bb7a.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.4b2076fc.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.cdc3013a.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.7835fb45.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.6109676b.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.14b9a7a7.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.7d96a52b.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.6aa91caa.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.f388a863.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.489c39d7.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.d64f0a72.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.9070678b.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.572b02f6.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.5f41a7d3.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.662b2630.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.5df647ad.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.892325da.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.76d8e5df.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.389a237c.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.b5905bd6.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.afbd099f.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.efba877c.js"><link rel="prefetch" href="/android-note/assets/404.html.93146c89.js"><link rel="prefetch" href="/android-note/assets/index.html.a3d1ed7b.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.a64d1991.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.34218e19.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.7b54b523.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.89bd0ab9.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.103f1200.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.c8e634bf.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.7624414c.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.98a6217e.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.e0cbd1b3.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.d07ae209.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.1a7412c1.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.fae25f98.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.a45462e1.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.0e42552a.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.fac83de9.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.946e9782.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.75dd3aa7.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.b99bea93.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.024e40a5.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.17601c25.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.e4dd3dff.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.b8f61c98.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.e4a0b5c1.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.5c2a56e3.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.771b598f.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.ec948576.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.968e5163.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.b91f279b.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.e5d334b3.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.16b555ba.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.38d70312.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.630ea31f.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.6a608b01.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.c7294606.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.d153b865.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.0788dd70.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.c4f2cabf.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.4ffa43cf.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.7160a49a.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.cdc28261.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.ca3b8f37.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.04dae4e9.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.b2eee048.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.43f5056a.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.7e9d24cb.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.fe0e18e4.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.9692f10a.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.a035f300.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.daf97b10.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.4b3a8a75.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.c9b0c208.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.f56d8adb.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.27b4fbd7.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.019759be.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.c6e22d33.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.ddae6365.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.89a53b41.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.4034729a.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.213d99fd.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.4a292186.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.26281ec4.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.711522c7.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.ca454c03.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.d2d568fe.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.2b23078a.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.e59debb3.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.96161766.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.faa1301d.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.37bcd8c4.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.037d5f51.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.20dd3611.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.8477f837.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.379af02f.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.46a9b2e4.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.2d58e745.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.c608688f.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.bfa9e3d0.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.5511f591.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.6e584085.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.6b73df63.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.fbac04fc.js"><link rel="prefetch" href="/android-note/assets/病毒.html.5cd88c03.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.b01be570.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.adc8af11.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.e5536922.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.ba3817b8.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.4496e01e.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.aa990bb9.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.b42b4b49.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.02d23272.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.971b5263.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.4ef9b35f.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.02696243.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.3dae42d2.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.b7da17de.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.49e56b2a.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.51a94c44.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.793bc62a.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.d0b4194f.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.3b5da204.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.f85478dc.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.c0b33ce0.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.9cf366a8.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.2db819bd.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.0df280d7.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.b857d0ab.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.6daec307.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.21b0f237.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.69e343c0.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.164e8303.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.124cdb1e.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.facc0566.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.f48859b0.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.2c4caa9a.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.1273fefc.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.f1e06473.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.52f84c68.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.ed4970f5.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.7bc7d93a.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.9e31d408.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.84866fc9.js"><link rel="prefetch" href="/android-note/assets/单链表.html.4400da11.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.757c2b22.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.28fdc49e.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.2ee7fbf3.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.ab0fdf74.js"><link rel="prefetch" href="/android-note/assets/死锁.html.2dfc5516.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.4ca60911.js"><link rel="prefetch" href="/android-note/assets/算法.html.18c6261d.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.665d4e8a.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.9917c0f8.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.a6e27633.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.592167e3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.6f6c5af5.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.dcd32d84.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.710e4efa.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.27f8d4ad.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.20c931ca.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.038bb020.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.44688c6c.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.49e88efd.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.1d7dfe42.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.e26fe642.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.c0efdbc5.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.96bbc22f.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.a3ea4f26.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.1026b60c.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.b836467c.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.ecb4c8c6.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.014a0e80.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.bf6c619f.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.43a40b19.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.1d72231a.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.39e338b7.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.42bac657.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.7b81876b.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.d5679c84.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.bf97314b.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.28934eff.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.dc598784.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.fe77a4c4.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.86d37938.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.b0173f04.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.da0db26d.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.e8bf8449.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.ed14c462.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.18900a2a.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.8aa50d61.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.9e991b58.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.747f298d.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.4a5af4a7.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.a26fa93a.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.f24adf9a.js"><link rel="prefetch" href="/android-note/assets/404.html.8b61bad2.js"><link rel="prefetch" href="/android-note/assets/404.e8cf6e3a.js"><link rel="prefetch" href="/android-note/assets/Layout.36051849.js">
    <link rel="stylesheet" href="/android-note/assets/style.1f7fd01d.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/android-note/" class=""><!----><span class="site-name">Android Notes</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading"> <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/android-note/SourceAnalysis/Netowork/Volley%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html#volley源码分析" class="router-link-active router-link-exact-active sidebar-item" aria-label="Volley源码分析"><!--[--><!--]--> Volley源码分析 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h2 id="volley源码分析" tabindex="-1"><a class="header-anchor" href="#volley源码分析" aria-hidden="true">#</a> Volley源码分析</h2><ul><li><p>Volley简介</p><p><a href="https://android.googlesource.com/platform/frameworks/volley" target="_blank" rel="noopener noreferrer">volley官方地址<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a><br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/volley.png?raw=true" alt="image"></p><p>在<code>Google I/0 2013</code>中发布了<code>Volley</code>.<code>Volley</code>是<code>Android</code>平台上的网络通信库，能使网络通信更快，更简单，更健壮。</p><p>这是<code>Volley</code>名称的由来:<code>a burst or emission of many things or a large amount at once</code>.<code>Volley</code>特别适合数据量不大但是通信频繁的场景。</p><p><code>Github</code>上面已经有大神做了镜像，使用<code>Gradle</code>更方便。<a href="https://github.com/mcxiaoke/android-volley" target="_blank" rel="noopener noreferrer">Volley On Github<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></li><li><p>Volley使用<br><code>Volley</code>的使用非常方便。</p><ul><li>首先就是要构建一个<code>RequestQueue</code>的请求队列，它可以缓存所有<code>Http</code>请求，内部处理的非常完善，通常我们整个应用只需要一个<code>RequestQueue</code>对象即可。</li><li>创建<code>StringRequest</code>对象，并且传入相应的请求地址以及添加请求成功和失败的回调方法。这一步的意思就是创建一个新的网络请求。</li><li>将刚才新创建的<code>StringRequest</code>对象加入到<code>RequestQueue</code>队列中。这样就相当于会去执行该请求。等到执行成功后就可以在<code>StringRequest</code>中设置的回调方法里面获取到相应的结果。<br> 总结一下，其实挺像我们浏览器的操作，第一步打开浏览器，第二步输入<code>URL</code>地址第三步按回车去执行。</li></ul><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HttpUtil</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">HttpUtil</span> instance<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">RequestQueue</span> mQueue<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">HttpUtil</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mQueue <span class="token operator">=</span> <span class="token class-name">Volley</span><span class="token punctuation">.</span><span class="token function">newRequestQueue</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">synchronized</span> <span class="token class-name">HttpUtil</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>instance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpUtil</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Request</span> <span class="token function">sendGetRequest</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">HttpListener</span> listener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StringRequest</span> stringRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRequest</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Response<span class="token punctuation">.</span>Listener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResponse</span><span class="token punctuation">(</span><span class="token class-name">String</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>listener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    listener<span class="token punctuation">.</span><span class="token function">onResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Response<span class="token punctuation">.</span>ErrorListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onErrorResponse</span><span class="token punctuation">(</span><span class="token class-name">VolleyError</span> error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>listener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    listener<span class="token punctuation">.</span><span class="token function">onErrorResponse</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mQueue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>stringRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> stringRequest<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Request</span> <span class="token function">sendPostRequest</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">HttpListener</span> listener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">StringRequest</span> stringRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRequest</span><span class="token punctuation">(</span><span class="token class-name">Request<span class="token punctuation">.</span>Method</span><span class="token punctuation">.</span>POST<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Response<span class="token punctuation">.</span>Listener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResponse</span><span class="token punctuation">(</span><span class="token class-name">String</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>listener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    listener<span class="token punctuation">.</span><span class="token function">onResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Response<span class="token punctuation">.</span>ErrorListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onErrorResponse</span><span class="token punctuation">(</span><span class="token class-name">VolleyError</span> error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>listener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    listener<span class="token punctuation">.</span><span class="token function">onErrorResponse</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">protected</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthFailureError</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> map<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        mQueue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>stringRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> stringRequest<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Response listener of HttpUtil.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">HttpListener</span> <span class="token punctuation">{</span>

        <span class="token keyword">void</span> <span class="token function">onResponse</span><span class="token punctuation">(</span><span class="token class-name">String</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">void</span> <span class="token function">onErrorResponse</span><span class="token punctuation">(</span><span class="token class-name">VolleyError</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><p>到这里我们就简单的介绍了它的使用，当然还有一些其他的<code>Request</code>对象例如<code>JsonRequest</code>等，他们的使用方法都是一样的，这里就不再说明了。当然<code>Volley</code>里面还提供了对图片的处理，例如<code>NetworkImageView</code>空间和<code>ImageRequest</code>等，因为这里图片用到的不太多，所以暂时不去分析了。</p><p>接下来我们就从源码的角度去分析一下：<br> 这里我们都知道使用的时候最新要初始化一个<code>RequestQueue</code>所以，我们首先看一下<code>Volley.newRequestQueue</code>方法。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Volley</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/** Default on-disk cache directory. */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> DEFAULT_CACHE_DIR <span class="token operator">=</span> <span class="token string">&quot;volley&quot;</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * Creates a default instance of the worker pool and calls <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">RequestQueue</span><span class="token punctuation">#</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> on it.
     * You may set a maximum size of the disk cache in bytes.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">context</span> A <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Context</span></span><span class="token punctuation">}</span> to use for creating the cache dir.
     * <span class="token keyword">@param</span> <span class="token parameter">stack</span> An <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">HttpStack</span></span><span class="token punctuation">}</span> to use for the network, or null for default.
     * <span class="token keyword">@param</span> <span class="token parameter">maxDiskCacheBytes</span> the maximum size of the disk cache, in bytes. Use -1 for default size.
     * <span class="token keyword">@return</span> A started <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">RequestQueue</span></span><span class="token punctuation">}</span> instance.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RequestQueue</span> <span class="token function">newRequestQueue</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">HttpStack</span> stack<span class="token punctuation">,</span> <span class="token keyword">int</span> maxDiskCacheBytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">File</span> cacheDir <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getCacheDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> DEFAULT_CACHE_DIR<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> userAgent <span class="token operator">=</span> <span class="token string">&quot;volley/0&quot;</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> packageName <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">PackageInfo</span> info <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPackageInfo</span><span class="token punctuation">(</span>packageName<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 使用包名和versionCode作为userAgent</span>
            userAgent <span class="token operator">=</span> packageName <span class="token operator">+</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">+</span> info<span class="token punctuation">.</span>versionCode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NameNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>stack <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 在9及以上Volleys使用HttpURLConnection，9一下使用HttpClient。这里是有原因的，因为在9之前HttpURLConnection有Bug。</span>
                <span class="token comment">// 那HttpClient那么好为什么不一直使用它，要在9及以后使用HttpURLConnection呢？这里也是有原因的。从9开始HttpURLConnection</span>
                <span class="token comment">// 将自动添加`Accept-Encoding:gzip`头字段到`request`请求中，并做相应处理，一般我们请求都是字符串，所以压缩可以使数据大小大幅降低。</span>
                <span class="token comment">// 但是这也会带来问题的，之前开发中就遇到过。因为启用了压缩，所以`Content-Lenght`字段返回的是压缩后的大小。使用`getContentLength()`</span>
                <span class="token comment">// 方法去分配解压缩后数据大小是错误的。应该从response中读取字节直到`InputStream.read()`返回-1为止。当时我们在开发下载时就遇到过这个</span>
                <span class="token comment">// 问题，在下载视频时没有问题，但是在下载小说的时候就会发现`content-length`返回值不对。</span>
                <span class="token comment">// 总结一下就是在9之前HttpClient的bug更少，而HttpURLConnection存在严重的Bug。但是从9开始HttpURLConnection更小巧，API更简单，压缩以及</span>
                <span class="token comment">// response cache的使用减少了网络流量，提高了网络速度，也就更省电，所以更适合在Android中使用</span>
                stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HurlStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// Prior to Gingerbread, HttpUrlConnection was unreliable.</span>
                <span class="token comment">// See: http://android-developers.blogspot.com/2011/09/androids-http-clients.html</span>
                stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpClientStack</span><span class="token punctuation">(</span><span class="token class-name">AndroidHttpClient</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>userAgent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 创建BasicNetwork对象，下面会介绍BasicNetwork(HttpStack)方法的内部实现</span>
        <span class="token class-name">Network</span> network <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicNetwork</span><span class="token punctuation">(</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">RequestQueue</span> queue<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>maxDiskCacheBytes <span class="token operator">&lt;=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
                <span class="token comment">// 如果不指定大小的话，默认大小为5M</span>
            <span class="token comment">// No maximum size specified</span>
        	queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RequestQueue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DiskBasedCache</span><span class="token punctuation">(</span>cacheDir<span class="token punctuation">)</span><span class="token punctuation">,</span> network<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{</span>
        	<span class="token comment">// Disk cache size specified</span>
        	queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RequestQueue</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DiskBasedCache</span><span class="token punctuation">(</span>cacheDir<span class="token punctuation">,</span> maxDiskCacheBytes<span class="token punctuation">)</span><span class="token punctuation">,</span> network<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        queue<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> queue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token doc-comment comment">/**
     * Creates a default instance of the worker pool and calls <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">RequestQueue</span><span class="token punctuation">#</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> on it.
     * You may set a maximum size of the disk cache in bytes.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">context</span> A <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Context</span></span><span class="token punctuation">}</span> to use for creating the cache dir.
     * <span class="token keyword">@param</span> <span class="token parameter">maxDiskCacheBytes</span> the maximum size of the disk cache, in bytes. Use -1 for default size.
     * <span class="token keyword">@return</span> A started <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">RequestQueue</span></span><span class="token punctuation">}</span> instance.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RequestQueue</span> <span class="token function">newRequestQueue</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token keyword">int</span> maxDiskCacheBytes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">newRequestQueue</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> maxDiskCacheBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token doc-comment comment">/**
     * Creates a default instance of the worker pool and calls <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">RequestQueue</span><span class="token punctuation">#</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> on it.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">context</span> A <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Context</span></span><span class="token punctuation">}</span> to use for creating the cache dir.
     * <span class="token keyword">@param</span> <span class="token parameter">stack</span> An <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">HttpStack</span></span><span class="token punctuation">}</span> to use for the network, or null for default.
     * <span class="token keyword">@return</span> A started <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">RequestQueue</span></span><span class="token punctuation">}</span> instance.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RequestQueue</span> <span class="token function">newRequestQueue</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">HttpStack</span> stack<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
    	<span class="token keyword">return</span> <span class="token function">newRequestQueue</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> stack<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token doc-comment comment">/**
     * Creates a default instance of the worker pool and calls <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">RequestQueue</span><span class="token punctuation">#</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> on it.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">context</span> A <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Context</span></span><span class="token punctuation">}</span> to use for creating the cache dir.
     * <span class="token keyword">@return</span> A started <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">RequestQueue</span></span><span class="token punctuation">}</span> instance.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">RequestQueue</span> <span class="token function">newRequestQueue</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">newRequestQueue</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接着来看一上上面提到的new BasicNetwork(HttpStack)方法的实现,可以看到他内部的缓存大小是4k</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> DEFAULT_POOL_SIZE <span class="token operator">=</span> <span class="token number">4096</span><span class="token punctuation">;</span>

<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">HttpStack</span> mHttpStack<span class="token punctuation">;</span>

<span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">ByteArrayPool</span> mPool<span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@param</span> <span class="token parameter">httpStack</span> HTTP stack to be used
 */</span>
<span class="token keyword">public</span> <span class="token class-name">BasicNetwork</span><span class="token punctuation">(</span><span class="token class-name">HttpStack</span> httpStack<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// If a pool isn&#39;t passed in, then build a small default pool that will give us a lot of</span>
    <span class="token comment">// benefit and not use too much memory.</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span>httpStack<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayPool</span><span class="token punctuation">(</span>DEFAULT_POOL_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@param</span> <span class="token parameter">httpStack</span> HTTP stack to be used
 * <span class="token keyword">@param</span> <span class="token parameter">pool</span> a buffer pool that improves GC performance in copy operations
 */</span>
<span class="token keyword">public</span> <span class="token class-name">BasicNetwork</span><span class="token punctuation">(</span><span class="token class-name">HttpStack</span> httpStack<span class="token punctuation">,</span> <span class="token class-name">ByteArrayPool</span> pool<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    mHttpStack <span class="token operator">=</span> httpStack<span class="token punctuation">;</span>
    mPool <span class="token operator">=</span> pool<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接着我们还要分析一下<code>RequestQueue</code>的构造方法以及<code>start()</code>方法:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * A request dispatch queue with a thread pool of dispatchers.
 *
 * Calling <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> will enqueue the given Request for dispatch,
 * resolving from either cache or network on a worker thread, and then delivering
 * a parsed response on the main thread.
 */</span><span class="token doc-comment comment">/**
 * A request dispatch queue with a thread pool of dispatchers.
 *
 * Calling <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> will enqueue the given Request for dispatch,
 * resolving from either cache or network on a worker thread, and then delivering
 * a parsed response on the main thread.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequestQueue</span> <span class="token punctuation">{</span>

    <span class="token doc-comment comment">/** Used for generating monotonically-increasing sequence numbers for requests. */</span>
    <span class="token keyword">private</span> <span class="token class-name">AtomicInteger</span> mSequenceGenerator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AtomicInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * Staging area for requests that already have a duplicate request in flight.
     *
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
     *     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>containsKey(cacheKey) indicates that there is a request in flight for the given cache
     *          key.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     *     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>get(cacheKey) returns waiting requests for the given cache key. The in flight request
     *          is <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>not<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span> contained in that list. Is null if no requests are staged.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Queue</span><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> mWaitingRequests <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Queue</span><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * The set of all requests currently being processed by this RequestQueue. A Request
     * will be in this set if it is waiting in any queue or currently being processed by
     * any dispatcher.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> mCurrentRequests <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// cache队列</span>
    <span class="token doc-comment comment">/** The cache triage queue. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">PriorityBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> mCacheQueue <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">PriorityBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 网络请求队列</span>
    <span class="token doc-comment comment">/** The queue of requests that are actually going out to the network. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">PriorityBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> mNetworkQueue <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">PriorityBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** Number of network request dispatcher threads to start. */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> DEFAULT_NETWORK_THREAD_POOL_SIZE <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** Cache interface for retrieving and storing responses. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Cache</span> mCache<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** Network interface for performing requests. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Network</span> mNetwork<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** Response delivery mechanism. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ResponseDelivery</span> mDelivery<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** The network dispatchers. */</span>
    <span class="token keyword">private</span> <span class="token class-name">NetworkDispatcher</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mDispatchers<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** The cache dispatcher. */</span>
    <span class="token keyword">private</span> <span class="token class-name">CacheDispatcher</span> mCacheDispatcher<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * Creates the worker pool. Processing will not begin until <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> is called.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">cache</span> A Cache to use for persisting responses to disk
     * <span class="token keyword">@param</span> <span class="token parameter">network</span> A Network interface for performing HTTP requests
     * <span class="token keyword">@param</span> <span class="token parameter">threadPoolSize</span> Number of network dispatcher threads to create
     * <span class="token keyword">@param</span> <span class="token parameter">delivery</span> A ResponseDelivery interface for posting responses and errors
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">RequestQueue</span><span class="token punctuation">(</span><span class="token class-name">Cache</span> cache<span class="token punctuation">,</span> <span class="token class-name">Network</span> network<span class="token punctuation">,</span> <span class="token keyword">int</span> threadPoolSize<span class="token punctuation">,</span>
            <span class="token class-name">ResponseDelivery</span> delivery<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mCache <span class="token operator">=</span> cache<span class="token punctuation">;</span>
        mNetwork <span class="token operator">=</span> network<span class="token punctuation">;</span>
        mDispatchers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetworkDispatcher</span><span class="token punctuation">[</span>threadPoolSize<span class="token punctuation">]</span><span class="token punctuation">;</span>
        mDelivery <span class="token operator">=</span> delivery<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Creates the worker pool. Processing will not begin until <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> is called.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">cache</span> A Cache to use for persisting responses to disk
     * <span class="token keyword">@param</span> <span class="token parameter">network</span> A Network interface for performing HTTP requests
     * <span class="token keyword">@param</span> <span class="token parameter">threadPoolSize</span> Number of network dispatcher threads to create
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">RequestQueue</span><span class="token punctuation">(</span><span class="token class-name">Cache</span> cache<span class="token punctuation">,</span> <span class="token class-name">Network</span> network<span class="token punctuation">,</span> <span class="token keyword">int</span> threadPoolSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> network<span class="token punctuation">,</span> threadPoolSize<span class="token punctuation">,</span>
                <span class="token keyword">new</span> <span class="token class-name">ExecutorDelivery</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">getMainLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Creates the worker pool. Processing will not begin until <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> is called.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">cache</span> A Cache to use for persisting responses to disk
     * <span class="token keyword">@param</span> <span class="token parameter">network</span> A Network interface for performing HTTP requests
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">RequestQueue</span><span class="token punctuation">(</span><span class="token class-name">Cache</span> cache<span class="token punctuation">,</span> <span class="token class-name">Network</span> network<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 默认大小为4</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>cache<span class="token punctuation">,</span> network<span class="token punctuation">,</span> DEFAULT_NETWORK_THREAD_POOL_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Starts the dispatchers in this queue.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Make sure any currently running dispatchers are stopped.</span>
        <span class="token comment">// Create the cache dispatcher and start it.</span>
        <span class="token comment">// 初始化RequestQueue之后就会调用start方法，内部会开启CacheDispatcher,也是Thread的子类，后面再看里面具体的run方法</span>
        mCacheDispatcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CacheDispatcher</span><span class="token punctuation">(</span>mCacheQueue<span class="token punctuation">,</span> mNetworkQueue<span class="token punctuation">,</span> mCache<span class="token punctuation">,</span> mDelivery<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mCacheDispatcher<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Create network dispatchers (and corresponding threads) up to the pool size.</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mDispatchers<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 创建4个(默认是4个)NetworkDispatcher一直去执行, NetworkDispatcher是Thread的子类，他会不断的去从mNetworkQueue中取出Requet并用</span>
            <span class="token comment">// 并用mNetwork去执行，执行完成后再使用mDelivery去分发相应的结果</span>
            <span class="token class-name">NetworkDispatcher</span> networkDispatcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetworkDispatcher</span><span class="token punctuation">(</span>mNetworkQueue<span class="token punctuation">,</span> mNetwork<span class="token punctuation">,</span>
                    mCache<span class="token punctuation">,</span> mDelivery<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mDispatchers<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> networkDispatcher<span class="token punctuation">;</span>
            networkDispatcher<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 就好像一个工厂一启动，里面就分配了5个搬运工，一个负责搬运cache里面的的请求，4个负责搬运network中的。启动后他们就开始待命</span>
        <span class="token comment">// 一旦有活来了，就开始去取出活开始干。</span>

    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Stops the cache and network dispatchers.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mCacheDispatcher <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mCacheDispatcher<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> mDispatchers<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mDispatchers<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mDispatchers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Gets a sequence number.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getSequenceNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mSequenceGenerator<span class="token punctuation">.</span><span class="token function">incrementAndGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Gets the <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Cache</span></span><span class="token punctuation">}</span> instance being used.
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Cache</span> <span class="token function">getCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mCache<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * A simple predicate or filter interface for Requests, for use by
     * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">RequestQueue</span><span class="token punctuation">#</span><span class="token function">cancelAll</span><span class="token punctuation">(</span><span class="token class-name">RequestFilter</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span>.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RequestFilter</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Cancels all requests in this queue for which the given filter applies.
     * <span class="token keyword">@param</span> <span class="token parameter">filter</span> The filtering function to use
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancelAll</span><span class="token punctuation">(</span><span class="token class-name">RequestFilter</span> filter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mCurrentRequests<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> request <span class="token operator">:</span> mCurrentRequests<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>filter<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    request<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Cancels all requests in this queue with the given tag. Tag must be non-null
     * and equality is by identity.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancelAll</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Object</span> tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>tag <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot cancelAll with a null tag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">cancelAll</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RequestFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> request<span class="token punctuation">.</span><span class="token function">getTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> tag<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Adds a Request to the dispatch queue.
     * <span class="token keyword">@param</span> <span class="token parameter">request</span> The request to service
     * <span class="token keyword">@return</span> The passed-in request
     */</span>
    <span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Tag the request as belonging to this queue and add it to the set of current requests.</span>
        request<span class="token punctuation">.</span><span class="token function">setRequestQueue</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mCurrentRequests<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 添加到mCurrentRequests中，在执行完后的finish方法中会去移除该请求。</span>
            mCurrentRequests<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Process requests in the order they are added.</span>
        request<span class="token punctuation">.</span><span class="token function">setSequence</span><span class="token punctuation">(</span><span class="token function">getSequenceNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token string">&quot;add-to-queue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 判断一下该请求能否进行缓存，如果不能缓存就直接添加到网络请求的队列中。这个能不能缓存是怎么判断的？其实就是根据Request中的一个变量来判断。</span>
　　　　<span class="token comment">// 默认情况下所有的请求都是可以缓存的，可以通过Request.setShouldCache(false)方法，来将其设置为不可缓存状态。</span>
        <span class="token comment">// If the request is uncacheable, skip the cache queue and go straight to the network.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>request<span class="token punctuation">.</span><span class="token function">shouldCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mNetworkQueue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> request<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Insert request into stage if there&#39;s already a request with the same cache key in flight.</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mWaitingRequests<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">String</span> cacheKey <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getCacheKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mWaitingRequests<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// There is already a request in flight. Queue up.</span>
                <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> stagedRequests <span class="token operator">=</span> mWaitingRequests<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>stagedRequests <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    stagedRequests <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                stagedRequests<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
                mWaitingRequests<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">,</span> stagedRequests<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">VolleyLog</span><span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">VolleyLog</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token string">&quot;Request for cacheKey=%s is in flight, putting on hold.&quot;</span><span class="token punctuation">,</span> cacheKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// 如果能缓存，并且缓存线程中没有的时候就讲该请求添加到缓存队列中</span>
                <span class="token comment">// Insert &#39;null&#39; queue for this cacheKey, indicating there is now a request in</span>
                <span class="token comment">// flight.</span>
                mWaitingRequests<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                mCacheQueue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> request<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Called from <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Request</span><span class="token punctuation">#</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span>, indicating that processing of the given request
     * has finished.
     *
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Releases waiting requests for <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span><span class="token code-section"><span class="token line"><span class="token code language-java">request<span class="token punctuation">.</span><span class="token function">getCacheKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span> if
     *      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span><span class="token code-section"><span class="token line"><span class="token code language-java">request<span class="token punctuation">.</span><span class="token function">shouldCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     */</span>
    <span class="token keyword">void</span> <span class="token function">finish</span><span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Remove from the set of requests currently being processed.</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mCurrentRequests<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mCurrentRequests<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">shouldCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>mWaitingRequests<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">String</span> cacheKey <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getCacheKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Queue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> waitingRequests <span class="token operator">=</span> mWaitingRequests<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>cacheKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>waitingRequests <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">VolleyLog</span><span class="token punctuation">.</span>DEBUG<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">VolleyLog</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token string">&quot;Releasing %d waiting requests for cacheKey=%s.&quot;</span><span class="token punctuation">,</span>
                                waitingRequests<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cacheKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">// Process all queued up requests. They won&#39;t be considered as in flight, but</span>
                    <span class="token comment">// that&#39;s not a problem as the cache has been primed by &#39;request&#39;.</span>
                    mCacheQueue<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>waitingRequests<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>看到这里基本都能看的差不多了。官方文档中有句话说的很好，这里用他来总结一下<code>A RequestQueue needs two things to do its job: a network to perform transport of the requests, and a cache to handle caching. </code> 顺便再上一张图:</p><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/volley-request.png?raw=true" alt="image"></p><p>总结完之后我们接着进行分析。因为默认情况下请求都是可缓存的，所以都会被添加到mCacheQueue中。添加该队列之后，就会被开始<code>start</code>方法所制定的cache搬运工去执行，所以我们要看一下CacheDispatcher的实现。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Provides a thread for performing cache triage on a queue of requests.
 *
 * Requests added to the specified cache queue are resolved from cache.
 * Any deliverable response is posted back to the caller via a
 * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">ResponseDelivery</span></span><span class="token punctuation">}</span>.  Cache misses and responses that require
 * refresh are enqueued on the specified network queue for processing
 * by a <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">NetworkDispatcher</span></span><span class="token punctuation">}</span>.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CacheDispatcher</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> DEBUG <span class="token operator">=</span> <span class="token class-name">VolleyLog</span><span class="token punctuation">.</span>DEBUG<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** The queue of requests coming in for triage. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> mCacheQueue<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** The queue of requests going out to the network. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> mNetworkQueue<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** The cache to read from. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Cache</span> mCache<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** For posting responses. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ResponseDelivery</span> mDelivery<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** Used for telling us to die. */</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> mQuit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * Creates a new cache triage dispatcher thread.  You must call <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span>
     * in order to begin processing.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">cacheQueue</span> Queue of incoming requests for triage
     * <span class="token keyword">@param</span> <span class="token parameter">networkQueue</span> Queue to post requests that require network to
     * <span class="token keyword">@param</span> <span class="token parameter">cache</span> Cache interface to use for resolution
     * <span class="token keyword">@param</span> <span class="token parameter">delivery</span> Delivery interface to use for posting responses
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">CacheDispatcher</span><span class="token punctuation">(</span>
            <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> cacheQueue<span class="token punctuation">,</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> networkQueue<span class="token punctuation">,</span>
            <span class="token class-name">Cache</span> cache<span class="token punctuation">,</span> <span class="token class-name">ResponseDelivery</span> delivery<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 将CacheQueue以及networkQueue等传递进来。</span>
        mCacheQueue <span class="token operator">=</span> cacheQueue<span class="token punctuation">;</span>
        mNetworkQueue <span class="token operator">=</span> networkQueue<span class="token punctuation">;</span>
        mCache <span class="token operator">=</span> cache<span class="token punctuation">;</span>
        mDelivery <span class="token operator">=</span> delivery<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Forces this dispatcher to quit immediately.  If any requests are still in
     * the queue, they are not guaranteed to be processed.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mQuit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>DEBUG<span class="token punctuation">)</span> <span class="token class-name">VolleyLog</span><span class="token punctuation">.</span><span class="token function">v</span><span class="token punctuation">(</span><span class="token string">&quot;start new dispatcher&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Process</span><span class="token punctuation">.</span><span class="token function">setThreadPriority</span><span class="token punctuation">(</span><span class="token class-name">Process</span><span class="token punctuation">.</span>THREAD_PRIORITY_BACKGROUND<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Make a blocking call to initialize the cache.</span>
    <span class="token doc-comment comment">/**
     * Performs any potentially long-running actions needed to initialize the cache;
     * will be called from a worker thread.
     */</span>
        mCache<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// 从缓存队列中取出第一个请求</span>
                <span class="token comment">// Get a request from the cache triage queue, blocking until</span>
                <span class="token comment">// at least one is available.</span>
                <span class="token keyword">final</span> <span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> request <span class="token operator">=</span> mCacheQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                request<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token string">&quot;cache-queue-take&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// If the request has been canceled, don&#39;t bother dispatching it.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">isCanceled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    request<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token string">&quot;cache-discard-canceled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// Attempt to retrieve this item from cache.</span>
                <span class="token class-name">Cache<span class="token punctuation">.</span>Entry</span> entry <span class="token operator">=</span> mCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getCacheKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>entry <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 如果缓存中找不到该请求，就把该请求添加到网络请求队列中。</span>
                    request<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token string">&quot;cache-miss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// Cache miss; send off to the network dispatcher.</span>
                    mNetworkQueue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// 如果缓存中找到了该请求，接下来就判断该缓存是否过期。</span>
                <span class="token comment">// If it is completely expired, just send it to the network.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">isExpired</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 过期了也重新添加到网络请求中</span>
                    request<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token string">&quot;cache-hit-expired&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    request<span class="token punctuation">.</span><span class="token function">setCacheEntry</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mNetworkQueue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// 没有过期，就不用再请求了，直接从缓存中取出数据返回即可。</span>
                <span class="token comment">// We have a cache hit; parse its data for delivery back to the request.</span>
                request<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token string">&quot;cache-hit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 这里的意思就是对数据进行解析，后面再看Request.parseNetworkResponse方法。</span>
                <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">parseNetworkResponse</span><span class="token punctuation">(</span>
                        <span class="token keyword">new</span> <span class="token class-name">NetworkResponse</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span>data<span class="token punctuation">,</span> entry<span class="token punctuation">.</span>responseHeaders<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                request<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token string">&quot;cache-hit-parsed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 判断缓存数据是否需要刷新，以便使用mDelivery分发结果或者添加到网络请求队列中</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>entry<span class="token punctuation">.</span><span class="token function">refreshNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// Completely unexpired cache hit. Just deliver the response.</span>
                    mDelivery<span class="token punctuation">.</span><span class="token function">postResponse</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment">// Soft-expired cache hit. We can deliver the cached response,</span>
                    <span class="token comment">// but we need to also send the request to the network for</span>
                    <span class="token comment">// refreshing.</span>
                    request<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token string">&quot;cache-hit-refresh-needed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    request<span class="token punctuation">.</span><span class="token function">setCacheEntry</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">// Mark the response as intermediate.</span>
                    response<span class="token punctuation">.</span>intermediate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

                    <span class="token comment">// Post the intermediate response back to the user and have</span>
                    <span class="token comment">// the delivery then forward the request along to the network.</span>
                    mDelivery<span class="token punctuation">.</span><span class="token function">postResponse</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                                mNetworkQueue<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token comment">// Not much we can do about this.</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// We may have been interrupted because it was time to quit.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mQuit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>而对于网络请求队列中的任务该如何执行，这里就要看<code>NetworkDispatcher</code>的具体实现:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Provides a thread for performing network dispatch from a queue of requests.
 *
 * Requests added to the specified queue are processed from the network via a
 * specified <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Network</span></span><span class="token punctuation">}</span> interface. Responses are committed to cache, if
 * eligible, using a specified <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Cache</span></span><span class="token punctuation">}</span> interface. Valid responses and
 * errors are posted back to the caller via a <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">ResponseDelivery</span></span><span class="token punctuation">}</span>.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NetworkDispatcher</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/** The queue of requests to service. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> mQueue<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** The network interface for processing requests. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Network</span> mNetwork<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** The cache to write to. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Cache</span> mCache<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** For posting responses and errors. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ResponseDelivery</span> mDelivery<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** Used for telling us to die. */</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> mQuit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * Creates a new network dispatcher thread.  You must call <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span>
     * in order to begin processing.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">queue</span> Queue of incoming requests for triage
     * <span class="token keyword">@param</span> <span class="token parameter">network</span> Network interface to use for performing requests
     * <span class="token keyword">@param</span> <span class="token parameter">cache</span> Cache interface to use for writing responses to cache
     * <span class="token keyword">@param</span> <span class="token parameter">delivery</span> Delivery interface to use for posting responses
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">NetworkDispatcher</span><span class="token punctuation">(</span><span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Request</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> queue<span class="token punctuation">,</span>
            <span class="token class-name">Network</span> network<span class="token punctuation">,</span> <span class="token class-name">Cache</span> cache<span class="token punctuation">,</span>
            <span class="token class-name">ResponseDelivery</span> delivery<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mQueue <span class="token operator">=</span> queue<span class="token punctuation">;</span>
        mNetwork <span class="token operator">=</span> network<span class="token punctuation">;</span>
        mCache <span class="token operator">=</span> cache<span class="token punctuation">;</span>
        mDelivery <span class="token operator">=</span> delivery<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Forces this dispatcher to quit immediately.  If any requests are still in
     * the queue, they are not guaranteed to be processed.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mQuit <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@TargetApi</span><span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>ICE_CREAM_SANDWICH<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addTrafficStatsTag</span><span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Tag the request (if API &gt;= 14)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> <span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>ICE_CREAM_SANDWICH<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">TrafficStats</span><span class="token punctuation">.</span><span class="token function">setThreadStatsTag</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getTrafficStatsTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Process</span><span class="token punctuation">.</span><span class="token function">setThreadPriority</span><span class="token punctuation">(</span><span class="token class-name">Process</span><span class="token punctuation">.</span>THREAD_PRIORITY_BACKGROUND<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">long</span> startTimeMs <span class="token operator">=</span> <span class="token class-name">SystemClock</span><span class="token punctuation">.</span><span class="token function">elapsedRealtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> request<span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// Take a request from the queue.</span>
                request <span class="token operator">=</span> mQueue<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// We may have been interrupted because it was time to quit.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mQuit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                request<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token string">&quot;network-queue-take&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// If the request was cancelled already, do not perform the</span>
                <span class="token comment">// network request.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">isCanceled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    request<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token string">&quot;network-discard-cancelled&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token function">addTrafficStatsTag</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// mNetwork会去执行对应的request请求，后面再看里面的具体实现</span>
                <span class="token comment">// Perform the network request.</span>
                <span class="token class-name">NetworkResponse</span> networkResponse <span class="token operator">=</span> mNetwork<span class="token punctuation">.</span><span class="token function">performRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
                request<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token string">&quot;network-http-complete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// If the server returned 304 AND we delivered a response already,</span>
                <span class="token comment">// we&#39;re done -- don&#39;t deliver a second identical response.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>networkResponse<span class="token punctuation">.</span>notModified <span class="token operator">&amp;&amp;</span> request<span class="token punctuation">.</span><span class="token function">hasHadResponseDelivered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    request<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token string">&quot;not-modified&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">continue</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">// 将网络请求返回的NetworkResponse交给request.parseNetworkResponse进行处理</span>
                <span class="token comment">// Parse the response here on the worker thread.</span>
                <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> response <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">parseNetworkResponse</span><span class="token punctuation">(</span>networkResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
                request<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token string">&quot;network-parse-complete&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Write to cache if applicable.</span>
                <span class="token comment">// TODO: Only update cache metadata instead of entire record for 304s.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">shouldCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>cacheEntry <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    mCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getCacheKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>cacheEntry<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    request<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token string">&quot;network-cache-written&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// Post the response back.</span>
                request<span class="token punctuation">.</span><span class="token function">markDelivered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// mDelivery进行分发</span>
                mDelivery<span class="token punctuation">.</span><span class="token function">postResponse</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">VolleyError</span> volleyError<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                volleyError<span class="token punctuation">.</span><span class="token function">setNetworkTimeMs</span><span class="token punctuation">(</span><span class="token class-name">SystemClock</span><span class="token punctuation">.</span><span class="token function">elapsedRealtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTimeMs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">parseAndDeliverNetworkError</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> volleyError<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">VolleyLog</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">&quot;Unhandled exception %s&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">VolleyError</span> volleyError <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VolleyError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                volleyError<span class="token punctuation">.</span><span class="token function">setNetworkTimeMs</span><span class="token punctuation">(</span><span class="token class-name">SystemClock</span><span class="token punctuation">.</span><span class="token function">elapsedRealtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTimeMs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                mDelivery<span class="token punctuation">.</span><span class="token function">postError</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> volleyError<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">parseAndDeliverNetworkError</span><span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> request<span class="token punctuation">,</span> <span class="token class-name">VolleyError</span> error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        error <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">parseNetworkError</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mDelivery<span class="token punctuation">.</span><span class="token function">postError</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面会执行到<code>mNetwork.performRequest</code>方法，而<code>Network</code>是一个接口，具体的实现要看<code>BaseNetwork</code>中的实现：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">NetworkResponse</span> <span class="token function">performRequest</span><span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">VolleyError</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> requestStart <span class="token operator">=</span> <span class="token class-name">SystemClock</span><span class="token punctuation">.</span><span class="token function">elapsedRealtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">HttpResponse</span> httpResponse <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> responseContents <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> responseHeaders <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token comment">// Gather headers.</span>
                <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">addCacheHeaders</span><span class="token punctuation">(</span>headers<span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getCacheEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 调用mHttpStack.performRequest方法，这里就是newRequestQueue中创建的部分，9及以上为HurlStack，9以下为HttpClientStach,具体就是真正执行网络请求的部分了。</span>
                httpResponse <span class="token operator">=</span> mHttpStack<span class="token punctuation">.</span><span class="token function">performRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">StatusLine</span> statusLine <span class="token operator">=</span> httpResponse<span class="token punctuation">.</span><span class="token function">getStatusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> statusCode <span class="token operator">=</span> statusLine<span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                responseHeaders <span class="token operator">=</span> <span class="token function">convertHeaders</span><span class="token punctuation">(</span>httpResponse<span class="token punctuation">.</span><span class="token function">getAllHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Handle cache validation.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>statusCode <span class="token operator">==</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>SC_NOT_MODIFIED<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                    <span class="token class-name">Entry</span> entry <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getCacheEntry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>entry <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NetworkResponse</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>SC_NOT_MODIFIED<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
                                responseHeaders<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                                <span class="token class-name">SystemClock</span><span class="token punctuation">.</span><span class="token function">elapsedRealtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> requestStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">// A HTTP 304 response does not have all header fields. We</span>
                    <span class="token comment">// have to use the header fields from the cache entry plus</span>
                    <span class="token comment">// the new ones from the response.</span>
                    <span class="token comment">// http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.3.5</span>
                    entry<span class="token punctuation">.</span>responseHeaders<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>responseHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NetworkResponse</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>SC_NOT_MODIFIED<span class="token punctuation">,</span> entry<span class="token punctuation">.</span>data<span class="token punctuation">,</span>
                            entry<span class="token punctuation">.</span>responseHeaders<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                            <span class="token class-name">SystemClock</span><span class="token punctuation">.</span><span class="token function">elapsedRealtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> requestStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                
                <span class="token comment">// Handle moved resources</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>statusCode <span class="token operator">==</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>SC_MOVED_PERMANENTLY <span class="token operator">||</span> statusCode <span class="token operator">==</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>SC_MOVED_TEMPORARILY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                	<span class="token class-name">String</span> newUrl <span class="token operator">=</span> responseHeaders<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;Location&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                	request<span class="token punctuation">.</span><span class="token function">setRedirectUrl</span><span class="token punctuation">(</span>newUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// Some responses such as 204s do not have content.  We must check.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>httpResponse<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                  responseContents <span class="token operator">=</span> <span class="token function">entityToBytes</span><span class="token punctuation">(</span>httpResponse<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                  <span class="token comment">// Add 0 byte response as a way of honestly representing a</span>
                  <span class="token comment">// no-content request.</span>
                  responseContents <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// if the request is slow, log it.</span>
                <span class="token keyword">long</span> requestLifetime <span class="token operator">=</span> <span class="token class-name">SystemClock</span><span class="token punctuation">.</span><span class="token function">elapsedRealtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> requestStart<span class="token punctuation">;</span>
                <span class="token function">logSlowRequests</span><span class="token punctuation">(</span>requestLifetime<span class="token punctuation">,</span> request<span class="token punctuation">,</span> responseContents<span class="token punctuation">,</span> statusLine<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>statusCode <span class="token operator">&lt;</span> <span class="token number">200</span> <span class="token operator">||</span> statusCode <span class="token operator">&gt;</span> <span class="token number">299</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">NetworkResponse</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">,</span> responseContents<span class="token punctuation">,</span> responseHeaders<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
                        <span class="token class-name">SystemClock</span><span class="token punctuation">.</span><span class="token function">elapsedRealtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> requestStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">SocketTimeoutException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">attemptRetryOnException</span><span class="token punctuation">(</span><span class="token string">&quot;socket&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TimeoutError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ConnectTimeoutException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">attemptRetryOnException</span><span class="token punctuation">(</span><span class="token string">&quot;connection&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">TimeoutError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MalformedURLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Bad URL &quot;</span> <span class="token operator">+</span> request<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> statusCode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token class-name">NetworkResponse</span> networkResponse <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>httpResponse <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    statusCode <span class="token operator">=</span> httpResponse<span class="token punctuation">.</span><span class="token function">getStatusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoConnectionError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>statusCode <span class="token operator">==</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>SC_MOVED_PERMANENTLY <span class="token operator">||</span> 
                		statusCode <span class="token operator">==</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>SC_MOVED_TEMPORARILY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                	<span class="token class-name">VolleyLog</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;Request at %s has been redirected to %s&quot;</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getOriginUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                	<span class="token class-name">VolleyLog</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">&quot;Unexpected response code %d for %s&quot;</span><span class="token punctuation">,</span> statusCode<span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>responseContents <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    networkResponse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NetworkResponse</span><span class="token punctuation">(</span>statusCode<span class="token punctuation">,</span> responseContents<span class="token punctuation">,</span>
                            responseHeaders<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token class-name">SystemClock</span><span class="token punctuation">.</span><span class="token function">elapsedRealtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> requestStart<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>statusCode <span class="token operator">==</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>SC_UNAUTHORIZED <span class="token operator">||</span>
                            statusCode <span class="token operator">==</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>SC_FORBIDDEN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">attemptRetryOnException</span><span class="token punctuation">(</span><span class="token string">&quot;auth&quot;</span><span class="token punctuation">,</span>
                                request<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AuthFailureError</span><span class="token punctuation">(</span>networkResponse<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>statusCode <span class="token operator">==</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>SC_MOVED_PERMANENTLY <span class="token operator">||</span> 
                    			statusCode <span class="token operator">==</span> <span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>SC_MOVED_TEMPORARILY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">attemptRetryOnException</span><span class="token punctuation">(</span><span class="token string">&quot;redirect&quot;</span><span class="token punctuation">,</span>
                                request<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AuthFailureError</span><span class="token punctuation">(</span>networkResponse<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        <span class="token comment">// TODO: Only throw ServerError for 5xx status codes.</span>
                        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ServerError</span><span class="token punctuation">(</span>networkResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NetworkError</span><span class="token punctuation">(</span>networkResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面调用了mHttpStack.performRequest的方法，这里就以9及以上的HurlStack类来看下源码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">HttpResponse</span> <span class="token function">performRequest</span><span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> request<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> additionalHeaders<span class="token punctuation">)</span>
		<span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">AuthFailureError</span> <span class="token punctuation">{</span>
	<span class="token class-name">String</span> url <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	map<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	map<span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>additionalHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mUrlRewriter <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">String</span> rewritten <span class="token operator">=</span> mUrlRewriter<span class="token punctuation">.</span><span class="token function">rewriteUrl</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>rewritten <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">&quot;URL blocked by rewriter: &quot;</span> <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		url <span class="token operator">=</span> rewritten<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">URL</span> parsedUrl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">HttpURLConnection</span> connection <span class="token operator">=</span> <span class="token function">openConnection</span><span class="token punctuation">(</span>parsedUrl<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> headerName <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		connection<span class="token punctuation">.</span><span class="token function">addRequestProperty</span><span class="token punctuation">(</span>headerName<span class="token punctuation">,</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>headerName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">setConnectionParametersForRequest</span><span class="token punctuation">(</span>connection<span class="token punctuation">,</span> request<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// Initialize HttpResponse with data from the HttpURLConnection.</span>
	<span class="token class-name">ProtocolVersion</span> protocolVersion <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProtocolVersion</span><span class="token punctuation">(</span><span class="token string">&quot;HTTP&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> responseCode <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">getResponseCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>responseCode <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// -1 is returned by getResponseCode() if the response code could not be retrieved.</span>
		<span class="token comment">// Signal to the caller that something was wrong with the connection.</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">&quot;Could not retrieve response code from HttpUrlConnection.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token class-name">StatusLine</span> responseStatus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicStatusLine</span><span class="token punctuation">(</span>protocolVersion<span class="token punctuation">,</span>
			connection<span class="token punctuation">.</span><span class="token function">getResponseCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> connection<span class="token punctuation">.</span><span class="token function">getResponseMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">BasicHttpResponse</span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicHttpResponse</span><span class="token punctuation">(</span>responseStatus<span class="token punctuation">)</span><span class="token punctuation">;</span>
	response<span class="token punctuation">.</span><span class="token function">setEntity</span><span class="token punctuation">(</span><span class="token function">entityFromConnection</span><span class="token punctuation">(</span>connection<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> header <span class="token operator">:</span> connection<span class="token punctuation">.</span><span class="token function">getHeaderFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>header<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">Header</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BasicHeader</span><span class="token punctuation">(</span>header<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> header<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			response<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> response<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来还要看一下<code>mDelivery.postResponse(request, response);</code>这里的,mDelivery就是<code>new ExecutorDelivery(new Handler(Looper.getMainLooper()))</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Delivers responses and errors.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExecutorDelivery</span> <span class="token keyword">implements</span> <span class="token class-name">ResponseDelivery</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/** Used for posting responses, typically to the main thread. */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Executor</span> mResponsePoster<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * Creates a new response delivery interface.
     * <span class="token keyword">@param</span> <span class="token parameter">handler</span> <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Handler</span></span><span class="token punctuation">}</span> to post responses on
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">ExecutorDelivery</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Handler</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Make an Executor that just wraps the handler.</span>
        mResponsePoster <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Executor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span> command<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                handler<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Creates a new response delivery interface, mockable version
     * for testing.
     * <span class="token keyword">@param</span> <span class="token parameter">executor</span> For running delivery tasks
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">ExecutorDelivery</span><span class="token punctuation">(</span><span class="token class-name">Executor</span> executor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mResponsePoster <span class="token operator">=</span> executor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postResponse</span><span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> request<span class="token punctuation">,</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">postResponse</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postResponse</span><span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> request<span class="token punctuation">,</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> response<span class="token punctuation">,</span> <span class="token class-name">Runnable</span> runnable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        request<span class="token punctuation">.</span><span class="token function">markDelivered</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token string">&quot;post-response&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 内部会调用execute方法</span>
        mResponsePoster<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResponseDeliveryRunnable</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> runnable<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postError</span><span class="token punctuation">(</span><span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> request<span class="token punctuation">,</span> <span class="token class-name">VolleyError</span> error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        request<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token string">&quot;post-error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> response <span class="token operator">=</span> <span class="token class-name">Response</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mResponsePoster<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ResponseDeliveryRunnable</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * A Runnable used for delivering network responses to a listener on the
     * main thread.
     */</span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;rawtypes&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">ResponseDeliveryRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Request</span> mRequest<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Response</span> mResponse<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Runnable</span> mRunnable<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token class-name">ResponseDeliveryRunnable</span><span class="token punctuation">(</span><span class="token class-name">Request</span> request<span class="token punctuation">,</span> <span class="token class-name">Response</span> response<span class="token punctuation">,</span> <span class="token class-name">Runnable</span> runnable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mRequest <span class="token operator">=</span> request<span class="token punctuation">;</span>
            mResponse <span class="token operator">=</span> response<span class="token punctuation">;</span>
            mRunnable <span class="token operator">=</span> runnable<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">&quot;unchecked&quot;</span><span class="token punctuation">)</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 这里就是重点部分了</span>
            <span class="token comment">// If this request has canceled, finish it and don&#39;t deliver.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mRequest<span class="token punctuation">.</span><span class="token function">isCanceled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mRequest<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token string">&quot;canceled-at-delivery&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 调用mRequest的deliverResponse或者deliverError进行分发</span>
            <span class="token comment">// Deliver a normal response or error, depending.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mResponse<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mRequest<span class="token punctuation">.</span><span class="token function">deliverResponse</span><span class="token punctuation">(</span>mResponse<span class="token punctuation">.</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                mRequest<span class="token punctuation">.</span><span class="token function">deliverError</span><span class="token punctuation">(</span>mResponse<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// If this is an intermediate response, add a marker, otherwise we&#39;re done</span>
            <span class="token comment">// and the request can be finished.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mResponse<span class="token punctuation">.</span>intermediate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mRequest<span class="token punctuation">.</span><span class="token function">addMarker</span><span class="token punctuation">(</span><span class="token string">&quot;intermediate-response&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// 执行finish方法</span>
                mRequest<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token string">&quot;done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// If we have been provided a post-delivery runnable, run it.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mRunnable <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mRunnable<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里再看一下mRequest的deliverResponse方法。<br> Request接口中没有实现该方法，具体我们以StringRequest为例看一下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * A canned request for retrieving the response body at a given URL as a String.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringRequest</span> <span class="token keyword">extends</span> <span class="token class-name">Request</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Listener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> mListener<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * Creates a new request with the given method.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">method</span> the request <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Method</span></span><span class="token punctuation">}</span> to use
     * <span class="token keyword">@param</span> <span class="token parameter">url</span> URL to fetch the string at
     * <span class="token keyword">@param</span> <span class="token parameter">listener</span> Listener to receive the String response
     * <span class="token keyword">@param</span> <span class="token parameter">errorListener</span> Error listener, or null to ignore errors
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">StringRequest</span><span class="token punctuation">(</span><span class="token keyword">int</span> method<span class="token punctuation">,</span> <span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">Listener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> listener<span class="token punctuation">,</span>
            <span class="token class-name">ErrorListener</span> errorListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> errorListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mListener <span class="token operator">=</span> listener<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Creates a new GET request.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">url</span> URL to fetch the string at
     * <span class="token keyword">@param</span> <span class="token parameter">listener</span> Listener to receive the String response
     * <span class="token keyword">@param</span> <span class="token parameter">errorListener</span> Error listener, or null to ignore errors
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">StringRequest</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">Listener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> listener<span class="token punctuation">,</span> <span class="token class-name">ErrorListener</span> errorListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token class-name">Method</span><span class="token punctuation">.</span>GET<span class="token punctuation">,</span> url<span class="token punctuation">,</span> listener<span class="token punctuation">,</span> errorListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">deliverResponse</span><span class="token punctuation">(</span><span class="token class-name">String</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 回调</span>
        mListener<span class="token punctuation">.</span><span class="token function">onResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Response</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">parseNetworkResponse</span><span class="token punctuation">(</span><span class="token class-name">NetworkResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> parsed<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            parsed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">,</span> <span class="token class-name">HttpHeaderParser</span><span class="token punctuation">.</span><span class="token function">parseCharset</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnsupportedEncodingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            parsed <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">Response</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>parsed<span class="token punctuation">,</span> <span class="token class-name">HttpHeaderParser</span><span class="token punctuation">.</span><span class="token function">parseCacheHeaders</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接着看一下mRequest.finish方法的实现:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Notifies the request queue that this request has finished (successfully or with error).
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Also dumps all events from this request&#39;s event log; for debugging.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 */</span>
<span class="token keyword">void</span> <span class="token function">finish</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span> tag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mRequestQueue <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 内部调用了mRequestQueue的finish方法，也就是把请求从请求队列中移除。</span>
        mRequestQueue<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">MarkerLog</span><span class="token punctuation">.</span>ENABLED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">long</span> threadId <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">myLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">getMainLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// If we finish marking off of the main thread, we need to</span>
            <span class="token comment">// actually do it on the main thread to ensure correct ordering.</span>
            <span class="token class-name">Handler</span> mainThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">getMainLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mainThread<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    mEventLog<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> threadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mEventLog<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        mEventLog<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> threadId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mEventLog<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> requestTime <span class="token operator">=</span> <span class="token class-name">SystemClock</span><span class="token punctuation">.</span><span class="token function">elapsedRealtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> mRequestBirthTime<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>requestTime <span class="token operator">&gt;=</span> SLOW_REQUEST_THRESHOLD_MS<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">VolleyLog</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;%d ms: %s&quot;</span><span class="token punctuation">,</span> requestTime<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>到这里就全部分析完了。</p><hr><ul><li>邮箱 ：charon.chui@gmail.com</li><li>Good Luck!</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/android-note/assets/app.89e8a229.js" defer></script>
  </body>
</html>

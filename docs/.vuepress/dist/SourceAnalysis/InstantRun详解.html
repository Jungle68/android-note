<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.47">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>InstantRun详解 | Android Notes</title><meta name="description" content="一个 Android 技术记录文档">
    <link rel="modulepreload" href="/android-note/assets/app.89e8a229.js"><link rel="modulepreload" href="/android-note/assets/InstantRun详解.html.014a0e80.js"><link rel="modulepreload" href="/android-note/assets/InstantRun详解.html.22dab991.js"><link rel="prefetch" href="/android-note/assets/index.html.8bd0e776.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.7e59ca03.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.c477e23d.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.8ae3b627.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.d2e9fd43.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.c3aa8849.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.e39fb926.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.24d347d7.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.d974bc5d.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.e5751fb9.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.0e899c35.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.6ec105de.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.5d07c2c2.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.820183b1.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.ea867ee7.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.e0f11045.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.22b42870.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.61dfcc93.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.3cd2d991.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.ecfe19bd.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.570ee8a4.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.f8aba27b.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.1d392d64.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.9559fa68.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.ed0822f0.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.dc7889f9.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.3020c3be.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.073c39e0.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.8baf198e.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.51e0046b.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.5bd737af.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.1159aa8f.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.7c3e31b6.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.8ab8a2cc.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.e50646bb.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.f8bdc563.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.f120c888.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.1f8b3f62.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.96ecc87a.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.1b541a89.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.998dc7dc.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.0cbd4bdb.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.6cf7c851.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.d7db60a7.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.2f79a0af.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.f4db4c13.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.a286106e.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.de385267.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.b8bbd45f.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.2e8c4081.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.c39ce824.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.244019e6.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.7e587735.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.e625c50f.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.225da764.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.78211940.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.9c72d222.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.e192df98.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.9b54500d.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.f28a57f0.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.a093a882.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.2b0af47b.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.e441b7fd.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.7bc27bce.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.fbfbbb8a.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.4e2ae931.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.1319d9f7.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.e2f05584.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.9b6cca73.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.741df4a3.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.57a2cd66.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.57f05d22.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.722980d0.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.15a7fa24.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.cd786a69.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.7cd4845a.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.9db13890.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.819c1c88.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.4b8cb269.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.4ea9b161.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.844e0d9d.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.3bc9ff9e.js"><link rel="prefetch" href="/android-note/assets/病毒.html.7619f49a.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.4c49d5e1.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.2a88d555.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.8765e43b.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.cfb14486.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.fe974a62.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.00182d24.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.247dc68f.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.96572e52.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.653a3c88.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.eac67d7b.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.238e6553.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.27594cde.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.05e678bb.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.58f90a22.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.cdacbd38.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.e91c5d3e.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.fa9bacd0.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.94232b6c.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.8dbea4e8.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.20202cc3.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.40d0942f.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.2b05f9c3.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.f5b236bc.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.6952074c.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.323427b3.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.59a6c538.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.1b20bae5.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.3f8c1a56.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.fa61902d.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.b4741bb9.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.df8708de.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.0e6309ee.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.74b808b7.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.5e76b5d1.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.39b59b79.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.1041f4f4.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.4fcf5dcb.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.9a1e399b.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.52b2b04d.js"><link rel="prefetch" href="/android-note/assets/单链表.html.f419429a.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.db38b6c6.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.4e2b2a81.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.f0d24ad9.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.f7a3cc92.js"><link rel="prefetch" href="/android-note/assets/死锁.html.ec93d9d3.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.24e33318.js"><link rel="prefetch" href="/android-note/assets/算法.html.0a01e9ba.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.fbaeb1bd.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.1dff0557.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.e6733f54.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.a855a233.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.ddbbaf1e.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.8e0796a3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.18ccf0d4.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.e4c68b6e.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.afea2f74.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.e49e1c52.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.d2a307b1.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.9c599d21.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.d5da1eb6.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.80367240.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.0a73d443.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.ebaba068.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.13bba357.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.a8c42ae7.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.735f795b.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.8f2cca4a.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.7018659f.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.f551bb7a.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.4b2076fc.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.cdc3013a.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.7835fb45.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.6109676b.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.14b9a7a7.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.7d96a52b.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.6aa91caa.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.f388a863.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.489c39d7.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.d64f0a72.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.9070678b.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.572b02f6.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.5f41a7d3.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.662b2630.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.5df647ad.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.892325da.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.76d8e5df.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.389a237c.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.b5905bd6.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.afbd099f.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.d24ca0e9.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.efba877c.js"><link rel="prefetch" href="/android-note/assets/404.html.93146c89.js"><link rel="prefetch" href="/android-note/assets/index.html.a3d1ed7b.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.a64d1991.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.34218e19.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.7b54b523.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.89bd0ab9.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.103f1200.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.c8e634bf.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.7624414c.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.98a6217e.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.e0cbd1b3.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.d07ae209.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.1a7412c1.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.fae25f98.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.a45462e1.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.0e42552a.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.fac83de9.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.946e9782.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.75dd3aa7.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.b99bea93.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.024e40a5.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.17601c25.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.e4dd3dff.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.b8f61c98.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.e4a0b5c1.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.5c2a56e3.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.771b598f.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.ec948576.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.968e5163.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.b91f279b.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.e5d334b3.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.16b555ba.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.38d70312.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.630ea31f.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.6a608b01.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.c7294606.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.d153b865.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.0788dd70.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.c4f2cabf.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.4ffa43cf.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.7160a49a.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.cdc28261.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.ca3b8f37.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.04dae4e9.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.b2eee048.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.43f5056a.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.7e9d24cb.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.fe0e18e4.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.9692f10a.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.a035f300.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.daf97b10.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.4b3a8a75.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.c9b0c208.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.f56d8adb.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.27b4fbd7.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.019759be.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.c6e22d33.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.ddae6365.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.89a53b41.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.4034729a.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.213d99fd.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.4a292186.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.26281ec4.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.711522c7.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.ca454c03.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.d2d568fe.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.2b23078a.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.e59debb3.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.96161766.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.faa1301d.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.37bcd8c4.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.037d5f51.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.20dd3611.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.8477f837.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.379af02f.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.46a9b2e4.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.2d58e745.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.c608688f.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.bfa9e3d0.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.5511f591.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.6e584085.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.6b73df63.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.fbac04fc.js"><link rel="prefetch" href="/android-note/assets/病毒.html.5cd88c03.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.b01be570.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.adc8af11.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.e5536922.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.ba3817b8.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.4496e01e.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.aa990bb9.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.b42b4b49.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.02d23272.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.971b5263.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.4ef9b35f.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.02696243.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.3dae42d2.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.b7da17de.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.49e56b2a.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.51a94c44.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.793bc62a.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.d0b4194f.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.3b5da204.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.f85478dc.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.c0b33ce0.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.9cf366a8.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.2db819bd.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.0df280d7.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.b857d0ab.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.6daec307.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.21b0f237.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.69e343c0.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.164e8303.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.124cdb1e.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.facc0566.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.f48859b0.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.2c4caa9a.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.1273fefc.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.f1e06473.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.52f84c68.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.ed4970f5.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.7bc7d93a.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.9e31d408.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.84866fc9.js"><link rel="prefetch" href="/android-note/assets/单链表.html.4400da11.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.757c2b22.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.28fdc49e.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.2ee7fbf3.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.ab0fdf74.js"><link rel="prefetch" href="/android-note/assets/死锁.html.2dfc5516.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.4ca60911.js"><link rel="prefetch" href="/android-note/assets/算法.html.18c6261d.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.665d4e8a.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.9917c0f8.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.a6e27633.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.592167e3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.6f6c5af5.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.dcd32d84.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.710e4efa.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.27f8d4ad.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.20c931ca.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.038bb020.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.44688c6c.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.49e88efd.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.1d7dfe42.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.e26fe642.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.c0efdbc5.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.96bbc22f.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.a3ea4f26.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.1026b60c.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.b836467c.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.ecb4c8c6.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.bf6c619f.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.43a40b19.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.1d72231a.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.39e338b7.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.42bac657.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.7b81876b.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.d5679c84.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.bf97314b.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.28934eff.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.dc598784.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.fe77a4c4.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.86d37938.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.b0173f04.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.da0db26d.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.e8bf8449.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.ed14c462.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.18900a2a.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.8aa50d61.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.9e991b58.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.747f298d.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.4a5af4a7.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.a26fa93a.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.d4e4b484.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.f24adf9a.js"><link rel="prefetch" href="/android-note/assets/404.html.8b61bad2.js"><link rel="prefetch" href="/android-note/assets/404.e8cf6e3a.js"><link rel="prefetch" href="/android-note/assets/Layout.36051849.js">
    <link rel="stylesheet" href="/android-note/assets/style.1f7fd01d.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/android-note/" class=""><!----><span class="site-name">Android Notes</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">InstantRun详解 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/android-note/SourceAnalysis/InstantRun%E8%AF%A6%E8%A7%A3.html#配置你的应用来使用instant-run" class="router-link-active router-link-exact-active sidebar-item" aria-label="配置你的应用来使用Instant Run"><!--[--><!--]--> 配置你的应用来使用Instant Run <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/android-note/SourceAnalysis/InstantRun%E8%AF%A6%E8%A7%A3.html#修复类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="修复类型"><!--[--><!--]--> 修复类型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/android-note/SourceAnalysis/InstantRun%E8%AF%A6%E8%A7%A3.html#实现原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="实现原理"><!--[--><!--]--> 实现原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/android-note/SourceAnalysis/InstantRun%E8%AF%A6%E8%A7%A3.html#热修复过程" class="router-link-active router-link-exact-active sidebar-item" aria-label="热修复过程"><!--[--><!--]--> 热修复过程 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/android-note/SourceAnalysis/InstantRun%E8%AF%A6%E8%A7%A3.html#暖修复" class="router-link-active router-link-exact-active sidebar-item" aria-label="暖修复"><!--[--><!--]--> 暖修复 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/android-note/SourceAnalysis/InstantRun%E8%AF%A6%E8%A7%A3.html#冷修复" class="router-link-active router-link-exact-active sidebar-item" aria-label="冷修复"><!--[--><!--]--> 冷修复 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/android-note/SourceAnalysis/InstantRun%E8%AF%A6%E8%A7%A3.html#instant-run使用技巧及提示" class="router-link-active router-link-exact-active sidebar-item" aria-label="Instant Run使用技巧及提示"><!--[--><!--]--> Instant Run使用技巧及提示 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="instantrun详解" tabindex="-1"><a class="header-anchor" href="#instantrun详解" aria-hidden="true">#</a> InstantRun详解</h1><p>之前在写<a href="https://github.com/CharonChui/AndroidNote/blob/master/AndroidStudioCourse/AndroidStudio%E6%8F%90%E9%AB%98Build%E9%80%9F%E5%BA%A6.md" title="AndroidStudio提高Build速度" target="_blank" rel="noopener noreferrer">AndroidStudio提高Build速度<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>]这篇文章的时候写到，想要快，就用<code>Instant Run</code>。最近有朋友发来邮件讨论它的原理，最近项目不忙，索性就来系统的学习下。</p><p><code>Android Studio</code>2.0开始引入了<code>Instant Run</code>，它主要是在<code>Run</code>和<code>Debug</code>的时候可以去减少更新应用的时间。虽然第一次<code>Build</code>的时候可能会消耗稍长的时间来完成，但是<code>Instant Run</code>可以把更新内容推送到设备上，而无需重新<code>build</code>一个新的<code>apk</code>，这样就会很快速的让我们观察到改变。</p><p><code>Instant Run</code>只支持在<code>build.gralde</code>文件中配置的<code>Gradle</code>版本是2.0.0以上并且<code>minSdkVersion</code>是15以上才可以。为了能更好的使用，请将<code>minSdkVrsion</code>设置到21以上。</p><p>部署完应用后，会在<code>Run</code><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/as-irrun.png?raw=true" alt="image">(或者(Debug<img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/as-irdebug.png?raw=true" alt="image">))图标上面出现一个小黄色的闪电符号，这就意味着<code>Instant Run</code>已经准备就绪，在你下次点击按钮的时候可以推送更新内容。它不需要重新构建一个新的<code>APK</code>,它只推送那些新改变的地方，有些情况下<code>app</code>都不需要重启就可以直接显示新改变的下效果。</p><h3 id="配置你的应用来使用instant-run" tabindex="-1"><a class="header-anchor" href="#配置你的应用来使用instant-run" aria-hidden="true">#</a> 配置你的应用来使用<code>Instant Run</code></h3><p><code>Android Stuido</code>中项目使用<code>Gralde</code>2.0.0及以上版本会默认使用<code>Instant Run</code>。<br> 让项目更新到最新的版本:</p><ol><li>点击<code>Settings</code>中的<code>Preferences</code>按钮。</li><li>找到<code>Build,Execution,Deployment</code>中的<code>Instant Run</code>然后点击<code>Update Project</code>，如果<code>Update Project</code>部分没有显示，那说明你当前已经是最新版本了.<br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/update-project-dialog.png?raw=true" alt="image"></li></ol><h3 id="修复类型" tabindex="-1"><a class="header-anchor" href="#修复类型" aria-hidden="true">#</a> 修复类型</h3><p><code>Instant Run</code>通过热修复、暖修复或者冷修复来推送改变的代码和资源到你的设备或者模拟器上。它会根据你更改的内容来自动选择对应的修复类型。</p><ul><li>热修复: 更改的内容不需要重启应用甚至不需要重启当前的<code>activity</code>就可以让显示内容的改变，对于大部分通过方法内容改变的更改都可以通过这种方式来修改。</li><li>暖修复: 需要重启<code>activity</code>才能让改变生效，在改变资源时会通过该方式。</li><li>冷修复: 应用需要重启(不是重新安装)。对于一些方法方法结构和实现等结构性的改变需要通过该方式。</li></ul><p>那具体更改内容和修复方式是怎么对应的呢？</p><ul><li><p>改变现在已经存在的方法<br> 这将通过<em><strong>热修复</strong></em>来执行，这是最快的一种修复方式。你的应用会在运行的过程中，在下次调用该方法时直接使用新实现的方法。 热修复不需要重新初始化对象。在看到具体的更改之前，你可能会需要重启当前的<code>activity</code>或者应用。默认情况下<code>Android Studio</code>在执行热修复后会自动重启当前的<code>activity</code>。如果你不想要它自动重启<code>activity</code>你也可以在设置中禁用。</p></li><li><p>更改或者移除已经存在的资源<br> 这将通过<em><strong>暖修复</strong></em>来执行:这也是非常快的，但是<code>Instant Run</code>在推送这些更新内容时必须要重启当前的<code>activity</code>。你的应用仍然会继续运行，但是在重启<code>activity</code>时屏幕可能会闪动-这是正常滴。</p></li><li><p>结构性的改变例如:</p><ul><li><p>增删或者改变:</p><ul><li>一个注解</li><li>一个变量</li><li>一个静态变量</li><li>一个方法结构</li><li>一个静态方法结构</li></ul></li><li><p>更改该类集成的父类</p></li><li><p>更改接口的实现列表</p></li><li><p>更改类的静态修饰符</p></li><li><p>使用动态资源<code>id</code>重新布局</p></li></ul><p>上面的这些改变都将通过***冷修复(API 21以上才支持)***来执行.冷修复会稍微有些慢，因为虽然不需要构建一个新的<code>APK</code>但是必须要重启整个<code>app</code>才能推送这些结构性的代码改变。对于<code>API</code> 20及以下的版本，<code>Android Studio</code>将重新部署<code>APK</code>。</p></li><li><p>更改<code>manifest</code>文件或者更改<code>manifest</code>文件中引用的资源或者更改<code>Android</code>桌面<code>widget</code>的<code>UI</code>实现(需要Clean and Rerun)<br> 在更改清单文件或者清单文件中引用的资源时，<code>Android Studio</code>会自动的重新部署引用来实现这些内容的改变。这是因为例如应用名称、图标和<code>intent filters</code>这些东西是要在应用安装到设备时根据清单文件来决定的。 在更新<code>Android UI widget</code>时，你需要执行<code>Clean and Rerun</code>才能看到更改的内容，因为在使用<code>Instant Run</code>时执行<code>clean</code>会需要很长的时间，所以你在更新<code>UI widget</code>时可以禁用<code>Instant Run</code>。</p></li></ul><h5 id="使用rerun" tabindex="-1"><a class="header-anchor" href="#使用rerun" aria-hidden="true">#</a> 使用Rerun</h5><p>如果修改了一些会影响到初始化的内容时，例如修改了应用的<code>onCreate()</code>方法，你需要重启你的应用来让这些改变生效，你可以点击<code>Rerun</code>图标。它将会停止应用运行，并且执行<code>clean</code>操作后重新部署一个新的<code>APK</code>到你的设备。</p><h3 id="实现原理" tabindex="-1"><a class="header-anchor" href="#实现原理" aria-hidden="true">#</a> 实现原理</h3><p>正常情况下，我们修改了内容，想让让它生效，那就需要如下的步骤:</p><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/change_run_list.png?raw=true" alt="image"></p><p>那<code>Instant Run</code>的目标也非常简单:</p><blockquote><p>尽可能多的移除上面的步骤，来让剩下的部分尽可能更快。</p></blockquote><p>这就意味着:</p><ul><li>只构建和部署新更改的部分。</li><li>不去重新安装应用。</li><li>不去重启应用。</li><li>甚至不去重启<code>activity</code>。</li></ul><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/instant_run_list.png?raw=true" alt="image"></p><p>普通情况下在你点击<code>Run</code>或者<code>Debug</code>按钮时，会执行如下的操作:<br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/apk_progress.png?raw=true" alt="image"></p><p>清单文件会被整合然后与你应用的资源重启打包成<code>APK</code>.同样的，<code>.java</code>的源代码会被编译成二进制，然后转换成<code>.dex</code>文件，他们也会被包含到<code>APK</code>中。</p><p>在使用<code>Instant Run</code>的情况下，第一次点击<code>Run</code>和<code>Debug</code>时<code>Gradle</code>会执行一些额外的操作:<br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/instant_apk_progress.png?raw=true" alt="image"><code>instrumentation</code>相关的二进制内容会被增加到<code>.class</code>文件中，并且一个新的<code>App Server</code>类会被注入到应用中。<br> 同时也会增加一个新的<code>Application</code>类，来注入一些自定义的<code>class loader</code>并且能启动<code>App Server</code>。因此<code>minifest</code>文件会被修改来保证使用该新加的<code>Application</code>类(如果你已经创建了自己的<code>Application</code>类，<code>Instant Run</code>的版本将会用你定义的来进行代理扩展)</p><p>经过上面的操作<code>Instant Run</code>就开始执行了，以后如果你改变了代码部分，在重新点击<code>Run</code>或者<code>Debug</code>时，<code>Instant Run</code>将会通过热、暖、冷修复来尽可能的减少上面的构建过程。</p><p>在<code>Instant Run</code>更改内容前，<code>Android Studio</code>会你的应用版本是否支持<code>Instant Run</code>并且<code>App Server</code>是否运行在对其有用的端口(内部使用了Socket)。 这样来确定你的应用是否在前台运行，并且找到<code>Studio</code>所需要的构建<code>ID</code>.</p><p>总结一下，其实就是内部会对每个<code>class</code>文件注入<code>instant run</code>相关的代码，然后自定义一个<code>application</code>内部指定自定义的<code>classLoader</code>(也就是说不使用默认的<code>classLoader</code>了，只要用了<code>Instant Run</code>就需要使用它自定义的<code>classLoader</code>)，然后在应用程序里面开启一个服务器，<code>Studio</code>将修改的代码发送到该服务器，然后再通过自定义的<code>classLoader</code>加载代码的时候会去请求该服务器判断代码是否有更新，如果有更新就会通过委托机制加载新更新的代码然后注入到应用程序中，这样就完成了替换的操作。</p><h3 id="热修复过程" tabindex="-1"><a class="header-anchor" href="#热修复过程" aria-hidden="true">#</a> 热修复过程</h3><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/hot_swapping.png?raw=true" alt="image"></p><p><code>Android Studio</code>会监听在开发过程中哪个文件发生了改变，并且通过一个自定义的<code>Gralde task</code>来只对修改的<code>class</code>文件生成对应的<code>.dex</code>文件。<br> 这些新的<code>.dex</code>文件会通过<code>Studio</code>传递发布给应用中运行的<code>App Server</code>。</p><p>因为开始时这些文件的<code>class</code>已经存在到运行中的应用中-<code>Gralde</code>需要保证更新的版本来保证他们能覆盖之前已经存在的文件。这些更新文件的转换是由<code>App Server</code>通过自定义的<code>class loader</code>来完成的。</p><p>从现在开始，每次一个方法被调用时(不管在应用中的任何地方)，被注入到最初的<code>class</code>文件中的<code>instrumentation</code>都讲去连接<code>App Server</code>来检查它们是否有更新了。 如果有更新，执行操作将被指派到新的充在的<code>class</code>文件，这样就会执行新修改的方法。</p><p><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/instant_run_app_server.png?raw=true" alt="image"></p><p>如果你设置断点，你会发现你调用的是<code>override</code>名字的类中的方法。 <img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/instant_debug_override.gif?raw=true" alt="image"></p><p>这种重新指定方法的方式在改变方法实现时非常有效，但是对于那种需要在<code>Activity</code>启动时加载的改变呢？</p><h3 id="暖修复" tabindex="-1"><a class="header-anchor" href="#暖修复" aria-hidden="true">#</a> 暖修复</h3><p>暖修复会重启<code>Activity</code>。资源文件会在<code>Activity</code>启动时被加载，所以修改它们需要<code>activity</code>重新启动来进行加载。</p><p>现在，更改任何资源都会导致所有的资源都被重新打包病转移到应用中-但是以后会支持增量包的功能来让只打包和部署那些新修改的资源。</p><blockquote><p>注意，暖修复在更改<code>manifest</code>件或者<code>manifest</code>文件中引用的内容时无效，因为<code>manifest</code>文件中的内容需要在<code>apk</code>安装时读取。更改<code>Manifest</code>文件(或者它所引用的内容)需要被全部构建和部署。</p></blockquote><p>非常不幸的是，重启<code>activity</code>在做一些结构性的改变时无效。对于这些改变需要使用冷修复。</p><h3 id="冷修复" tabindex="-1"><a class="header-anchor" href="#冷修复" aria-hidden="true">#</a> 冷修复</h3><p>在部署时，你的应用和他的子项目会被分派到10个不同的部分，每个都在自己单独的<code>dex</code>文件。不同部分的类会通过包名来分配。在使用冷修复时，修改的类需要其他所有相关的<code>class</code>文件都被重新打包后才能被部署到设备上。<br> 这就需要依赖<code>Android Runtime</code>能支持加载多个<code>.dex</code>文件,这是一个在<code>ART</code>中新增的功能，它只有在<code>Android 5.0(API 21)</code>以上的设备总才支持。<br> 对于<code>API 20</code>一下的设备，他们仍在使用<code>Dalvik</code>虚拟机，<code>Android Studio</code>需要部署整个<code>APK</code>。</p><p>有些时候通过热修复来改变的代码，但是它会被应用首次运行时的初始化所影响，这时你就需要<code>restart</code>你的应用来让其生效(快捷键是Command + Ctrl + R)。<br><img src="https://raw.githubusercontent.com/CharonChui/Pictures/master/instant_run_restart.gif?raw=true" alt="image"></p><h3 id="instant-run使用技巧及提示" tabindex="-1"><a class="header-anchor" href="#instant-run使用技巧及提示" aria-hidden="true">#</a> Instant Run使用技巧及提示</h3><p><code>Instant Run</code>是由<code>Android Studio</code>控制的，所以你只能通过<code>IDE</code>来<code>start/restart</code>你的<code>debug</code>实例，不要直接在设备中<code>start/restart</code>你的应用，不然的话就会发生错乱。</p><h5 id="instant-run限制条件" tabindex="-1"><a class="header-anchor" href="#instant-run限制条件" aria-hidden="true">#</a> Instant Run限制条件</h5><ul><li><p>部署到多个设备</p><p><code>Instant Run</code>针对设备的不同<code>API Level</code>使用不同的技术来进行热、暖、冷修复。因此，如果同时部署一个应用到多个设备时，<code>Studio</code>会暂时关闭<code>Instant Run</code>功能。</p></li><li><p>Multidex</p><p>如果你的项目支持传统的<code>Multidex</code>-也就是在<code>build.gradle</code>中配置了<code>multiDexEnabled true</code>和<code>minSdkVersion 20</code>及以下-当你部署应用到<code>4.4</code>以下的设备上时，<code>Android Studio</code>将会禁用<code>Instant Run</code>。</p><p>如果<code>minSdkVersion</code>设置为21或者更高时，<code>Instant Run</code>将自动配置来支持<code>multidex</code>，因为<code>Instant Run</code>只支持<code>debug</code>版本，有需要在发布<code>release</code>版的时候配置你的<code>build</code>变量来支持<code>multidex</code>。</p></li><li><p>使用第三方插件 <code>Android Studio</code>在使用<code>Instant Run</code>时会暂时禁用<code>Java Code Coverage Library</code>和<code>ProGuard</code>。因为<code>Instant Run</code>只支持<code>debug</code>版本，这样也不会影响<code>release</code>版的构建。</p></li><li><p>只能在主进程中运行<br> 目前热修复只能在主进程中进行，如果在其他进程中热、暖修复将无法使用，只能用冷修复来替代。</p></li></ul><p>参考:</p><ul><li><a href="https://developer.android.com/studio/run/index.html#instant-run" target="_blank" rel="noopener noreferrer">官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://medium.com/google-developers/instant-run-how-does-it-work-294a1633367f#.8xmpk8xvc" target="_blank" rel="noopener noreferrer">Instant Run: How Does it Work?!<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><hr><ul><li>邮箱 ：charon.chui@gmail.com</li><li>Good Luck!</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/android-note/assets/app.89e8a229.js" defer></script>
  </body>
</html>

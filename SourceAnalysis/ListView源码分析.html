<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.47">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>ListView源码分析 | Android Notes</title><meta name="description" content="一个 Android 技术记录文档">
    <link rel="modulepreload" href="/android-note/assets/app.e2a3b496.js"><link rel="modulepreload" href="/android-note/assets/ListView源码分析.html.957f7aff.js"><link rel="modulepreload" href="/android-note/assets/ListView源码分析.html.6f55660e.js"><link rel="prefetch" href="/android-note/assets/index.html.fff2aa76.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.261ddca4.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.518850bc.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.d9910bec.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.dff63630.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.f29a403a.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.dc69d7fd.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.7be45349.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.d78f651d.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.a07e9d8a.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.75fdf471.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.7e81f1f2.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.103e5176.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.6e607fde.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.29df35d8.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.6014594b.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.2a53d290.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.d19ee784.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.43ec2966.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.0afb9bec.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.7b3bfc5f.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.b99bf27c.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.c8895c23.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.3fdb02c5.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.f0becde3.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.8ca1aed1.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.eb73aa59.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.6799221d.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.9f737361.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.eab7452f.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.82e665f3.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.659d7444.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.26e47455.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.cbf93a65.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.7c42765a.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.696ea85d.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.ae3ef80a.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.186ba84a.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.0a30a4bc.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.161eb2a1.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.42e7fa9a.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.02a55fca.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.025745a3.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.9e95d7d7.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.1d87d268.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.3e311c7b.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.1396114e.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.0b924706.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.1b6d020f.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.da94471c.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.4322b77a.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.a580533a.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.0d501025.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.c374045d.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.3691aec0.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.c2883070.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.bb92c86c.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.05a63ed7.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.3f42e962.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.3d385a0b.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.0b6f4401.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.f2310aae.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.6a7abbed.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.8dd2e53f.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.bf36afb3.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.99106e24.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.1f642fe4.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.75bf928e.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.e4ee636e.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.7bfa0f27.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.3cd85193.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.4653eac1.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.5baf68fb.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.67f51c74.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.46b3e9fe.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.072d0f77.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.64e84f7f.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.6aca8bc8.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.e628cefe.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.d5eb1b47.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.e063f731.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.d48d5aed.js"><link rel="prefetch" href="/android-note/assets/病毒.html.5c217cee.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.31f82ea1.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.ffc29463.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.fb6b9fb3.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.b0ad1ca1.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.24e72ac9.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.396f8926.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.6e7387ea.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.48ca2361.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.92583f07.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.b42b2b32.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.9735c882.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.b7572111.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.6aeb286a.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.4be18e44.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.1b6d8302.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.7072c065.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.28e1d009.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.562e3ff3.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.adf99661.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.701b6583.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.8e9c74db.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.a390a303.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.9316ab84.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.d24d23a1.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.f8555457.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.d207af8e.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.a69a3d66.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.48d0886d.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.5f2d4f42.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.39e89308.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.9b0ff02d.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.f7c14739.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.3d5cdd7a.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.522bbd31.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.79e59d3a.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.0c16f110.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.fe56a9af.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.d4f1aed1.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.20acb3b8.js"><link rel="prefetch" href="/android-note/assets/单链表.html.bf62db54.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.6deb38fc.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.b46be9ac.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.513c7a20.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.c4c4dcc3.js"><link rel="prefetch" href="/android-note/assets/死锁.html.99ba4a89.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.1b7c653d.js"><link rel="prefetch" href="/android-note/assets/算法.html.9d4e0aef.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.537ece5d.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.d6be503e.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.90a2793b.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.7d77fbc3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.b1be9fff.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.e19fc3f0.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.605ed319.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.a5a68958.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.011717f3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.ef802fd5.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.f1520e1f.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.3f7548ca.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.766c9e14.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.e37403f2.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.86d3c34a.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.8b7d82ae.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.14c41b41.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.7939bdd8.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.6e0ecf53.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.ee42d351.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.50780cae.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.45a2578f.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.8a6fec11.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.dc751b15.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.3b0d9330.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.9e48a859.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.1c2bdb90.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.967a0203.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.f37c7aff.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.49b62c31.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.0e2aaf0e.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.9fd639b3.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.55bd9526.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.2a20a491.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.f03f6006.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.baa87ac6.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.d2862232.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.5bef6c29.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.e75759f0.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.67635b46.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.b4b4741f.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.84ce4ed4.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.96115c87.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.37e80618.js"><link rel="prefetch" href="/android-note/assets/404.html.93146c89.js"><link rel="prefetch" href="/android-note/assets/index.html.a3b2c356.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.593d518f.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.1f126c97.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.a5ba8c6b.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.ca8b1ccd.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.d0272eba.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.187c5ed4.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.56b02a10.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.64aef548.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.164306fd.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.3f4b1857.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.22df54ee.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.649f129f.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.fa20e530.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.a1a10337.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.e761907d.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.48720165.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.be35e4a9.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.2ba5a7aa.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.58919723.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.6ddb95e6.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.fdf20e86.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.8e054392.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.414cb35a.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.13675508.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.d6d4b951.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.b98f8285.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.5346a958.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.1b23c403.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.48bf4f17.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.00c828d1.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.f1757cb9.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.8521978d.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.b1900bf7.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.b0686769.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.5283befd.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.c819f916.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.ff577025.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.5636ef45.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.ef8a6333.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.c749c345.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.44210aa0.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.31cc83ad.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.9dfecddb.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.acf1dc16.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.b863d19a.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.ccbe3768.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.d7a77f6f.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.e345b3a9.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.1c81b7f8.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.c35eb2fc.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.6c7ff613.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.3ae6b882.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.5ff8b11c.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.8bb54a97.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.a6164902.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.09ce9c48.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.665dba40.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.33108888.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.562c0f22.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.7e555978.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.a5b5dc81.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.6b1638d3.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.2b0db888.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.3988e4e5.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.a958fc42.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.e34bdbe5.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.6e540a45.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.d2d7c9b1.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.674d0b48.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.b6ce9885.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.f406015e.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.e717f114.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.f9420718.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.04da3193.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.12db7ee7.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.b25bda0f.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.9e008ea8.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.f34946bf.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.91e7515b.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.927862c8.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.89709d55.js"><link rel="prefetch" href="/android-note/assets/病毒.html.dfdf570b.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.08bb7427.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.0ae81f02.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.d3bf5ba6.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.958ad9fd.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.3d0fcc1c.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.091df93c.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.cb73d038.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.76947534.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.e776dd24.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.8c46b7ff.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.b9ca8c91.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.7b085d61.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.a597a6b0.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.152b4577.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.bbe32974.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.82c852a9.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.4d107d95.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.53598b60.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.235979e1.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.c14f1fd9.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.79c074c0.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.1e80f727.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.46ff5834.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.4f649ea3.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.1afb41c6.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.77fd44d2.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.f67e6cf2.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.87e02d9e.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.dcfdc432.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.924476e1.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.043d41ed.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.56507109.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.9b64eb77.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.7ea26885.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.182d318a.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.73b388a2.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.08ed1a50.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.02faa77d.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.ff9f67fa.js"><link rel="prefetch" href="/android-note/assets/单链表.html.816ccbf3.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.81be9d3a.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.5979ef3a.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.d3a34d4d.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.f871bc28.js"><link rel="prefetch" href="/android-note/assets/死锁.html.05fcf641.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.124be265.js"><link rel="prefetch" href="/android-note/assets/算法.html.a5d32479.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.0447b400.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.23d92421.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.1f70a7af.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.0aca5205.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.c64ac1eb.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.259d5746.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.2d7e84b0.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.f80d0190.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.cb3b0dd9.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.5eba2fc6.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.f95797de.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.af807638.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.af237da0.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.c7354991.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.2c386862.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.502b69b2.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.4cf1fc11.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.0d0ec937.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.1a5daf97.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.49cca9fa.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.6bf6b961.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.8e6935a4.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.db0f2341.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.28394ba6.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.e37f15c5.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.4900e197.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.d17a443e.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.6d4b95b6.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.7617b5a1.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.ebe8409a.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.d8336de6.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.51987a1b.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.4040429e.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.fc34230c.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.8310dbe0.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.a609e06b.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.92fc9cbb.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.6f0bcff8.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.3d8a0779.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.88c6186b.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.2513ea33.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.d0778e46.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.bfc12cf1.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.45995d69.js"><link rel="prefetch" href="/android-note/assets/404.html.bf6755d7.js"><link rel="prefetch" href="/android-note/assets/404.0f84ac09.js"><link rel="prefetch" href="/android-note/assets/Layout.c5c30828.js">
    <link rel="stylesheet" href="/android-note/assets/style.1f7fd01d.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/android-note/" class=""><!----><span class="site-name">Android Notes</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">ListView源码分析 <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="listview源码分析" tabindex="-1"><a class="header-anchor" href="#listview源码分析" aria-hidden="true">#</a> ListView源码分析</h1><p>一直都想写一篇文章分析下<code>ListView</code>的实现，总是忙，一直拖到现在，快到年底了，写出来希望能帮助一些面试跳槽的人。<br> 当然写这篇文章也是有原因的，当时有同事在面试的时候，被对方要求当场实现一个<code>ListView</code>，同事简单的答了一些实现原理后，很显然对方不满意，经过几轮PK后，就有了不河蟹的结局。<br> 不欢而散，哈哈。听说后当时我想着要把<code>ListView</code>源码仔细分析后，我自己也去面试试试，可是拖到了现在也没机会了。</p><p><code>GridView</code>与<code>ListView</code>都继承自<code>AbsListView</code>，他俩的实现也比较类似，这里就不说<code>GridView</code>了。只说一下<code>ListView</code>。 首先看一下<code>ListView</code>的文档:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*
 * Implementation Notes:
 *
 * Some terminology:
 *
 *     index    - index of the items that are currently visible
 *     position - index of the items in the cursor
 */</span>


<span class="token doc-comment comment">/**
 * A view that shows items in a vertically scrolling list. The items
 * come from the <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">ListAdapter</span></span><span class="token punctuation">}</span> associated with this view.
 */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后再说一下<code>ListView</code>的继承关系<code>ListView extends AbsListView extends AdapterView&lt;ListAdapter&gt; extends ViewGroup extends View</code>。 <code>ListView</code>与其他空间不一样，不是拖到界面上就能用，而是要通过设置适配器来添加条目。这就是<code>AdapterView</code>的主要功能。既然通过适配器来操作数据。 这里自然想到的就是<code>MVC</code>设计模式。</p><ul><li><code>Data</code> - <code>M</code></li><li><code>ListView</code> - <code>V</code></li><li><code>Adapter</code> - <code>C</code></li></ul><p>到这里我们写罗列一下我们将要分析的内容:</p><ul><li><code>ListView</code>与<code>Adapter</code>间的调用。</li><li><code>ListView</code>上下滑动时操作及缓存。</li></ul><p>我们平时使用<code>ListView</code>的时候都是调用<code>setAdapter()</code>方法，所以我们这里就从该方法入手:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * Sets the data behind this ListView.
     *
     * The adapter passed to this method may be wrapped by a <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">WrapperListAdapter</span></span><span class="token punctuation">}</span>,
     * depending on the ListView features currently in use. For instance, adding
     * headers and/or footers will cause the adapter to be wrapped.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">adapter</span> The ListAdapter which is responsible for maintaining the
     *        data backing this list and for producing a view to represent an
     *        item in that data set.
     *
     * <span class="token keyword">@see</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">getAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span> 
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAdapter</span><span class="token punctuation">(</span><span class="token class-name">ListAdapter</span> adapter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mAdapter <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mDataSetObserver <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    	    <span class="token comment">// 取消之前注册过的Adapter</span>
            mAdapter<span class="token punctuation">.</span><span class="token function">unregisterDataSetObserver</span><span class="token punctuation">(</span>mDataSetObserver<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 清空所有的数据</span>
        <span class="token function">resetList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
        <span class="token comment">// The data set used to store unused views that should be reused during the next layout to avoid creating new ones.</span>
        <span class="token comment">// 从注释中可以很明显的看出`View`的复用是通过`RecycleBin`类来实现的。它就决定了为什么`ListView`可以显示很多数据缺不会内存溢出。</span>
        mRecycler<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mHeaderViewInfos<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token operator">||</span> mFooterViewInfos<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果有HeaderView或者FooterView就把Adapter重新封装下,这是什么设计模式？－装饰</span>
			<span class="token comment">// mHeaderViewInfos和mFooterViewInfos分别是header view和foooter view装饰类FixedViewInfo的集合。</span>
			<span class="token comment">// 会在addHeaderView()和addFooterView()中进行添加。</span>
            mAdapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HeaderViewListAdapter</span><span class="token punctuation">(</span>mHeaderViewInfos<span class="token punctuation">,</span> mFooterViewInfos<span class="token punctuation">,</span> adapter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            mAdapter <span class="token operator">=</span> adapter<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        mOldSelectedPosition <span class="token operator">=</span> INVALID_POSITION<span class="token punctuation">;</span>
        mOldSelectedRowId <span class="token operator">=</span> INVALID_ROW_ID<span class="token punctuation">;</span>

        <span class="token comment">// AbsListView#setAdapter will update choice mode states.</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>adapter<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mAdapter <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mAreAllItemsSelectable <span class="token operator">=</span> mAdapter<span class="token punctuation">.</span><span class="token function">areAllItemsEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mOldItemCount <span class="token operator">=</span> mItemCount<span class="token punctuation">;</span>
            mItemCount <span class="token operator">=</span> mAdapter<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">checkFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            mDataSetObserver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AdapterDataSetObserver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mAdapter<span class="token punctuation">.</span><span class="token function">registerDataSetObserver</span><span class="token punctuation">(</span>mDataSetObserver<span class="token punctuation">)</span><span class="token punctuation">;</span> 
            <span class="token comment">// 将viewtypecount设置给RecycleBin</span>
            mRecycler<span class="token punctuation">.</span><span class="token function">setViewTypeCount</span><span class="token punctuation">(</span>mAdapter<span class="token punctuation">.</span><span class="token function">getViewTypeCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">int</span> position<span class="token punctuation">;</span>
            <span class="token comment">// mStackFromBottom Indicates whether the list is stacked from the bottom edge or the top edge.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mStackFromBottom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                position <span class="token operator">=</span> <span class="token function">lookForSelectablePosition</span><span class="token punctuation">(</span>mItemCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                position <span class="token operator">=</span> <span class="token function">lookForSelectablePosition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">setSelectedPositionInt</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setNextSelectedPositionInt</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>mItemCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// Nothing selected</span>
                <span class="token function">checkSelectionChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            mAreAllItemsSelectable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">checkFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Nothing selected</span>
            <span class="token function">checkSelectionChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
		<span class="token comment">// 请求layout了，这个就很重要了啊...我们稍后看一下。</span>
        <span class="token function">requestLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	
	<span class="token doc-comment comment">/**
     * The list is empty. Clear everything out.
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">resetList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// The parent&#39;s resetList() will remove all views from the layout so we need to</span>
        <span class="token comment">// cleanup the state of our footers and headers</span>
        <span class="token function">clearRecycledState</span><span class="token punctuation">(</span>mHeaderViewInfos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">clearRecycledState</span><span class="token punctuation">(</span>mFooterViewInfos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// The list is empty. Clear everything out.</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">resetList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        mLayoutMode <span class="token operator">=</span> LAYOUT_NORMAL<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">clearRecycledState</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">FixedViewInfo</span><span class="token punctuation">&gt;</span></span> infos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>infos <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> count <span class="token operator">=</span> infos<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">final</span> <span class="token class-name">View</span> child <span class="token operator">=</span> infos<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">;</span>
                <span class="token keyword">final</span> <span class="token class-name">LayoutParams</span> p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LayoutParams</span><span class="token punctuation">)</span> child<span class="token punctuation">.</span><span class="token function">getLayoutParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				    <span class="token comment">// 这里p就是AbsListView.LayoutParams。对于recycledHeaderFooter在注释中是这样说的. </span>
					<span class="token doc-comment comment">/**
					 * When this boolean is set, the view has been added to the AbsListView
					 * at least once. It is used to know whether headers/footers have already
					 * been added to the list view and whether they should be treated as
					 * recycled views or not.
					 */</span>
                    p<span class="token punctuation">.</span>recycledHeaderFooter <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们看到<code>setAdapter()</code>方法中会调用<code>requestLayout()</code>方法。而<code>requestLayout()</code>方法会调用<code>onLayout()</code>方法，但是我们在<code>ListView</code>中找不到<code>onLayout()</code>方法。 那就去他的父类<code>AbsListView</code>中找。我们接着来看一下<code>AbsListView.onLayout()</code>方法的实现。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Subclasses should NOT override this method but
 *  <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">layoutChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> instead.
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onLayout</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> changed<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> t<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onLayout</span><span class="token punctuation">(</span>changed<span class="token punctuation">,</span> l<span class="token punctuation">,</span> t<span class="token punctuation">,</span> r<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>

	mInLayout <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	<span class="token keyword">final</span> <span class="token keyword">int</span> childCount <span class="token operator">=</span> <span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>changed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> childCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">getChildAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forceLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		mRecycler<span class="token punctuation">.</span><span class="token function">markChildrenDirty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 调用layoutChildren()方法。</span>
	<span class="token function">layoutChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mInLayout <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	mOverscrollMax <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">-</span> t<span class="token punctuation">)</span> <span class="token operator">/</span> OVERSCROLL_LIMIT_DIVISOR<span class="token punctuation">;</span>

	<span class="token comment">// TODO: Move somewhere sane. This doesn&#39;t belong in onLayout().</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mFastScroll <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mFastScroll<span class="token punctuation">.</span><span class="token function">onItemCountChanged</span><span class="token punctuation">(</span><span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mItemCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们看一下<code>AbsListView.layoutChildren()</code>方法的实现:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Subclasses must override this method to layout their children.
 */</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">layoutChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实现是空的,文档说的很明白了，子类必须要去实现该方法，这也是应该的，因为<code>ListView</code>和<code>GridView</code>的展现是不一样的.所以我们看一下<code>ListView.layoutChildren()</code>方法的实现:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">layoutChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// When set to true, calls to requestLayout() will not propagate up the parent hierarchy.</span>
    <span class="token comment">// This is used to layout the children during a layout pass.</span>
	<span class="token keyword">final</span> <span class="token keyword">boolean</span> blockLayoutRequests <span class="token operator">=</span> mBlockLayoutRequests<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>blockLayoutRequests<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 开始了，置为true</span>
	mBlockLayoutRequests <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">layoutChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>mAdapter <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">resetList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">invokeOnItemScrollListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">final</span> <span class="token keyword">int</span> childrenTop <span class="token operator">=</span> mListPadding<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> childrenBottom <span class="token operator">=</span> mBottom <span class="token operator">-</span> mTop <span class="token operator">-</span> mListPadding<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> childCount <span class="token operator">=</span> <span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> delta <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

		<span class="token class-name">View</span> sel<span class="token punctuation">;</span>
		<span class="token class-name">View</span> oldSel <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token class-name">View</span> oldFirst <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token class-name">View</span> newSel <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

		<span class="token comment">// Remember stuff we will need down below</span>
		<span class="token comment">// mLayoutMode的注释为Controls how the next layout will happen，默认为LAYOUT_NORMAL</span>
		<span class="token keyword">switch</span> <span class="token punctuation">(</span>mLayoutMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> LAYOUT_SET_SELECTION<span class="token operator">:</span>
			index <span class="token operator">=</span> mNextSelectedPosition <span class="token operator">-</span> mFirstPosition<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> index <span class="token operator">&lt;</span> childCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				newSel <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> LAYOUT_FORCE_TOP<span class="token operator">:</span>
		<span class="token keyword">case</span> LAYOUT_FORCE_BOTTOM<span class="token operator">:</span>
		<span class="token keyword">case</span> LAYOUT_SPECIFIC<span class="token operator">:</span>
		<span class="token keyword">case</span> LAYOUT_SYNC<span class="token operator">:</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> LAYOUT_MOVE_SELECTION<span class="token operator">:</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
			<span class="token comment">// Remember the previously selected view</span>
			index <span class="token operator">=</span> mSelectedPosition <span class="token operator">-</span> mFirstPosition<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> index <span class="token operator">&lt;</span> childCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				oldSel <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// Remember the previous first child</span>
			oldFirst <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>mNextSelectedPosition <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				delta <span class="token operator">=</span> mNextSelectedPosition <span class="token operator">-</span> mSelectedPosition<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// Caution: newSel might be null</span>
			newSel <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>index <span class="token operator">+</span> delta<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// mDataChanged变量标记Adapter中数据是否发生变化</span>
		<span class="token keyword">boolean</span> dataChanged <span class="token operator">=</span> mDataChanged<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>dataChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">handleDataChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Handle the empty set by removing all views that are visible</span>
		<span class="token comment">// and calling it a day</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mItemCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">resetList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">invokeOnItemScrollListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mItemCount <span class="token operator">!=</span> mAdapter<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;The content of the adapter has changed but &quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;ListView did not receive a notification. Make sure the content of &quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;your adapter is not modified from a background thread, but only from &quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;the UI thread. Make sure your adapter calls notifyDataSetChanged() &quot;</span>
					<span class="token operator">+</span> <span class="token string">&quot;when its content changes. [in ListView(&quot;</span> <span class="token operator">+</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
					<span class="token operator">+</span> <span class="token string">&quot;) with Adapter(&quot;</span> <span class="token operator">+</span> mAdapter<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;)]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token function">setSelectedPositionInt</span><span class="token punctuation">(</span>mNextSelectedPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">AccessibilityNodeInfo</span> accessibilityFocusLayoutRestoreNode <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token class-name">View</span> accessibilityFocusLayoutRestoreView <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> accessibilityFocusPosition <span class="token operator">=</span> INVALID_POSITION<span class="token punctuation">;</span>

		<span class="token comment">// Remember which child, if any, had accessibility focus. This must</span>
		<span class="token comment">// occur before recycling any views, since that will clear</span>
		<span class="token comment">// accessibility focus.</span>
		<span class="token keyword">final</span> <span class="token class-name">ViewRootImpl</span> viewRootImpl <span class="token operator">=</span> <span class="token function">getViewRootImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>viewRootImpl <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token class-name">View</span> focusHost <span class="token operator">=</span> viewRootImpl<span class="token punctuation">.</span><span class="token function">getAccessibilityFocusedHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>focusHost <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">final</span> <span class="token class-name">View</span> focusChild <span class="token operator">=</span> <span class="token function">getAccessibilityFocusedChild</span><span class="token punctuation">(</span>focusHost<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>focusChild <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dataChanged <span class="token operator">||</span> <span class="token function">isDirectChildHeaderOrFooter</span><span class="token punctuation">(</span>focusChild<span class="token punctuation">)</span>
							<span class="token operator">||</span> focusChild<span class="token punctuation">.</span><span class="token function">hasTransientState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> mAdapterHasStableIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token comment">// The views won&#39;t be changing, so try to maintain</span>
						<span class="token comment">// focus on the current host and virtual view.</span>
						accessibilityFocusLayoutRestoreView <span class="token operator">=</span> focusHost<span class="token punctuation">;</span>
						accessibilityFocusLayoutRestoreNode <span class="token operator">=</span> viewRootImpl
								<span class="token punctuation">.</span><span class="token function">getAccessibilityFocusedVirtualView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token comment">// If all else fails, maintain focus at the same</span>
					<span class="token comment">// position.</span>
					accessibilityFocusPosition <span class="token operator">=</span> <span class="token function">getPositionForView</span><span class="token punctuation">(</span>focusChild<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token class-name">View</span> focusLayoutRestoreDirectChild <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token class-name">View</span> focusLayoutRestoreView <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

		<span class="token comment">// Take focus back to us temporarily to avoid the eventual call to</span>
		<span class="token comment">// clear focus when removing the focused child below from messing</span>
		<span class="token comment">// things up when ViewAncestor assigns focus back to someone else.</span>
		<span class="token keyword">final</span> <span class="token class-name">View</span> focusedChild <span class="token operator">=</span> <span class="token function">getFocusedChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>focusedChild <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// TODO: in some cases focusedChild.getParent() == null</span>

			<span class="token comment">// We can remember the focused view to restore after re-layout</span>
			<span class="token comment">// if the data hasn&#39;t changed, or if the focused position is a</span>
			<span class="token comment">// header or footer.</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dataChanged <span class="token operator">||</span> <span class="token function">isDirectChildHeaderOrFooter</span><span class="token punctuation">(</span>focusedChild<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				focusLayoutRestoreDirectChild <span class="token operator">=</span> focusedChild<span class="token punctuation">;</span>
				<span class="token comment">// Remember the specific view that had focus.</span>
				focusLayoutRestoreView <span class="token operator">=</span> <span class="token function">findFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>focusLayoutRestoreView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// Tell it we are going to mess with it.</span>
					focusLayoutRestoreView<span class="token punctuation">.</span><span class="token function">onStartTemporaryDetach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Pull all children into the RecycleBin.</span>
		<span class="token comment">// These views will be reused if possible</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> firstPosition <span class="token operator">=</span> mFirstPosition<span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token class-name">RecycleBin</span> recycleBin <span class="token operator">=</span> mRecycler<span class="token punctuation">;</span>
		<span class="token comment">// RecycleBin控制着整个item的复用，等最后我们再仔细分析下RecycleBin类</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>dataChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		    <span class="token comment">// 如果数据发生变化，就把现在的View都添加到一个废弃的View进行缓存，RecycleBin.addScrapView()方法就是缓存一些废弃的View</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> childCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				recycleBin<span class="token punctuation">.</span><span class="token function">addScrapView</span><span class="token punctuation">(</span><span class="token function">getChildAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> firstPosition<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		    <span class="token comment">// 调用这个方法后就会根据传入的参数来将ListView中的指定元素存储到mActiveViews数组当中。</span>
			recycleBin<span class="token punctuation">.</span><span class="token function">fillActiveViews</span><span class="token punctuation">(</span>childCount<span class="token punctuation">,</span> firstPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Clear out old views</span>
		<span class="token function">detachAllViewsFromParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		recycleBin<span class="token punctuation">.</span><span class="token function">removeSkippedScrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// mLayoutMode默认是LAYOUT_NORMAL</span>
		<span class="token keyword">switch</span> <span class="token punctuation">(</span>mLayoutMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> LAYOUT_SET_SELECTION<span class="token operator">:</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>newSel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				sel <span class="token operator">=</span> <span class="token function">fillFromSelection</span><span class="token punctuation">(</span>newSel<span class="token punctuation">.</span><span class="token function">getTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> childrenTop<span class="token punctuation">,</span> childrenBottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				sel <span class="token operator">=</span> <span class="token function">fillFromMiddle</span><span class="token punctuation">(</span>childrenTop<span class="token punctuation">,</span> childrenBottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> LAYOUT_SYNC<span class="token operator">:</span>
			sel <span class="token operator">=</span> <span class="token function">fillSpecific</span><span class="token punctuation">(</span>mSyncPosition<span class="token punctuation">,</span> mSpecificTop<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> LAYOUT_FORCE_BOTTOM<span class="token operator">:</span>
			sel <span class="token operator">=</span> <span class="token function">fillUp</span><span class="token punctuation">(</span>mItemCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> childrenBottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">adjustViewsUpOrDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> LAYOUT_FORCE_TOP<span class="token operator">:</span>
			mFirstPosition <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			sel <span class="token operator">=</span> <span class="token function">fillFromTop</span><span class="token punctuation">(</span>childrenTop<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">adjustViewsUpOrDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> LAYOUT_SPECIFIC<span class="token operator">:</span>
			sel <span class="token operator">=</span> <span class="token function">fillSpecific</span><span class="token punctuation">(</span><span class="token function">reconcileSelectedPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mSpecificTop<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> LAYOUT_MOVE_SELECTION<span class="token operator">:</span>
			sel <span class="token operator">=</span> <span class="token function">moveSelection</span><span class="token punctuation">(</span>oldSel<span class="token punctuation">,</span> newSel<span class="token punctuation">,</span> delta<span class="token punctuation">,</span> childrenTop<span class="token punctuation">,</span> childrenBottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
		    <span class="token comment">// 第一次调用layoutChildren方法的时候是还没有layout的，所以这时候childCount是0</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>childCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			    <span class="token comment">// mStackFromBottom的注释Indicates whether the list is stacked from the bottom edge or the top edge.</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mStackFromBottom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				    <span class="token comment">// 默认的布局方式是从上往下的。</span>
					<span class="token keyword">final</span> <span class="token keyword">int</span> position <span class="token operator">=</span> <span class="token function">lookForSelectablePosition</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">setSelectedPositionInt</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// 调用fillFromTop方法。</span>
					sel <span class="token operator">=</span> <span class="token function">fillFromTop</span><span class="token punctuation">(</span>childrenTop<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					<span class="token keyword">final</span> <span class="token keyword">int</span> position <span class="token operator">=</span> <span class="token function">lookForSelectablePosition</span><span class="token punctuation">(</span>mItemCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">setSelectedPositionInt</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
					sel <span class="token operator">=</span> <span class="token function">fillUp</span><span class="token punctuation">(</span>mItemCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> childrenBottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			    <span class="token comment">// 如果已经有条目了就会走到这里</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>mSelectedPosition <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> mSelectedPosition <span class="token operator">&lt;</span> mItemCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					sel <span class="token operator">=</span> <span class="token function">fillSpecific</span><span class="token punctuation">(</span>mSelectedPosition<span class="token punctuation">,</span>
							oldSel <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> childrenTop <span class="token operator">:</span> oldSel<span class="token punctuation">.</span><span class="token function">getTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mFirstPosition <span class="token operator">&lt;</span> mItemCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				    <span class="token comment">// 没有选中的条目</span>
					<span class="token comment">// TODO 一会先分析上面的fillFromTop部分，把其全部分析完后再回来分析这里。</span>
					sel <span class="token operator">=</span> <span class="token function">fillSpecific</span><span class="token punctuation">(</span>mFirstPosition<span class="token punctuation">,</span>
							oldFirst <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> childrenTop <span class="token operator">:</span> oldFirst<span class="token punctuation">.</span><span class="token function">getTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					sel <span class="token operator">=</span> <span class="token function">fillSpecific</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> childrenTop<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Flush any cached views that did not get reused above</span>
		recycleBin<span class="token punctuation">.</span><span class="token function">scrapActiveViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>sel <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// The current selected item should get focus if items are</span>
			<span class="token comment">// focusable.</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mItemsCanFocus <span class="token operator">&amp;&amp;</span> <span class="token function">hasFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>sel<span class="token punctuation">.</span><span class="token function">hasFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">final</span> <span class="token keyword">boolean</span> focusWasTaken <span class="token operator">=</span> <span class="token punctuation">(</span>sel <span class="token operator">==</span> focusLayoutRestoreDirectChild <span class="token operator">&amp;&amp;</span>
						focusLayoutRestoreView <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
						focusLayoutRestoreView<span class="token punctuation">.</span><span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">||</span> sel<span class="token punctuation">.</span><span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>focusWasTaken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// Selected item didn&#39;t take focus, but we still want to</span>
					<span class="token comment">// make sure something else outside of the selected view</span>
					<span class="token comment">// has focus.</span>
					<span class="token keyword">final</span> <span class="token class-name">View</span> focused <span class="token operator">=</span> <span class="token function">getFocusedChild</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>focused <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						focused<span class="token punctuation">.</span><span class="token function">clearFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token function">positionSelector</span><span class="token punctuation">(</span>INVALID_POSITION<span class="token punctuation">,</span> sel<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					sel<span class="token punctuation">.</span><span class="token function">setSelected</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					mSelectorRect<span class="token punctuation">.</span><span class="token function">setEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token function">positionSelector</span><span class="token punctuation">(</span>INVALID_POSITION<span class="token punctuation">,</span> sel<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			mSelectedTop <span class="token operator">=</span> sel<span class="token punctuation">.</span><span class="token function">getTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token keyword">boolean</span> inTouchMode <span class="token operator">=</span> mTouchMode <span class="token operator">==</span> TOUCH_MODE_TAP
					<span class="token operator">||</span> mTouchMode <span class="token operator">==</span> TOUCH_MODE_DONE_WAITING<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>inTouchMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// If the user&#39;s finger is down, select the motion position.</span>
				<span class="token keyword">final</span> <span class="token class-name">View</span> child <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>mMotionPosition <span class="token operator">-</span> mFirstPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">positionSelector</span><span class="token punctuation">(</span>mMotionPosition<span class="token punctuation">,</span> child<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mSelectorPosition <span class="token operator">!=</span> INVALID_POSITION<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// If we had previously positioned the selector somewhere,</span>
				<span class="token comment">// put it back there. It might not match up with the data,</span>
				<span class="token comment">// but it&#39;s transitioning out so it&#39;s not a big deal.</span>
				<span class="token keyword">final</span> <span class="token class-name">View</span> child <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>mSelectorPosition <span class="token operator">-</span> mFirstPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">positionSelector</span><span class="token punctuation">(</span>mSelectorPosition<span class="token punctuation">,</span> child<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token comment">// Otherwise, clear selection.</span>
				mSelectedTop <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				mSelectorRect<span class="token punctuation">.</span><span class="token function">setEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// Even if there is not selected position, we may need to</span>
			<span class="token comment">// restore focus (i.e. something focusable in touch mode).</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">hasFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> focusLayoutRestoreView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				focusLayoutRestoreView<span class="token punctuation">.</span><span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Attempt to restore accessibility focus, if necessary.</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>viewRootImpl <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token class-name">View</span> newAccessibilityFocusedView <span class="token operator">=</span> viewRootImpl<span class="token punctuation">.</span><span class="token function">getAccessibilityFocusedHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>newAccessibilityFocusedView <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>accessibilityFocusLayoutRestoreView <span class="token operator">!=</span> <span class="token keyword">null</span>
						<span class="token operator">&amp;&amp;</span> accessibilityFocusLayoutRestoreView<span class="token punctuation">.</span><span class="token function">isAttachedToWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">final</span> <span class="token class-name">AccessibilityNodeProvider</span> provider <span class="token operator">=</span>
							accessibilityFocusLayoutRestoreView<span class="token punctuation">.</span><span class="token function">getAccessibilityNodeProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>accessibilityFocusLayoutRestoreNode <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> provider <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">final</span> <span class="token keyword">int</span> virtualViewId <span class="token operator">=</span> <span class="token class-name">AccessibilityNodeInfo</span><span class="token punctuation">.</span><span class="token function">getVirtualDescendantId</span><span class="token punctuation">(</span>
								accessibilityFocusLayoutRestoreNode<span class="token punctuation">.</span><span class="token function">getSourceNodeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						provider<span class="token punctuation">.</span><span class="token function">performAction</span><span class="token punctuation">(</span>virtualViewId<span class="token punctuation">,</span>
								<span class="token class-name">AccessibilityNodeInfo</span><span class="token punctuation">.</span>ACTION_ACCESSIBILITY_FOCUS<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
						accessibilityFocusLayoutRestoreView<span class="token punctuation">.</span><span class="token function">requestAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>accessibilityFocusPosition <span class="token operator">!=</span> INVALID_POSITION<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// Bound the position within the visible children.</span>
					<span class="token keyword">final</span> <span class="token keyword">int</span> position <span class="token operator">=</span> <span class="token class-name">MathUtils</span><span class="token punctuation">.</span><span class="token function">constrain</span><span class="token punctuation">(</span>
							accessibilityFocusPosition <span class="token operator">-</span> mFirstPosition<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
							<span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">final</span> <span class="token class-name">View</span> restoreView <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>restoreView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						restoreView<span class="token punctuation">.</span><span class="token function">requestAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Tell focus view we are done mucking with it, if it is still in</span>
		<span class="token comment">// our view hierarchy.</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>focusLayoutRestoreView <span class="token operator">!=</span> <span class="token keyword">null</span>
				<span class="token operator">&amp;&amp;</span> focusLayoutRestoreView<span class="token punctuation">.</span><span class="token function">getWindowToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			focusLayoutRestoreView<span class="token punctuation">.</span><span class="token function">onFinishTemporaryDetach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		mLayoutMode <span class="token operator">=</span> LAYOUT_NORMAL<span class="token punctuation">;</span>
		mDataChanged <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mPositionScrollAfterLayout <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">post</span><span class="token punctuation">(</span>mPositionScrollAfterLayout<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mPositionScrollAfterLayout <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		mNeedSync <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token function">setNextSelectedPositionInt</span><span class="token punctuation">(</span>mSelectedPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">updateScrollIndicators</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>mItemCount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">checkSelectionChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token function">invokeOnItemScrollListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>blockLayoutRequests<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mBlockLayoutRequests <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面看到会调用<code>fillFromTop()</code>方法，我们看一下该方法的实现:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Fills the list from top to bottom, starting with mFirstPosition
 *
 * <span class="token keyword">@param</span> <span class="token parameter">nextTop</span> The location where the top of the first item should be
 *        drawn
 *
 * <span class="token keyword">@return</span> The view that is currently selected
 */</span>
<span class="token keyword">private</span> <span class="token class-name">View</span> <span class="token function">fillFromTop</span><span class="token punctuation">(</span><span class="token keyword">int</span> nextTop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	mFirstPosition <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>mFirstPosition<span class="token punctuation">,</span> mSelectedPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
	mFirstPosition <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>mFirstPosition<span class="token punctuation">,</span> mItemCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mFirstPosition <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mFirstPosition <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 调用fillDown()方法。</span>
	<span class="token keyword">return</span> <span class="token function">fillDown</span><span class="token punctuation">(</span>mFirstPosition<span class="token punctuation">,</span> nextTop<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来我们看一下<code>fillDown()</code>方法的实现:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Fills the list from pos down to the end of the list view.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">pos</span> The first position to put in the list
 *
 * <span class="token keyword">@param</span> <span class="token parameter">nextTop</span> The location where the top of the item associated with pos
 *        should be drawn
 *
 * <span class="token keyword">@return</span> The view that is currently selected, if it happens to be in the
 *         range that we draw.
 */</span>
<span class="token keyword">private</span> <span class="token class-name">View</span> <span class="token function">fillDown</span><span class="token punctuation">(</span><span class="token keyword">int</span> pos<span class="token punctuation">,</span> <span class="token keyword">int</span> nextTop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">View</span> selectedView <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> end <span class="token operator">=</span> <span class="token punctuation">(</span>mBottom <span class="token operator">-</span> mTop<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> CLIP_TO_PADDING_MASK<span class="token punctuation">)</span> <span class="token operator">==</span> CLIP_TO_PADDING_MASK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		end <span class="token operator">-=</span> mListPadding<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 用一个循环一直去填充，nextTop与end的比较来判断是否超过当前屏幕了，这就是为什么ListView就算有一万条最开始载入也不卡，因为他只初始化一屏啊。</span>
	<span class="token comment">// 以后都是边滑动边显示啊，说到这里一会我们还要看一下手势部分的处理。pos和mItemCount的比较来判断当前是否已经把所有条目填充完</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span>nextTop <span class="token operator">&lt;</span> end <span class="token operator">&amp;&amp;</span> pos <span class="token operator">&lt;</span> mItemCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// is this the selected item?</span>
		<span class="token keyword">boolean</span> selected <span class="token operator">=</span> pos <span class="token operator">==</span> mSelectedPosition<span class="token punctuation">;</span>
		<span class="token comment">// 调用makeAndAddView方法</span>
		<span class="token class-name">View</span> child <span class="token operator">=</span> <span class="token function">makeAndAddView</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> nextTop<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> mListPadding<span class="token punctuation">.</span>left<span class="token punctuation">,</span> selected<span class="token punctuation">)</span><span class="token punctuation">;</span>

		nextTop <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">getBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> mDividerHeight<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>selected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			selectedView <span class="token operator">=</span> child<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		pos<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">setVisibleRangeHint</span><span class="token punctuation">(</span>mFirstPosition<span class="token punctuation">,</span> mFirstPosition <span class="token operator">+</span> <span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> selectedView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来看一下<code>makeAndAddView()</code>方法，文档里面说的非常清楚了:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Obtain the view and add it to our list of children. The view can be made
 * fresh, converted from an unused view, or used as is if it was in the
 * recycle bin.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">position</span> Logical position in the list
 * <span class="token keyword">@param</span> <span class="token parameter">y</span> Top or bottom edge of the view to add
 * <span class="token keyword">@param</span> <span class="token parameter">flow</span> If flow is true, align top edge to y. If false, align bottom
 *        edge to y.
 * <span class="token keyword">@param</span> <span class="token parameter">childrenLeft</span> Left edge where children should be positioned
 * <span class="token keyword">@param</span> <span class="token parameter">selected</span> Is this position selected?
 * <span class="token keyword">@return</span> View that was added
 */</span>
<span class="token keyword">private</span> <span class="token class-name">View</span> <span class="token function">makeAndAddView</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">boolean</span> flow<span class="token punctuation">,</span> <span class="token keyword">int</span> childrenLeft<span class="token punctuation">,</span>
		<span class="token keyword">boolean</span> selected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">View</span> child<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mDataChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Try to use an existing view for this position</span>
		child <span class="token operator">=</span> mRecycler<span class="token punctuation">.</span><span class="token function">getActiveView</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// Found it -- we&#39;re using an existing child</span>
			<span class="token comment">// This just needs to be positioned</span>
			<span class="token comment">// 最后一个参数为true说明是复用的</span>
			<span class="token function">setupChild</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> position<span class="token punctuation">,</span> y<span class="token punctuation">,</span> flow<span class="token punctuation">,</span> childrenLeft<span class="token punctuation">,</span> selected<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">return</span> child<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Make a new view for this position, or convert an unused view if possible</span>
	<span class="token comment">// 一会我们先看一下obtainView方法，这个方法其实就是创建一个childView</span>
	<span class="token comment">// obtainView方法中会更改mIsScrap[0]的值，以便下面setupChild()中使用。</span>
	child <span class="token operator">=</span> <span class="token function">obtainView</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> mIsScrap<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// This needs to be positioned and measured</span>
	<span class="token comment">// 把childView添加到listview中，这里最后一个参数会是false</span>
	<span class="token function">setupChild</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> position<span class="token punctuation">,</span> y<span class="token punctuation">,</span> flow<span class="token punctuation">,</span> childrenLeft<span class="token punctuation">,</span> selected<span class="token punctuation">,</span> mIsScrap<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> child<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>makeAndAddView()</code>方法里面就是通过<code>RecycleBin</code>来复用<code>View</code>，如果不存在可以复用的<code>View</code>时就创建一个新的。<br> 那我们就先看一下`obtainView()方法，这个方法中的注释写的非常清楚，谷歌大神写代码就是规范，不想某些牛逼哄哄的人整天咋呼敏捷开发，一个注释也不写，那能叫敏捷？。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Get a view and have it show the data associated with the specified
 * position. This is called when we have already discovered that the view is
 * not available for reuse in the recycle bin. The only choices left are
 * converting an old view or making a new one.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">position</span> The position to display
 * <span class="token keyword">@param</span> <span class="token parameter">isScrap</span> Array of at least 1 boolean, the first entry will become true if
 *                the returned view was taken from the scrap heap, false if otherwise.
 *
 * <span class="token keyword">@return</span> A view displaying the data associated with the specified position
 */</span>
<span class="token class-name">View</span> <span class="token function">obtainView</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">,</span> <span class="token keyword">boolean</span><span class="token punctuation">[</span><span class="token punctuation">]</span> isScrap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Trace</span><span class="token punctuation">.</span><span class="token function">traceBegin</span><span class="token punctuation">(</span><span class="token class-name">Trace</span><span class="token punctuation">.</span>TRACE_TAG_VIEW<span class="token punctuation">,</span> <span class="token string">&quot;obtainView&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	isScrap<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token comment">// Check whether we have a transient state view. Attempt to re-bind the</span>
	<span class="token comment">// data and discard the view if we fail.</span>
	<span class="token keyword">final</span> <span class="token class-name">View</span> transientView <span class="token operator">=</span> mRecycler<span class="token punctuation">.</span><span class="token function">getTransientStateView</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>transientView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">final</span> <span class="token class-name">LayoutParams</span> params <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LayoutParams</span><span class="token punctuation">)</span> transientView<span class="token punctuation">.</span><span class="token function">getLayoutParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// If the view type hasn&#39;t changed, attempt to re-bind the data.</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>viewType <span class="token operator">==</span> mAdapter<span class="token punctuation">.</span><span class="token function">getItemViewType</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token class-name">View</span> updatedView <span class="token operator">=</span> mAdapter<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> transientView<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// If we failed to re-bind the data, scrap the obtained view.</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>updatedView <span class="token operator">!=</span> transientView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">setItemViewLayoutParams</span><span class="token punctuation">(</span>updatedView<span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span>
				mRecycler<span class="token punctuation">.</span><span class="token function">addScrapView</span><span class="token punctuation">(</span>updatedView<span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Scrap view implies temporary detachment.</span>
		isScrap<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> transientView<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token comment">// getScrapView()方法会从废弃View的缓存中去取，一旦View移除了屏幕就会被加到该废弃缓存中，所以他就是当View移除屏幕了就加到该缓存中</span>
	<span class="token comment">// 显示的时候再从该缓存中取，就这样进行了复用。</span>
	<span class="token keyword">final</span> <span class="token class-name">View</span> scrapView <span class="token operator">=</span> mRecycler<span class="token punctuation">.</span><span class="token function">getScrapView</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 调用Adapter.getView()方法了。并且将scrapView作为converview的参数传入。这个方法都挺熟，就不说了。</span>
	<span class="token keyword">final</span> <span class="token class-name">View</span> child <span class="token operator">=</span> mAdapter<span class="token punctuation">.</span><span class="token function">getView</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> scrapView<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>scrapView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">!=</span> scrapView<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// Failed to re-bind the data, return scrap to the heap.</span>
			mRecycler<span class="token punctuation">.</span><span class="token function">addScrapView</span><span class="token punctuation">(</span>scrapView<span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			isScrap<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

			child<span class="token punctuation">.</span><span class="token function">dispatchFinishTemporaryDetach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>mCacheColorHint <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		child<span class="token punctuation">.</span><span class="token function">setDrawingCacheBackgroundColor</span><span class="token punctuation">(</span>mCacheColorHint<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getImportantForAccessibility</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> IMPORTANT_FOR_ACCESSIBILITY_AUTO<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		child<span class="token punctuation">.</span><span class="token function">setImportantForAccessibility</span><span class="token punctuation">(</span>IMPORTANT_FOR_ACCESSIBILITY_YES<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 设置该view的layoutparams</span>
	<span class="token function">setItemViewLayoutParams</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">AccessibilityManager</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>mContext<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mAccessibilityDelegate <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mAccessibilityDelegate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ListItemAccessibilityDelegate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getAccessibilityDelegate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			child<span class="token punctuation">.</span><span class="token function">setAccessibilityDelegate</span><span class="token punctuation">(</span>mAccessibilityDelegate<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token class-name">Trace</span><span class="token punctuation">.</span><span class="token function">traceEnd</span><span class="token punctuation">(</span><span class="token class-name">Trace</span><span class="token punctuation">.</span>TRACE_TAG_VIEW<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> child<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>到这里我们就把<code>obtainView()</code>方法都看完了，接下来我们再看一下<code>setupChild()</code>方法:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Add a view as a child and make sure it is measured (if necessary) and
 * positioned properly.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">child</span> The view to add
 * <span class="token keyword">@param</span> <span class="token parameter">position</span> The position of this child
 * <span class="token keyword">@param</span> <span class="token parameter">y</span> The y position relative to which this view will be positioned
 * <span class="token keyword">@param</span> <span class="token parameter">flowDown</span> If true, align top edge to y. If false, align bottom
 *        edge to y.
 * <span class="token keyword">@param</span> <span class="token parameter">childrenLeft</span> Left edge where children should be positioned
 * <span class="token keyword">@param</span> <span class="token parameter">selected</span> Is this position selected?
 * <span class="token keyword">@param</span> <span class="token parameter">recycled</span> Has this view been pulled from the recycle bin? If so it
 *        does not need to be remeasured.
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">setupChild</span><span class="token punctuation">(</span><span class="token class-name">View</span> child<span class="token punctuation">,</span> <span class="token keyword">int</span> position<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">boolean</span> flowDown<span class="token punctuation">,</span> <span class="token keyword">int</span> childrenLeft<span class="token punctuation">,</span>
		<span class="token keyword">boolean</span> selected<span class="token punctuation">,</span> <span class="token keyword">boolean</span> recycled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">Trace</span><span class="token punctuation">.</span><span class="token function">traceBegin</span><span class="token punctuation">(</span><span class="token class-name">Trace</span><span class="token punctuation">.</span>TRACE_TAG_VIEW<span class="token punctuation">,</span> <span class="token string">&quot;setupListItem&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">final</span> <span class="token keyword">boolean</span> isSelected <span class="token operator">=</span> selected <span class="token operator">&amp;&amp;</span> <span class="token function">shouldShowSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">boolean</span> updateChildSelected <span class="token operator">=</span> isSelected <span class="token operator">!=</span> child<span class="token punctuation">.</span><span class="token function">isSelected</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> mode <span class="token operator">=</span> mTouchMode<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">boolean</span> isPressed <span class="token operator">=</span> mode <span class="token operator">&gt;</span> TOUCH_MODE_DOWN <span class="token operator">&amp;&amp;</span> mode <span class="token operator">&lt;</span> TOUCH_MODE_SCROLL <span class="token operator">&amp;&amp;</span>
			mMotionPosition <span class="token operator">==</span> position<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">boolean</span> updateChildPressed <span class="token operator">=</span> isPressed <span class="token operator">!=</span> child<span class="token punctuation">.</span><span class="token function">isPressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">boolean</span> needToMeasure <span class="token operator">=</span> <span class="token operator">!</span>recycled <span class="token operator">||</span> updateChildSelected <span class="token operator">||</span> child<span class="token punctuation">.</span><span class="token function">isLayoutRequested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// Respect layout params that are already in the view. Otherwise make some up...</span>
	<span class="token comment">// noinspection unchecked</span>
	<span class="token class-name">AbsListView<span class="token punctuation">.</span>LayoutParams</span> p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">AbsListView<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">)</span> child<span class="token punctuation">.</span><span class="token function">getLayoutParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">AbsListView<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">)</span> <span class="token function">generateDefaultLayoutParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 这里就是Adapter中getItemViewType的调用处</span>
	p<span class="token punctuation">.</span>viewType <span class="token operator">=</span> mAdapter<span class="token punctuation">.</span><span class="token function">getItemViewType</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>recycled <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>p<span class="token punctuation">.</span>forceAdd<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>recycledHeaderFooter <span class="token operator">&amp;&amp;</span>
			p<span class="token punctuation">.</span>viewType <span class="token operator">==</span> <span class="token class-name">AdapterView</span><span class="token punctuation">.</span>ITEM_VIEW_TYPE_HEADER_OR_FOOTER<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 复用的或者headerView及footerView等调用attachViewToParent方法，把之前detach的View重新attach到ViewGroup上</span>
		<span class="token function">attachViewToParent</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> flowDown <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		p<span class="token punctuation">.</span>forceAdd <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>viewType <span class="token operator">==</span> <span class="token class-name">AdapterView</span><span class="token punctuation">.</span>ITEM_VIEW_TYPE_HEADER_OR_FOOTER<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			p<span class="token punctuation">.</span>recycledHeaderFooter <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 第一次都是通过该方法来把View添加到ViewGroup中</span>
		<span class="token function">addViewInLayout</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> flowDown <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> p<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>updateChildSelected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		child<span class="token punctuation">.</span><span class="token function">setSelected</span><span class="token punctuation">(</span>isSelected<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>updateChildPressed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		child<span class="token punctuation">.</span><span class="token function">setPressed</span><span class="token punctuation">(</span>isPressed<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>mChoiceMode <span class="token operator">!=</span> CHOICE_MODE_NONE <span class="token operator">&amp;&amp;</span> mCheckStates <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token keyword">instanceof</span> <span class="token class-name">Checkable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Checkable</span><span class="token punctuation">)</span> child<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setChecked</span><span class="token punctuation">(</span>mCheckStates<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getApplicationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>targetSdkVersion
				<span class="token operator">&gt;=</span> <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span>Build</span><span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>HONEYCOMB<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			child<span class="token punctuation">.</span><span class="token function">setActivated</span><span class="token punctuation">(</span>mCheckStates<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>needToMeasure<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">int</span> childWidthSpec <span class="token operator">=</span> <span class="token class-name">ViewGroup</span><span class="token punctuation">.</span><span class="token function">getChildMeasureSpec</span><span class="token punctuation">(</span>mWidthMeasureSpec<span class="token punctuation">,</span>
				mListPadding<span class="token punctuation">.</span>left <span class="token operator">+</span> mListPadding<span class="token punctuation">.</span>right<span class="token punctuation">,</span> p<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> lpHeight <span class="token operator">=</span> p<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
		<span class="token keyword">int</span> childHeightSpec<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>lpHeight <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			childHeightSpec <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">makeMeasureSpec</span><span class="token punctuation">(</span>lpHeight<span class="token punctuation">,</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>EXACTLY<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			childHeightSpec <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">makeMeasureSpec</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>UNSPECIFIED<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		child<span class="token punctuation">.</span><span class="token function">measure</span><span class="token punctuation">(</span>childWidthSpec<span class="token punctuation">,</span> childHeightSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token function">cleanupLayoutState</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">final</span> <span class="token keyword">int</span> w <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">getMeasuredWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> h <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">getMeasuredHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> childTop <span class="token operator">=</span> flowDown <span class="token operator">?</span> y <span class="token operator">:</span> y <span class="token operator">-</span> h<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>needToMeasure<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> childRight <span class="token operator">=</span> childrenLeft <span class="token operator">+</span> w<span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> childBottom <span class="token operator">=</span> childTop <span class="token operator">+</span> h<span class="token punctuation">;</span>
		child<span class="token punctuation">.</span><span class="token function">layout</span><span class="token punctuation">(</span>childrenLeft<span class="token punctuation">,</span> childTop<span class="token punctuation">,</span> childRight<span class="token punctuation">,</span> childBottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		child<span class="token punctuation">.</span><span class="token function">offsetLeftAndRight</span><span class="token punctuation">(</span>childrenLeft <span class="token operator">-</span> child<span class="token punctuation">.</span><span class="token function">getLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		child<span class="token punctuation">.</span><span class="token function">offsetTopAndBottom</span><span class="token punctuation">(</span>childTop <span class="token operator">-</span> child<span class="token punctuation">.</span><span class="token function">getTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>mCachingStarted <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>child<span class="token punctuation">.</span><span class="token function">isDrawingCacheEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		child<span class="token punctuation">.</span><span class="token function">setDrawingCacheEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>recycled <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">AbsListView<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">)</span>child<span class="token punctuation">.</span><span class="token function">getLayoutParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>scrappedFromPosition<span class="token punctuation">)</span>
			<span class="token operator">!=</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		child<span class="token punctuation">.</span><span class="token function">jumpDrawablesToCurrentState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token class-name">Trace</span><span class="token punctuation">.</span><span class="token function">traceEnd</span><span class="token punctuation">(</span><span class="token class-name">Trace</span><span class="token punctuation">.</span>TRACE_TAG_VIEW<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过分析我们看到核心的部分就是<code>attachViewToParent()</code>方法和<code>addViewInLayout()</code>方法，这两个方法都是父类<code>ViewGroup</code>中的方法， 我们分别来看一下:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Attaches a view to this view group. Attaching a view assigns this group as the parent,
 * sets the layout parameters and puts the view in the list of children so that
 * it can be retrieved by calling <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">getChildAt</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span>.
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 * This method is intended to be lightweight and makes no assumptions about whether the
 * parent or child should be redrawn. Proper use of this method will include also making
 * any appropriate <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">requestLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> or <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> calls.
 * For example, callers can <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token class-name">Runnable</span><span class="token punctuation">)</span></span> post<span class="token punctuation">}</span> a <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">Runnable</span></span><span class="token punctuation">}</span>
 * which performs a <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">requestLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> on the next frame, after all detach/attach
 * calls are finished, causing layout to be run prior to redrawing the view hierarchy.
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 * This method should be called only for views which were detached from their parent.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">child</span> the child to attach
 * <span class="token keyword">@param</span> <span class="token parameter">index</span> the index at which the child should be attached
 * <span class="token keyword">@param</span> <span class="token parameter">params</span> the layout parameters of the child
 *
 * <span class="token keyword">@see</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">removeDetachedView</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">,</span> <span class="token keyword">boolean</span><span class="token punctuation">)</span></span>
 * <span class="token keyword">@see</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">detachAllViewsFromParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
 * <span class="token keyword">@see</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">detachViewFromParent</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">)</span></span>
 * <span class="token keyword">@see</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">detachViewFromParent</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span></span>
 */</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">attachViewToParent</span><span class="token punctuation">(</span><span class="token class-name">View</span> child<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">LayoutParams</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	child<span class="token punctuation">.</span>mLayoutParams <span class="token operator">=</span> params<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		index <span class="token operator">=</span> mChildrenCount<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 把该view添加到数组中，就像注释所说的为了能够让`getChildAt()`方法能获取到。</span>
	<span class="token function">addInArray</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>

	child<span class="token punctuation">.</span>mParent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
	child<span class="token punctuation">.</span>mPrivateFlags <span class="token operator">=</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>mPrivateFlags <span class="token operator">&amp;</span> <span class="token operator">~</span>PFLAG_DIRTY_MASK
					<span class="token operator">&amp;</span> <span class="token operator">~</span>PFLAG_DRAWING_CACHE_VALID<span class="token punctuation">)</span>
			<span class="token operator">|</span> PFLAG_DRAWN <span class="token operator">|</span> PFLAG_INVALIDATED<span class="token punctuation">;</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span>mPrivateFlags <span class="token operator">|=</span> PFLAG_INVALIDATED<span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">hasFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">requestChildFocus</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> child<span class="token punctuation">.</span><span class="token function">findFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>复用的处理看完后，我们看一下新创建的childView如何被添加到ListView上，我们看一下<code>addViewInLayout()</code>方法:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Adds a view during layout. This is useful if in your onLayout() method,
 * you need to add more views (as does the list view for example).
 *
 * If index is negative, it means put it at the end of the list.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">child</span> the view to add to the group
 * <span class="token keyword">@param</span> <span class="token parameter">index</span> the index at which the child must be added
 * <span class="token keyword">@param</span> <span class="token parameter">params</span> the layout parameters to associate with the child
 * <span class="token keyword">@param</span> <span class="token parameter">preventRequestLayout</span> if true, calling this method will not trigger a
 *        layout request on child
 * <span class="token keyword">@return</span> true if the child was added, false otherwise
 */</span>
<span class="token keyword">protected</span> <span class="token keyword">boolean</span> <span class="token function">addViewInLayout</span><span class="token punctuation">(</span><span class="token class-name">View</span> child<span class="token punctuation">,</span> <span class="token keyword">int</span> index<span class="token punctuation">,</span> <span class="token class-name">LayoutParams</span> params<span class="token punctuation">,</span>
		<span class="token keyword">boolean</span> preventRequestLayout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Cannot add a null child view to a ViewGroup&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	child<span class="token punctuation">.</span>mParent <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token comment">// 这个方法最终会调用addView方法添加childView</span>
	<span class="token function">addViewInner</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> index<span class="token punctuation">,</span> params<span class="token punctuation">,</span> preventRequestLayout<span class="token punctuation">)</span><span class="token punctuation">;</span>
	child<span class="token punctuation">.</span>mPrivateFlags <span class="token operator">=</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span>mPrivateFlags <span class="token operator">&amp;</span> <span class="token operator">~</span>PFLAG_DIRTY_MASK<span class="token punctuation">)</span> <span class="token operator">|</span> PFLAG_DRAWN<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>到这里已经把上面<code>fillFromTop()</code>方法的部分都分析完了。<br> 不要忘了我们上面还留了一个TODO的部分，就是对于已经有数据的部分调用<code>fillSpecific()</code>方法，那我们就看一下他的实现:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Put a specific item at a specific location on the screen and then build
 * up and down from there.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">position</span> The reference view to use as the starting point
 * <span class="token keyword">@param</span> <span class="token parameter">top</span> Pixel offset from the top of this view to the top of the
 *        reference view.
 *
 * <span class="token keyword">@return</span> The selected view, or null if the selected view is outside the
 *         visible area.
 */</span>
<span class="token keyword">private</span> <span class="token class-name">View</span> <span class="token function">fillSpecific</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">,</span> <span class="token keyword">int</span> top<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">boolean</span> tempIsSelected <span class="token operator">=</span> position <span class="token operator">==</span> mSelectedPosition<span class="token punctuation">;</span>
	<span class="token class-name">View</span> temp <span class="token operator">=</span> <span class="token function">makeAndAddView</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> top<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> mListPadding<span class="token punctuation">.</span>left<span class="token punctuation">,</span> tempIsSelected<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// Possibly changed again in fillUp if we add rows above this one.</span>
	mFirstPosition <span class="token operator">=</span> position<span class="token punctuation">;</span>

	<span class="token class-name">View</span> above<span class="token punctuation">;</span>
	<span class="token class-name">View</span> below<span class="token punctuation">;</span>

	<span class="token keyword">final</span> <span class="token keyword">int</span> dividerHeight <span class="token operator">=</span> mDividerHeight<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mStackFromBottom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		above <span class="token operator">=</span> <span class="token function">fillUp</span><span class="token punctuation">(</span>position <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> temp<span class="token punctuation">.</span><span class="token function">getTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> dividerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// This will correct for the top of the first view not touching the top of the list</span>
		<span class="token function">adjustViewsUpOrDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		below <span class="token operator">=</span> <span class="token function">fillDown</span><span class="token punctuation">(</span>position <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> temp<span class="token punctuation">.</span><span class="token function">getBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> dividerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> childCount <span class="token operator">=</span> <span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>childCount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">correctTooHigh</span><span class="token punctuation">(</span>childCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		below <span class="token operator">=</span> <span class="token function">fillDown</span><span class="token punctuation">(</span>position <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> temp<span class="token punctuation">.</span><span class="token function">getBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> dividerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// This will correct for the bottom of the last view not touching the bottom of the list</span>
		<span class="token function">adjustViewsUpOrDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		above <span class="token operator">=</span> <span class="token function">fillUp</span><span class="token punctuation">(</span>position <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> temp<span class="token punctuation">.</span><span class="token function">getTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> dividerHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> childCount <span class="token operator">=</span> <span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>childCount <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			 <span class="token function">correctTooLow</span><span class="token punctuation">(</span>childCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>tempIsSelected<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> temp<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>above <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> above<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> below<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>就像注释所说的它是让指定位置的View先加载到屏幕上，然后在加载该view往上以及往下位置的其他View，他里面会调用<code>fillUp()</code>和<code>fillDown()</code>方法，又会走上面的流程，所以这里就不分析了。</p><p>好了，到这里我们就基本已经分析完了，但是感觉好像好少了点什么？</p><p>这里少了不是一点，是两点:</p><ul><li>手势滑动过程中ListView的复用处理</li><li>RecycleBin中复用的具体实现</li></ul><p>一个个的来，先看一下手势滑动部分，这个当然是从<code>onTouchEvent()</code>方法看了，<br> 手势这一块不太清楚的可以看我之前的一篇文章 <a href="https://github.com/CharonChui/AndroidNote/blob/master/Android%E5%8A%A0%E5%BC%BA/Android%20Touch%E4%BA%8B%E4%BB%B6%E5%88%86%E5%8F%91%E8%AF%A6%E8%A7%A3.md" target="_blank" rel="noopener noreferrer">Android Touch事件分发详解<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>发现<code>ListView</code>没有重写<code>onTouchEvent()</code>方法，这也好理解，因为<code>GridView</code>也有类似的滑动功能，所以去父类<code>AbsListView</code>中看.<br> 我们看一下<code>AbsListView.onTouchEvent()</code>方法:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// A disabled view that is clickable still consumes the touch</span>
		<span class="token comment">// events, it just doesn&#39;t respond to them.</span>
		<span class="token keyword">return</span> <span class="token function">isClickable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isLongClickable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>mPositionScroller <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mPositionScroller<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>mIsDetaching <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">isAttachedToWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Something isn&#39;t right.</span>
		<span class="token comment">// Since we rely on being attached to get data set change notifications,</span>
		<span class="token comment">// don&#39;t risk doing anything where we might try to resync and find things</span>
		<span class="token comment">// in a bogus state.</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">startNestedScroll</span><span class="token punctuation">(</span>SCROLL_AXIS_VERTICAL<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>mFastScroll <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">boolean</span> intercepted <span class="token operator">=</span> mFastScroll<span class="token punctuation">.</span><span class="token function">onTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>intercepted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token function">initVelocityTrackerIfNotExists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token class-name">MotionEvent</span> vtev <span class="token operator">=</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token function">obtain</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">final</span> <span class="token keyword">int</span> actionMasked <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getActionMasked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mNestedYOffset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	vtev<span class="token punctuation">.</span><span class="token function">offsetLocation</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> mNestedYOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>actionMasked<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN<span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token function">onTouchDown</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_MOVE<span class="token operator">:</span> <span class="token punctuation">{</span>
		    <span class="token comment">// 具体移动的部分就在这里了</span>
			<span class="token function">onTouchMove</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span> vtev<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_UP<span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token function">onTouchUp</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_CANCEL<span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token function">onTouchCancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_POINTER_UP<span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token function">onSecondaryPointerUp</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> x <span class="token operator">=</span> mMotionX<span class="token punctuation">;</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> y <span class="token operator">=</span> mMotionY<span class="token punctuation">;</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> motionPosition <span class="token operator">=</span> <span class="token function">pointToPosition</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>motionPosition <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// Remember where the motion event started</span>
				<span class="token keyword">final</span> <span class="token class-name">View</span> child <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>motionPosition <span class="token operator">-</span> mFirstPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
				mMotionViewOriginalTop <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">getTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				mMotionPosition <span class="token operator">=</span> motionPosition<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			mLastY <span class="token operator">=</span> y<span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_POINTER_DOWN<span class="token operator">:</span> <span class="token punctuation">{</span>
			<span class="token comment">// New pointers take over dragging duties</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> index <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getActionIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> id <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getPointerId</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> ev<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> ev<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mMotionCorrection <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			mActivePointerId <span class="token operator">=</span> id<span class="token punctuation">;</span>
			mMotionX <span class="token operator">=</span> x<span class="token punctuation">;</span>
			mMotionY <span class="token operator">=</span> y<span class="token punctuation">;</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> motionPosition <span class="token operator">=</span> <span class="token function">pointToPosition</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>motionPosition <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// Remember where the motion event started</span>
				<span class="token keyword">final</span> <span class="token class-name">View</span> child <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>motionPosition <span class="token operator">-</span> mFirstPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
				mMotionViewOriginalTop <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">getTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				mMotionPosition <span class="token operator">=</span> motionPosition<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			mLastY <span class="token operator">=</span> y<span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>mVelocityTracker <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mVelocityTracker<span class="token punctuation">.</span><span class="token function">addMovement</span><span class="token punctuation">(</span>vtev<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	vtev<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接着看一下<code>onTouchMove()</code>方法:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">onTouchMove</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">,</span> <span class="token class-name">MotionEvent</span> vtev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> pointerIndex <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">findPointerIndex</span><span class="token punctuation">(</span>mActivePointerId<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pointerIndex <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		pointerIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		mActivePointerId <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getPointerId</span><span class="token punctuation">(</span>pointerIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>mDataChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Re-sync everything if data has been changed</span>
		<span class="token comment">// since the scroll operation can query the adapter.</span>
		<span class="token function">layoutChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">final</span> <span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> ev<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span>pointerIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">switch</span> <span class="token punctuation">(</span>mTouchMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">case</span> TOUCH_MODE_DOWN<span class="token operator">:</span>
		<span class="token keyword">case</span> TOUCH_MODE_TAP<span class="token operator">:</span>
		<span class="token keyword">case</span> TOUCH_MODE_DONE_WAITING<span class="token operator">:</span>
			<span class="token comment">// Check if we have moved far enough that it looks more like a</span>
			<span class="token comment">// scroll than a tap. If so, we&#39;ll enter scrolling mode.</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">startScrollIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> ev<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span>pointerIndex<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">,</span> vtev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// Otherwise, check containment within list bounds. If we&#39;re</span>
			<span class="token comment">// outside bounds, cancel any active presses.</span>
			<span class="token keyword">final</span> <span class="token class-name">View</span> motionView <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>mMotionPosition <span class="token operator">-</span> mFirstPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">final</span> <span class="token keyword">float</span> x <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span>pointerIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">pointInView</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> mTouchSlop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>motionView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					motionView<span class="token punctuation">.</span><span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token function">removeCallbacks</span><span class="token punctuation">(</span>mTouchMode <span class="token operator">==</span> TOUCH_MODE_DOWN <span class="token operator">?</span>
						mPendingCheckForTap <span class="token operator">:</span> mPendingCheckForLongPress<span class="token punctuation">)</span><span class="token punctuation">;</span>
				mTouchMode <span class="token operator">=</span> TOUCH_MODE_DONE_WAITING<span class="token punctuation">;</span>
				<span class="token function">updateSelectorState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>motionView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// Still within bounds, update the hotspot.</span>
				<span class="token keyword">final</span> <span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span> point <span class="token operator">=</span> mTmpPoint<span class="token punctuation">;</span>
				point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
				point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> y<span class="token punctuation">;</span>
				<span class="token function">transformPointToViewLocal</span><span class="token punctuation">(</span>point<span class="token punctuation">,</span> motionView<span class="token punctuation">)</span><span class="token punctuation">;</span>
				motionView<span class="token punctuation">.</span><span class="token function">drawableHotspotChanged</span><span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> point<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>

		<span class="token keyword">case</span> TOUCH_MODE_SCROLL<span class="token operator">:</span>
		<span class="token keyword">case</span> TOUCH_MODE_OVERSCROLL<span class="token operator">:</span>
			<span class="token comment">// 滑动部分的处理，传入当前位置的x,y坐标</span>
			<span class="token function">scrollIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> ev<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span>pointerIndex<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">,</span> vtev<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再看一下<code>scrollIfNeeded()</code>方法的实现:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">scrollIfNeeded</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token class-name">MotionEvent</span> vtev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> rawDeltaY <span class="token operator">=</span> y <span class="token operator">-</span> mMotionY<span class="token punctuation">;</span>
	<span class="token keyword">int</span> scrollOffsetCorrection <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> scrollConsumedCorrection <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mLastY <span class="token operator">==</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MIN_VALUE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		rawDeltaY <span class="token operator">-=</span> mMotionCorrection<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dispatchNestedPreScroll</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> mLastY <span class="token operator">!=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MIN_VALUE <span class="token operator">?</span> mLastY <span class="token operator">-</span> y <span class="token operator">:</span> <span class="token operator">-</span>rawDeltaY<span class="token punctuation">,</span>
			mScrollConsumed<span class="token punctuation">,</span> mScrollOffset<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		rawDeltaY <span class="token operator">+=</span> mScrollConsumed<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		scrollOffsetCorrection <span class="token operator">=</span> <span class="token operator">-</span>mScrollOffset<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		scrollConsumedCorrection <span class="token operator">=</span> mScrollConsumed<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>vtev <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			vtev<span class="token punctuation">.</span><span class="token function">offsetLocation</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> mScrollOffset<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			mNestedYOffset <span class="token operator">+=</span> mScrollOffset<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> deltaY <span class="token operator">=</span> rawDeltaY<span class="token punctuation">;</span>
	<span class="token keyword">int</span> incrementalDeltaY <span class="token operator">=</span>
			mLastY <span class="token operator">!=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MIN_VALUE <span class="token operator">?</span> y <span class="token operator">-</span> mLastY <span class="token operator">+</span> scrollConsumedCorrection <span class="token operator">:</span> deltaY<span class="token punctuation">;</span>
	<span class="token keyword">int</span> lastYCorrection <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>mTouchMode <span class="token operator">==</span> TOUCH_MODE_SCROLL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>PROFILE_SCROLLING<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mScrollProfilingStarted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">Debug</span><span class="token punctuation">.</span><span class="token function">startMethodTracing</span><span class="token punctuation">(</span><span class="token string">&quot;AbsListViewScroll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				mScrollProfilingStarted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>mScrollStrictSpan <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// If it&#39;s non-null, we&#39;re already in a scroll.</span>
			mScrollStrictSpan <span class="token operator">=</span> <span class="token class-name">StrictMode</span><span class="token punctuation">.</span><span class="token function">enterCriticalSpan</span><span class="token punctuation">(</span><span class="token string">&quot;AbsListView-scroll&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">!=</span> mLastY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 移动了</span>
			<span class="token comment">// We may be here after stopping a fling and continuing to scroll.</span>
			<span class="token comment">// If so, we haven&#39;t disallowed intercepting touch events yet.</span>
			<span class="token comment">// Make sure that we do so in case we&#39;re in a parent that can intercept.</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> FLAG_DISALLOW_INTERCEPT<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
					<span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>rawDeltaY<span class="token punctuation">)</span> <span class="token operator">&gt;</span> mTouchSlop<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">final</span> <span class="token class-name">ViewParent</span> parent <span class="token operator">=</span> <span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					parent<span class="token punctuation">.</span><span class="token function">requestDisallowInterceptTouchEvent</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">final</span> <span class="token keyword">int</span> motionIndex<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mMotionPosition <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				motionIndex <span class="token operator">=</span> mMotionPosition <span class="token operator">-</span> mFirstPosition<span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token comment">// If we don&#39;t have a motion position that we can reliably track,</span>
				<span class="token comment">// pick something in the middle to make a best guess at things below.</span>
				motionIndex <span class="token operator">=</span> <span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">int</span> motionViewPrevTop <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token class-name">View</span> motionView <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getChildAt</span><span class="token punctuation">(</span>motionIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>motionView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				motionViewPrevTop <span class="token operator">=</span> motionView<span class="token punctuation">.</span><span class="token function">getTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// No need to do all this work if we&#39;re not going to move anyway</span>
			<span class="token keyword">boolean</span> atEdge <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>incrementalDeltaY <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			    <span class="token comment">// 移动的过程中不断调用</span>
				atEdge <span class="token operator">=</span> <span class="token function">trackMotionScroll</span><span class="token punctuation">(</span>deltaY<span class="token punctuation">,</span> incrementalDeltaY<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// Check to see if we have bumped into the scroll limit</span>
			motionView <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getChildAt</span><span class="token punctuation">(</span>motionIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>motionView <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// Check if the top of the motion view is where it is</span>
				<span class="token comment">// supposed to be</span>
				<span class="token keyword">final</span> <span class="token keyword">int</span> motionViewRealTop <span class="token operator">=</span> motionView<span class="token punctuation">.</span><span class="token function">getTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>atEdge<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// Apply overscroll</span>

					<span class="token keyword">int</span> overscroll <span class="token operator">=</span> <span class="token operator">-</span>incrementalDeltaY <span class="token operator">-</span>
							<span class="token punctuation">(</span>motionViewRealTop <span class="token operator">-</span> motionViewPrevTop<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dispatchNestedScroll</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> overscroll <span class="token operator">-</span> incrementalDeltaY<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> overscroll<span class="token punctuation">,</span>
							mScrollOffset<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						lastYCorrection <span class="token operator">-=</span> mScrollOffset<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>vtev <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							vtev<span class="token punctuation">.</span><span class="token function">offsetLocation</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> mScrollOffset<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							mNestedYOffset <span class="token operator">+=</span> mScrollOffset<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
						<span class="token keyword">final</span> <span class="token keyword">boolean</span> atOverscrollEdge <span class="token operator">=</span> <span class="token function">overScrollBy</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> overscroll<span class="token punctuation">,</span>
								<span class="token number">0</span><span class="token punctuation">,</span> mScrollY<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mOverscrollDistance<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

						<span class="token keyword">if</span> <span class="token punctuation">(</span>atOverscrollEdge <span class="token operator">&amp;&amp;</span> mVelocityTracker <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token comment">// Don&#39;t allow overfling if we&#39;re at the edge</span>
							mVelocityTracker<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>

						<span class="token keyword">final</span> <span class="token keyword">int</span> overscrollMode <span class="token operator">=</span> <span class="token function">getOverScrollMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>overscrollMode <span class="token operator">==</span> OVER_SCROLL_ALWAYS <span class="token operator">||</span>
								<span class="token punctuation">(</span>overscrollMode <span class="token operator">==</span> OVER_SCROLL_IF_CONTENT_SCROLLS <span class="token operator">&amp;&amp;</span>
										<span class="token operator">!</span><span class="token function">contentFits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>atOverscrollEdge<span class="token punctuation">)</span> <span class="token punctuation">{</span>
								mDirection <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// Reset when entering overscroll.</span>
								mTouchMode <span class="token operator">=</span> TOUCH_MODE_OVERSCROLL<span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>incrementalDeltaY <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								mEdgeGlowTop<span class="token punctuation">.</span><span class="token function">onPull</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token operator">-</span>overscroll <span class="token operator">/</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
										<span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> x <span class="token operator">/</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mEdgeGlowBottom<span class="token punctuation">.</span><span class="token function">isFinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
									mEdgeGlowBottom<span class="token punctuation">.</span><span class="token function">onRelease</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token punctuation">}</span>
								<span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
										mEdgeGlowTop<span class="token punctuation">.</span><span class="token function">getMaxHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">getPaddingTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>incrementalDeltaY <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								mEdgeGlowBottom<span class="token punctuation">.</span><span class="token function">onPull</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> overscroll <span class="token operator">/</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
										<span class="token number">1.f</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> x <span class="token operator">/</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mEdgeGlowTop<span class="token punctuation">.</span><span class="token function">isFinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
									mEdgeGlowTop<span class="token punctuation">.</span><span class="token function">onRelease</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
								<span class="token punctuation">}</span>
								<span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">getPaddingBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span>
										mEdgeGlowBottom<span class="token punctuation">.</span><span class="token function">getMaxHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
										<span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				mMotionY <span class="token operator">=</span> y <span class="token operator">+</span> lastYCorrection <span class="token operator">+</span> scrollOffsetCorrection<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			mLastY <span class="token operator">=</span> y <span class="token operator">+</span> lastYCorrection <span class="token operator">+</span> scrollOffsetCorrection<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mTouchMode <span class="token operator">==</span> TOUCH_MODE_OVERSCROLL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 灰起了.</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>y <span class="token operator">!=</span> mLastY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> oldScroll <span class="token operator">=</span> mScrollY<span class="token punctuation">;</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> newScroll <span class="token operator">=</span> oldScroll <span class="token operator">-</span> incrementalDeltaY<span class="token punctuation">;</span>
			<span class="token keyword">int</span> newDirection <span class="token operator">=</span> y <span class="token operator">&gt;</span> mLastY <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>mDirection <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mDirection <span class="token operator">=</span> newDirection<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">int</span> overScrollDistance <span class="token operator">=</span> <span class="token operator">-</span>incrementalDeltaY<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>newScroll <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> oldScroll <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>newScroll <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> oldScroll <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				overScrollDistance <span class="token operator">=</span> <span class="token operator">-</span>oldScroll<span class="token punctuation">;</span>
				incrementalDeltaY <span class="token operator">+=</span> overScrollDistance<span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				incrementalDeltaY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>overScrollDistance <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">overScrollBy</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> overScrollDistance<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> mScrollY<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
						<span class="token number">0</span><span class="token punctuation">,</span> mOverscrollDistance<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">final</span> <span class="token keyword">int</span> overscrollMode <span class="token operator">=</span> <span class="token function">getOverScrollMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>overscrollMode <span class="token operator">==</span> OVER_SCROLL_ALWAYS <span class="token operator">||</span>
						<span class="token punctuation">(</span>overscrollMode <span class="token operator">==</span> OVER_SCROLL_IF_CONTENT_SCROLLS <span class="token operator">&amp;&amp;</span>
								<span class="token operator">!</span><span class="token function">contentFits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>rawDeltaY <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						mEdgeGlowTop<span class="token punctuation">.</span><span class="token function">onPull</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> overScrollDistance <span class="token operator">/</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
								<span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> x <span class="token operator">/</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mEdgeGlowBottom<span class="token punctuation">.</span><span class="token function">isFinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							mEdgeGlowBottom<span class="token punctuation">.</span><span class="token function">onRelease</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
								mEdgeGlowTop<span class="token punctuation">.</span><span class="token function">getMaxHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">getPaddingTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>rawDeltaY <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						mEdgeGlowBottom<span class="token punctuation">.</span><span class="token function">onPull</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> overScrollDistance <span class="token operator">/</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
								<span class="token number">1.f</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> x <span class="token operator">/</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mEdgeGlowTop<span class="token punctuation">.</span><span class="token function">isFinished</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							mEdgeGlowTop<span class="token punctuation">.</span><span class="token function">onRelease</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">getPaddingBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span>
								mEdgeGlowBottom<span class="token punctuation">.</span><span class="token function">getMaxHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
								<span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>incrementalDeltaY <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// Coming back to &#39;real&#39; list scrolling</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>mScrollY <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					mScrollY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
					<span class="token function">invalidateParentIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 继续处理着</span>
				<span class="token function">trackMotionScroll</span><span class="token punctuation">(</span>incrementalDeltaY<span class="token punctuation">,</span> incrementalDeltaY<span class="token punctuation">)</span><span class="token punctuation">;</span>

				mTouchMode <span class="token operator">=</span> TOUCH_MODE_SCROLL<span class="token punctuation">;</span>

				<span class="token comment">// We did not scroll the full amount. Treat this essentially like the</span>
				<span class="token comment">// start of a new touch scroll</span>
				<span class="token keyword">final</span> <span class="token keyword">int</span> motionPosition <span class="token operator">=</span> <span class="token function">findClosestMotionRow</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

				mMotionCorrection <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token class-name">View</span> motionView <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>motionPosition <span class="token operator">-</span> mFirstPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
				mMotionViewOriginalTop <span class="token operator">=</span> motionView <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> motionView<span class="token punctuation">.</span><span class="token function">getTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
				mMotionY <span class="token operator">=</span>  y <span class="token operator">+</span> scrollOffsetCorrection<span class="token punctuation">;</span>
				mMotionPosition <span class="token operator">=</span> motionPosition<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			mLastY <span class="token operator">=</span> y <span class="token operator">+</span> lastYCorrection <span class="token operator">+</span> scrollOffsetCorrection<span class="token punctuation">;</span>
			mDirection <span class="token operator">=</span> newDirection<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这部分代码逻辑牵扯太多，有点晕呼呼的，记着看一下<code>trackMotionScroll()</code>方法:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Track a motion scroll
 *
 * <span class="token keyword">@param</span> <span class="token parameter">deltaY</span> Amount to offset mMotionView. This is the accumulated delta since the motion
 *        began. Positive numbers mean the user&#39;s finger is moving down the screen.
 * <span class="token keyword">@param</span> <span class="token parameter">incrementalDeltaY</span> Change in deltaY from the previous event. 通过它的正负来判断是向上还是向下。
 * <span class="token keyword">@return</span> true if we&#39;re already at the beginning/end of the list and have nothing to do.
 */</span>
<span class="token keyword">boolean</span> <span class="token function">trackMotionScroll</span><span class="token punctuation">(</span><span class="token keyword">int</span> deltaY<span class="token punctuation">,</span> <span class="token keyword">int</span> incrementalDeltaY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> childCount <span class="token operator">=</span> <span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>childCount <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">final</span> <span class="token keyword">int</span> firstTop <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> lastBottom <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>childCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">final</span> <span class="token class-name">Rect</span> listPadding <span class="token operator">=</span> mListPadding<span class="token punctuation">;</span>

	<span class="token comment">// &quot;effective padding&quot; In this case is the amount of padding that affects</span>
	<span class="token comment">// how much space should not be filled by items. If we don&#39;t clip to padding</span>
	<span class="token comment">// there is no effective padding.</span>
	<span class="token keyword">int</span> effectivePaddingTop <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> effectivePaddingBottom <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> CLIP_TO_PADDING_MASK<span class="token punctuation">)</span> <span class="token operator">==</span> CLIP_TO_PADDING_MASK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		effectivePaddingTop <span class="token operator">=</span> listPadding<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
		effectivePaddingBottom <span class="token operator">=</span> listPadding<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	 <span class="token comment">// FIXME account for grid vertical spacing too?</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> spaceAbove <span class="token operator">=</span> effectivePaddingTop <span class="token operator">-</span> firstTop<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> end <span class="token operator">=</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> effectivePaddingBottom<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> spaceBelow <span class="token operator">=</span> lastBottom <span class="token operator">-</span> end<span class="token punctuation">;</span>

	<span class="token keyword">final</span> <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> mPaddingBottom <span class="token operator">-</span> mPaddingTop<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>deltaY <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		deltaY <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span>height <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> deltaY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		deltaY <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>height <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> deltaY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>incrementalDeltaY <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		incrementalDeltaY <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">(</span>height <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> incrementalDeltaY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		incrementalDeltaY <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>height <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> incrementalDeltaY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">final</span> <span class="token keyword">int</span> firstPosition <span class="token operator">=</span> mFirstPosition<span class="token punctuation">;</span>

	<span class="token comment">// Update our guesses for where the first and last views are</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>firstPosition <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mFirstPositionDistanceGuess <span class="token operator">=</span> firstTop <span class="token operator">-</span> listPadding<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		mFirstPositionDistanceGuess <span class="token operator">+=</span> incrementalDeltaY<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>firstPosition <span class="token operator">+</span> childCount <span class="token operator">==</span> mItemCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mLastPositionDistanceGuess <span class="token operator">=</span> lastBottom <span class="token operator">+</span> listPadding<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		mLastPositionDistanceGuess <span class="token operator">+=</span> incrementalDeltaY<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">final</span> <span class="token keyword">boolean</span> cannotScrollDown <span class="token operator">=</span> <span class="token punctuation">(</span>firstPosition <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span>
			firstTop <span class="token operator">&gt;=</span> listPadding<span class="token punctuation">.</span>top <span class="token operator">&amp;&amp;</span> incrementalDeltaY <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">boolean</span> cannotScrollUp <span class="token operator">=</span> <span class="token punctuation">(</span>firstPosition <span class="token operator">+</span> childCount <span class="token operator">==</span> mItemCount <span class="token operator">&amp;&amp;</span>
			lastBottom <span class="token operator">&lt;=</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> listPadding<span class="token punctuation">.</span>bottom <span class="token operator">&amp;&amp;</span> incrementalDeltaY <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>cannotScrollDown <span class="token operator">||</span> cannotScrollUp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> incrementalDeltaY <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 判断向上还是向下</span>
	<span class="token keyword">final</span> <span class="token keyword">boolean</span> down <span class="token operator">=</span> incrementalDeltaY <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">final</span> <span class="token keyword">boolean</span> inTouchMode <span class="token operator">=</span> <span class="token function">isInTouchMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>inTouchMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">hideSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">final</span> <span class="token keyword">int</span> headerViewsCount <span class="token operator">=</span> <span class="token function">getHeaderViewsCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> footerViewsStart <span class="token operator">=</span> mItemCount <span class="token operator">-</span> <span class="token function">getFooterViewsCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> start <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>down<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">int</span> top <span class="token operator">=</span> <span class="token operator">-</span>incrementalDeltaY<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> CLIP_TO_PADDING_MASK<span class="token punctuation">)</span> <span class="token operator">==</span> CLIP_TO_PADDING_MASK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			top <span class="token operator">+=</span> listPadding<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> childCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token class-name">View</span> child <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> top<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			    <span class="token comment">// 如果这个View的底部位置已经小于top值了，说明这个view已经移除屏幕了，不可见了</span>
				count<span class="token operator">++</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> position <span class="token operator">=</span> firstPosition <span class="token operator">+</span> i<span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">&gt;=</span> headerViewsCount <span class="token operator">&amp;&amp;</span> position <span class="token operator">&lt;</span> footerViewsStart<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// The view will be rebound to new data, clear any</span>
					<span class="token comment">// system-managed transient state.</span>
					child<span class="token punctuation">.</span><span class="token function">clearAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// 只要该view移除屏幕就把该view添加到废弃的缓存中</span>
					mRecycler<span class="token punctuation">.</span><span class="token function">addScrapView</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">int</span> bottom <span class="token operator">=</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> incrementalDeltaY<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> CLIP_TO_PADDING_MASK<span class="token punctuation">)</span> <span class="token operator">==</span> CLIP_TO_PADDING_MASK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			bottom <span class="token operator">-=</span> listPadding<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> childCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token class-name">View</span> child <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> bottom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				start <span class="token operator">=</span> i<span class="token punctuation">;</span>
				count<span class="token operator">++</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> position <span class="token operator">=</span> firstPosition <span class="token operator">+</span> i<span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">&gt;=</span> headerViewsCount <span class="token operator">&amp;&amp;</span> position <span class="token operator">&lt;</span> footerViewsStart<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// The view will be rebound to new data, clear any</span>
					<span class="token comment">// system-managed transient state.</span>
					child<span class="token punctuation">.</span><span class="token function">clearAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					mRecycler<span class="token punctuation">.</span><span class="token function">addScrapView</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	mMotionViewNewTop <span class="token operator">=</span> mMotionViewOriginalTop <span class="token operator">+</span> deltaY<span class="token punctuation">;</span>

	mBlockLayoutRequests <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	<span class="token comment">// count记录了当前已经移除屏幕的view个数</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 把已经移除的View从ViewGroup总detach掉</span>
		<span class="token function">detachViewsFromParent</span><span class="token punctuation">(</span>start<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mRecycler<span class="token punctuation">.</span><span class="token function">removeSkippedScrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// invalidate before moving the children to avoid unnecessary invalidate</span>
	<span class="token comment">// calls to bubble up from the children all the way to the top</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">awakenScrollBars</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	   <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 这个方法让所有的子view都按照这个参数的距离大小进行改变，这样就实现了移动也就是滑动的功能。</span>
	<span class="token function">offsetChildrenTopAndBottom</span><span class="token punctuation">(</span>incrementalDeltaY<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>down<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mFirstPosition <span class="token operator">+=</span> count<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">final</span> <span class="token keyword">int</span> absIncrementalDeltaY <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>incrementalDeltaY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>spaceAbove <span class="token operator">&lt;</span> absIncrementalDeltaY <span class="token operator">||</span> spaceBelow <span class="token operator">&lt;</span> absIncrementalDeltaY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 第一个View的顶部移入了屏幕或者最后一个View的底部移入了屏幕</span>
		<span class="token function">fillGap</span><span class="token punctuation">(</span>down<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>inTouchMode <span class="token operator">&amp;&amp;</span> mSelectedPosition <span class="token operator">!=</span> INVALID_POSITION<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> childIndex <span class="token operator">=</span> mSelectedPosition <span class="token operator">-</span> mFirstPosition<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>childIndex <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> childIndex <span class="token operator">&lt;</span> <span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">positionSelector</span><span class="token punctuation">(</span>mSelectedPosition<span class="token punctuation">,</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>childIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mSelectorPosition <span class="token operator">!=</span> INVALID_POSITION<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> childIndex <span class="token operator">=</span> mSelectorPosition <span class="token operator">-</span> mFirstPosition<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>childIndex <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> childIndex <span class="token operator">&lt;</span> <span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">positionSelector</span><span class="token punctuation">(</span>INVALID_POSITION<span class="token punctuation">,</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>childIndex<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		mSelectorRect<span class="token punctuation">.</span><span class="token function">setEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	mBlockLayoutRequests <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token function">invokeOnItemScrollListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>继续看一下<code>offsetChildrenTopAndBottom()</code>方法的，在<code>AbsListView</code>中没有重写该方法，具体要看其父类<code>ViewGroup</code>中的实现: `</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Offset the vertical location of all children of this view by the specified number of pixels.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">offset</span> the number of pixels to offset
 *
 * <span class="token keyword">@hide</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">offsetChildrenTopAndBottom</span><span class="token punctuation">(</span><span class="token keyword">int</span> offset<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> count <span class="token operator">=</span> mChildrenCount<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token class-name">View</span><span class="token punctuation">[</span><span class="token punctuation">]</span> children <span class="token operator">=</span> mChildren<span class="token punctuation">;</span>
	<span class="token keyword">boolean</span> invalidate <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 把所有的view都移动指定的距离</span>
		<span class="token keyword">final</span> <span class="token class-name">View</span> v <span class="token operator">=</span> children<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		v<span class="token punctuation">.</span>mTop <span class="token operator">+=</span> offset<span class="token punctuation">;</span>
		v<span class="token punctuation">.</span>mBottom <span class="token operator">+=</span> offset<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>v<span class="token punctuation">.</span>mRenderNode <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			invalidate <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			v<span class="token punctuation">.</span>mRenderNode<span class="token punctuation">.</span><span class="token function">offsetTopAndBottom</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>invalidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">invalidateViewProperty</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">notifySubtreeAccessibilityStateChangedIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再看一下<code>fillGap()</code>方法的实现:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Fills the gap left open by a touch-scroll. During a touch scroll, children that
 * remain on screen are shifted and the other ones are discarded. The role of this
 * method is to fill the gap thus created by performing a partial layout in the
 * empty space.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">down</span> true if the scroll is going down, false if it is going up
 */</span>
<span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">fillGap</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> down<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>发现在<code>AbsListView</code>中该方法是抽象的，所以我们要再<code>ListView</code>中找一下他的具体实现类:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>    <span class="token doc-comment comment">/**
     * <span class="token punctuation">{</span><span class="token keyword">@inheritDoc</span><span class="token punctuation">}</span>
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">void</span> <span class="token function">fillGap</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> down<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>down<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> paddingTop <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> CLIP_TO_PADDING_MASK<span class="token punctuation">)</span> <span class="token operator">==</span> CLIP_TO_PADDING_MASK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                paddingTop <span class="token operator">=</span> <span class="token function">getListPaddingTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> startOffset <span class="token operator">=</span> count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> mDividerHeight <span class="token operator">:</span>
                    paddingTop<span class="token punctuation">;</span>
            <span class="token function">fillDown</span><span class="token punctuation">(</span>mFirstPosition <span class="token operator">+</span> count<span class="token punctuation">,</span> startOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">correctTooHigh</span><span class="token punctuation">(</span><span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> paddingBottom <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> CLIP_TO_PADDING_MASK<span class="token punctuation">)</span> <span class="token operator">==</span> CLIP_TO_PADDING_MASK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                paddingBottom <span class="token operator">=</span> <span class="token function">getListPaddingBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> startOffset <span class="token operator">=</span> count <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> mDividerHeight <span class="token operator">:</span>
                    <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> paddingBottom<span class="token punctuation">;</span>
            <span class="token function">fillUp</span><span class="token punctuation">(</span>mFirstPosition <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> startOffset<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">correctTooLow</span><span class="token punctuation">(</span><span class="token function">getChildCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到他会分别根据向下滑动还是向上滑动去调用<code>fillDown</code>和<code>fillUp</code>两个方法，这两个方法之前我们都分析过了，就不再继续看了。</p><p>到这里基本就把滑动部分的处理都看完了。 还剩最后一个问题就是<code>RecycleBin</code>的实现,他是<code>AbsListView</code>中的一个内部类。</p><p>直接上代码了，他的注释也说的非常清楚，我就把不好理解的地方简单说一下:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * The RecycleBin facilitates reuse of views across layouts. The RecycleBin has two levels of
 * storage: ActiveViews and ScrapViews. ActiveViews are those views which were onscreen at the
 * start of a layout. By construction, they are displaying current information. At the end of
 * layout, all views in ActiveViews are demoted to ScrapViews. ScrapViews are old views that
 * could potentially be used by the adapter to avoid allocating views unnecessarily.
 *
 * <span class="token keyword">@see</span> <span class="token reference"><span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">AbsListView</span><span class="token punctuation">#</span><span class="token function">setRecyclerListener</span><span class="token punctuation">(</span><span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">AbsListView</span><span class="token punctuation">.</span><span class="token class-name">RecyclerListener</span><span class="token punctuation">)</span></span>
 * <span class="token keyword">@see</span> <span class="token reference"><span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">AbsListView</span><span class="token punctuation">.</span><span class="token class-name">RecyclerListener</span></span>
 */</span>
<span class="token keyword">class</span> <span class="token class-name">RecycleBin</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">RecyclerListener</span> mRecyclerListener<span class="token punctuation">;</span>

	<span class="token doc-comment comment">/**
	 * The position of the first view stored in mActiveViews.
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">int</span> mFirstActivePosition<span class="token punctuation">;</span>

	<span class="token doc-comment comment">/**
	 * Views that were on screen at the start of layout. This array is populated at the start of
	 * layout, and at the end of layout all view in mActiveViews are moved to mScrapViews.
	 * Views in mActiveViews represent a contiguous range of Views, with position of the first
	 * view store in mFirstActivePosition.
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">View</span><span class="token punctuation">[</span><span class="token punctuation">]</span> mActiveViews <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

	<span class="token doc-comment comment">/**
	 * 为什么是个数组呢？因为ListView会有多种不同的ViewType啊。
	 * Unsorted views that can be used by the adapter as a convert view.
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> mScrapViews<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">int</span> mViewTypeCount<span class="token punctuation">;</span>
	<span class="token comment">// mScrapViews数组中的第一个元素，方便在ViewType是1的时候使用</span>
	<span class="token keyword">private</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> mCurrentScrap<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> mSkippedScrap<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">SparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> mTransientStateViews<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">LongSparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> mTransientStateViewsById<span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setViewTypeCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> viewTypeCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>viewTypeCount <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;Can&#39;t have a viewTypeCount &lt; 1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 根据ViewType的数量来创建，因为ViewType可以有多中类型，每种不同类型的View肯定要分开单独进行缓存和复用的。</span>
		<span class="token comment">//noinspection unchecked</span>
		<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> scrapViews <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token punctuation">[</span>viewTypeCount<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> viewTypeCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			scrapViews<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		mViewTypeCount <span class="token operator">=</span> viewTypeCount<span class="token punctuation">;</span>
		mCurrentScrap <span class="token operator">=</span> scrapViews<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		mScrapViews <span class="token operator">=</span> scrapViews<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 方法名说明了一切</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">markChildrenDirty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mViewTypeCount <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> scrap <span class="token operator">=</span> mCurrentScrap<span class="token punctuation">;</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> scrapCount <span class="token operator">=</span> scrap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> scrapCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				scrap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forceLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> typeCount <span class="token operator">=</span> mViewTypeCount<span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> typeCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">final</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> scrap <span class="token operator">=</span> mScrapViews<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">final</span> <span class="token keyword">int</span> scrapCount <span class="token operator">=</span> scrap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> scrapCount<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					scrap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forceLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mTransientStateViews <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> count <span class="token operator">=</span> mTransientStateViews<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mTransientStateViews<span class="token punctuation">.</span><span class="token function">valueAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forceLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mTransientStateViewsById <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> count <span class="token operator">=</span> mTransientStateViewsById<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mTransientStateViewsById<span class="token punctuation">.</span><span class="token function">valueAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forceLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">shouldRecycleViewType</span><span class="token punctuation">(</span><span class="token keyword">int</span> viewType<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> viewType <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token doc-comment comment">/**
	 * Clears the scrap heap.
	 */</span>
	<span class="token keyword">void</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mViewTypeCount <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> scrap <span class="token operator">=</span> mCurrentScrap<span class="token punctuation">;</span>
			<span class="token function">clearScrap</span><span class="token punctuation">(</span>scrap<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> typeCount <span class="token operator">=</span> mViewTypeCount<span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> typeCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">final</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> scrap <span class="token operator">=</span> mScrapViews<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token function">clearScrap</span><span class="token punctuation">(</span>scrap<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token function">clearTransientStateViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token doc-comment comment">/**
	 * Fill ActiveViews with all of the children of the AbsListView.
	 * 将View存储到mActiveViews数组中
	 * <span class="token keyword">@param</span> <span class="token parameter">childCount</span> The minimum number of views mActiveViews should hold
	 * <span class="token keyword">@param</span> <span class="token parameter">firstActivePosition</span> The position of the first view that will be stored in
	 *        mActiveViews
	 */</span>
	<span class="token keyword">void</span> <span class="token function">fillActiveViews</span><span class="token punctuation">(</span><span class="token keyword">int</span> childCount<span class="token punctuation">,</span> <span class="token keyword">int</span> firstActivePosition<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mActiveViews<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> childCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mActiveViews <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">View</span><span class="token punctuation">[</span>childCount<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		mFirstActivePosition <span class="token operator">=</span> firstActivePosition<span class="token punctuation">;</span>

		<span class="token comment">//noinspection MismatchedReadAndWriteOfArray</span>
		<span class="token keyword">final</span> <span class="token class-name">View</span><span class="token punctuation">[</span><span class="token punctuation">]</span> activeViews <span class="token operator">=</span> mActiveViews<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> childCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">View</span> child <span class="token operator">=</span> <span class="token function">getChildAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">AbsListView<span class="token punctuation">.</span>LayoutParams</span> lp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">AbsListView<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">)</span> child<span class="token punctuation">.</span><span class="token function">getLayoutParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// Don&#39;t put header or footer views into the scrap heap</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>lp <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> lp<span class="token punctuation">.</span>viewType <span class="token operator">!=</span> ITEM_VIEW_TYPE_HEADER_OR_FOOTER<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// Note:  We do place AdapterView.ITEM_VIEW_TYPE_IGNORE in active views.</span>
				<span class="token comment">//        However, we will NOT place them into scrap views.</span>
				activeViews<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> child<span class="token punctuation">;</span>
				<span class="token comment">// Remember the position so that setupChild() doesn&#39;t reset state.</span>
				lp<span class="token punctuation">.</span>scrappedFromPosition <span class="token operator">=</span> firstActivePosition <span class="token operator">+</span> i<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token doc-comment comment">/**
	 * Get the view corresponding to the specified position. The view will be removed from
	 * mActiveViews if it is found.注释说了获取完之后就会从mActiveViews中移除，这是很好理解的
	 * 因为获取了就是说这个View已经显示到当前的ListView中了，肯定不能再复用他了。
	 *
	 * <span class="token keyword">@param</span> <span class="token parameter">position</span> The position to look up in mActiveViews
	 * <span class="token keyword">@return</span> The view if it is found, null otherwise
	 */</span>
	<span class="token class-name">View</span> <span class="token function">getActiveView</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">int</span> index <span class="token operator">=</span> position <span class="token operator">-</span> mFirstActivePosition<span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token class-name">View</span><span class="token punctuation">[</span><span class="token punctuation">]</span> activeViews <span class="token operator">=</span> mActiveViews<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> index <span class="token operator">&lt;</span> activeViews<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token class-name">View</span> match <span class="token operator">=</span> activeViews<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
			activeViews<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> match<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token class-name">View</span> <span class="token function">getTransientStateView</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mAdapter <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mAdapterHasStableIds <span class="token operator">&amp;&amp;</span> mTransientStateViewsById <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">long</span> id <span class="token operator">=</span> mAdapter<span class="token punctuation">.</span><span class="token function">getItemId</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">View</span> result <span class="token operator">=</span> mTransientStateViewsById<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mTransientStateViewsById<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> result<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mTransientStateViews <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> index <span class="token operator">=</span> mTransientStateViews<span class="token punctuation">.</span><span class="token function">indexOfKey</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token class-name">View</span> result <span class="token operator">=</span> mTransientStateViews<span class="token punctuation">.</span><span class="token function">valueAt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
				mTransientStateViews<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> result<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token doc-comment comment">/**
	 * Dumps and fully detaches any currently saved views with transient
	 * state.
	 */</span>
	<span class="token keyword">void</span> <span class="token function">clearTransientStateViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">final</span> <span class="token class-name">SparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> viewsByPos <span class="token operator">=</span> mTransientStateViews<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>viewsByPos <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">N</span> <span class="token operator">=</span> viewsByPos<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token class-name">N</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">removeDetachedView</span><span class="token punctuation">(</span>viewsByPos<span class="token punctuation">.</span><span class="token function">valueAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			viewsByPos<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">final</span> <span class="token class-name">LongSparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> viewsById <span class="token operator">=</span> mTransientStateViewsById<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>viewsById <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token class-name">N</span> <span class="token operator">=</span> viewsById<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token class-name">N</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">removeDetachedView</span><span class="token punctuation">(</span>viewsById<span class="token punctuation">.</span><span class="token function">valueAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			viewsById<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token doc-comment comment">/**
	 * 从废弃View的缓存中获取，只要移动出屏幕之后就都会被加到废弃View的缓存中 
	 * <span class="token keyword">@return</span> A view from the ScrapViews collection. These are unordered.
	 */</span>
	<span class="token class-name">View</span> <span class="token function">getScrapView</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mViewTypeCount <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token function">retrieveFromScrap</span><span class="token punctuation">(</span>mCurrentScrap<span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> whichScrap <span class="token operator">=</span> mAdapter<span class="token punctuation">.</span><span class="token function">getItemViewType</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>whichScrap <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> whichScrap <span class="token operator">&lt;</span> mScrapViews<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">return</span> <span class="token function">retrieveFromScrap</span><span class="token punctuation">(</span>mScrapViews<span class="token punctuation">[</span>whichScrap<span class="token punctuation">]</span><span class="token punctuation">,</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token doc-comment comment">/**
	 * Puts a view into the list of scrap views.
	 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
	 * If the list data hasn&#39;t changed or the adapter has stable IDs, views
	 * with transient state will be preserved for later retrieval.
	 *
	 * <span class="token keyword">@param</span> <span class="token parameter">scrap</span> The view to add
	 * <span class="token keyword">@param</span> <span class="token parameter">position</span> The view&#39;s position within its parent
	 */</span>
	<span class="token keyword">void</span> <span class="token function">addScrapView</span><span class="token punctuation">(</span><span class="token class-name">View</span> scrap<span class="token punctuation">,</span> <span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">final</span> <span class="token class-name">AbsListView<span class="token punctuation">.</span>LayoutParams</span> lp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">AbsListView<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">)</span> scrap<span class="token punctuation">.</span><span class="token function">getLayoutParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>lp <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		lp<span class="token punctuation">.</span>scrappedFromPosition <span class="token operator">=</span> position<span class="token punctuation">;</span>

		<span class="token comment">// Remove but don&#39;t scrap header or footer views, or views that</span>
		<span class="token comment">// should otherwise not be recycled.</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> viewType <span class="token operator">=</span> lp<span class="token punctuation">.</span>viewType<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">shouldRecycleViewType</span><span class="token punctuation">(</span>viewType<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		scrap<span class="token punctuation">.</span><span class="token function">dispatchStartTemporaryDetach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// The the accessibility state of the view may change while temporary</span>
		<span class="token comment">// detached and we do not allow detached views to fire accessibility</span>
		<span class="token comment">// events. So we are announcing that the subtree changed giving a chance</span>
		<span class="token comment">// to clients holding on to a view in this subtree to refresh it.</span>
		<span class="token function">notifyViewAccessibilityStateChangedIfNeeded</span><span class="token punctuation">(</span>
				<span class="token class-name">AccessibilityEvent</span><span class="token punctuation">.</span>CONTENT_CHANGE_TYPE_SUBTREE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 对一些瞬态View的处理</span>
		<span class="token comment">// Don&#39;t scrap views that have transient state.</span>
		<span class="token keyword">final</span> <span class="token keyword">boolean</span> scrapHasTransientState <span class="token operator">=</span> scrap<span class="token punctuation">.</span><span class="token function">hasTransientState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>scrapHasTransientState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mAdapter <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mAdapterHasStableIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// If the adapter has stable IDs, we can reuse the view for</span>
				<span class="token comment">// the same data.</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>mTransientStateViewsById <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					mTransientStateViewsById <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LongSparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				mTransientStateViewsById<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>lp<span class="token punctuation">.</span>itemId<span class="token punctuation">,</span> scrap<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mDataChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// If the data hasn&#39;t changed, we can reuse the views at</span>
				<span class="token comment">// their old positions.</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>mTransientStateViews <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					mTransientStateViews <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				mTransientStateViews<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> scrap<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token comment">// Otherwise, we&#39;ll have to remove the view and start over.</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>mSkippedScrap <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					mSkippedScrap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				mSkippedScrap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>scrap<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mViewTypeCount <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mCurrentScrap<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>scrap<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				mScrapViews<span class="token punctuation">[</span>viewType<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>scrap<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>mRecyclerListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mRecyclerListener<span class="token punctuation">.</span><span class="token function">onMovedToScrapHeap</span><span class="token punctuation">(</span>scrap<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token doc-comment comment">/**
	 * Finish the removal of any views that skipped the scrap heap.
	 */</span>
	<span class="token keyword">void</span> <span class="token function">removeSkippedScrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mSkippedScrap <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> count <span class="token operator">=</span> mSkippedScrap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">removeDetachedView</span><span class="token punctuation">(</span>mSkippedScrap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		mSkippedScrap<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token doc-comment comment">/**
	 * Move all views remaining in mActiveViews to mScrapViews.
	 */</span>
	<span class="token keyword">void</span> <span class="token function">scrapActiveViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">final</span> <span class="token class-name">View</span><span class="token punctuation">[</span><span class="token punctuation">]</span> activeViews <span class="token operator">=</span> mActiveViews<span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token keyword">boolean</span> hasListener <span class="token operator">=</span> mRecyclerListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token keyword">boolean</span> multipleScraps <span class="token operator">=</span> mViewTypeCount <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">;</span>

		<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> scrapViews <span class="token operator">=</span> mCurrentScrap<span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> count <span class="token operator">=</span> activeViews<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> count <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token class-name">View</span> victim <span class="token operator">=</span> activeViews<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>victim <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">final</span> <span class="token class-name">AbsListView<span class="token punctuation">.</span>LayoutParams</span> lp
						<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">AbsListView<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">)</span> victim<span class="token punctuation">.</span><span class="token function">getLayoutParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">final</span> <span class="token keyword">int</span> whichScrap <span class="token operator">=</span> lp<span class="token punctuation">.</span>viewType<span class="token punctuation">;</span>

				activeViews<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

				<span class="token keyword">if</span> <span class="token punctuation">(</span>victim<span class="token punctuation">.</span><span class="token function">hasTransientState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// Store views with transient state for later use.</span>
					victim<span class="token punctuation">.</span><span class="token function">dispatchStartTemporaryDetach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

					<span class="token keyword">if</span> <span class="token punctuation">(</span>mAdapter <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mAdapterHasStableIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>mTransientStateViewsById <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							mTransientStateViewsById <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LongSparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token keyword">long</span> id <span class="token operator">=</span> mAdapter<span class="token punctuation">.</span><span class="token function">getItemId</span><span class="token punctuation">(</span>mFirstActivePosition <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
						mTransientStateViewsById<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> victim<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mDataChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>mTransientStateViews <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							mTransientStateViews <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						mTransientStateViews<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>mFirstActivePosition <span class="token operator">+</span> i<span class="token punctuation">,</span> victim<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>whichScrap <span class="token operator">!=</span> ITEM_VIEW_TYPE_HEADER_OR_FOOTER<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token comment">// The data has changed, we can&#39;t keep this view.</span>
						<span class="token function">removeDetachedView</span><span class="token punctuation">(</span>victim<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">shouldRecycleViewType</span><span class="token punctuation">(</span>whichScrap<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// Discard non-recyclable views except headers/footers.</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>whichScrap <span class="token operator">!=</span> ITEM_VIEW_TYPE_HEADER_OR_FOOTER<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token function">removeDetachedView</span><span class="token punctuation">(</span>victim<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					<span class="token comment">// Store everything else on the appropriate scrap heap.</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>multipleScraps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						scrapViews <span class="token operator">=</span> mScrapViews<span class="token punctuation">[</span>whichScrap<span class="token punctuation">]</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					victim<span class="token punctuation">.</span><span class="token function">dispatchStartTemporaryDetach</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					lp<span class="token punctuation">.</span>scrappedFromPosition <span class="token operator">=</span> mFirstActivePosition <span class="token operator">+</span> i<span class="token punctuation">;</span>
					scrapViews<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>victim<span class="token punctuation">)</span><span class="token punctuation">;</span>

					<span class="token keyword">if</span> <span class="token punctuation">(</span>hasListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						mRecyclerListener<span class="token punctuation">.</span><span class="token function">onMovedToScrapHeap</span><span class="token punctuation">(</span>victim<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token function">pruneScrapViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token doc-comment comment">/**
	 * Makes sure that the size of mScrapViews does not exceed the size of
	 * mActiveViews, which can happen if an adapter does not recycle its
	 * views. Removes cached transient state views that no longer have
	 * transient state.
	 */</span>
	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">pruneScrapViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> maxViews <span class="token operator">=</span> mActiveViews<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> viewTypeCount <span class="token operator">=</span> mViewTypeCount<span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> scrapViews <span class="token operator">=</span> mScrapViews<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> viewTypeCount<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> scrapPile <span class="token operator">=</span> scrapViews<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> size <span class="token operator">=</span> scrapPile<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> extras <span class="token operator">=</span> size <span class="token operator">-</span> maxViews<span class="token punctuation">;</span>
			size<span class="token operator">--</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> extras<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">removeDetachedView</span><span class="token punctuation">(</span>scrapPile<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>size<span class="token operator">--</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">final</span> <span class="token class-name">SparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> transViewsByPos <span class="token operator">=</span> mTransientStateViews<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>transViewsByPos <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> transViewsByPos<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">final</span> <span class="token class-name">View</span> v <span class="token operator">=</span> transViewsByPos<span class="token punctuation">.</span><span class="token function">valueAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>v<span class="token punctuation">.</span><span class="token function">hasTransientState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">removeDetachedView</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					transViewsByPos<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
					i<span class="token operator">--</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">final</span> <span class="token class-name">LongSparseArray</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> transViewsById <span class="token operator">=</span> mTransientStateViewsById<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>transViewsById <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> transViewsById<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">final</span> <span class="token class-name">View</span> v <span class="token operator">=</span> transViewsById<span class="token punctuation">.</span><span class="token function">valueAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>v<span class="token punctuation">.</span><span class="token function">hasTransientState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">removeDetachedView</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					transViewsById<span class="token punctuation">.</span><span class="token function">removeAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
					i<span class="token operator">--</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token doc-comment comment">/**
	 * Puts all views in the scrap heap into the supplied list.
	 */</span>
	<span class="token keyword">void</span> <span class="token function">reclaimScrapViews</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> views<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mViewTypeCount <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			views<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>mCurrentScrap<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> viewTypeCount <span class="token operator">=</span> mViewTypeCount<span class="token punctuation">;</span>
			<span class="token keyword">final</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> scrapViews <span class="token operator">=</span> mScrapViews<span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> viewTypeCount<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">final</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> scrapPile <span class="token operator">=</span> scrapViews<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
				views<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>scrapPile<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token doc-comment comment">/**
	 * Updates the cache color hint of all known views.
	 *
	 * <span class="token keyword">@param</span> <span class="token parameter">color</span> The new cache color hint.
	 */</span>
	<span class="token keyword">void</span> <span class="token function">setCacheColorHint</span><span class="token punctuation">(</span><span class="token keyword">int</span> color<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mViewTypeCount <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> scrap <span class="token operator">=</span> mCurrentScrap<span class="token punctuation">;</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> scrapCount <span class="token operator">=</span> scrap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> scrapCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				scrap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDrawingCacheBackgroundColor</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> typeCount <span class="token operator">=</span> mViewTypeCount<span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> typeCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">final</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> scrap <span class="token operator">=</span> mScrapViews<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">final</span> <span class="token keyword">int</span> scrapCount <span class="token operator">=</span> scrap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> scrapCount<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					scrap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDrawingCacheBackgroundColor</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// Just in case this is called during a layout pass</span>
		<span class="token keyword">final</span> <span class="token class-name">View</span><span class="token punctuation">[</span><span class="token punctuation">]</span> activeViews <span class="token operator">=</span> mActiveViews<span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> count <span class="token operator">=</span> activeViews<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">final</span> <span class="token class-name">View</span> victim <span class="token operator">=</span> activeViews<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>victim <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				victim<span class="token punctuation">.</span><span class="token function">setDrawingCacheBackgroundColor</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token class-name">View</span> <span class="token function">retrieveFromScrap</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> scrapViews<span class="token punctuation">,</span> <span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> size <span class="token operator">=</span> scrapViews<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// See if we still have a view for this position or ID.</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">final</span> <span class="token class-name">View</span> view <span class="token operator">=</span> scrapViews<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">final</span> <span class="token class-name">AbsListView<span class="token punctuation">.</span>LayoutParams</span> params <span class="token operator">=</span>
						<span class="token punctuation">(</span><span class="token class-name">AbsListView<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">)</span> view<span class="token punctuation">.</span><span class="token function">getLayoutParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token keyword">if</span> <span class="token punctuation">(</span>mAdapterHasStableIds<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">final</span> <span class="token keyword">long</span> id <span class="token operator">=</span> mAdapter<span class="token punctuation">.</span><span class="token function">getItemId</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>id <span class="token operator">==</span> params<span class="token punctuation">.</span>itemId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">return</span> scrapViews<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span>scrappedFromPosition <span class="token operator">==</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">final</span> <span class="token class-name">View</span> scrap <span class="token operator">=</span> scrapViews<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token function">clearAccessibilityFromScrap</span><span class="token punctuation">(</span>scrap<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span> scrap<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">final</span> <span class="token class-name">View</span> scrap <span class="token operator">=</span> scrapViews<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">clearAccessibilityFromScrap</span><span class="token punctuation">(</span>scrap<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> scrap<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">clearScrap</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> scrap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> scrapCount <span class="token operator">=</span> scrap<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> scrapCount<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">removeDetachedView</span><span class="token punctuation">(</span>scrap<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>scrapCount <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">clearAccessibilityFromScrap</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		view<span class="token punctuation">.</span><span class="token function">clearAccessibilityFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		view<span class="token punctuation">.</span><span class="token function">setAccessibilityDelegate</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">removeDetachedView</span><span class="token punctuation">(</span><span class="token class-name">View</span> child<span class="token punctuation">,</span> <span class="token keyword">boolean</span> animate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		child<span class="token punctuation">.</span><span class="token function">setAccessibilityDelegate</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">AbsListView</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">removeDetachedView</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> animate<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>到此为止。</p><hr><ul><li>邮箱 ：charon.chui@gmail.com</li><li>Good Luck!</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 335891510@qq.com">Jungle68</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/android-note/assets/app.e2a3b496.js" defer></script>
  </body>
</html>

import{_ as n,o as s,c as a,e as t}from"./app.89e8a229.js";const p={},o=t(`<h1 id="\u591A\u7EBF\u7A0B\u65AD\u70B9\u4E0B\u8F7D" tabindex="-1"><a class="header-anchor" href="#\u591A\u7EBF\u7A0B\u65AD\u70B9\u4E0B\u8F7D" aria-hidden="true">#</a> \u591A\u7EBF\u7A0B\u65AD\u70B9\u4E0B\u8F7D</h1><ol><li><p>\u591A\u7EBF\u7A0B\u4E0B\u8F7D</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MultiThreadDownloader</span> <span class="token punctuation">{</span>

	<span class="token keyword">private</span> <span class="token class-name">URL</span> url<span class="token punctuation">;</span>        <span class="token comment">// \u76EE\u6807\u5730\u5740</span>
	<span class="token keyword">private</span> <span class="token class-name">File</span> file<span class="token punctuation">;</span>        <span class="token comment">// \u672C\u5730\u6587\u4EF6</span>
	<span class="token keyword">private</span> <span class="token keyword">long</span> threadLen<span class="token punctuation">;</span>    <span class="token comment">// \u6BCF\u4E2A\u7EBF\u7A0B\u4E0B\u8F7D\u591A\u5C11</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> THREAD_AMOUNT <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>                <span class="token comment">// \u7EBF\u7A0B\u6570</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> DIR_PATH <span class="token operator">=</span> <span class="token string">&quot;F:/Download&quot;</span><span class="token punctuation">;</span>    <span class="token comment">// \u4E0B\u8F7D\u76EE\u5F55</span>

	<span class="token keyword">public</span> <span class="token class-name">MultiThreadDownloader</span><span class="token punctuation">(</span><span class="token class-name">String</span> address<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>    
		url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                            <span class="token comment">// \u8BB0\u4F4F\u4E0B\u8F7D\u5730\u5740</span>
		file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>DIR_PATH<span class="token punctuation">,</span> address<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// \u622A\u53D6\u5730\u5740\u4E2D\u7684\u6587\u4EF6\u540D, \u521B\u5EFA\u672C\u5730\u6587\u4EF6</span>
		<span class="token comment">// \u521B\u5EFA\u4E00\u4E2A\u4E34\u65F6\u6587\u4EF6\u8DEF\u5F84</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token class-name">HttpURLConnection</span> conn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpURLConnection</span><span class="token punctuation">)</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		conn<span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">long</span> totalLen <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">getContentLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// \u83B7\u53D6\u6587\u4EF6\u603B\u957F\u5EA6</span>
		threadLen <span class="token operator">=</span> <span class="token punctuation">(</span>totalLen <span class="token operator">+</span> THREAD_AMOUNT <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> THREAD_AMOUNT<span class="token punctuation">;</span>    <span class="token comment">// \u8BA1\u7B97\u6BCF\u4E2A\u7EBF\u7A0B\u8981\u4E0B\u8F7D\u7684\u957F\u5EA6</span>

		<span class="token comment">// \u603B\u957F\u5EA6 \u5982\u679C\u80FD\u6574\u9664 \u7EBF\u7A0B\u6570, \u6BCF\u6761\u7EBF\u7A0B\u4E0B\u8F7D\u7684\u957F\u5EA6\u5C31\u662F \u603B\u957F\u5EA6 / \u7EBF\u7A0B\u6570</span>
		<span class="token comment">// \u603B\u957F\u5EA6 \u5982\u679C\u4E0D\u80FD\u6574\u9664 \u7EBF\u7A0B\u6570, \u90A3\u4E48\u6BCF\u6761\u7EBF\u7A0B\u4E0B\u8F7D\u957F\u5EA6\u5C31\u662F \u603B\u957F\u5EA6 / \u7EBF\u7A0B\u6570 + 1</span>

		<span class="token class-name">RandomAccessFile</span> raf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">&quot;rw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// \u5728\u672C\u5730\u521B\u5EFA\u4E00\u4E2A\u548C\u670D\u52A1\u7AEF\u5927\u5C0F\u76F8\u540C\u7684\u6587\u4EF6</span>
		raf<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span>totalLen<span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token comment">// \u8BBE\u7F6E\u6587\u4EF6\u7684\u5927\u5C0F, \u5199\u5165\u4E86\u82E5\u5E72\u4E2A0</span>
		raf<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// \u521B\u5EFA\u4E34\u65F6\u6587\u4EF6</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> THREAD_AMOUNT<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token comment">// \u6309\u7167\u7EBF\u7A0B\u6570\u5FAA\u73AF</span>
			<span class="token keyword">new</span> <span class="token class-name">DownloadThread</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// \u5F00\u542F\u7EBF\u7A0B, \u6BCF\u4E2A\u7EBF\u7A0B\u5C06\u4F1A\u4E0B\u8F7D\u4E00\u90E8\u5206\u6570\u636E\u5230\u672C\u5730\u6587\u4EF6\u4E2D</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">DownloadThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
		<span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>     <span class="token comment">// \u7528\u6765\u6807\u8BB0\u5F53\u524D\u7EBF\u7A0B\u662F\u4E0B\u8F7D\u4EFB\u52A1\u4E2D\u7684\u7B2C\u51E0\u4E2A\u7EBF\u7A0B</span>

		<span class="token keyword">public</span> <span class="token class-name">DownloadThread</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// \u4ECE\u4E34\u65F6\u6587\u4EF6\u8BFB\u53D6\u5F53\u524D\u7EBF\u7A0B\u5DF2\u5B8C\u6210\u7684\u8FDB\u5EA6</span>

			<span class="token keyword">long</span> start <span class="token operator">=</span> id <span class="token operator">*</span> threadLen<span class="token punctuation">;</span>                    <span class="token comment">// \u8D77\u59CB\u4F4D\u7F6E</span>
			<span class="token keyword">long</span> end <span class="token operator">=</span> id <span class="token operator">*</span> threadLen <span class="token operator">+</span> threadLen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment">// \u7ED3\u675F\u4F4D\u7F6E</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7EBF\u7A0B&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> start <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				<span class="token class-name">HttpURLConnection</span> conn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpURLConnection</span><span class="token punctuation">)</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				conn<span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				conn<span class="token punctuation">.</span><span class="token function">setRequestProperty</span><span class="token punctuation">(</span><span class="token string">&quot;Range&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bytes=&quot;</span> <span class="token operator">+</span> start <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// \u8BBE\u7F6E\u5F53\u524D\u7EBF\u7A0B\u4E0B\u8F7D\u7684\u8303\u56F4(start\u548Cend\u90FD\u5305\u542B)</span>

				<span class="token class-name">InputStream</span> in <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token comment">// \u83B7\u53D6\u8FDE\u63A5\u7684\u8F93\u5165\u6D41, \u7528\u6765\u8BFB\u53D6\u670D\u52A1\u7AEF\u6570\u636E</span>
				<span class="token class-name">RandomAccessFile</span> raf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token string">&quot;rw&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// \u968F\u673A\u8BFB\u5199\u6587\u4EF6, \u7528\u6765\u5411\u672C\u5730\u6587\u4EF6\u5199\u51FA</span>
				raf<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                <span class="token comment">// \u8BBE\u7F6E\u4FDD\u5B58\u6570\u636E\u7684\u4F4D\u7F6E</span>

				<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">// \u6BCF\u6B21\u62F7\u8D1D100KB</span>
				<span class="token keyword">int</span> len<span class="token punctuation">;</span>
				<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					raf<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// \u4ECE\u670D\u52A1\u7AEF\u8BFB\u53D6\u6570\u636E, \u5199\u5230\u672C\u5730\u6587\u4EF6</span>
					<span class="token comment">// \u5B58\u50A8\u5F53\u524D\u4E0B\u8F7D\u8FDB\u5EA6\u5230\u4E34\u65F6\u6587\u4EF6</span>
				<span class="token punctuation">}</span>
				raf<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7EBF\u7A0B&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;\u4E0B\u8F7D\u5B8C\u6BD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token keyword">new</span> <span class="token class-name">MultiThreadDownloader</span><span class="token punctuation">(</span><span class="token string">&quot;http://192.168.1.240:8080/14.Web/android-sdk_r17-windows.zip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u65AD\u70B9\u4E0B\u8F7D</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BreakpointDownloader</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> DIR_PATH <span class="token operator">=</span> <span class="token string">&quot;F:/Download&quot;</span><span class="token punctuation">;</span>    <span class="token comment">// \u4E0B\u8F7D\u76EE\u5F55</span>
	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> THREAD_AMOUNT <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>                <span class="token comment">// \u603B\u7EBF\u7A0B\u6570</span>

	<span class="token keyword">private</span> <span class="token class-name">URL</span> url<span class="token punctuation">;</span>            <span class="token comment">// \u76EE\u6807\u4E0B\u8F7D\u5730\u5740</span>
	<span class="token keyword">private</span> <span class="token class-name">File</span> dataFile<span class="token punctuation">;</span>        <span class="token comment">// \u672C\u5730\u6587\u4EF6</span>
	<span class="token keyword">private</span> <span class="token class-name">File</span> tempFile<span class="token punctuation">;</span>        <span class="token comment">// \u7528\u6765\u5B58\u50A8\u6BCF\u4E2A\u7EBF\u7A0B\u4E0B\u8F7D\u7684\u8FDB\u5EA6\u7684\u4E34\u65F6\u6587\u4EF6</span>
	<span class="token keyword">private</span> <span class="token keyword">long</span> threadLen<span class="token punctuation">;</span>        <span class="token comment">// \u6BCF\u4E2A\u7EBF\u7A0B\u8981\u4E0B\u8F7D\u7684\u957F\u5EA6</span>
	<span class="token keyword">private</span> <span class="token keyword">long</span> totalFinish<span class="token punctuation">;</span>    <span class="token comment">// \u603B\u5171\u5B8C\u6210\u4E86\u591A\u5C11</span>
	<span class="token keyword">private</span> <span class="token keyword">long</span> totalLen<span class="token punctuation">;</span>        <span class="token comment">// \u670D\u52A1\u7AEF\u6587\u4EF6\u603B\u957F\u5EA6</span>
	<span class="token keyword">private</span> <span class="token keyword">long</span> begin<span class="token punctuation">;</span>            <span class="token comment">// \u7528\u6765\u8BB0\u5F55\u5F00\u59CB\u4E0B\u8F7D\u65F6\u7684\u65F6\u95F4</span>

	<span class="token keyword">public</span> <span class="token class-name">BreakpointDownloader</span><span class="token punctuation">(</span><span class="token class-name">String</span> address<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>    
		url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                            <span class="token comment">// \u8BB0\u4F4F\u4E0B\u8F7D\u5730\u5740</span>
		dataFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>DIR_PATH<span class="token punctuation">,</span> address<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>address<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// \u622A\u53D6\u5730\u5740\u4E2D\u7684\u6587\u4EF6\u540D, \u521B\u5EFA\u672C\u5730\u6587\u4EF6</span>
		tempFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>dataFile<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;.temp&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// \u5728\u672C\u5730\u6587\u4EF6\u6240\u5728\u6587\u4EF6\u5939\u4E2D\u521B\u5EFA\u4E34\u65F6\u6587\u4EF6</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token class-name">HttpURLConnection</span> conn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpURLConnection</span><span class="token punctuation">)</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		conn<span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		totalLen <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">getContentLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token comment">// \u83B7\u53D6\u670D\u52A1\u7AEF\u53D1\u9001\u8FC7\u6765\u7684\u6587\u4EF6\u957F\u5EA6</span>
		threadLen <span class="token operator">=</span> <span class="token punctuation">(</span>totalLen <span class="token operator">+</span> THREAD_AMOUNT <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> THREAD_AMOUNT<span class="token punctuation">;</span>            <span class="token comment">// \u8BA1\u7B97\u6BCF\u4E2A\u7EBF\u7A0B\u8981\u4E0B\u8F7D\u7684\u957F\u5EA6</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>dataFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                            <span class="token comment">// \u5982\u679C\u672C\u5730\u6587\u4EF6\u4E0D\u5B58\u5728</span>
			<span class="token class-name">RandomAccessFile</span> raf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>dataFile<span class="token punctuation">,</span> <span class="token string">&quot;rws&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// \u5728\u672C\u5730\u521B\u5EFA\u6587\u4EF6</span>
			raf<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span>totalLen<span class="token punctuation">)</span><span class="token punctuation">;</span>                                        <span class="token comment">// \u8BBE\u7F6E\u6587\u4EF6\u7684\u5927\u5C0F\u548C\u670D\u52A1\u7AEF\u76F8\u540C</span>
			raf<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>tempFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                            <span class="token comment">// \u5982\u679C\u4E34\u65F6\u6587\u4EF6\u4E0D\u5B58\u5728</span>
			<span class="token class-name">RandomAccessFile</span> raf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>tempFile<span class="token punctuation">,</span> <span class="token string">&quot;rws&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// \u521B\u5EFA\u4E34\u65F6\u6587\u4EF6, \u7528\u6765\u8BB0\u5F55\u6BCF\u4E2A\u7EBF\u7A0B\u5DF2\u4E0B\u8F7D\u591A\u5C11</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> THREAD_AMOUNT<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>                            <span class="token comment">// \u6309\u7167\u7EBF\u7A0B\u6570\u5FAA\u73AF</span>
				raf<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                            <span class="token comment">// \u5199\u5165\u6BCF\u4E2A\u7EBF\u7A0B\u7684\u5F00\u59CB\u4F4D\u7F6E(\u90FD\u662F\u4ECE0\u5F00\u59CB)</span>
			raf<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> THREAD_AMOUNT<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token comment">// \u6309\u7167\u7EBF\u7A0B\u6570\u5FAA\u73AF</span>
			<span class="token keyword">new</span> <span class="token class-name">DownloadThread</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// \u5F00\u542F\u7EBF\u7A0B, \u6BCF\u4E2A\u7EBF\u7A0B\u5C06\u4F1A\u4E0B\u8F7D\u4E00\u90E8\u5206\u6570\u636E\u5230\u672C\u5730\u6587\u4EF6\u4E2D</span>

		begin <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// \u8BB0\u5F55\u5F00\u59CB\u65F6\u95F4</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">DownloadThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
		<span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>     <span class="token comment">// \u7528\u6765\u6807\u8BB0\u5F53\u524D\u7EBF\u7A0B\u662F\u4E0B\u8F7D\u4EFB\u52A1\u4E2D\u7684\u7B2C\u51E0\u4E2A\u7EBF\u7A0B</span>

		<span class="token keyword">public</span> <span class="token class-name">DownloadThread</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				<span class="token class-name">RandomAccessFile</span> tempRaf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>tempFile<span class="token punctuation">,</span> <span class="token string">&quot;rws&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// \u7528\u6765\u8BB0\u5F55\u4E0B\u8F7D\u8FDB\u5EA6\u7684\u4E34\u65F6\u6587\u4EF6</span>
				tempRaf<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>id <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// \u5C06\u6307\u9488\u79FB\u52A8\u5230\u5F53\u524D\u7EBF\u7A0B\u7684\u4F4D\u7F6E(\u6BCF\u4E2A\u7EBF\u7A0B\u51991\u4E2Along\u503C, \u53608\u5B57\u8282)</span>
				<span class="token keyword">long</span> threadFinish <span class="token operator">=</span> tempRaf<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// \u8BFB\u53D6\u5F53\u524D\u7EBF\u7A0B\u5DF2\u5B8C\u6210\u4E86\u591A\u5C11</span>
				<span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">BreakpointDownloader</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// \u591A\u4E2A\u4E0B\u8F7D\u7EBF\u7A0B\u4E4B\u95F4\u540C\u6B65</span>
					totalFinish <span class="token operator">+=</span> threadFinish<span class="token punctuation">;</span>            <span class="token comment">// \u7EDF\u8BA1\u6240\u6709\u7EBF\u7A0B\u603B\u5171\u5B8C\u6210\u4E86\u591A\u5C11</span>
				<span class="token punctuation">}</span>

				<span class="token keyword">long</span> start <span class="token operator">=</span> id <span class="token operator">*</span> threadLen <span class="token operator">+</span> threadFinish<span class="token punctuation">;</span>        <span class="token comment">// \u8BA1\u7B97\u5F53\u524D\u7EBF\u7A0B\u7684\u8D77\u59CB\u4F4D\u7F6E</span>
				<span class="token keyword">long</span> end <span class="token operator">=</span> id <span class="token operator">*</span> threadLen <span class="token operator">+</span> threadLen <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment">// \u8BA1\u7B97\u5F53\u524D\u7EBF\u7A0B\u7684\u7ED3\u675F\u4F4D\u7F6E</span>
				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7EBF\u7A0B&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> start <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token class-name">HttpURLConnection</span> conn <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpURLConnection</span><span class="token punctuation">)</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				conn<span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				conn<span class="token punctuation">.</span><span class="token function">setRequestProperty</span><span class="token punctuation">(</span><span class="token string">&quot;Range&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bytes=&quot;</span> <span class="token operator">+</span> start <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// \u8BBE\u7F6E\u5F53\u524D\u7EBF\u7A0B\u4E0B\u8F7D\u7684\u8303\u56F4</span>

				<span class="token class-name">InputStream</span> in <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token comment">// \u83B7\u53D6\u8FDE\u63A5\u7684\u8F93\u5165\u6D41</span>
				<span class="token class-name">RandomAccessFile</span> dataRaf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RandomAccessFile</span><span class="token punctuation">(</span>dataFile<span class="token punctuation">,</span> <span class="token string">&quot;rws&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// \u88C5\u8F7D\u6570\u636E\u7684\u672C\u5730\u6587\u4EF6(\u53EF\u4EE5\u7406\u89E3\u4E3A\u8F93\u51FA\u6D41)</span>
				dataRaf<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span>                                                <span class="token comment">// \u8BBE\u7F6E\u5F53\u524D\u7EBF\u7A0B\u4FDD\u5B58\u6570\u636E\u7684\u4F4D\u7F6E</span>

				<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">// \u6BCF\u6B21\u62F7\u8D1D100KB</span>
				<span class="token keyword">int</span> len<span class="token punctuation">;</span>
				<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					dataRaf<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// \u4ECE\u670D\u52A1\u7AEF\u8BFB\u53D6\u6570\u636E, \u5199\u5230\u672C\u5730\u6587\u4EF6</span>
					threadFinish <span class="token operator">+=</span> len<span class="token punctuation">;</span>                        <span class="token comment">// \u6BCF\u6B21\u5199\u5165\u6570\u636E\u4E4B\u540E, \u7EDF\u8BA1\u5F53\u524D\u7EBF\u7A0B\u5B8C\u6210\u4E86\u591A\u5C11</span>
					tempRaf<span class="token punctuation">.</span><span class="token function">seek</span><span class="token punctuation">(</span>id <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// \u5C06\u4E34\u65F6\u6587\u4EF6\u7684\u6307\u9488\u6307\u5411\u5F53\u524D\u7EBF\u7A0B\u7684\u4F4D\u7F6E</span>
					tempRaf<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>threadFinish<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// \u5C06\u5F53\u524D\u7EBF\u7A0B\u5B8C\u6210\u4E86\u591A\u5C11\u5199\u5165\u5230\u4E34\u65F6\u6587\u4EF6</span>
					<span class="token keyword">synchronized</span><span class="token punctuation">(</span><span class="token class-name">BreakpointDownloader</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// \u591A\u4E2A\u4E0B\u8F7D\u7EBF\u7A0B\u4E4B\u95F4\u540C\u6B65</span>
						totalFinish <span class="token operator">+=</span> len<span class="token punctuation">;</span>                        <span class="token comment">// \u7EDF\u8BA1\u6240\u6709\u7EBF\u7A0B\u603B\u5171\u5B8C\u6210\u4E86\u591A\u5C11</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				dataRaf<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				tempRaf<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u7EBF\u7A0B&quot;</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">&quot;\u4E0B\u8F7D\u5B8C\u6BD5&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>totalFinish <span class="token operator">==</span> totalLen<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment">// \u5982\u679C\u5DF2\u5B8C\u6210\u957F\u5EA6\u7B49\u4E8E\u670D\u52A1\u7AEF\u6587\u4EF6\u957F\u5EA6(\u4EE3\u8868\u4E0B\u8F7D\u5B8C\u6210)</span>
					<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;\u4E0B\u8F7D\u5B8C\u6210, \u8017\u65F6: &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> begin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					tempFile<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token comment">// \u5220\u9664\u4E34\u65F6\u6587\u4EF6</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>
		<span class="token keyword">new</span> <span class="token class-name">BreakpointDownloader</span><span class="token punctuation">(</span><span class="token string">&quot;http://192.168.1.240:8080/14.Web/android-sdk_r17-windows.zip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><ul><li>\u90AE\u7BB1 \uFF1Acharon.chui@gmail.com</li><li>Good Luck!</li></ul>`,4),e=[o];function c(l,i){return s(),a("div",null,e)}var k=n(p,[["render",c],["__file","\u591A\u7EBF\u7A0B\u65AD\u70B9\u4E0B\u8F7D.html.vue"]]);export{k as default};

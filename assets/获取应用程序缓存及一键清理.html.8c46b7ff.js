import{_ as n,o as s,c as a,e as t}from"./app.e2a3b496.js";const p={},e=t(`<h1 id="\u83B7\u53D6\u5E94\u7528\u7A0B\u5E8F\u7F13\u5B58\u53CA\u4E00\u952E\u6E05\u7406" tabindex="-1"><a class="header-anchor" href="#\u83B7\u53D6\u5E94\u7528\u7A0B\u5E8F\u7F13\u5B58\u53CA\u4E00\u952E\u6E05\u7406" aria-hidden="true">#</a> \u83B7\u53D6\u5E94\u7528\u7A0B\u5E8F\u7F13\u5B58\u53CA\u4E00\u952E\u6E05\u7406</h1><ol><li><p>\u4EC0\u4E48\u662F\u7F13\u5B58\u5462\uFF1F<br> \u5728\u624B\u673AROM\u91CC\u9762\u7684\u7F13\u5B58\u5C31\u662F\u6BCF\u4E2A\u7A0B\u5E8F\u7684cache\u6587\u4EF6\u5939</p></li><li><p>\u83B7\u53D6\u7F13\u5B58\u601D\u8DEF(\u53C2\u8003\u624B\u673A\u8BBE\u7F6E\u9875\u9762)<br> \u901A\u8FC7<code>PakcageManager.getPakcageSizeInfo()</code>\u80FD\u5F97\u5230\u7A0B\u5E8F\u7684\u7F13\u5B58\uFF0C\u4F46\u662F\u8FD9\u4E2A\u65B9\u6CD5\u88AB\u9690\u85CF\u4E86\uFF0C\u800C\u7CFB\u7EDF\u7684<code>Setting</code>\u9875\u9762\u4E4B\u6240\u4EE5\u80FD\u4F7F\u7528\u662F\u56E0\u4E3A\u5B83\u4EEC\u7684\u6743\u9650\u9AD8\uFF0C \u6211\u4EEC\u8981\u60F3\u4F7F\u7528\u5C31\u5FC5\u987B\u901A\u8FC7\u53CD\u5C04\u6765\u5F97\u5230\uFF0C\u8FD9\u91CC<code>getPackageSizeInfo()</code>\u65B9\u6CD5\u7684\u7B2C\u4E8C\u4E2A\u53C2\u6570\u662F\u4E00\u4E2A\u8FDC\u7A0B\u7684<code>aidl</code>\u6587\u4EF6\u3002</p><ul><li>\u6240\u4EE5\u5FC5\u987B\u8981\u5728\u672C\u5730\u7684\u5DE5\u7A0B\u4E2D\u65B0\u5EFA\u4E00\u4E2A\u5305\uFF0C\u540D\u5B57\u4E3A<code>android.content.pm</code></li><li>\u62F7\u8D1D<code>IPakcageStatsObserver.aidl</code>\u5230\u8BE5\u5305\u4E2D,\u5BFC\u5165\u540E\u53D1\u73B0\u62A5\u9519\uFF0C\u662F\u56E0\u4E3A\u8FD8\u8981\u5BFC\u5165\u53E6\u5916\u4E00\u4E2A<code>aidl</code>\u6587\u4EF6<code>PackageStats.aidl</code></li></ul></li><li><p>\u83B7\u53D6\u7F13\u5B58\u5927\u5C0F</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">Void</span> <span class="token function">doInBackground</span><span class="token punctuation">(</span><span class="token class-name">Void</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> params<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PackageInfo</span><span class="token punctuation">&gt;</span></span> infos <span class="token operator">=</span> pm<span class="token punctuation">.</span><span class="token function">getInstalledPackages</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//pm.getInstalledApplications(flags);</span>
		pb<span class="token punctuation">.</span><span class="token function">setMax</span><span class="token punctuation">(</span>infos<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PackageInfo</span> info <span class="token operator">:</span> infos<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">String</span> packname <span class="token operator">=</span> info<span class="token punctuation">.</span>packageName<span class="token punctuation">;</span>
			<span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span>
					<span class="token string">&quot;getPackageSizeInfo&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
							<span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
							<span class="token class-name">IPackageStatsObserver</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>pm<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> packname<span class="token punctuation">,</span>
					<span class="token keyword">new</span> <span class="token class-name">MyObserver</span><span class="token punctuation">(</span>packname<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">publishProgress</span><span class="token punctuation">(</span><span class="token string">&quot;\u6B63\u5728\u626B\u63CF:&quot;</span> <span class="token operator">+</span> packname<span class="token punctuation">)</span><span class="token punctuation">;</span>
			total<span class="token operator">++</span><span class="token punctuation">;</span>
			pb<span class="token punctuation">.</span><span class="token function">setProgress</span><span class="token punctuation">(</span>total<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">MyObserver</span> <span class="token keyword">extends</span> <span class="token class-name">IPackageStatsObserver<span class="token punctuation">.</span>Stub</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> packname<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">MyObserver</span><span class="token punctuation">(</span><span class="token class-name">String</span> packname<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>packname <span class="token operator">=</span> packname<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//\u56DE\u8C03\u65B9\u6CD5\uFF0C\u5230\u5F97\u5230\u72B6\u6001\u4E4B\u540E\u5C31\u4F1A\u8C03\u7528\u8BE5\u65B9\u6CD5\uFF0C\u6211\u4EEC\u53EF\u4EE5\u901A\u8FC7PackageStats\u4E2D\u7684\u5C5E\u6027\u6765\u5F97\u5230\u7F13\u5B58\u7684\u5927\u5C0F</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onGetStatsCompleted</span><span class="token punctuation">(</span><span class="token class-name">PackageStats</span> pStats<span class="token punctuation">,</span> <span class="token keyword">boolean</span> succeeded<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">RemoteException</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> cache <span class="token operator">=</span> pStats<span class="token punctuation">.</span>cacheSize<span class="token punctuation">;</span>
        <span class="token keyword">long</span> code <span class="token operator">=</span> pStats<span class="token punctuation">.</span>codeSize<span class="token punctuation">;</span>
        <span class="token keyword">long</span> data <span class="token operator">=</span> pStats<span class="token punctuation">.</span>dataSize<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cache <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            cacheInfo<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>packname<span class="token punctuation">,</span> cache<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>\u7F13\u5B58\u6E05\u7406 \u5F97\u5230\u6BCF\u4E2A\u7A0B\u5E8F\u7684\u7F13\u5B58\u5927\u5C0F\u540E\uFF0C\u8BE5\u600E\u4E48\u53BB\u6E05\u7406\u7A0B\u5E8F\u7684\u7F13\u5B58\u5462\uFF1F\u8C03\u7528<code>PackageManager.deleteApplicationCacheFiles</code>,\u8FD9\u4E2A\u65B9\u6CD5\u662F\u9690\u85CF\u7684\uFF0C\u6211\u4EEC\u901A\u8FC7\u53CD\u5C04\u6765\u6267\u884C\u4F46\u662F\u53D1\u73B0\u9700\u8981\u6743\u9650\uFF0C \u8BBE\u7F6E\u6743\u9650\u540E\u8FD8\u662F\u63D0\u793A\u9700\u8981\u6743\u9650\uFF0C\u8FD9\u662F\u56E0\u4E3A\u6CA1\u6709\u7CFB\u7EDF\u6743\u9650\u6211\u4EEC\u4E0D\u80FD\u6E05\u7406\uFF0C\u8BBE\u7F6E\u9875\u9762\u4E4B\u6240\u4EE5\u80FD\u591F\u4F7F\u7528\u8FD9\u4E2A\u65B9\u6CD5\uFF0C\u56E0\u4E3A\u662F\u7CFB\u7EDF\u7684<code>API</code>\uFF0C \u6240\u4EE5\u6211\u4EEC\u53EA\u80FD\u662F\u70B9\u51FB\u6761\u76EE\u4E4B\u540E\u8DF3\u8F6C\u5230\u7CFB\u7EDF\u7684\u8BBE\u7F6E\u9875\u9762\uFF0C\u8BA9\u901A\u8FC7\u8BBE\u7F6E\u9875\u9762\u6765\u5220\u9664\u7F13\u5B58.</p></li><li><p>\u4E00\u952E\u6E05\u7406 \u4E00\u952E\u81EA\u52A8\u6E05\u7406\u4F7F\u7528<code>freeStorageAndNotify</code>\u65B9\u6CD5\uFF0C\u8BE5\u65B9\u6CD5\u80FD\u591F\u5411\u7CFB\u7EDF\u7533\u8BF7\u91CA\u653E\u591A\u5927\u7684\u5185\u5B58\uFF0C\u7CFB\u7EDF\u4F1A\u6839\u636E\u4F60\u7533\u8BF7\u7684\u5927\u5C0F\uFF0C\u5C3D\u53EF\u80FD\u7684\u53BB\u662F\u91CA\u653E\u53EF\u4EE5\u91CA\u653E\u7684\u5927\u5C0F\u3002</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cleanAll</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ms <span class="token operator">=</span> <span class="token class-name">PackageManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> m <span class="token operator">:</span> ms<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;freeStorageAndNotify&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                m<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>pm<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token class-name">Long</span><span class="token punctuation">.</span>MAX_VALUE<span class="token punctuation">,</span>
                        <span class="token keyword">new</span> <span class="token class-name">MyDataObersver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>		
<span class="token punctuation">}</span>

<span class="token comment">//\u8FD9\u662F\u4E00\u4E2Aaidl</span>
<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">MyDataObersver</span> <span class="token keyword">extends</span> <span class="token class-name">IPackageDataObserver<span class="token punctuation">.</span>Stub</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRemoveCompleted</span><span class="token punctuation">(</span><span class="token class-name">String</span> packageName<span class="token punctuation">,</span> <span class="token keyword">boolean</span> succeeded<span class="token punctuation">)</span>
            <span class="token keyword">throws</span> <span class="token class-name">RemoteException</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><hr><ul><li>\u90AE\u7BB1 \uFF1Acharon.chui@gmail.com</li><li>Good Luck!</li></ul>`,4),c=[e];function o(l,i){return s(),a("div",null,c)}var k=n(p,[["render",o],["__file","\u83B7\u53D6\u5E94\u7528\u7A0B\u5E8F\u7F13\u5B58\u53CA\u4E00\u952E\u6E05\u7406.html.vue"]]);export{k as default};

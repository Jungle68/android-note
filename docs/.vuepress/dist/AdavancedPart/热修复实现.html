<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.47">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>热修复实现 | Android Notes</title><meta name="description" content="一个 Android 技术记录文档">
    <link rel="modulepreload" href="/android-note/assets/app.89e8a229.js"><link rel="modulepreload" href="/android-note/assets/热修复实现.html.024e40a5.js"><link rel="modulepreload" href="/android-note/assets/热修复实现.html.ecfe19bd.js"><link rel="prefetch" href="/android-note/assets/index.html.8bd0e776.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.7e59ca03.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.c477e23d.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.8ae3b627.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.d2e9fd43.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.c3aa8849.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.e39fb926.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.24d347d7.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.d974bc5d.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.e5751fb9.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.0e899c35.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.6ec105de.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.5d07c2c2.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.820183b1.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.ea867ee7.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.e0f11045.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.22b42870.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.61dfcc93.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.3cd2d991.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.570ee8a4.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.f8aba27b.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.1d392d64.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.9559fa68.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.ed0822f0.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.dc7889f9.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.3020c3be.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.073c39e0.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.8baf198e.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.51e0046b.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.5bd737af.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.1159aa8f.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.7c3e31b6.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.8ab8a2cc.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.e50646bb.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.f8bdc563.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.f120c888.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.1f8b3f62.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.96ecc87a.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.1b541a89.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.998dc7dc.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.0cbd4bdb.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.6cf7c851.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.d7db60a7.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.2f79a0af.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.f4db4c13.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.a286106e.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.de385267.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.b8bbd45f.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.2e8c4081.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.c39ce824.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.244019e6.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.7e587735.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.e625c50f.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.225da764.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.78211940.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.9c72d222.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.e192df98.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.9b54500d.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.f28a57f0.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.a093a882.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.2b0af47b.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.e441b7fd.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.7bc27bce.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.fbfbbb8a.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.4e2ae931.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.1319d9f7.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.e2f05584.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.9b6cca73.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.741df4a3.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.57a2cd66.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.57f05d22.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.722980d0.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.15a7fa24.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.cd786a69.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.7cd4845a.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.9db13890.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.819c1c88.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.4b8cb269.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.4ea9b161.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.844e0d9d.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.3bc9ff9e.js"><link rel="prefetch" href="/android-note/assets/病毒.html.7619f49a.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.4c49d5e1.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.2a88d555.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.8765e43b.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.cfb14486.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.fe974a62.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.00182d24.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.247dc68f.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.96572e52.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.653a3c88.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.eac67d7b.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.238e6553.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.27594cde.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.05e678bb.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.58f90a22.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.cdacbd38.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.e91c5d3e.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.fa9bacd0.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.94232b6c.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.8dbea4e8.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.20202cc3.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.40d0942f.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.2b05f9c3.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.f5b236bc.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.6952074c.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.323427b3.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.59a6c538.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.1b20bae5.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.3f8c1a56.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.fa61902d.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.b4741bb9.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.df8708de.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.0e6309ee.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.74b808b7.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.5e76b5d1.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.39b59b79.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.1041f4f4.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.4fcf5dcb.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.9a1e399b.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.52b2b04d.js"><link rel="prefetch" href="/android-note/assets/单链表.html.f419429a.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.db38b6c6.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.4e2b2a81.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.f0d24ad9.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.f7a3cc92.js"><link rel="prefetch" href="/android-note/assets/死锁.html.ec93d9d3.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.24e33318.js"><link rel="prefetch" href="/android-note/assets/算法.html.0a01e9ba.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.fbaeb1bd.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.1dff0557.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.e6733f54.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.a855a233.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.ddbbaf1e.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.8e0796a3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.18ccf0d4.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.e4c68b6e.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.afea2f74.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.e49e1c52.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.d2a307b1.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.9c599d21.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.d5da1eb6.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.80367240.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.0a73d443.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.ebaba068.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.13bba357.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.a8c42ae7.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.735f795b.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.8f2cca4a.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.22dab991.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.7018659f.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.f551bb7a.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.4b2076fc.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.cdc3013a.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.7835fb45.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.6109676b.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.14b9a7a7.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.7d96a52b.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.6aa91caa.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.f388a863.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.489c39d7.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.d64f0a72.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.9070678b.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.572b02f6.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.5f41a7d3.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.662b2630.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.5df647ad.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.892325da.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.76d8e5df.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.389a237c.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.b5905bd6.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.afbd099f.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.d24ca0e9.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.efba877c.js"><link rel="prefetch" href="/android-note/assets/404.html.93146c89.js"><link rel="prefetch" href="/android-note/assets/index.html.a3d1ed7b.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.a64d1991.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.34218e19.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.7b54b523.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.89bd0ab9.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.103f1200.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.c8e634bf.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.7624414c.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.98a6217e.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.e0cbd1b3.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.d07ae209.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.1a7412c1.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.fae25f98.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.a45462e1.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.0e42552a.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.fac83de9.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.946e9782.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.75dd3aa7.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.b99bea93.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.17601c25.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.e4dd3dff.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.b8f61c98.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.e4a0b5c1.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.5c2a56e3.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.771b598f.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.ec948576.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.968e5163.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.b91f279b.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.e5d334b3.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.16b555ba.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.38d70312.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.630ea31f.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.6a608b01.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.c7294606.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.d153b865.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.0788dd70.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.c4f2cabf.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.4ffa43cf.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.7160a49a.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.cdc28261.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.ca3b8f37.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.04dae4e9.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.b2eee048.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.43f5056a.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.7e9d24cb.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.fe0e18e4.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.9692f10a.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.a035f300.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.daf97b10.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.4b3a8a75.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.c9b0c208.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.f56d8adb.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.27b4fbd7.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.019759be.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.c6e22d33.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.ddae6365.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.89a53b41.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.4034729a.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.213d99fd.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.4a292186.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.26281ec4.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.711522c7.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.ca454c03.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.d2d568fe.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.2b23078a.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.e59debb3.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.96161766.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.faa1301d.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.37bcd8c4.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.037d5f51.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.20dd3611.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.8477f837.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.379af02f.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.46a9b2e4.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.2d58e745.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.c608688f.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.bfa9e3d0.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.5511f591.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.6e584085.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.6b73df63.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.fbac04fc.js"><link rel="prefetch" href="/android-note/assets/病毒.html.5cd88c03.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.b01be570.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.adc8af11.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.e5536922.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.ba3817b8.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.4496e01e.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.aa990bb9.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.b42b4b49.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.02d23272.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.971b5263.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.4ef9b35f.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.02696243.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.3dae42d2.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.b7da17de.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.49e56b2a.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.51a94c44.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.793bc62a.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.d0b4194f.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.3b5da204.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.f85478dc.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.c0b33ce0.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.9cf366a8.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.2db819bd.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.0df280d7.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.b857d0ab.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.6daec307.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.21b0f237.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.69e343c0.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.164e8303.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.124cdb1e.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.facc0566.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.f48859b0.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.2c4caa9a.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.1273fefc.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.f1e06473.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.52f84c68.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.ed4970f5.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.7bc7d93a.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.9e31d408.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.84866fc9.js"><link rel="prefetch" href="/android-note/assets/单链表.html.4400da11.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.757c2b22.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.28fdc49e.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.2ee7fbf3.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.ab0fdf74.js"><link rel="prefetch" href="/android-note/assets/死锁.html.2dfc5516.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.4ca60911.js"><link rel="prefetch" href="/android-note/assets/算法.html.18c6261d.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.665d4e8a.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.9917c0f8.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.a6e27633.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.592167e3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.6f6c5af5.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.dcd32d84.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.710e4efa.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.27f8d4ad.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.20c931ca.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.038bb020.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.44688c6c.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.49e88efd.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.1d7dfe42.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.e26fe642.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.c0efdbc5.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.96bbc22f.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.a3ea4f26.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.1026b60c.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.b836467c.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.ecb4c8c6.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.014a0e80.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.bf6c619f.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.43a40b19.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.1d72231a.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.39e338b7.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.42bac657.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.7b81876b.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.d5679c84.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.bf97314b.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.28934eff.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.dc598784.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.fe77a4c4.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.86d37938.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.b0173f04.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.da0db26d.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.e8bf8449.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.ed14c462.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.18900a2a.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.8aa50d61.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.9e991b58.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.747f298d.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.4a5af4a7.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.a26fa93a.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.d4e4b484.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.f24adf9a.js"><link rel="prefetch" href="/android-note/assets/404.html.8b61bad2.js"><link rel="prefetch" href="/android-note/assets/404.e8cf6e3a.js"><link rel="prefetch" href="/android-note/assets/Layout.36051849.js">
    <link rel="stylesheet" href="/android-note/assets/style.1f7fd01d.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/android-note/" class=""><!----><span class="site-name">Android Notes</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">热修复实现 <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="热修复实现" tabindex="-1"><a class="header-anchor" href="#热修复实现" aria-hidden="true">#</a> 热修复实现</h1><p>现在的热修复方案已经有很多了，例如<code>alibaba</code>的<a href="https://github.com/alibaba/dexposed" target="_blank" rel="noopener noreferrer">dexposed<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>、<a href="https://github.com/alibaba/AndFix" target="_blank" rel="noopener noreferrer">AndFix<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>以及<code>jasonross</code>的<a href="https://github.com/jasonross/Nuwa" target="_blank" rel="noopener noreferrer">Nuwa<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>等等。原来没有仔细去分析过也没想写这篇文章，但是之前<a href="https://github.com/CharonChui/AndroidNote/blob/master/SourceAnalysis/InstantRun%E8%AF%A6%E8%A7%A3.md" title="InstantRun详解" target="_blank" rel="noopener noreferrer">InstantRun详解<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>这篇文章中介绍了<code>Android Studio Instant Run</code>的 实现原理，这不就是活生生的一个热修复吗？ 随心情久久不能平复，我们何不用这种方式来实现。</p><p>方案有很多种，我就只说明下我想到的方式，也就是<code>Instant Run</code>的方式:<br> 分拆到不同的<code>dex</code>中，然后通过<code>classloader</code>来进行加载。但是在之前<code>InstantRun详解</code>中只说到会通过内部的<code>server</code>去判断该类是否有更新，如果有的话就去从新的<code>dex</code>中加载该类，否则就从旧的<code>dex</code>中加载，但这是如何实现的呢？ 怎么去从不同的<code>dex</code>中选择最新的那个来进行加载。</p><p>讲到这里需要先介绍一下<code>ClassLoader</code>：</p><p>&lt; <code>A class loader is an object that is responsible for loading classes. The class ClassLoader is an abstract class. Given the binary name of a class, a class loader should attempt to locate or generate data that constitutes a definition for the class. A typical strategy is to transform the name into a file name and then read a &quot;class file&quot; of that name from a file system.</code></p><p>在一般情况下，应用程序不需要创建一个全新的ClassLoader对象，而是使用当前环境已经存在的ClassLoader。因为Javad的Runtime环境在初始化时，其内部会创建一个ClassLoader对象用于加载Runtime所需的各种Java类。 每个ClassLoader必须有一个父ClassLoader，在装载Class文件时，子ClassLoader会先请求父ClassLoader加载该Class文件，只有当其父ClassLoader找不到该Class文件时，子ClassLoader才会继续装载该类，这是一种安全机制。</p><p>对于Android的应用程序，本质上虽然也是用Java开发，并且使用标准的Java编译器编译出Class文件，但最终的APK文件中包含的却是dex类型的文件。dex文件是将所需的所有Class文件重新打包，打包的规则不是简单的压缩，而是完全对Class文件内部的各种函数表、变量表等进行优化，并产生一个新的文件，这就是dex文件。由于dex文件是一种经过优化的Class文件，因此要加载这样特殊的Class文件就需要特殊的类装载器，这就是DexClassLoader，Android SDK中提供的DexClassLoader类就是出于这个目的。</p><p>总体来说，<code>Android</code> 默认主要有三个<code>ClassLoader</code>:</p><ul><li><code>BootClassLoader</code>: 系统启动时创建， &lt; `Provides an explicit representation of the boot class loader. It sits at the</li></ul><ul><li>head of the class loader chain and delegates requests to the VM&#39;s internal</li><li>class loading mechanism.`</li></ul><ul><li><code>PathClassLoader</code>: 可以加载/data/app目录下的apk，这也意味着，它只能加载已经安装的apk；</li><li><code>DexClassLoader</code>: 可以加载文件系统上的jar、dex、apk；可以从SD卡中加载未安装的apk</li></ul><p>通过上面的分析知道，如果用多个<code>dex</code>的话肯定会用到<code>DexClassLoader</code>类，我们首先来看一下它的源码(这里 插一嘴，源码可以去<a href="https://android.googlesource.com/platform/libcore-snapshot/+/ics-mr1/dalvik/src/main/java/dalvik/system" target="_blank" rel="noopener noreferrer">googlesource<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>中找):</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * A class loader that loads classes from <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token punctuation">.</span>jar</span></span><span class="token punctuation">}</span> and <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token punctuation">.</span>apk</span></span><span class="token punctuation">}</span> files
 * containing a <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">classes<span class="token punctuation">.</span>dex</span></span><span class="token punctuation">}</span> entry. This can be used to execute code not
 * installed as part of an application.
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This class loader requires an application-private, writable directory to
 * cache optimized classes. Use <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token function">getDir</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span> to create
 * such a directory: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">&gt;</span></span>   <span class="token punctuation">{</span><span class="token keyword">@code</span>
 <span class="token code-section">*   <span class="token code language-java"><span class="token class-name">File</span> dexOutputDir <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getDir</span><span class="token punctuation">(</span><span class="token string">&quot;dex&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
 *</span> <span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>Do not cache optimized classes on external storage.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span>
 * External storage does not provide access controls necessary to protect your
 * application from code injection attacks.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DexClassLoader</span> <span class="token keyword">extends</span> <span class="token class-name">BaseDexClassLoader</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * Creates a <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">DexClassLoader</span></span></span><span class="token punctuation">}</span> that finds interpreted and native
     * code.  Interpreted classes are found in a set of DEX files contained
     * in Jar or APK files.
     *
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>The path lists are separated using the character specified by the
     * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">path<span class="token punctuation">.</span>separator</span></span><span class="token punctuation">}</span> system property, which defaults to <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token operator">:</span></span></span><span class="token punctuation">}</span>.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">dexPath</span> the list of jar/apk files containing classes and
     *     resources, delimited by <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">File</span><span class="token punctuation">.</span>pathSeparator</span></span><span class="token punctuation">}</span>, which
     *     defaults to <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token string">&quot;:&quot;</span></span></span><span class="token punctuation">}</span> on Android
     * <span class="token keyword">@param</span> <span class="token parameter">optimizedDirectory</span> directory where optimized dex files
     *     should be written; must not be <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">null</span></span></span><span class="token punctuation">}</span>
     * <span class="token keyword">@param</span> <span class="token parameter">libraryPath</span> the list of directories containing native
     *     libraries, delimited by <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">File</span><span class="token punctuation">.</span>pathSeparator</span></span><span class="token punctuation">}</span>; may be
     *     <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">null</span></span></span><span class="token punctuation">}</span>
     * <span class="token keyword">@param</span> <span class="token parameter">parent</span> the parent class loader
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">DexClassLoader</span><span class="token punctuation">(</span><span class="token class-name">String</span> dexPath<span class="token punctuation">,</span> <span class="token class-name">String</span> optimizedDirectory<span class="token punctuation">,</span>
            <span class="token class-name">String</span> libraryPath<span class="token punctuation">,</span> <span class="token class-name">ClassLoader</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>dexPath<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>optimizedDirectory<span class="token punctuation">)</span><span class="token punctuation">,</span> libraryPath<span class="token punctuation">,</span> parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注释说的太明白了，这里就不翻译了，但是我们并没有找到加载的代码，去它的父类中查找， 因为家在都是从<code>loadClass()</code>方法中，所以我们去<code>ClassLoader</code>类中看一下<code>loadClass()</code>方法:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
     * Loads the class with the specified name. Invoking this method is
     * equivalent to calling <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token function">loadClass</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span>.
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>Note:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span> In the Android reference implementation, the
     * second parameter of <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token keyword">boolean</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> is ignored
     * anyway.
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     *
     * <span class="token keyword">@return</span> the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Class</span></span></span><span class="token punctuation">}</span> object.
     * <span class="token keyword">@param</span> <span class="token parameter">className</span>
     *            the name of the class to look for.
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">ClassNotFoundException</span></span>
     *             if the class can not be found.
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">loadClass</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Loads the class with the specified name, optionally linking it after
     * loading. The following steps are performed:
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ol</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> Call <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">findLoadedClass</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> to determine if the requested
     * class has already been loaded.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>If the class has not yet been loaded: Invoke this method on the
     * parent class loader.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>If the class has still not been loaded: Call
     * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span> to find the class.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ol</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>strong</span><span class="token punctuation">&gt;</span></span>Note:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>strong</span><span class="token punctuation">&gt;</span></span> In the Android reference implementation, the
     * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">resolve</span></span><span class="token punctuation">}</span> parameter is ignored; classes are never linked.
     * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
     *
     * <span class="token keyword">@return</span> the <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Class</span></span></span><span class="token punctuation">}</span> object.
     * <span class="token keyword">@param</span> <span class="token parameter">className</span>
     *            the name of the class to look for.
     * <span class="token keyword">@param</span> <span class="token parameter">resolve</span>
     *            Indicates if the class should be resolved after loading. This
     *            parameter is ignored on the Android reference implementation;
     *            classes are not resolved.
     * <span class="token keyword">@throws</span> <span class="token reference"><span class="token class-name">ClassNotFoundException</span></span>
     *             if the class can not be found.
     */</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">,</span> <span class="token keyword">boolean</span> resolve<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> <span class="token function">findLoadedClass</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>clazz <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ClassNotFoundException</span> suppressed <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
            	<span class="token comment">// 先检查父ClassLoader是否已经家在过该类</span>
                clazz <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                suppressed <span class="token operator">=</span> e<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>clazz <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                	<span class="token comment">// 调用DexClassLoader.findClass()方法。</span>
                    clazz <span class="token operator">=</span> <span class="token function">findClass</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">addSuppressed</span><span class="token punctuation">(</span>suppressed<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">throw</span> e<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> clazz<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面会调用<code>DexClassLoader.findClass()</code>方法，但是<code>DexClassLoader</code>没有实现该方法，所以去它的父类<code>BaseDexClassLoader</code>中看，接着看一下<code>BaseDexClassLoader</code>的源码:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Base class for common functionality between various dex-based
 * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">ClassLoader</span></span><span class="token punctuation">}</span> implementations.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseDexClassLoader</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/** originally specified path (just used for <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token punctuation">}</span>) */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> originalPath<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** structured lists of path elements */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">DexPathList</span> pathList<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/**
     * Constructs an instance.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">dexPath</span> the list of jar/apk files containing classes and
     * resources, delimited by <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">File</span><span class="token punctuation">.</span>pathSeparator</span></span><span class="token punctuation">}</span>, which
     * defaults to <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token string">&quot;:&quot;</span></span></span><span class="token punctuation">}</span> on Android
     * <span class="token keyword">@param</span> <span class="token parameter">optimizedDirectory</span> directory where optimized dex files
     * should be written; may be <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">null</span></span></span><span class="token punctuation">}</span>
     * <span class="token keyword">@param</span> <span class="token parameter">libraryPath</span> the list of directories containing native
     * libraries, delimited by <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">File</span><span class="token punctuation">.</span>pathSeparator</span></span><span class="token punctuation">}</span>; may be
     * <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">null</span></span></span><span class="token punctuation">}</span>
     * <span class="token keyword">@param</span> <span class="token parameter">parent</span> the parent class loader
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">BaseDexClassLoader</span><span class="token punctuation">(</span><span class="token class-name">String</span> dexPath<span class="token punctuation">,</span> <span class="token class-name">File</span> optimizedDirectory<span class="token punctuation">,</span>
            <span class="token class-name">String</span> libraryPath<span class="token punctuation">,</span> <span class="token class-name">ClassLoader</span> parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>originalPath <span class="token operator">=</span> dexPath<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>pathList <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">DexPathList</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> dexPath<span class="token punctuation">,</span> libraryPath<span class="token punctuation">,</span> optimizedDirectory<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token comment">// 从DexPathList中找</span>
        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> pathList<span class="token punctuation">.</span><span class="token function">findClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>clazz <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> clazz<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">URL</span> <span class="token function">findResource</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> pathList<span class="token punctuation">.</span><span class="token function">findResource</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> <span class="token function">findResources</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> pathList<span class="token punctuation">.</span><span class="token function">findResources</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">findLibrary</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> pathList<span class="token punctuation">.</span><span class="token function">findLibrary</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在<code>findClass()</code>方法中我们看到调用了<code>DexPathList.findClass()</code>方法:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * A pair of lists of entries, associated with a <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">ClassLoader</span></span></span><span class="token punctuation">}</span>.
 * One of the lists is a dex/resource path <span class="token entity named-entity" title="—">&amp;mdash;</span> typically referred
 * to as a &quot;class path&quot; <span class="token entity named-entity" title="—">&amp;mdash;</span> list, and the other names directories
 * containing native code libraries. Class path entries may be any of:
 * a <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token punctuation">.</span>jar</span></span><span class="token punctuation">}</span> or <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token punctuation">.</span>zip</span></span><span class="token punctuation">}</span> file containing an optional
 * top-level <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java">classes<span class="token punctuation">.</span>dex</span></span><span class="token punctuation">}</span> file as well as arbitrary resources,
 * or a plain <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token punctuation">.</span>dex</span></span><span class="token punctuation">}</span> file (with no possibility of associated
 * resources).
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>This class also contains methods to use these lists to look up
 * classes and resources.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
 */</span>
<span class="token comment">/*package*/</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">DexPathList</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> DEX_SUFFIX <span class="token operator">=</span> <span class="token string">&quot;.dex&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> JAR_SUFFIX <span class="token operator">=</span> <span class="token string">&quot;.jar&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> ZIP_SUFFIX <span class="token operator">=</span> <span class="token string">&quot;.zip&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> APK_SUFFIX <span class="token operator">=</span> <span class="token string">&quot;.apk&quot;</span><span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** class definition context */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ClassLoader</span> definingContext<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** list of dex/resource (class path) elements */</span> 
    <span class="token comment">// 把dex封装成一个数组，每个Element代表一个dex</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Element</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dexElements<span class="token punctuation">;</span>
    <span class="token doc-comment comment">/** list of native library directory elements */</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">File</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nativeLibraryDirectories<span class="token punctuation">;</span>

    <span class="token comment">// .....</span>

    <span class="token doc-comment comment">/**
     * Finds the named class in one of the dex files pointed at by
     * this instance. This will find the one in the earliest listed
     * path element. If the class is found but has not yet been
     * defined, then this method will define it in the defining
     * context that this instance was constructed with.
     *
     * <span class="token keyword">@return</span> the named class or <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">null</span></span></span><span class="token punctuation">}</span> if the class is not
     * found in any of the dex files
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Class</span> <span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Element</span> element <span class="token operator">:</span> dexElements<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">DexFile</span> dex <span class="token operator">=</span> element<span class="token punctuation">.</span>dexFile<span class="token punctuation">;</span>
            <span class="token comment">// 遍历数组，拿到第一个就返回</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>dex <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Class</span> clazz <span class="token operator">=</span> dex<span class="token punctuation">.</span><span class="token function">loadClassBinaryName</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> definingContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>clazz <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> clazz<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从上面的源码中分析，我知道系统会把所有相关的<code>dex</code>维护到一个数组中，然后在加载类的时候会从该数组中的第一个元素中取，然后返回。那我们只要保证将我们热修复后的<code>dex</code>对应的<code>Element</code>放到该数组的第一个位置就可以了，这样系统就会加载我们热修复的<code>dex</code>中的类。<br> 所以方案出来了，只要把有问题的类修复后，放到一个单独的<code>dex</code>，然后把该<code>Dex</code>转换成对应的<code>Element</code>后再将该<code>Element</code>插入到<code>dexElements</code>数组的第一个位置就可以了。那该如何去将其插入到<code>dexElements</code>数组的第一个位置呢？-- 暴力反射。</p><p>到这里我感觉初步的思路已经有了:</p><ul><li>将补丁作为<code>dex</code>发布。</li><li>通过反射修改该<code>dex</code>所对应的<code>Element</code>在数组中的位置。</li></ul><p>但是我也想到肯定还会有类似下面的问题:</p><ul><li>资源文件的处理</li><li>四大组件的处理</li><li>清单文件的处理</li></ul><p>虽然我知道没有这么简单，但是我还是决定抱着不作不死的宗旨继续前行。</p><p>好了，<code>demo</code>走起来。</p><p>怎么生成<code>dex</code>文件呢？ 这要讲过两部分:</p><ul><li><code>.class</code>-&gt; <code>.jar</code> : <code>jar -cvf test.jar com/charon/instantfix_sample/MainActivity.class</code></li><li><code>.jar</code>-&gt; <code>.dex</code>: <code>dx --dex --output=target.jar test.jar</code> <code>target.jar</code>就是包含<code>.dex</code>的<code>jar</code>包</li></ul><p>生成好<code>dex</code>后我们为了模拟先将其放到<code>asset</code>目录下(实际开发中肯定要从接口中去下载，当然还会有一些版本号的判断等)，然后就是将该<code>dex</code>转换成</p><p>我的方案中采用的是MultiDex，对其进行一部分改造，具体代码： 1、添加dex文件，并执行install</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
* 添加apk包外的dex文件
* 自动执行install
* <span class="token keyword">@param</span> <span class="token parameter">dexFile</span>
*/</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">addDexFileAutoInstall</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">File</span><span class="token punctuation">&gt;</span></span> dexFile<span class="token punctuation">,</span><span class="token class-name">File</span> optimizedDirectory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dexFile <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>dexFile<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span><span class="token operator">!</span>dexFiles<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>dexFile<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         dexFiles<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>dexFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token class-name">LogUtil</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;add other dexfile&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token function">installDexFile</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>optimizedDirectory<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2、installDexFile直接调用MultiDex 的installSecondaryDexes方法。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 添加apk包外的dex文件，
 * <span class="token keyword">@param</span> <span class="token parameter">context</span>
 */</span>
publicstatic <span class="token keyword">void</span> <span class="token function">installDexFile</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">File</span> optimizedDirectory<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">checkValidZipFiles</span><span class="token punctuation">(</span>dexFiles<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">installSecondaryDexes</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> optimizedDirectory<span class="token punctuation">,</span> dexFiles<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessExceptione</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchFieldExceptione</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvocationTargetExceptione</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchMethodExceptione</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOExceptione</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3、将patch.dex放在所有dex最前面。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token function">voidexpandFieldArray</span><span class="token punctuation">(</span><span class="token class-name">Object</span> instance<span class="token punctuation">,</span> <span class="token class-name">String</span> fieldName<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span>extraElements<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchFieldException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">,</span>
<span class="token class-name">IllegalAccessException</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Field</span> jlrField <span class="token operator">=</span> <span class="token function">findField</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> fieldName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span>original <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> jlrField<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span>combined <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span>original<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getComponentType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>original<span class="token punctuation">.</span>length <span class="token operator">+</span> extraElements<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 将后来的dex放在前面，主dex放在最后。</span>
                  <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>extraElements<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> combined<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> extraElements<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>original<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> combined<span class="token punctuation">,</span> extraElements<span class="token punctuation">.</span>length<span class="token punctuation">,</span>original<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
                   <span class="token comment">// 原始的dex合并，是将主dex放在前面，其他的dex依次放在后面。</span>
                   <span class="token comment">//System.arraycopy(original, 0, combined, 0, original.length);</span>
                   <span class="token comment">//System.arraycopy(extraElements, 0, combined, original.length,extraElements.length);</span>
                  jlrField<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>instance<span class="token punctuation">,</span> combined<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>到此将patch.dex放进了Element，接下来的问题就是加载Class，当加载patch.dex中类的时候，会遇到一个问题，这个问题就是QQ空间团队遇到,Classd的CLASS_ISPREVERIFIED。具体原因是dvmResolveClass这个方法对Class进行了校验。判断这个要Resolve的class是否和其引用来自一个dex。如果不是，就会遇到问题。</p><p>当引用这和被引用者不在同一个dex中就会抛出异常，导致Resolve失败。QQ空间团队的方案是阻止所有的Class类打上CLASS_ISPREVERIFIED来逃过校验，这种方式其实是影响性能。 我们的方案是和QQ团队的类似，但是和QQ空间不同的是，我们将fromUnverifiedConstant设置为true，来逃过校验，达到补丁的路径。具体怎么实现呢？ 要引用Cydia Hook技术来hook Native dalvik中dvmResolveClass这个方法。有关Cydia Hook技术请参考： 官网地址：http://www.cydiasubstrate.com/ 官方教程：http://www.cydiasubstrate.com/id/38be592b-bda7-4dd2-b049-cec44ef7a73b SDK下载地址：http://asdk.cydiasubstrate.com/zips/cydia_substrate-r2.zip 具体代码如下。 //指明要hook的lib ： MSConfig(MSFilterLibrary,&quot;/system/lib/libdvm.so&quot;)</p><p>// 在初始化的时候进行hook MSInitialize { LOGD(&quot;Cydia Init&quot;); MSImageRef image; //载入lib image = MSGetImageByName(&quot;/system/lib/libdvm.so&quot;); if (image != NULL) { LOGD(&quot;image is not null&quot;); void <em>dexload=MSFindSymbol(image,&quot;dvmResolveClass&quot;); if(dexload != NULL) { LOGD(&quot;dexloadis not null&quot;); MSHookFunction(dexload, (void</em>)proxyDvmResolveClass, (void**)&amp;dvmResolveClass_Proxy); } else{ LOGD(&quot;errorfind dvmResolveClass&quot;); } } } // 在初始化的时候进行hook//保留原来的地址 ClassObject* (<em>dvmResolveClass_Proxy)(ClassObject</em> referrer, u4 classIdx, boolfromUnverifiedConstant); // 新方法地址 static ClassObject* proxyDvmResolveClass(ClassObject* referrer, u4 classIdx,bool fromUnverifiedConstant) { return dvmResolveClass_Proxy(referrer, classIdx,true); } 有人可能会担心cydia Hook性能，稳定性问题，但是据我所知，目前有些公司已经用它来实现apk加壳和脱壳防止反编译技术方案。具体可以参考http://www.gitzx.com/android-cydiasubstrate/</p><p>说到此处，似乎已经是一个完整的方案了，但在实践中，会发现运行加载类的时候报preverified错误，原来在DexPrepare.cpp，将dex转化成odex的过程中，会在DexVerify.cpp进行校验，验证如果直接引用到的类和clazz是否在同一个dex，如果是，则会打上CLASS_ISPREVERIFIED标志。通过在所有类（Application除外，当时还没加载自定义类的代码）的构造函数插入一个对在单独的dex的类的引用，就可以解决这个问题。空间使用了javaassist进行编译时字节码插入。</p><p>所以为了实现补丁方案，所以必须从这些方法中入手，防止类被打上CLASS_ISPREVERIFIED标志。 最终空间的方案是往所有类的构造函数里面插入了一段代码，代码如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">ClassVerifier</span><span class="token punctuation">.</span>PREVENT_VERIFY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">AntilazyLoad</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中AntilazyLoad类会被打包成单独的antilazy.dex，这样当安装apk的时候，classes.dex内的类都会引用一个在不相同dex中的AntilazyLoad类，这样就防止了类被打上CLASS_ISPREVERIFIED的标志了，只要没被打上这个标志的类都可以进行打补丁操作。 然后在应用启动的时候加载进来.AntilazyLoad类所在的dex包必须被先加载进来,不然AntilazyLoad类会被标记为不存在，即使后续加载了hack.dex包，那么他也是不存在的，这样屏幕就会出现茫茫多的类AntilazyLoad找不到的log。 所以Application作为应用的入口不能插入这段代码。（因为载入hack.dex的代码是在Application中onCreate中执行的，如果在Application的构造函数里面插入了这段代码，那么就是在hack.dex加载之前就使用该类，该类一次找不到，会被永远的打上找不到的标志)</p><p>如何打包补丁包： １. 空间在正式版本发布的时候，会生成一份缓存文件，里面记录了所有class文件的md5，还有一份mapping混淆文件。 ２. 在后续的版本中使用-applymapping选项，应用正式版本的mapping文件，然后计算编译完成后的class文件的md5和正式版本进行比较，把不相同的class文件打包成补丁包。 备注:该方案现在也应用到我们的编译过程当中,编译不需要重新打包dex,只需要把修改过的类的class文件打包成patch dex,然后放到sdcard下,那么就会让改变的代码生效。</p><p>在 Java 中，只有当两个实例的类名、包名以及加载其的 ClassLoader 都相同，才会被认为是同一种类型。上面分别加载的新类和旧类，虽然包名和类名都完全一样，但是由于加载的 ClassLoader 不同，所以并不是同一种类型，在实际使用中可能会出现类型不符异常。 同一个 Class = 相同的 ClassName + PackageName + ClassLoader 以上问题在采用动态加载功能的开发中容易出现，请注意。</p><p>通过上面的分析，我们知道使用ClassLoader动态加载一个外部的类是非常容易的事情，所以很容易就能实现动态加载新的可执行代码的功能，但是比起一般的Java程序，在Android程序中使用动态加载主要有两个麻烦的问题：</p><p>Android中许多组件类（如Activity、Service等）是需要在Manifest文件里面注册后才能工作的（系统会检查该组件有没有注册），所以即使动态加载了一个新的组件类进来，没有注册的话还是无法工作； Res资源是Android开发中经常用到的，而Android是把这些资源用对应的R.id注册好，运行时通过这些ID从Resource实例中获取对应的资源。如果是运行时动态加载进来的新类，那类里面用到R.id的地方将会抛出找不到资源或者用错资源的异常，因为新类的资源ID根本和现有的Resource实例中保存的资源ID对不上； 说到底，抛开虚拟机的差别不说，一个Android程序和标准的Java程序最大的区别就在于他们的上下文环境（Context）不同。Android中，这个环境可以给程序提供组件需要用到的功能，也可以提供一些主题、Res等资源，其实上面说到的两个问题都可以统一说是这个环境的问题，而现在的各种Android动态加载框架中，核心要解决的东西也正是“如何给外部的新类提供上下文环境”的问题。</p><p>DexClassLoader的使用方法一般有两种： 从已安装的apk中读取dex 从apk文件中读取dex 假如有两个APK，一个是宿主APK，叫作HOST，一个是插件APK，叫作Plugin。Plugin中有一个类叫PluginClass，代码如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PluginClass</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">PluginClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;JG&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;初始化PluginClass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">function</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> a<span class="token operator">+</span>b<span class="token punctuation">;</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在如果想调用插件APK中PluginClass内的方法，应该怎么办？ ####从已安装的apk中读取dex</p><p>先来看第一种方法，这种方法必须建一个Activity，在清单文件中配置Action.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token operator">&lt;</span>activity android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;.MainActivity&quot;</span><span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span>intent<span class="token operator">-</span>filter<span class="token operator">&gt;</span>
             <span class="token operator">&lt;</span>action android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">&quot;com.maplejaw.plugin&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
         <span class="token operator">&lt;</span><span class="token operator">/</span>intent<span class="token operator">-</span>filter<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>activity<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后在宿主APK中如下使用:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
   * 这种方式用于从已安装的apk中读取，必须要有一个activity，且需要配置ACTION
   */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">useDexClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//创建一个意图，用来找到指定的apk</span>
      <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token string">&quot;com.maplejaw.plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//获得包管理器</span>
      <span class="token class-name">PackageManager</span> pm <span class="token operator">=</span> <span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ResolveInfo</span><span class="token punctuation">&gt;</span></span> resolveinfoes <span class="token operator">=</span>  pm<span class="token punctuation">.</span><span class="token function">queryIntentActivities</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>resolveinfoes<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//获得指定的activity的信息</span>
      <span class="token class-name">ActivityInfo</span> actInfo <span class="token operator">=</span> resolveinfoes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>activityInfo<span class="token punctuation">;</span>

      <span class="token comment">//获得包名</span>
      <span class="token class-name">String</span> packageName <span class="token operator">=</span> actInfo<span class="token punctuation">.</span>packageName<span class="token punctuation">;</span>
      <span class="token comment">//获得apk的目录或者jar的目录</span>
      <span class="token class-name">String</span> apkPath <span class="token operator">=</span> actInfo<span class="token punctuation">.</span>applicationInfo<span class="token punctuation">.</span>sourceDir<span class="token punctuation">;</span>
      <span class="token comment">//dex解压后的目录,注意，这个用宿主程序的目录，android中只允许程序读取写自己</span>
      <span class="token comment">//目录下的文件</span>
      <span class="token class-name">String</span> dexOutputDir <span class="token operator">=</span> <span class="token function">getApplicationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>dataDir<span class="token punctuation">;</span>

      <span class="token comment">//native代码的目录</span>
      <span class="token class-name">String</span> libPath <span class="token operator">=</span> actInfo<span class="token punctuation">.</span>applicationInfo<span class="token punctuation">.</span>nativeLibraryDir<span class="token punctuation">;</span>

      <span class="token comment">//创建类加载器，把dex加载到虚拟机中</span>
      <span class="token class-name">DexClassLoader</span> calssLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DexClassLoader</span><span class="token punctuation">(</span>apkPath<span class="token punctuation">,</span> dexOutputDir<span class="token punctuation">,</span> libPath<span class="token punctuation">,</span>
              <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">//利用反射调用插件包内的类的方法</span>

      <span class="token keyword">try</span> <span class="token punctuation">{</span>
          <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> calssLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>packageName<span class="token operator">+</span><span class="token string">&quot;.PluginClass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token class-name">Object</span> obj <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          param<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">;</span>
          param<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">;</span>

          <span class="token class-name">Method</span> method <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;function&quot;</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token class-name">Integer</span> ret <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span>method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span><span class="token number">34</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;JG&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;返回的调用结果为:&quot;</span> <span class="token operator">+</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们安装完两个APK后，在宿主中就可以直接调用，调用示例如下。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">btnClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">useDexClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>####从apk文件中读取dex</p><p>这种方法由于并不需要安装，所以不需要通过Intent从activity中解析信息。换言之，这种方法不需要创建Activity。无需配置清单文件。我们只需要打包一个apk，然后放到SD卡中即可。 核心代码如下：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">//apk路径</span>
<span class="token class-name">String</span> path<span class="token operator">=</span><span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token function">getExternalStorageDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">&quot;/1.apk&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">useDexClassLoader</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span><span class="token punctuation">{</span>
  
    <span class="token class-name">File</span> codeDir<span class="token operator">=</span><span class="token function">getDir</span><span class="token punctuation">(</span><span class="token string">&quot;dex&quot;</span><span class="token punctuation">,</span> <span class="token class-name">Context</span><span class="token punctuation">.</span>MODE_PRIVATE<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//创建类加载器，把dex加载到虚拟机中</span>
    <span class="token class-name">DexClassLoader</span> calssLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DexClassLoader</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> codeDir<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//利用反射调用插件包内的类的方法</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> calssLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">&quot;com.maplejaw.plugin.PluginClass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Object</span> obj <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> param <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        param<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">;</span>
        param<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">;</span>

        <span class="token class-name">Method</span> method <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;function&quot;</span><span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Integer</span> ret <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span>method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">&quot;JG&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;返回的调用结果为: &quot;</span> <span class="token operator">+</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>动态加载的几个关键问题 资源访问：无法找到某某id所对应的资源 因为将apk加载到宿主程序中去执行，就无法通过宿主程序的Context去取到apk中的资源,比如图片、文本等，这是很好理解的，因为apk已经不存在上下文了，它执行时所采用的上下文是宿主程序的上下文，用别人的Context是无法得到自己的资源的； 解决方案一：插件中的资源在宿主程序中也预置一份； 缺点：增加了宿主apk的大小；在这种模式下，每次发布一个插件都需要将资源复制到宿主程序中，这意味着每发布一个插件都要更新一下宿主程序； 解决方案二：将插件中的资源解压出来，然后通过文件流去读取资源； 缺点：实际操作起来还是有很大难度的。首先不同资源有不同的文件流格式，比如图片、XML等，其次针对不同设备加载的资源可能是不一样的，如何选择合适的资源也是一个需要解决的问题； 实际解决方案： Activity中有一个叫mBase的成员变量，它的类型就是ContextImpl。注意到Context中有如下两个抽象方法，看起来是和资源有关的，实际上Context就是通过它们来获取资源的。这两个抽象方法的真正实现在ContextImpl中；</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/** Return an AssetManager instance for your application&#39;s package. */</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">AssetManager</span> <span class="token function">getAssets</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** Return a Resources instance for your application&#39;s package. */</span>
    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">Resources</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>具体实现:</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">loadResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">AssetManager</span> assetManager <span class="token operator">=</span> <span class="token class-name">AssetManager</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Method</span> addAssetPath <span class="token operator">=</span> assetManager<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">&quot;addAssetPath&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        addAssetPath<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>assetManager<span class="token punctuation">,</span> mDexPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mAssetManager <span class="token operator">=</span> assetManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Resources</span> superRes <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mResources <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Resources</span><span class="token punctuation">(</span>mAssetManager<span class="token punctuation">,</span> superRes<span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            superRes<span class="token punctuation">.</span><span class="token function">getConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mTheme <span class="token operator">=</span> mResources<span class="token punctuation">.</span><span class="token function">newTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mTheme<span class="token punctuation">.</span><span class="token function">setTo</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getTheme</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>加载资源的方法是通过反射，通过调用AssetManager中的addAssetPath方法，我们可以将一个apk中的资源加载到Resources对象中，由于addAssetPath是隐藏API我们无法直接调用，所以只能通过反射。 addAssetPath();</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@hide</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">addAssetPath</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">int</span> res <span class="token operator">=</span> <span class="token function">addAssetPathNative</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">makeStringBlocks</span><span class="token punctuation">(</span>mStringBlocks<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> res<span class="token punctuation">;</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Activity生命周期的管理： 反射方式和接口方式。 反射的方式很好理解，首先通过Java的反射去获取Activity的各种生命周期方法，比如onCreate、onStart、onResume等，然后在代理Activity中去调用插件Activity对应的生命周期方法即可； 缺点：一方面是反射代码写起来比较复杂，另一方面是过多使用反射会有一定的性能开销。</p><p>反射方式</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>

<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Method</span> onResume <span class="token operator">=</span> mActivityLifecircleMethods<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;onResume&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>onResume <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            onResume<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>mRemoteActivity<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Override</span>

<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token class-name">Method</span> onPause <span class="token operator">=</span> mActivityLifecircleMethods<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;onPause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>onPause <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            onPause<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>mRemoteActivity<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>

            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接口方式</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DLPlugin</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRestart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onActivityResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> requestCode<span class="token punctuation">,</span> <span class="token keyword">int</span> resultCode<span class="token punctuation">,</span> <span class="token class-name">Intent</span>

    data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProxy</span><span class="token punctuation">(</span><span class="token class-name">Activity</span> proxyActivity<span class="token punctuation">,</span> <span class="token class-name">String</span> dexPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onSaveInstanceState</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> outState<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onNewIntent</span><span class="token punctuation">(</span><span class="token class-name">Intent</span> intent<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onRestoreInstanceState</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onKeyUp</span><span class="token punctuation">(</span><span class="token keyword">int</span> keyCode<span class="token punctuation">,</span> <span class="token class-name">KeyEvent</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onWindowAttributesChanged</span><span class="token punctuation">(</span><span class="token class-name">LayoutParams</span> params<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onWindowFocusChanged</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> hasFocus<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onBackPressed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

…

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代理Activity中只需要按如下方式即可调用插件Activity的生命周期方法，这就完成了插件Activity的生命周期的管理;插件Activity需要实现DLPlugin接口；</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>

<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    mRemoteActivity<span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Override</span>

<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onRestart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    mRemoteActivity<span class="token punctuation">.</span><span class="token function">onRestart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onRestart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Override</span>

<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    mRemoteActivity<span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><a href="https://developer.android.com/topic/instant-apps/index.html" target="_blank" rel="noopener noreferrer">Google Instant app<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://github.com/WeMobileDev/article/blob/master/%E5%BE%AE%E4%BF%A1Android%E7%83%AD%E8%A1%A5%E4%B8%81%E5%AE%9E%E8%B7%B5%E6%BC%94%E8%BF%9B%E4%B9%8B%E8%B7%AF.md#rd" target="_blank" rel="noopener noreferrer">微信热补丁实现<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="http://my.oschina.net/853294317/blog/308583" target="_blank" rel="noopener noreferrer">多dex分拆<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzI1MTA1MzM2Nw==&amp;mid=400118620&amp;idx=1&amp;sn=b4fdd5055731290eef12ad0d17f39d4a" target="_blank" rel="noopener noreferrer">QQ空间热修复方案<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="http://my.oschina.net/853294317/blog/308583" target="_blank" rel="noopener noreferrer">Android dex分包方案<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="http://www.maplejaw.com/2016/05/24/Android%E6%8F%92%E4%BB%B6%E5%8C%96%E6%8E%A2%E7%B4%A2%EF%BC%88%E4%B8%80%EF%BC%89%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8DexClassLoader/" target="_blank" rel="noopener noreferrer">类加载器DexClassLoader<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="http://blog.csdn.net/xwl198937/article/details/49801975" target="_blank" rel="noopener noreferrer">基于cydia Hook在线热修复补丁方案<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="http://blog.csdn.net/lmj623565791/article/details/49883661" target="_blank" rel="noopener noreferrer"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="http://tech.meituan.com/mt-android-auto-split-dex.html" target="_blank" rel="noopener noreferrer"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="http://kymjs.com/column/plugin.html" target="_blank" rel="noopener noreferrer"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="http://weishu.me/" target="_blank" rel="noopener noreferrer"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="http://www.zjutkz.net/2016/05/23/%E5%BD%93%E4%BD%A0%E5%87%86%E5%A4%87%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E7%83%AD%E4%BF%AE%E5%A4%8D%E6%A1%86%E6%9E%B6%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%BD%A0%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E4%B8%80%E5%88%87/" target="_blank" rel="noopener noreferrer"><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><hr><ul><li>邮箱 ：charon.chui@gmail.com</li><li>Good Luck!</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/android-note/assets/app.89e8a229.js" defer></script>
  </body>
</html>

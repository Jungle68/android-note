<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.47">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Android Touch事件分发详解 | Android Notes</title><meta name="description" content="一个 Android 技术记录文档">
    <link rel="modulepreload" href="/android-note/assets/app.89e8a229.js"><link rel="modulepreload" href="/android-note/assets/Android Touch事件分发详解.html.b836467c.js"><link rel="modulepreload" href="/android-note/assets/Android Touch事件分发详解.html.735f795b.js"><link rel="prefetch" href="/android-note/assets/index.html.8bd0e776.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.7e59ca03.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.c477e23d.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.8ae3b627.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.d2e9fd43.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.c3aa8849.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.e39fb926.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.24d347d7.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.d974bc5d.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.e5751fb9.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.0e899c35.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.6ec105de.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.5d07c2c2.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.820183b1.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.ea867ee7.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.e0f11045.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.22b42870.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.61dfcc93.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.3cd2d991.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.ecfe19bd.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.570ee8a4.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.f8aba27b.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.1d392d64.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.9559fa68.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.ed0822f0.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.dc7889f9.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.3020c3be.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.073c39e0.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.8baf198e.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.51e0046b.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.5bd737af.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.1159aa8f.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.7c3e31b6.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.8ab8a2cc.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.e50646bb.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.f8bdc563.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.f120c888.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.1f8b3f62.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.96ecc87a.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.1b541a89.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.998dc7dc.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.0cbd4bdb.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.6cf7c851.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.d7db60a7.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.2f79a0af.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.f4db4c13.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.a286106e.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.de385267.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.b8bbd45f.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.2e8c4081.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.c39ce824.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.244019e6.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.7e587735.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.e625c50f.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.225da764.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.78211940.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.9c72d222.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.e192df98.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.9b54500d.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.f28a57f0.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.a093a882.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.2b0af47b.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.e441b7fd.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.7bc27bce.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.fbfbbb8a.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.4e2ae931.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.1319d9f7.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.e2f05584.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.9b6cca73.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.741df4a3.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.57a2cd66.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.57f05d22.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.722980d0.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.15a7fa24.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.cd786a69.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.7cd4845a.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.9db13890.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.819c1c88.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.4b8cb269.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.4ea9b161.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.844e0d9d.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.3bc9ff9e.js"><link rel="prefetch" href="/android-note/assets/病毒.html.7619f49a.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.4c49d5e1.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.2a88d555.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.8765e43b.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.cfb14486.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.fe974a62.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.00182d24.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.247dc68f.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.96572e52.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.653a3c88.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.eac67d7b.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.238e6553.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.27594cde.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.05e678bb.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.58f90a22.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.cdacbd38.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.e91c5d3e.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.fa9bacd0.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.94232b6c.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.8dbea4e8.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.20202cc3.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.40d0942f.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.2b05f9c3.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.f5b236bc.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.6952074c.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.323427b3.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.59a6c538.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.1b20bae5.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.3f8c1a56.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.fa61902d.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.b4741bb9.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.df8708de.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.0e6309ee.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.74b808b7.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.5e76b5d1.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.39b59b79.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.1041f4f4.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.4fcf5dcb.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.9a1e399b.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.52b2b04d.js"><link rel="prefetch" href="/android-note/assets/单链表.html.f419429a.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.db38b6c6.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.4e2b2a81.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.f0d24ad9.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.f7a3cc92.js"><link rel="prefetch" href="/android-note/assets/死锁.html.ec93d9d3.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.24e33318.js"><link rel="prefetch" href="/android-note/assets/算法.html.0a01e9ba.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.fbaeb1bd.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.1dff0557.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.e6733f54.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.a855a233.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.ddbbaf1e.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.8e0796a3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.18ccf0d4.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.e4c68b6e.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.afea2f74.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.e49e1c52.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.d2a307b1.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.9c599d21.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.d5da1eb6.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.80367240.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.0a73d443.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.ebaba068.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.13bba357.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.a8c42ae7.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.8f2cca4a.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.22dab991.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.7018659f.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.f551bb7a.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.4b2076fc.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.cdc3013a.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.7835fb45.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.6109676b.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.14b9a7a7.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.7d96a52b.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.6aa91caa.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.f388a863.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.489c39d7.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.d64f0a72.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.9070678b.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.572b02f6.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.5f41a7d3.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.662b2630.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.5df647ad.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.892325da.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.76d8e5df.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.389a237c.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.b5905bd6.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.afbd099f.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.d24ca0e9.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.efba877c.js"><link rel="prefetch" href="/android-note/assets/404.html.93146c89.js"><link rel="prefetch" href="/android-note/assets/index.html.a3d1ed7b.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.a64d1991.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.34218e19.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.7b54b523.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.89bd0ab9.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.103f1200.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.c8e634bf.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.7624414c.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.98a6217e.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.e0cbd1b3.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.d07ae209.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.1a7412c1.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.fae25f98.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.a45462e1.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.0e42552a.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.fac83de9.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.946e9782.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.75dd3aa7.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.b99bea93.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.024e40a5.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.17601c25.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.e4dd3dff.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.b8f61c98.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.e4a0b5c1.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.5c2a56e3.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.771b598f.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.ec948576.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.968e5163.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.b91f279b.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.e5d334b3.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.16b555ba.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.38d70312.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.630ea31f.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.6a608b01.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.c7294606.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.d153b865.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.0788dd70.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.c4f2cabf.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.4ffa43cf.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.7160a49a.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.cdc28261.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.ca3b8f37.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.04dae4e9.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.b2eee048.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.43f5056a.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.7e9d24cb.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.fe0e18e4.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.9692f10a.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.a035f300.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.daf97b10.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.4b3a8a75.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.c9b0c208.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.f56d8adb.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.27b4fbd7.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.019759be.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.c6e22d33.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.ddae6365.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.89a53b41.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.4034729a.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.213d99fd.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.4a292186.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.26281ec4.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.711522c7.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.ca454c03.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.d2d568fe.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.2b23078a.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.e59debb3.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.96161766.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.faa1301d.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.37bcd8c4.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.037d5f51.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.20dd3611.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.8477f837.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.379af02f.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.46a9b2e4.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.2d58e745.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.c608688f.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.bfa9e3d0.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.5511f591.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.6e584085.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.6b73df63.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.fbac04fc.js"><link rel="prefetch" href="/android-note/assets/病毒.html.5cd88c03.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.b01be570.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.adc8af11.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.e5536922.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.ba3817b8.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.4496e01e.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.aa990bb9.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.b42b4b49.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.02d23272.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.971b5263.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.4ef9b35f.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.02696243.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.3dae42d2.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.b7da17de.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.49e56b2a.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.51a94c44.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.793bc62a.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.d0b4194f.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.3b5da204.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.f85478dc.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.c0b33ce0.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.9cf366a8.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.2db819bd.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.0df280d7.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.b857d0ab.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.6daec307.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.21b0f237.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.69e343c0.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.164e8303.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.124cdb1e.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.facc0566.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.f48859b0.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.2c4caa9a.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.1273fefc.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.f1e06473.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.52f84c68.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.ed4970f5.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.7bc7d93a.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.9e31d408.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.84866fc9.js"><link rel="prefetch" href="/android-note/assets/单链表.html.4400da11.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.757c2b22.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.28fdc49e.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.2ee7fbf3.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.ab0fdf74.js"><link rel="prefetch" href="/android-note/assets/死锁.html.2dfc5516.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.4ca60911.js"><link rel="prefetch" href="/android-note/assets/算法.html.18c6261d.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.665d4e8a.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.9917c0f8.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.a6e27633.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.592167e3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.6f6c5af5.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.dcd32d84.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.710e4efa.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.27f8d4ad.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.20c931ca.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.038bb020.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.44688c6c.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.49e88efd.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.1d7dfe42.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.e26fe642.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.c0efdbc5.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.96bbc22f.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.a3ea4f26.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.1026b60c.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.ecb4c8c6.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.014a0e80.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.bf6c619f.js"><link rel="prefetch" href="/android-note/assets/VideoView源码分析.html.43a40b19.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.1d72231a.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.39e338b7.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.42bac657.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.7b81876b.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.d5679c84.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.bf97314b.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.28934eff.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.dc598784.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.fe77a4c4.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.86d37938.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.b0173f04.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.da0db26d.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.e8bf8449.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.ed14c462.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.18900a2a.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.8aa50d61.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.9e991b58.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.747f298d.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.4a5af4a7.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.a26fa93a.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.d4e4b484.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.f24adf9a.js"><link rel="prefetch" href="/android-note/assets/404.html.8b61bad2.js"><link rel="prefetch" href="/android-note/assets/404.e8cf6e3a.js"><link rel="prefetch" href="/android-note/assets/Layout.36051849.js">
    <link rel="stylesheet" href="/android-note/assets/style.1f7fd01d.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/android-note/" class=""><!----><span class="site-name">Android Notes</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Android Touch事件分发详解 <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="android-touch事件分发详解" tabindex="-1"><a class="header-anchor" href="#android-touch事件分发详解" aria-hidden="true">#</a> Android Touch事件分发详解</h1><p>先说一些基本的知识，方便后面分析源码时能更好理解。</p><ul><li><p>所有<code>Touch</code>事件都被封装成<code>MotionEvent</code>对象，包括<code>Touch</code>的位置、历史记录、第几个手指等.</p></li><li><p>事件类型分为<code>ACTION_DOWN</code>,<code>ACTION_UP</code>,<code>ACTION_MOVE</code>,<code>ACTION_POINTER_DOWN</code>,<code>ACTION_POINTER_UP</code>,<code>ACTION_CANCEL</code>, 每个 一个完整的事件以<code>ACTION_DOWN</code>开始<code>ACTION_UP</code>结束，并且<code>ACTION_CANCEL</code>只能由代码引起.一般对于<code>CANCEL</code>的处理和<code>UP</code>的相同。 <code>CANCEL</code>的一个简单例子：手指在移动的过程中突然移动到了边界外，那么这时<code>ACTION_UP</code>事件了，所以这是的<code>CANCEL</code>和<code>UP</code>的处理是一致的。</p></li><li><p>事件的处理分别为<code>dispatchTouchEveent()</code>分发事件(<code>TextView</code>等这种最小的<code>View</code>中不会有该方式)、<code>onInterceptTouchEvent()</code>拦截事件(<code>ViewGroup</code>中拦截事件)、<code>onTouchEvent()</code>消费事件.</p></li><li><p>事件从<code>Activity.dispatchTouchEveent()</code>开始传递，只要没有停止拦截，就会从最上层(<code>ViewGroup</code>)开始一直往下传递，子<code>View</code>通过<code>onTouchEvent()</code>消费事件。(隧道式向下分发).</p></li><li><p>如果时间从上往下一直传递到最底层的子<code>View</code>，但是该<code>View</code>没有消费该事件，那么该事件会反序网上传递(从该<code>View</code>传递给自己的<code>ViewGroup</code>，然后再传给更上层的<code>ViewGroup</code>直至传递给<code>Activity.onTouchEvent()</code>). (冒泡式向上处理).</p></li><li><p>如果<code>View</code>没有消费<code>ACTION_DOWN</code>事件，之后其他的<code>MOVE</code>、<code>UP</code>等事件都不会传递过来.</p></li><li><p>事件由父<code>View(ViewGroup)</code>传递给子<code>View</code>,<code>ViewGroup</code>可以通过<code>onInterceptTouchEvent()</code>方法对事件进行拦截，停止其往下传递，如果拦截(返回<code>true</code>)后该事件 会直接走到该<code>ViewGroup</code>中的<code>onTouchEvent()</code>中，不会再往下传递给子<code>View</code>.如果从<code>DOWN</code>开始，之后的<code>MOVE</code>、<code>UP</code>都会直接在该<code>ViewGroup.onTouchEvent()</code>中进行处理。 如果子<code>View</code>之前在处理某个事件，但是后续被<code>ViewGroup</code>拦截，那么子<code>View</code>会接收到<code>ACTION_CANCEL</code>.</p></li><li><p><code>OnTouchListener</code>优先于<code>onTouchEvent()</code>对事件进行消费。</p></li><li><p><code>TouchTarget</code>是保存手指点击区域属性的一个类，手指的所有移动过程都会被它记录下来, 包含被<code>touch</code>的<code>View</code>。</p></li></ul><p>废话不多说，直接上源码，源码妥妥的是最新版5.0： 我们先从<code>Activity.dispatchTouchEveent()</code>说起：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Called to process touch screen events.  You can override this to
 * intercept all touch screen events before they are dispatched to the
 * window.  Be sure to call this implementation for touch screen events
 * that should be handled normally.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">ev</span> The touch screen event.
 *
 * <span class="token keyword">@return</span> boolean Return true if this event was consumed.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>ev<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">onUserInteraction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">superDispatchTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码一看能感觉出来<code>DOWN</code>事件比较特殊。我们继续走到<code>onUserInteraction()</code>代码中.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Called whenever a key, touch, or trackball event is dispatched to the
 * activity.  Implement this method if you wish to know that the user has
 * interacted with the device in some way while your activity is running.
 * This callback and <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">onUserLeaveHint</span></span><span class="token punctuation">}</span> are intended to help
 * activities manage status bar notifications intelligently; specifically,
 * for helping activities determine the proper time to cancel a notfication.
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>All calls to your activity&#39;s <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">onUserLeaveHint</span></span><span class="token punctuation">}</span> callback will
 * be accompanied by calls to <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">onUserInteraction</span></span><span class="token punctuation">}</span>.  This
 * ensures that your activity will be told of relevant user activity such
 * as pulling down the notification pane and touching an item there.
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Note that this callback will be invoked for the touch down action
 * that begins a touch gesture, but may not be invoked for the touch-moved
 * and touch-up actions that follow.
 *
 * <span class="token keyword">@see</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">onUserLeaveHint</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onUserInteraction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是该方法是空方法，没有具体实现。 我们往下看<code>getWindow().superDispatchTouchEvent(ev)</code>.<br><code>getWindow()</code>获取到当前<code>Window</code>对象，表示顶层窗口，管理界面的显示和事件的响应；每个Activity 均会创建一个PhoneWindow对象， 是Activity和整个View系统交互的接口，但是该类是一个抽象类。 从文档中可以看到<code>The only existing implementation of this abstract class is android.policy.PhoneWindow, which you should instantiate when needing a Window. </code>， 所以我们找到<code>PhoneWindow</code>类，查看它的<code>superDispatchTouchEvent()</code>方法。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">superDispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> mDecor<span class="token punctuation">.</span><span class="token function">superDispatchTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>该方法又是调用了<code>mDecor.superDispatchTouchEvent(event)</code>, <code>mDecor</code>是什么呢？ 从名字中我们大概也能猜出来是当前窗口最顶层的<code>DecorView</code>， <code>Window</code>界面的最顶层的<code>View</code>对象。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// This is the top-level view of the window, containing the window decor.</span>
<span class="token keyword">private</span> <span class="token class-name">DecorView</span> mDecor<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>讲到这里不妨就提一下<code>DecorView</code>.</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">DecorView</span> <span class="token keyword">extends</span> <span class="token class-name">FrameLayout</span> <span class="token keyword">implements</span> <span class="token class-name">RootViewSurfaceTaker</span> <span class="token punctuation">{</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>它集成子<code>FrameLayout</code>所有很多时候我们在用布局工具查看的时候发现<code>Activity</code>的布局<code>FrameLayout</code>的。就是这个原因。<br> 好了，我们接着看<code>DecorView</code>中的<code>superDispatchTouchEvent()</code>方法。</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">superDispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>是调用了<code>super.dispatchTouchEveent()</code>，而<code>DecorView</code>的父类是<code>FrameLayout</code>所以我们找到<code>FrameLayout.dispatchTouchEveent()</code>. 我们看到<code>FrameLayout</code>中没有重写<code>dispatchTouchEveent()</code>方法，所以我们再找到<code>FrameLayout</code>的父类<code>ViewGroup</code>.看<code>ViewGroup.dispatchTouchEveent()</code>实现。 新大陆浮现了...</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * <span class="token punctuation">{</span><span class="token keyword">@inheritDoc</span><span class="token punctuation">}</span>
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token comment">// Consistency verifier for debugging purposes.是调试使用的，我们不用管这里了。</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mInputEventConsistencyVerifier <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mInputEventConsistencyVerifier<span class="token punctuation">.</span><span class="token function">onTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">boolean</span> handled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token comment">// onFilterTouchEventForSecurity()用安全机制来过滤触摸事件，true为不过滤分发下去，false则销毁掉该事件。</span>
	<span class="token comment">// 方法具体实现是去判断是否被其它窗口遮挡住了，如果遮挡住就要过滤掉该事件。</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">onFilterTouchEventForSecurity</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 没有被其它窗口遮住</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> action <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> actionMasked <span class="token operator">=</span> action <span class="token operator">&amp;</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_MASK<span class="token punctuation">;</span>

		<span class="token comment">// 下面这一块注释说的很清楚了，就是在`Down`的时候把所有的状态都重置，作为一个新事件的开始。</span>
		<span class="token comment">// Handle an initial down.</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// Throw away all previous state when starting a new touch gesture.</span>
			<span class="token comment">// The framework may have dropped the up or cancel event for the previous gesture</span>
			<span class="token comment">// due to an app switch, ANR, or some other state change.</span>
			<span class="token function">cancelAndClearTouchTargets</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">resetTouchState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 如果是`Down`，那么`mFirstTouchTarget`到这里肯定是`null`.因为是新一系列手势的开始。</span>
			<span class="token comment">// `mFirstTouchTarget`是处理第一个事件的目标。</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 检查是否拦截该事件(如果`onInterceptTouchEvent()`返回true就拦截该事件)</span>
		<span class="token comment">// Check for interception.</span>
		<span class="token keyword">final</span> <span class="token keyword">boolean</span> intercepted<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN
				<span class="token operator">||</span> mFirstTouchTarget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 标记事件不允许被拦截， 默认是`false`， 该值可以通过`requestDisallowInterceptTouchEvent(true)`方法来设置，</span>
			<span class="token comment">// 通知父`View`不要拦截该`View`上的事件。</span>
			<span class="token keyword">final</span> <span class="token keyword">boolean</span> disallowIntercept <span class="token operator">=</span> <span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> FLAG_DISALLOW_INTERCEPT<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>disallowIntercept<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// 判断该`ViewGroup`是否要拦截该事件。`onInterceptTouchEvent()`方法默认返回`false`即不拦截。</span>
				intercepted <span class="token operator">=</span> <span class="token function">onInterceptTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">;</span>
				ev<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// restore action in case it was changed</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token comment">// 子`View`通知父`View`不要拦截。这样就不会走到上面`onInterceptTouchEvent()`方法中了，</span>
				<span class="token comment">// 所以父`View`就不会拦截该事件。</span>
				intercepted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment">// 注释比较清楚了，就是没有目标来处理该事件，而且也不是一个新的事件`Down`事件(新事件的开始), </span>
			<span class="token comment">// 我们应该拦截下他。</span>
			<span class="token comment">// There are no touch targets and this action is not an initial down</span>
			<span class="token comment">// so this view group continues to intercept touches.</span>
			intercepted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Check for cancelation.检查当前是否是`Cancel`事件或者是有`Cancel`标记。</span>
		<span class="token keyword">final</span> <span class="token keyword">boolean</span> canceled <span class="token operator">=</span> <span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
				<span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_CANCEL<span class="token punctuation">;</span>

		<span class="token comment">// Update list of touch targets for pointer down, if needed. 这行代码为是否需要将当前的触摸事件分发给多个子`View`，</span>
		<span class="token comment">// 默认为`true`，分发给多个`View`（比如几个子`View`位置重叠）。默认是true</span>
		<span class="token keyword">final</span> <span class="token keyword">boolean</span> split <span class="token operator">=</span> <span class="token punctuation">(</span>mGroupFlags <span class="token operator">&amp;</span> FLAG_SPLIT_MOTION_EVENTS<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 保存当前要分发给的目标</span>
		<span class="token class-name">TouchTarget</span> newTouchTarget <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token keyword">boolean</span> alreadyDispatchedToNewTouchTarget <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 如果没取消也不拦截，进入方法内部</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>canceled <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>intercepted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		
			<span class="token comment">// 下面这部分代码的意思其实就是找到该事件位置下的`View`(可见或者是在动画中的View), 并且与`pointID`关联。</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN
					<span class="token operator">||</span> <span class="token punctuation">(</span>split <span class="token operator">&amp;&amp;</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_POINTER_DOWN<span class="token punctuation">)</span>
					<span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_HOVER_MOVE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">final</span> <span class="token keyword">int</span> actionIndex <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getActionIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// always 0 for down</span>
				<span class="token keyword">final</span> <span class="token keyword">int</span> idBitsToAssign <span class="token operator">=</span> split <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> ev<span class="token punctuation">.</span><span class="token function">getPointerId</span><span class="token punctuation">(</span>actionIndex<span class="token punctuation">)</span>
						<span class="token operator">:</span> <span class="token class-name">TouchTarget</span><span class="token punctuation">.</span>ALL_POINTER_IDS<span class="token punctuation">;</span>

				<span class="token comment">// Clean up earlier touch targets for this pointer id in case they</span>
				<span class="token comment">// have become out of sync.</span>
				<span class="token function">removePointersFromTouchTargets</span><span class="token punctuation">(</span>idBitsToAssign<span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token keyword">final</span> <span class="token keyword">int</span> childrenCount <span class="token operator">=</span> mChildrenCount<span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>newTouchTarget <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> childrenCount <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">final</span> <span class="token keyword">float</span> x <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span>actionIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">final</span> <span class="token keyword">float</span> y <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span>actionIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// Find a child that can receive the event.</span>
					<span class="token comment">// Scan children from front to back.</span>
					<span class="token keyword">final</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">View</span><span class="token punctuation">&gt;</span></span> preorderedList <span class="token operator">=</span> <span class="token function">buildOrderedChildList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">final</span> <span class="token keyword">boolean</span> customOrder <span class="token operator">=</span> preorderedList <span class="token operator">==</span> <span class="token keyword">null</span>
							<span class="token operator">&amp;&amp;</span> <span class="token function">isChildrenDrawingOrderEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// 遍历找子`View`进行分发了。</span>
					<span class="token keyword">final</span> <span class="token class-name">View</span><span class="token punctuation">[</span><span class="token punctuation">]</span> children <span class="token operator">=</span> mChildren<span class="token punctuation">;</span>
					<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> childrenCount <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">final</span> <span class="token keyword">int</span> childIndex <span class="token operator">=</span> customOrder
								<span class="token operator">?</span> <span class="token function">getChildDrawingOrder</span><span class="token punctuation">(</span>childrenCount<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">:</span> i<span class="token punctuation">;</span>
						<span class="token keyword">final</span> <span class="token class-name">View</span> child <span class="token operator">=</span> <span class="token punctuation">(</span>preorderedList <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
								<span class="token operator">?</span> children<span class="token punctuation">[</span>childIndex<span class="token punctuation">]</span> <span class="token operator">:</span> preorderedList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>childIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
								
						<span class="token comment">// `canViewReceivePointerEvents()`方法会去判断这个`View`是否可见或者在播放动画，</span>
						<span class="token comment">// 只有这两种情况下可以接受事件的分发</span>
						
						<span class="token comment">// `isTransformedTouchPointInView`判断这个事件的坐标值是否在该`View`内。</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">canViewReceivePointerEvents</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
								<span class="token operator">||</span> <span class="token operator">!</span><span class="token function">isTransformedTouchPointInView</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> child<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token keyword">continue</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>

						<span class="token comment">// 找到该`View`对应的在`mFristTouchTarget`中的存储的目标， 判断这个`View`可能已经不是之前`mFristTouchTarget`中的`View`了。</span>
						<span class="token comment">// 如果找不到就返回null, 这种情况是用于多点触摸， 比如在同一个`View`上按下了多跟手指。</span>
						newTouchTarget <span class="token operator">=</span> <span class="token function">getTouchTarget</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>newTouchTarget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token comment">// Child View已经接受了这个事件了</span>
							<span class="token comment">// Child is already receiving touch within its bounds.</span>
							<span class="token comment">// Give it the new pointer in addition to the ones it is handling.</span>
							newTouchTarget<span class="token punctuation">.</span>pointerIdBits <span class="token operator">|=</span> idBitsToAssign<span class="token punctuation">;</span>
							<span class="token comment">// 找到该View了，不用再循环找了</span>
							<span class="token keyword">break</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>

						<span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token comment">// 如果上面没有break，只有newTouchTarget为null，说明上面我们找到的Child View和之前的肯定不是同一个了， </span>
						<span class="token comment">// 是新增的， 比如多点触摸的时候，一个手指按在了这个`View`上，另一个手指按在了另一个`View`上。</span>
						<span class="token comment">// 这时候我们就看child是否分发该事件。dispatchTransformedTouchEvent如果child为null，就直接该ViewGroup出来事件</span>
						<span class="token comment">// 如果child不为null，就调用child.dispatchTouchEvent</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dispatchTransformedTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> child<span class="token punctuation">,</span> idBitsToAssign<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token comment">// 如果这个Child View能分发，那我们就要把之前存储的值改变成现在的Child View。</span>
							<span class="token comment">// Child wants to receive touch within its bounds.</span>
							mLastTouchDownTime <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getDownTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>preorderedList <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								<span class="token comment">// childIndex points into presorted list, find original index</span>
								<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> childrenCount<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
									<span class="token keyword">if</span> <span class="token punctuation">(</span>children<span class="token punctuation">[</span>childIndex<span class="token punctuation">]</span> <span class="token operator">==</span> mChildren<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
										mLastTouchDownIndex <span class="token operator">=</span> j<span class="token punctuation">;</span>
										<span class="token keyword">break</span><span class="token punctuation">;</span>
									<span class="token punctuation">}</span>
								<span class="token punctuation">}</span>
							<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
								mLastTouchDownIndex <span class="token operator">=</span> childIndex<span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
							mLastTouchDownX <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							mLastTouchDownY <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// 赋值成现在的Child View对应的值，并且会把`mFirstTouchTarget`也改成该值(mFristTouchTarget`与`newTouchTarget`是一样的)。</span>
							newTouchTarget <span class="token operator">=</span> <span class="token function">addTouchTarget</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> idBitsToAssign<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token comment">// 分发给子`View`了，不用再继续循环了</span>
							alreadyDispatchedToNewTouchTarget <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
							<span class="token keyword">break</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>preorderedList <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> preorderedList<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				<span class="token comment">// `newTouchTarget == null`就是没有找到新的可以分发该事件的子`View`，那我们只能用上一次的分发对象了。</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>newTouchTarget <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mFirstTouchTarget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// Did not find a child to receive the event.</span>
					<span class="token comment">// Assign the pointer to the least recently added target.</span>
					newTouchTarget <span class="token operator">=</span> mFirstTouchTarget<span class="token punctuation">;</span>
					<span class="token keyword">while</span> <span class="token punctuation">(</span>newTouchTarget<span class="token punctuation">.</span>next <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						newTouchTarget <span class="token operator">=</span> newTouchTarget<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					newTouchTarget<span class="token punctuation">.</span>pointerIdBits <span class="token operator">|=</span> idBitsToAssign<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// DOWN事件在上面会去找touch target</span>
		<span class="token comment">// Dispatch to touch targets.</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mFirstTouchTarget <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// dispatchTransformedTouchEvent方法中如果child为null，那么就调用super.dispatchTouchEvent(transformedEvent);否则调用child.dispatchTouchEvent(transformedEvent)。</span>
			<span class="token comment">// `super.dispatchTouchEvent()`也就是说，此时`Viewgroup`处理`touch`消息跟普通`view`一致。普通`View`类内部会调用`onTouchEvent()`方法</span>
			<span class="token comment">// No touch targets so treat this as an ordinary view. 自己处理</span>
			handled <span class="token operator">=</span> <span class="token function">dispatchTransformedTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span> canceled<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
					<span class="token class-name">TouchTarget</span><span class="token punctuation">.</span>ALL_POINTER_IDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment">// 分发</span>
			<span class="token comment">// Dispatch to touch targets, excluding the new touch target if we already</span>
			<span class="token comment">// dispatched to it.  Cancel touch targets if necessary.</span>
			<span class="token class-name">TouchTarget</span> predecessor <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
			<span class="token class-name">TouchTarget</span> target <span class="token operator">=</span> mFirstTouchTarget<span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>target <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token keyword">final</span> <span class="token class-name">TouchTarget</span> next <span class="token operator">=</span> target<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
				<span class="token comment">// 找到了新的子`View`，并且这个是新加的对象，上面已经处理过了。</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>alreadyDispatchedToNewTouchTarget <span class="token operator">&amp;&amp;</span> target <span class="token operator">==</span> newTouchTarget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					handled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
					<span class="token comment">// 否则都调用dispatchTransformedTouchEvent处理，传递给child</span>
					<span class="token keyword">final</span> <span class="token keyword">boolean</span> cancelChild <span class="token operator">=</span> <span class="token function">resetCancelNextUpFlag</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span>child<span class="token punctuation">)</span>
							<span class="token operator">||</span> intercepted<span class="token punctuation">;</span>
							
					<span class="token comment">// 正常分发</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dispatchTransformedTouchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span> cancelChild<span class="token punctuation">,</span>
							target<span class="token punctuation">.</span>child<span class="token punctuation">,</span> target<span class="token punctuation">.</span>pointerIdBits<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						handled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					
					<span class="token comment">// 如果是onInterceptTouchEvent返回true就会遍历mFirstTouchTarget全部给销毁，这就是为什么onInterceptTouchEvent返回true，之后所有的时间都不会再继续分发的了。</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>cancelChild<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>predecessor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
							mFirstTouchTarget <span class="token operator">=</span> next<span class="token punctuation">;</span>
						<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
							predecessor<span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						target<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						target <span class="token operator">=</span> next<span class="token punctuation">;</span>
						<span class="token keyword">continue</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				predecessor <span class="token operator">=</span> target<span class="token punctuation">;</span>
				target <span class="token operator">=</span> next<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// Update list of touch targets for pointer up or cancel, if needed.</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>canceled
				<span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_UP
				<span class="token operator">||</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_HOVER_MOVE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">resetTouchState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>split <span class="token operator">&amp;&amp;</span> actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_POINTER_UP<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 当某个手指抬起的时候，清除他相关的数据。</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> actionIndex <span class="token operator">=</span> ev<span class="token punctuation">.</span><span class="token function">getActionIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">final</span> <span class="token keyword">int</span> idBitsToRemove <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> ev<span class="token punctuation">.</span><span class="token function">getPointerId</span><span class="token punctuation">(</span>actionIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">removePointersFromTouchTargets</span><span class="token punctuation">(</span>idBitsToRemove<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>handled <span class="token operator">&amp;&amp;</span> mInputEventConsistencyVerifier <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mInputEventConsistencyVerifier<span class="token punctuation">.</span><span class="token function">onUnhandledEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> handled<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来还要说说<code>dispatchTransformedTouchEvent()</code>方法，虽然上面也说了大体功能，但是看一下源码能说明另一个问题：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Transforms a motion event into the coordinate space of a particular child view,
 * filters out irrelevant pointer ids, and overrides its action if necessary.
 * If child is null, assumes the MotionEvent will be sent to this ViewGroup instead.
 */</span>
<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTransformedTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">,</span> <span class="token keyword">boolean</span> cancel<span class="token punctuation">,</span>
		<span class="token class-name">View</span> child<span class="token punctuation">,</span> <span class="token keyword">int</span> desiredPointerIdBits<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">final</span> <span class="token keyword">boolean</span> handled<span class="token punctuation">;</span>

	<span class="token comment">// Canceling motions is a special case.  We don&#39;t need to perform any transformations</span>
	<span class="token comment">// or filtering.  The important part is the action, not the contents.</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> oldAction <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 这就是为什么时间被拦截之后，之前处理过该事件的`View`会收到`CANCEL`.</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>cancel <span class="token operator">||</span> oldAction <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_CANCEL<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		event<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_CANCEL<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			handled <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment">// 子`View`去处理，如果子`View`仍然是`ViewGroup`那还是同样的处理，如果子`View`是普通`View`，普通`View`的`dispatchTouchEveent()`会调用`onTouchEvent()`.</span>
			handled <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		event<span class="token punctuation">.</span><span class="token function">setAction</span><span class="token punctuation">(</span>oldAction<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> handled<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Calculate the number of pointers to deliver.</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> oldPointerIdBits <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getPointerIdBits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> newPointerIdBits <span class="token operator">=</span> oldPointerIdBits <span class="token operator">&amp;</span> desiredPointerIdBits<span class="token punctuation">;</span>

	<span class="token comment">// If for some reason we ended up in an inconsistent state where it looks like we</span>
	<span class="token comment">// might produce a motion event with no pointers in it, then drop the event.</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>newPointerIdBits <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// If the number of pointers is the same and we don&#39;t need to perform any fancy</span>
	<span class="token comment">// irreversible transformations, then we can reuse the motion event for this</span>
	<span class="token comment">// dispatch as long as we are careful to revert any changes we make.</span>
	<span class="token comment">// Otherwise we need to make a copy.</span>
	<span class="token keyword">final</span> <span class="token class-name">MotionEvent</span> transformedEvent<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>newPointerIdBits <span class="token operator">==</span> oldPointerIdBits<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> child<span class="token punctuation">.</span><span class="token function">hasIdentityMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				handled <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token keyword">final</span> <span class="token keyword">float</span> offsetX <span class="token operator">=</span> mScrollX <span class="token operator">-</span> child<span class="token punctuation">.</span>mLeft<span class="token punctuation">;</span>
				<span class="token keyword">final</span> <span class="token keyword">float</span> offsetY <span class="token operator">=</span> mScrollY <span class="token operator">-</span> child<span class="token punctuation">.</span>mTop<span class="token punctuation">;</span>
				event<span class="token punctuation">.</span><span class="token function">offsetLocation</span><span class="token punctuation">(</span>offsetX<span class="token punctuation">,</span> offsetY<span class="token punctuation">)</span><span class="token punctuation">;</span>

				handled <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>

				event<span class="token punctuation">.</span><span class="token function">offsetLocation</span><span class="token punctuation">(</span><span class="token operator">-</span>offsetX<span class="token punctuation">,</span> <span class="token operator">-</span>offsetY<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> handled<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		transformedEvent <span class="token operator">=</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span><span class="token function">obtain</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		transformedEvent <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span>newPointerIdBits<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Perform any necessary transformations and dispatch.</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>child <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		handled <span class="token operator">=</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span>transformedEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">final</span> <span class="token keyword">float</span> offsetX <span class="token operator">=</span> mScrollX <span class="token operator">-</span> child<span class="token punctuation">.</span>mLeft<span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token keyword">float</span> offsetY <span class="token operator">=</span> mScrollY <span class="token operator">-</span> child<span class="token punctuation">.</span>mTop<span class="token punctuation">;</span>
		transformedEvent<span class="token punctuation">.</span><span class="token function">offsetLocation</span><span class="token punctuation">(</span>offsetX<span class="token punctuation">,</span> offsetY<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> child<span class="token punctuation">.</span><span class="token function">hasIdentityMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			transformedEvent<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>child<span class="token punctuation">.</span><span class="token function">getInverseMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		handled <span class="token operator">=</span> child<span class="token punctuation">.</span><span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span>transformedEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Done.</span>
	transformedEvent<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> handled<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面讲了<code>ViewGroup</code>的<code>dispatchTouchEveent()</code>有些地方会调用<code>super.dispatchTouchEveent()</code>，而<code>ViewGroup</code>的父类就是<code>View</code>，接下来我们看一下<code>View.dispatchTouchEveent()</code>方法：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Pass the touch screen motion event down to the target view, or this
 * view if it is the target.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">event</span> The motion event to be dispatched.
 * <span class="token keyword">@return</span> True if the event was handled by the view, false otherwise.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">boolean</span> result <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token comment">// 调试用</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mInputEventConsistencyVerifier <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mInputEventConsistencyVerifier<span class="token punctuation">.</span><span class="token function">onTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">final</span> <span class="token keyword">int</span> actionMasked <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getActionMasked</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// Defensive cleanup for new gesture</span>
		<span class="token function">stopNestedScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 判断该`View`是否被其它`View`遮盖住。</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">onFilterTouchEventForSecurity</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//noinspection SimplifiableIfStatement</span>
		<span class="token class-name">ListenerInfo</span> li <span class="token operator">=</span> mListenerInfo<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>li <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> li<span class="token punctuation">.</span>mOnTouchListener <span class="token operator">!=</span> <span class="token keyword">null</span>
				<span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>mViewFlags <span class="token operator">&amp;</span> ENABLED_MASK<span class="token punctuation">)</span> <span class="token operator">==</span> ENABLED
				<span class="token operator">&amp;&amp;</span> li<span class="token punctuation">.</span>mOnTouchListener<span class="token punctuation">.</span><span class="token function">onTouch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 先执行`listener`.</span>
			result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result <span class="token operator">&amp;&amp;</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// 执行`onTouchEvent()`.</span>
			result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>result <span class="token operator">&amp;&amp;</span> mInputEventConsistencyVerifier <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mInputEventConsistencyVerifier<span class="token punctuation">.</span><span class="token function">onUnhandledEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// Clean up after nested scrolls if this is the end of a gesture;</span>
	<span class="token comment">// also cancel it if we tried an ACTION_DOWN but we didn&#39;t want the rest</span>
	<span class="token comment">// of the gesture.</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_UP <span class="token operator">||</span>
			actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_CANCEL <span class="token operator">||</span>
			<span class="token punctuation">(</span>actionMasked <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">stopNestedScroll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过上面的分析我们看到<code>View.dispatchTouchEvent()</code>里面会调用到<code>onTouchEvent()</code>来消耗事件。那么<code>onTouchEvent()</code>是如何处理的呢？下面我们看一下 <code>View.onTouchEvent()</code>源码：</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Implement this method to handle touch screen motion events.
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 * If this method is used to detect click actions, it is recommended that
 * the actions be performed by implementing and calling
 * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">performClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span>. This will ensure consistent system behavior,
 * including:
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>obeying click sound preferences
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>dispatching OnClickListener calls
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>handling <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">AccessibilityNodeInfo</span><span class="token punctuation">#</span><span class="token field">ACTION_CLICK</span></span> ACTION_CLICK<span class="token punctuation">}</span> when
 * accessibility features are enabled
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token keyword">@param</span> <span class="token parameter">event</span> The motion event.
 * <span class="token keyword">@return</span> True if the event was handled, false otherwise.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">final</span> <span class="token keyword">float</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">float</span> y <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token keyword">int</span> viewFlags <span class="token operator">=</span> mViewFlags<span class="token punctuation">;</span>

	<span class="token comment">// 对disable按钮的处理，注释说的比较明白，一个disable但是clickable的view仍然会消耗事件,只是不响应而已。</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>viewFlags <span class="token operator">&amp;</span> ENABLED_MASK<span class="token punctuation">)</span> <span class="token operator">==</span> DISABLED<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_UP <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>mPrivateFlags <span class="token operator">&amp;</span> PFLAG_PRESSED<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// A disabled view that is clickable still consumes the touch</span>
		<span class="token comment">// events, it just doesn&#39;t respond to them.</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>viewFlags <span class="token operator">&amp;</span> CLICKABLE<span class="token punctuation">)</span> <span class="token operator">==</span> CLICKABLE <span class="token operator">||</span>
				<span class="token punctuation">(</span>viewFlags <span class="token operator">&amp;</span> LONG_CLICKABLE<span class="token punctuation">)</span> <span class="token operator">==</span> LONG_CLICKABLE<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 关于TouchDelegate,文档中是这样说的The delegate to handle touch events that are physically in this view</span>
    <span class="token comment">// but should be handled by another view. 就是说如果两个View, View2在View1中，View1比较大，如果我们想点击</span>
	<span class="token comment">// View1的时候，让View2去响应点击事件，这时候就需要使用TouchDelegate来设置。</span>
	<span class="token comment">// 简单的理解就是如果这个View有自己的时间委托处理人，就交给委托人处理。</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mTouchDelegate <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mTouchDelegate<span class="token punctuation">.</span><span class="token function">onTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>viewFlags <span class="token operator">&amp;</span> CLICKABLE<span class="token punctuation">)</span> <span class="token operator">==</span> CLICKABLE <span class="token operator">||</span>
			<span class="token punctuation">(</span>viewFlags <span class="token operator">&amp;</span> LONG_CLICKABLE<span class="token punctuation">)</span> <span class="token operator">==</span> LONG_CLICKABLE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 这个View可点击</span>
		<span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_UP<span class="token operator">:</span>
			    <span class="token comment">// 最好先看DOWN后再看MOVE最后看UP。</span>
				<span class="token comment">// PFLAG_PREPRESSED 表示在一个可滚动的容器中,要稍后才能确定是按下还是滚动.</span>
                <span class="token comment">// PFLAG_PRESSED 表示不是在一个可滚动的容器中,已经可以确定按下这一操作.</span>
				<span class="token keyword">boolean</span> prepressed <span class="token operator">=</span> <span class="token punctuation">(</span>mPrivateFlags <span class="token operator">&amp;</span> PFLAG_PREPRESSED<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mPrivateFlags <span class="token operator">&amp;</span> PFLAG_PRESSED<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">||</span> prepressed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token comment">// 处理点击或长按事件</span>
					<span class="token comment">// take focus if we don&#39;t have it already and we should in</span>
					<span class="token comment">// touch mode.</span>
					<span class="token keyword">boolean</span> focusTaken <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isFocusable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isFocusableInTouchMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isFocused</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
						<span class="token comment">// 如果现在还没获取到焦点，就再获取一次焦点</span>
						focusTaken <span class="token operator">=</span> <span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token comment">// 在前面`DOWN`事件的时候会延迟显示`View`的`pressed`状态,用户可能在我们还没有显示按下状态效果时就不按了.我们还是得在进行实际的点击操作时,让用户看到效果。</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>prepressed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token comment">// The button is being released before we actually</span>
						<span class="token comment">// showed it as pressed.  Make it show the pressed</span>
						<span class="token comment">// state now (before scheduling the click) to ensure</span>
						<span class="token comment">// the user sees it.</span>
						<span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
				   <span class="token punctuation">}</span>
					
					
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mHasPerformedLongPress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token comment">// 判断不是长按</span>
						
						<span class="token comment">// This is a tap, so remove the longpress check</span>
						<span class="token function">removeLongPressCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

						<span class="token comment">// Only perform take click actions if we were in the pressed state</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>focusTaken<span class="token punctuation">)</span> <span class="token punctuation">{</span>
							<span class="token comment">// Use a Runnable and post this rather than calling</span>
							<span class="token comment">// performClick directly. This lets other visual state</span>
							<span class="token comment">// of the view update before click actions start.</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span>mPerformClick <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								mPerformClick <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PerformClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
							<span class="token comment">// PerformClick就是个Runnable,里面执行performClick()方法。performClick()方法中怎么执行呢？我们在后面再说。</span>
							<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">post</span><span class="token punctuation">(</span>mPerformClick<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
								<span class="token function">performClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>

					<span class="token keyword">if</span> <span class="token punctuation">(</span>mUnsetPressedState <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						mUnsetPressedState <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UnsetPressedState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token comment">// 取消按下状态，UnsetPressedState也是个Runnable,里面执行setPressed(false)</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>prepressed<span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token function">postDelayed</span><span class="token punctuation">(</span>mUnsetPressedState<span class="token punctuation">,</span>
								<span class="token class-name">ViewConfiguration</span><span class="token punctuation">.</span><span class="token function">getPressedStateDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">post</span><span class="token punctuation">(</span>mUnsetPressedState<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token comment">// If the post failed, unpress right now</span>
						mUnsetPressedState<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>

					<span class="token function">removeTapCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>

			<span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN<span class="token operator">:</span>
				mHasPerformedLongPress <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
				<span class="token comment">// performButtonActionOnTouchDown()处理鼠标右键菜单，有些View显示右键菜单就直接弹菜单.一般设备用不到鼠标，所以返回false。</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">performButtonActionOnTouchDown</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				<span class="token comment">// Walk up the hierarchy to determine if we&#39;re inside a scrolling container.</span>
				<span class="token keyword">boolean</span> isInScrollingContainer <span class="token operator">=</span> <span class="token function">isInScrollingContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token comment">// For views inside a scrolling container, delay the pressed feedback for</span>
				<span class="token comment">// a short period in case this is a scroll.</span>
				<span class="token comment">// 就是遍历下View层级，判断这个View是不是在一个能scroll的View中。</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>isInScrollingContainer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				    <span class="token comment">// 因为用户可能是点击或者是滚动，所以我们不能立马判断，先给用户设置一个要点击的事件。</span>
					mPrivateFlags <span class="token operator">|=</span> PFLAG_PREPRESSED<span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>mPendingCheckForTap <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						mPendingCheckForTap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CheckForTap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					mPendingCheckForTap<span class="token punctuation">.</span>x <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					mPendingCheckForTap<span class="token punctuation">.</span>y <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// 发送一个延时的操作，用于判断用户到底是点击还是滚动。其实就是在tapTimeout中如果用户没有滚动，那就是点击了。</span>
					<span class="token function">postDelayed</span><span class="token punctuation">(</span>mPendingCheckForTap<span class="token punctuation">,</span> <span class="token class-name">ViewConfiguration</span><span class="token punctuation">.</span><span class="token function">getTapTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				    <span class="token comment">// 设置成点击状态</span>
					<span class="token comment">// Not inside a scrolling container, so show the feedback right away</span>
					<span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// 检查是否是长按，就是过一段时间后如果还在按住，那就是长按了。长按的时间是ViewConfiguration.getLongPressTimeout()</span>
					<span class="token comment">// 也就是500毫秒</span>
					<span class="token function">checkForLongClick</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>

			<span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_CANCEL<span class="token operator">:</span>
				<span class="token comment">// 取消按下状态，移动点击消息，移动长按消息。</span>
				<span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">removeTapCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">removeLongPressCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>

			<span class="token keyword">case</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_MOVE<span class="token operator">:</span>
				<span class="token function">drawableHotspotChanged</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
				
				<span class="token comment">// Be lenient about moving outside of buttons， 检查是否移动到View外面了。</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">pointInView</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> mTouchSlop<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				    <span class="token comment">// 移动到区域外面去了，就要取消点击。</span>
					<span class="token comment">// Outside button</span>
					<span class="token function">removeTapCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mPrivateFlags <span class="token operator">&amp;</span> PFLAG_PRESSED<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						<span class="token comment">// Remove any future long press/tap checks</span>
						<span class="token function">removeLongPressCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

						<span class="token function">setPressed</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面讲了<code>Touch</code>事件的分发和处理，随便说一下点击事件:<br> 我们平时使用的时候都知道给<code>View</code>设置点击事件是<code>setOnClickListener()</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Register a callback to be invoked when this view is clicked. If this view is not
 * clickable, it becomes clickable.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">l</span> The callback that will run
 *
 * <span class="token keyword">@see</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">setClickable</span><span class="token punctuation">(</span><span class="token keyword">boolean</span><span class="token punctuation">)</span></span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token class-name">OnClickListener</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isClickable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">setClickable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// `getListenerInfo()`就是判断成员变量`mListenerInfo`是否是null，不是就返回，是的话就初始化一个。</span>
	<span class="token function">getListenerInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mOnClickListener <span class="token operator">=</span> l<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>那什么地方会调用<code>mListenerInfo.mOnClickListener</code>呢？</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Call this view&#39;s OnClickListener, if it is defined.  Performs all normal
 * actions associated with clicking: reporting accessibility event, playing
 * a sound, etc.
 *
 * <span class="token keyword">@return</span> True there was an assigned OnClickListener that was called, false
 *         otherwise is returned.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">performClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">final</span> <span class="token keyword">boolean</span> result<span class="token punctuation">;</span>
	<span class="token keyword">final</span> <span class="token class-name">ListenerInfo</span> li <span class="token operator">=</span> mListenerInfo<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>li <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> li<span class="token punctuation">.</span>mOnClickListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">playSoundEffect</span><span class="token punctuation">(</span><span class="token class-name">SoundEffectConstants</span><span class="token punctuation">.</span>CLICK<span class="token punctuation">)</span><span class="token punctuation">;</span>
		li<span class="token punctuation">.</span>mOnClickListener<span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		result <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		result <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">sendAccessibilityEvent</span><span class="token punctuation">(</span><span class="token class-name">AccessibilityEvent</span><span class="token punctuation">.</span>TYPE_VIEW_CLICKED<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>讲到这里就明白了。<code>onTouchEvent()</code>中的<code>ACTION_UP</code>中会调用<code>performClick()</code>方法。</p><p>到这里，就全部分析完了，这一块还是比较麻烦的，中间查了很多资料，有些地方自己可能也理解的不太对，如果有哪里理解的不对的地方，还请大家指出来。谢谢。</p><hr><ul><li>邮箱 ：charon.chui@gmail.com</li><li>Good Luck!</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/android-note/assets/app.89e8a229.js" defer></script>
  </body>
</html>

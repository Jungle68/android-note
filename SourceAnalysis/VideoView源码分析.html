<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.47">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>VideoView源码分析 | Android Notes</title><meta name="description" content="一个 Android 技术记录文档">
    <link rel="modulepreload" href="/android-note/assets/app.e2a3b496.js"><link rel="modulepreload" href="/android-note/assets/VideoView源码分析.html.8e6935a4.js"><link rel="modulepreload" href="/android-note/assets/VideoView源码分析.html.45a2578f.js"><link rel="prefetch" href="/android-note/assets/index.html.fff2aa76.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.261ddca4.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.518850bc.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.d9910bec.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.dff63630.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.f29a403a.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.dc69d7fd.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.7be45349.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.d78f651d.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.a07e9d8a.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.75fdf471.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.7e81f1f2.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.103e5176.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.6e607fde.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.29df35d8.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.6014594b.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.2a53d290.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.d19ee784.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.43ec2966.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.0afb9bec.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.7b3bfc5f.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.b99bf27c.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.c8895c23.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.3fdb02c5.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.f0becde3.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.8ca1aed1.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.eb73aa59.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.6799221d.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.9f737361.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.eab7452f.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.82e665f3.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.659d7444.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.26e47455.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.cbf93a65.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.7c42765a.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.696ea85d.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.ae3ef80a.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.186ba84a.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.0a30a4bc.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.161eb2a1.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.42e7fa9a.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.02a55fca.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.025745a3.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.9e95d7d7.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.1d87d268.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.3e311c7b.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.1396114e.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.0b924706.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.1b6d020f.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.da94471c.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.4322b77a.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.a580533a.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.0d501025.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.c374045d.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.3691aec0.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.c2883070.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.bb92c86c.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.05a63ed7.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.3f42e962.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.3d385a0b.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.0b6f4401.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.f2310aae.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.6a7abbed.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.8dd2e53f.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.bf36afb3.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.99106e24.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.1f642fe4.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.75bf928e.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.e4ee636e.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.7bfa0f27.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.3cd85193.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.4653eac1.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.5baf68fb.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.67f51c74.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.46b3e9fe.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.072d0f77.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.64e84f7f.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.6aca8bc8.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.e628cefe.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.d5eb1b47.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.e063f731.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.d48d5aed.js"><link rel="prefetch" href="/android-note/assets/病毒.html.5c217cee.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.31f82ea1.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.ffc29463.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.fb6b9fb3.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.b0ad1ca1.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.24e72ac9.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.396f8926.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.6e7387ea.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.48ca2361.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.92583f07.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.b42b2b32.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.9735c882.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.b7572111.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.6aeb286a.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.4be18e44.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.1b6d8302.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.7072c065.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.28e1d009.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.562e3ff3.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.adf99661.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.701b6583.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.8e9c74db.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.a390a303.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.9316ab84.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.d24d23a1.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.f8555457.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.d207af8e.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.a69a3d66.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.48d0886d.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.5f2d4f42.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.39e89308.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.9b0ff02d.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.f7c14739.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.3d5cdd7a.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.522bbd31.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.79e59d3a.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.0c16f110.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.fe56a9af.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.d4f1aed1.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.20acb3b8.js"><link rel="prefetch" href="/android-note/assets/单链表.html.bf62db54.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.6deb38fc.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.b46be9ac.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.513c7a20.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.c4c4dcc3.js"><link rel="prefetch" href="/android-note/assets/死锁.html.99ba4a89.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.1b7c653d.js"><link rel="prefetch" href="/android-note/assets/算法.html.9d4e0aef.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.537ece5d.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.d6be503e.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.90a2793b.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.7d77fbc3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.b1be9fff.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.e19fc3f0.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.605ed319.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.a5a68958.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.011717f3.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.ef802fd5.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.f1520e1f.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.3f7548ca.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.766c9e14.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.e37403f2.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.86d3c34a.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.8b7d82ae.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.14c41b41.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.7939bdd8.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.6e0ecf53.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.ee42d351.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.50780cae.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.6f55660e.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.8a6fec11.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.dc751b15.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.3b0d9330.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.9e48a859.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.1c2bdb90.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.967a0203.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.f37c7aff.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.49b62c31.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.0e2aaf0e.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.9fd639b3.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.55bd9526.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.2a20a491.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.f03f6006.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.baa87ac6.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.d2862232.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.5bef6c29.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.e75759f0.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.67635b46.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.b4b4741f.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.84ce4ed4.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.96115c87.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.37e80618.js"><link rel="prefetch" href="/android-note/assets/404.html.93146c89.js"><link rel="prefetch" href="/android-note/assets/index.html.a3b2c356.js"><link rel="prefetch" href="/android-note/assets/ART与Dalvik.html.593d518f.js"><link rel="prefetch" href="/android-note/assets/Android6.0权限系统.html.1f126c97.js"><link rel="prefetch" href="/android-note/assets/Android卸载反馈.html.a5ba8c6b.js"><link rel="prefetch" href="/android-note/assets/Android启动模式详解.html.ca8b1ccd.js"><link rel="prefetch" href="/android-note/assets/Android开发不申请权限来使用对应功能.html.d0272eba.js"><link rel="prefetch" href="/android-note/assets/Android开发中的MVP模式详解.html.187c5ed4.js"><link rel="prefetch" href="/android-note/assets/ApplicationId vs PackageName.html.56b02a10.js"><link rel="prefetch" href="/android-note/assets/BroadcastReceiver安全问题.html.64aef548.js"><link rel="prefetch" href="/android-note/assets/Handler导致内存泄露分析.html.164306fd.js"><link rel="prefetch" href="/android-note/assets/Library项目中资源id使用case时报错.html.3f4b1857.js"><link rel="prefetch" href="/android-note/assets/Mac下配置adb及Android命令.html.22df54ee.js"><link rel="prefetch" href="/android-note/assets/MaterialDesign使用.html.649f129f.js"><link rel="prefetch" href="/android-note/assets/RecyclerView专题.html.fa20e530.js"><link rel="prefetch" href="/android-note/assets/如何让Service常驻内存.html.a1a10337.js"><link rel="prefetch" href="/android-note/assets/屏幕适配之百分比方案详解.html.e761907d.js"><link rel="prefetch" href="/android-note/assets/布局优化.html.48720165.js"><link rel="prefetch" href="/android-note/assets/性能优化.html.be35e4a9.js"><link rel="prefetch" href="/android-note/assets/注解使用.html.2ba5a7aa.js"><link rel="prefetch" href="/android-note/assets/热修复实现.html.58919723.js"><link rel="prefetch" href="/android-note/assets/通过Hardware Layer提高动画性能.html.6ddb95e6.js"><link rel="prefetch" href="/android-note/assets/Android Studio你可能不知道的操作.html.fdf20e86.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio中进行ndk开发.html.8e054392.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第一弹).html.414cb35a.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第七弹).html.13675508.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第三弹).html.d6d4b951.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第二弹).html.b98f8285.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第五弹).html.5346a958.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第六弹).html.1b23c403.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio使用教程(第四弹).html.48bf4f17.js"><link rel="prefetch" href="/android-note/assets/AndroidStudio提高Build速度.html.00c828d1.js"><link rel="prefetch" href="/android-note/assets/Android应用发布.html.f1757cb9.js"><link rel="prefetch" href="/android-note/assets/Zipalign优化.html.8521978d.js"><link rel="prefetch" href="/android-note/assets/Android入门介绍.html.b1900bf7.js"><link rel="prefetch" href="/android-note/assets/Android动画.html.b0686769.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之ContentProvider.html.5283befd.js"><link rel="prefetch" href="/android-note/assets/Android四大组件之Service.html.c819f916.js"><link rel="prefetch" href="/android-note/assets/Android基础面试题.html.ff577025.js"><link rel="prefetch" href="/android-note/assets/Android编码规范.html.5636ef45.js"><link rel="prefetch" href="/android-note/assets/Ant打包.html.ef8a6333.js"><link rel="prefetch" href="/android-note/assets/Bitmap优化.html.c749c345.js"><link rel="prefetch" href="/android-note/assets/Fragment专题.html.44210aa0.js"><link rel="prefetch" href="/android-note/assets/Home键监听.html.31cc83ad.js"><link rel="prefetch" href="/android-note/assets/HttpClient执行Get和Post请求.html.9dfecddb.js"><link rel="prefetch" href="/android-note/assets/JNI_C语言基础.html.acf1dc16.js"><link rel="prefetch" href="/android-note/assets/JNI基础.html.b863d19a.js"><link rel="prefetch" href="/android-note/assets/ListView专题.html.ccbe3768.js"><link rel="prefetch" href="/android-note/assets/Parcelable及Serializable.html.d7a77f6f.js"><link rel="prefetch" href="/android-note/assets/PopupWindow细节.html.e345b3a9.js"><link rel="prefetch" href="/android-note/assets/SDK Manager无法更新的问题.html.1c81b7f8.js"><link rel="prefetch" href="/android-note/assets/Scroller简介.html.c35eb2fc.js"><link rel="prefetch" href="/android-note/assets/ScrollingTabs.html.6c7ff613.js"><link rel="prefetch" href="/android-note/assets/Selector使用.html.3ae6b882.js"><link rel="prefetch" href="/android-note/assets/SlidingMenu.html.5ff8b11c.js"><link rel="prefetch" href="/android-note/assets/String格式化.html.8bb54a97.js"><link rel="prefetch" href="/android-note/assets/TextView跑马灯效果.html.a6164902.js"><link rel="prefetch" href="/android-note/assets/WebView总结.html.09ce9c48.js"><link rel="prefetch" href="/android-note/assets/Widget(窗口小部件).html.665dba40.js"><link rel="prefetch" href="/android-note/assets/Wifi状态监听.html.33108888.js"><link rel="prefetch" href="/android-note/assets/XmlPullParser.html.562c0f22.js"><link rel="prefetch" href="/android-note/assets/adb logcat使用简介.html.7e555978.js"><link rel="prefetch" href="/android-note/assets/下拉刷新ListView.html.a5b5dc81.js"><link rel="prefetch" href="/android-note/assets/代码混淆.html.6b1638d3.js"><link rel="prefetch" href="/android-note/assets/任务管理器(ActivityManager).html.2b0db888.js"><link rel="prefetch" href="/android-note/assets/修改系统组件样式.html.3988e4e5.js"><link rel="prefetch" href="/android-note/assets/内存泄漏.html.a958fc42.js"><link rel="prefetch" href="/android-note/assets/多线程断点下载.html.e34bdbe5.js"><link rel="prefetch" href="/android-note/assets/安全退出应用程序.html.6e540a45.js"><link rel="prefetch" href="/android-note/assets/屏幕适配.html.d2d7c9b1.js"><link rel="prefetch" href="/android-note/assets/应用后台唤醒后数据的刷新.html.674d0b48.js"><link rel="prefetch" href="/android-note/assets/应用安装.html.b6ce9885.js"><link rel="prefetch" href="/android-note/assets/开发中Log的管理.html.f406015e.js"><link rel="prefetch" href="/android-note/assets/开发中异常的处理.html.e717f114.js"><link rel="prefetch" href="/android-note/assets/快捷方式工具类.html.f9420718.js"><link rel="prefetch" href="/android-note/assets/手机摇晃.html.04da3193.js"><link rel="prefetch" href="/android-note/assets/搜索框.html.12db7ee7.js"><link rel="prefetch" href="/android-note/assets/数据存储.html.b25bda0f.js"><link rel="prefetch" href="/android-note/assets/文件上传.html.9e008ea8.js"><link rel="prefetch" href="/android-note/assets/来电号码归属地提示框.html.f34946bf.js"><link rel="prefetch" href="/android-note/assets/来电监听及录音.html.91e7515b.js"><link rel="prefetch" href="/android-note/assets/横向ListView.html.927862c8.js"><link rel="prefetch" href="/android-note/assets/滑动切换Activity(GestureDetector).html.89709d55.js"><link rel="prefetch" href="/android-note/assets/病毒.html.dfdf570b.js"><link rel="prefetch" href="/android-note/assets/知识大杂烩.html.08bb7427.js"><link rel="prefetch" href="/android-note/assets/短信广播接收者.html.0ae81f02.js"><link rel="prefetch" href="/android-note/assets/程序的启动、卸载和分享.html.d3bf5ba6.js"><link rel="prefetch" href="/android-note/assets/竖着的Seekbar.html.958ad9fd.js"><link rel="prefetch" href="/android-note/assets/自定义Toast.html.3d0fcc1c.js"><link rel="prefetch" href="/android-note/assets/自定义控件.html.091df93c.js"><link rel="prefetch" href="/android-note/assets/自定义状态栏通知.html.cb73d038.js"><link rel="prefetch" href="/android-note/assets/自定义背景.html.76947534.js"><link rel="prefetch" href="/android-note/assets/获取位置(LocationManager).html.e776dd24.js"><link rel="prefetch" href="/android-note/assets/获取应用程序缓存及一键清理.html.8c46b7ff.js"><link rel="prefetch" href="/android-note/assets/获取手机中所有安装的程序.html.b9ca8c91.js"><link rel="prefetch" href="/android-note/assets/获取手机及SD卡可用存储空间.html.7b085d61.js"><link rel="prefetch" href="/android-note/assets/获取联系人.html.a597a6b0.js"><link rel="prefetch" href="/android-note/assets/读取用户logcat日志.html.152b4577.js"><link rel="prefetch" href="/android-note/assets/资源文件拷贝的三种方式.html.bbe32974.js"><link rel="prefetch" href="/android-note/assets/超级管理员(DevicePoliceManager).html.82c852a9.js"><link rel="prefetch" href="/android-note/assets/锁屏以及解锁监听.html.4d107d95.js"><link rel="prefetch" href="/android-note/assets/零权限上传数据.html.53598b60.js"><link rel="prefetch" href="/android-note/assets/音量及屏幕亮度调节.html.235979e1.js"><link rel="prefetch" href="/android-note/assets/黑名单挂断电话及删除电话记录.html.c14f1fd9.js"><link rel="prefetch" href="/android-note/assets/Gradle专题.html.79c074c0.js"><link rel="prefetch" href="/android-note/assets/发布library到Maven仓库.html.1e80f727.js"><link rel="prefetch" href="/android-note/assets/Glide简介(上).html.46ff5834.js"><link rel="prefetch" href="/android-note/assets/Glide简介(下).html.4f649ea3.js"><link rel="prefetch" href="/android-note/assets/图片加载库比较.html.1afb41c6.js"><link rel="prefetch" href="/android-note/assets/Base64加密.html.77fd44d2.js"><link rel="prefetch" href="/android-note/assets/Git命令.html.f67e6cf2.js"><link rel="prefetch" href="/android-note/assets/HashMap实现原理分析.html.87e02d9e.js"><link rel="prefetch" href="/android-note/assets/JVM垃圾回收机制.html.dcfdc432.js"><link rel="prefetch" href="/android-note/assets/Java基础面试题.html.924476e1.js"><link rel="prefetch" href="/android-note/assets/MD5加密.html.043d41ed.js"><link rel="prefetch" href="/android-note/assets/MVC与MVP及MVVM.html.56507109.js"><link rel="prefetch" href="/android-note/assets/RMB大小写转换.html.9b64eb77.js"><link rel="prefetch" href="/android-note/assets/Vim使用教程.html.7ea26885.js"><link rel="prefetch" href="/android-note/assets/hashCode与equals.html.182d318a.js"><link rel="prefetch" href="/android-note/assets/volatile和Synchronized区别.html.73b388a2.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(上).html.08ed1a50.js"><link rel="prefetch" href="/android-note/assets/剑指Offer(下).html.02faa77d.js"><link rel="prefetch" href="/android-note/assets/单例的最佳实现方式.html.ff9f67fa.js"><link rel="prefetch" href="/android-note/assets/单链表.html.816ccbf3.js"><link rel="prefetch" href="/android-note/assets/原子性、可见性以及有序性.html.81be9d3a.js"><link rel="prefetch" href="/android-note/assets/常用命令行大全.html.5979ef3a.js"><link rel="prefetch" href="/android-note/assets/强引用、软引用、弱引用、虚引用.html.d3a34d4d.js"><link rel="prefetch" href="/android-note/assets/数据加密及解密.html.f871bc28.js"><link rel="prefetch" href="/android-note/assets/死锁.html.05fcf641.js"><link rel="prefetch" href="/android-note/assets/生产者消费者.html.124be265.js"><link rel="prefetch" href="/android-note/assets/算法.html.a5d32479.js"><link rel="prefetch" href="/android-note/assets/线程池的原理.html.0447b400.js"><link rel="prefetch" href="/android-note/assets/网络请求相关内容总结.html.23d92421.js"><link rel="prefetch" href="/android-note/assets/获取今后多少天后的日期.html.1f70a7af.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(一).html.0aca5205.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(七).html.c64ac1eb.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(三).html.259d5746.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(九).html.2d7e84b0.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(二).html.f80d0190.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(五).html.cb3b0dd9.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(八).html.5eba2fc6.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(六).html.f95797de.js"><link rel="prefetch" href="/android-note/assets/Kotlin学习教程(四).html.af807638.js"><link rel="prefetch" href="/android-note/assets/RxJava系列全家桶.html.af237da0.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(上).html.c7354991.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(下).html.2c386862.js"><link rel="prefetch" href="/android-note/assets/RxJava详解(中).html.502b69b2.js"><link rel="prefetch" href="/android-note/assets/Activity启动过程.html.4cf1fc11.js"><link rel="prefetch" href="/android-note/assets/Activity界面绘制过程详解.html.0d0ec937.js"><link rel="prefetch" href="/android-note/assets/Android Touch事件分发详解.html.1a5daf97.js"><link rel="prefetch" href="/android-note/assets/AsyncTask详解.html.49cca9fa.js"><link rel="prefetch" href="/android-note/assets/InstantRun详解.html.6bf6b961.js"><link rel="prefetch" href="/android-note/assets/ListView源码分析.html.957f7aff.js"><link rel="prefetch" href="/android-note/assets/View绘制过程详解.html.db0f2341.js"><link rel="prefetch" href="/android-note/assets/butterknife源码详解.html.28394ba6.js"><link rel="prefetch" href="/android-note/assets/自定义View详解.html.e37f15c5.js"><link rel="prefetch" href="/android-note/assets/Android开发工具及类库.html.4900e197.js"><link rel="prefetch" href="/android-note/assets/Github个人主页绑定域名.html.d17a443e.js"><link rel="prefetch" href="/android-note/assets/MAT内存分析.html.6d4b95b6.js"><link rel="prefetch" href="/android-note/assets/Markdown学习手册.html.7617b5a1.js"><link rel="prefetch" href="/android-note/assets/性能优化相关工具.html.ebe8409a.js"><link rel="prefetch" href="/android-note/assets/目前流行的开发组合.html.d8336de6.js"><link rel="prefetch" href="/android-note/assets/Android WebRTC简介.html.51987a1b.js"><link rel="prefetch" href="/android-note/assets/Android音视频开发.html.4040429e.js"><link rel="prefetch" href="/android-note/assets/DLNA简介.html.fc34230c.js"><link rel="prefetch" href="/android-note/assets/搭建nginx_rtmp服务器.html.8310dbe0.js"><link rel="prefetch" href="/android-note/assets/视频播放相关内容总结.html.a609e06b.js"><link rel="prefetch" href="/android-note/assets/视频解码之软解与硬解.html.92fc9cbb.js"><link rel="prefetch" href="/android-note/assets/音视频基础知识.html.6f0bcff8.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection与HttpClient.html.3d8a0779.js"><link rel="prefetch" href="/android-note/assets/HttpURLConnection详解.html.88c6186b.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(上).html.2513ea33.js"><link rel="prefetch" href="/android-note/assets/Retrofit详解(下).html.d0778e46.js"><link rel="prefetch" href="/android-note/assets/Volley源码分析.html.bfc12cf1.js"><link rel="prefetch" href="/android-note/assets/volley-retrofit-okhttp之我们该如何选择网路框架.html.45995d69.js"><link rel="prefetch" href="/android-note/assets/404.html.bf6755d7.js"><link rel="prefetch" href="/android-note/assets/404.0f84ac09.js"><link rel="prefetch" href="/android-note/assets/Layout.c5c30828.js">
    <link rel="stylesheet" href="/android-note/assets/style.1f7fd01d.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/android-note/" class=""><!----><span class="site-name">Android Notes</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><!----><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><!----><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">VideoView源码分析 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/android-note/SourceAnalysis/VideoView%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html#videoview" class="router-link-active router-link-exact-active sidebar-item" aria-label="VideoView"><!--[--><!--]--> VideoView <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/android-note/SourceAnalysis/VideoView%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html#mediaplayercontrol" class="router-link-active router-link-exact-active sidebar-item" aria-label="MediaPlayerControl"><!--[--><!--]--> MediaPlayerControl <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/android-note/SourceAnalysis/VideoView%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.html#mediacontroller" class="router-link-active router-link-exact-active sidebar-item" aria-label="MediaController"><!--[--><!--]--> MediaController <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="videoview源码分析" tabindex="-1"><a class="header-anchor" href="#videoview源码分析" aria-hidden="true">#</a> VideoView源码分析</h1><h2 id="videoview" tabindex="-1"><a class="header-anchor" href="#videoview" aria-hidden="true">#</a> VideoView</h2><p>基于Android4.4源码进行分析</p><ul><li><p>简介</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Displays a video file.  The VideoView class
 * can load images from various sources (such as resources or content
 * providers), takes care of computing its measurement from the video so that
 * it can be used in any layout manager, and provides various display options
 * such as scaling and tinting.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>Note: VideoView does not retain its full state when going into the
 * background.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span>  In particular, it does not restore the current play state,
 * play position, selected tracks, or any subtitle tracks added via
 * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">addSubtitleSource</span></span> addSubtitleSource()<span class="token punctuation">}</span>.  Applications should
 * save and restore these on their own in
 * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">Activity</span><span class="token punctuation">#</span><span class="token field">onSaveInstanceState</span></span><span class="token punctuation">}</span> and
 * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">Activity</span><span class="token punctuation">#</span><span class="token field">onRestoreInstanceState</span></span><span class="token punctuation">}</span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 * Also note that the audio session id (from <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">getAudioSessionId</span></span><span class="token punctuation">}</span>) may
 * change from its previously returned value when the VideoView is restored.
 */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>关系</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VideoView</span> <span class="token keyword">extends</span> <span class="token class-name">SurfaceView</span>
		<span class="token keyword">implements</span> <span class="token class-name">MediaPlayerControl</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>成员</p><ul><li><p>播放器所有的状态</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// all possible internal states</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATE_ERROR              <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATE_IDLE               <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATE_PREPARING          <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATE_PREPARED           <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATE_PLAYING            <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATE_PAUSED             <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATE_PLAYBACK_COMPLETED <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>记录播放器状态</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// mCurrentState is a VideoView object&#39;s current state.</span>
<span class="token comment">// mTargetState is the state that a method caller intends to reach.</span>
<span class="token comment">// For instance, regardless the VideoView object&#39;s current state,</span>
<span class="token comment">// calling pause() intends to bring the object to a target state</span>
<span class="token comment">// of STATE_PAUSED.</span>
<span class="token keyword">private</span> <span class="token keyword">int</span> mCurrentState <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">int</span> mTargetState  <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>主要功能部分</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">SurfaceHolder</span> mSurfaceHolder <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">// 显示图像</span>
<span class="token keyword">private</span> <span class="token class-name">MediaPlayer</span> mMediaPlayer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 声音、播放</span>
<span class="token keyword">private</span> <span class="token class-name">MediaController</span> mMediaController<span class="token punctuation">;</span> <span class="token comment">// 播放控制</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>其他</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">int</span>         mVideoWidth<span class="token punctuation">;</span>  <span class="token comment">// 视频宽度 在onVideoSizeChanged() 和 onPrepared() 中可以得到具体大小</span>
<span class="token keyword">private</span> <span class="token keyword">int</span>         mVideoHeight<span class="token punctuation">;</span>  <span class="token comment">//视频高度</span>
<span class="token keyword">private</span> <span class="token keyword">int</span>         mSurfaceWidth<span class="token punctuation">;</span> <span class="token comment">// Surface宽度  在SurfaceHolder.Callback.surfaceChanged() 中可以得到具体大小</span>
<span class="token keyword">private</span> <span class="token keyword">int</span>         mSurfaceHeight<span class="token punctuation">;</span> <span class="token comment">// Surface高度</span>
<span class="token keyword">private</span> <span class="token keyword">int</span>         mSeekWhenPrepared<span class="token punctuation">;</span>  <span class="token comment">// recording the seek position while preparing</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>具体实现</p><ul><li><p>构造方法</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">VideoView</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">initVideoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">VideoView</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">AttributeSet</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">initVideoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">VideoView</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">AttributeSet</span> attrs<span class="token punctuation">,</span> <span class="token keyword">int</span> defStyle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> defStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">initVideoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 进行一些必要信息的初始化设置</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initVideoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	mVideoWidth <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	mVideoHeight <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 通过SurfaceHolder去控制SurfaceView</span>
	<span class="token function">getHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addCallback</span><span class="token punctuation">(</span>mSHCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// Deprecated. this is ignored, this value is set automatically when needed.Android3.0以上会自动设置，但是为了兼容还需设置</span>
	<span class="token function">getHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">SurfaceHolder</span><span class="token punctuation">.</span>SURFACE_TYPE_PUSH_BUFFERS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">setFocusable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setFocusableInTouchMode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 字幕相关，用不到</span>
	mPendingSubtitleTracks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pair</span><span class="token punctuation">&lt;</span><span class="token class-name">InputStream</span><span class="token punctuation">,</span> <span class="token class-name">MediaFormat</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	mCurrentState <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>
	mTargetState  <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>SurfaceHolder.Callback源码</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">SurfaceHolder<span class="token punctuation">.</span>Callback</span> mSHCallback <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SurfaceHolder<span class="token punctuation">.</span>Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">surfaceChanged</span><span class="token punctuation">(</span><span class="token class-name">SurfaceHolder</span> holder<span class="token punctuation">,</span> <span class="token keyword">int</span> format<span class="token punctuation">,</span>
								<span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		mSurfaceWidth <span class="token operator">=</span> w<span class="token punctuation">;</span>
		mSurfaceHeight <span class="token operator">=</span> h<span class="token punctuation">;</span>
		<span class="token keyword">boolean</span> isValidState <span class="token operator">=</span>  <span class="token punctuation">(</span>mTargetState <span class="token operator">==</span> STATE_PLAYING<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">boolean</span> hasValidSize <span class="token operator">=</span> <span class="token punctuation">(</span>mVideoWidth <span class="token operator">==</span> w <span class="token operator">&amp;&amp;</span> mVideoHeight <span class="token operator">==</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> isValidState <span class="token operator">&amp;&amp;</span> hasValidSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mSeekWhenPrepared <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">seekTo</span><span class="token punctuation">(</span>mSeekWhenPrepared<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 如果当前已经是播放状态的话就调用mediaplaer.start() 方法，并且把当前状态以及目标状态进行改变</span>
			<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">surfaceCreated</span><span class="token punctuation">(</span><span class="token class-name">SurfaceHolder</span> holder<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		mSurfaceHolder <span class="token operator">=</span> holder<span class="token punctuation">;</span>
		<span class="token comment">// Surface创建后就开始调用播放</span>
		<span class="token function">openVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">surfaceDestroyed</span><span class="token punctuation">(</span><span class="token class-name">SurfaceHolder</span> holder<span class="token punctuation">)</span>
	<span class="token punctuation">{</span>
		<span class="token comment">// after we return from this we can&#39;t use the surface any more</span>
		mSurfaceHolder <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> mMediaController<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">release</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>重写onMeasure()方法</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onMeasure</span><span class="token punctuation">(</span><span class="token keyword">int</span> widthMeasureSpec<span class="token punctuation">,</span> <span class="token keyword">int</span> heightMeasureSpec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">getDefaultSize</span><span class="token punctuation">(</span>mVideoWidth<span class="token punctuation">,</span> widthMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">getDefaultSize</span><span class="token punctuation">(</span>mVideoHeight<span class="token punctuation">,</span> heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// ....根据视频的宽高比进行处理， 为了更好的宽展，提供一些用户能自己选择的模式，一般会另外提供方法, 这部分代码可以先不看 start</span>
	<span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">getDefaultSize</span><span class="token punctuation">(</span>mVideoWidth<span class="token punctuation">,</span> widthMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">getDefaultSize</span><span class="token punctuation">(</span>mVideoHeight<span class="token punctuation">,</span> heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mVideoWidth <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> mVideoHeight <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">int</span> widthSpecMode <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> widthSpecSize <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> heightSpecMode <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span>heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> heightSpecSize <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span>heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>widthSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>EXACTLY <span class="token operator">&amp;&amp;</span> heightSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>EXACTLY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// the size is fixed</span>
            width <span class="token operator">=</span> widthSpecSize<span class="token punctuation">;</span>
            height <span class="token operator">=</span> heightSpecSize<span class="token punctuation">;</span>

            <span class="token comment">// for compatibility, we adjust size based on aspect ratio</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span> mVideoWidth <span class="token operator">*</span> height  <span class="token operator">&lt;</span> width <span class="token operator">*</span> mVideoHeight <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//Log.i(&quot;@@@&quot;, &quot;image too wide, correcting&quot;);</span>
                width <span class="token operator">=</span> height <span class="token operator">*</span> mVideoWidth <span class="token operator">/</span> mVideoHeight<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> mVideoWidth <span class="token operator">*</span> height  <span class="token operator">&gt;</span> width <span class="token operator">*</span> mVideoHeight <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//Log.i(&quot;@@@&quot;, &quot;image too tall, correcting&quot;);</span>
                height <span class="token operator">=</span> width <span class="token operator">*</span> mVideoHeight <span class="token operator">/</span> mVideoWidth<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>widthSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>EXACTLY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// only the width is fixed, adjust the height to match aspect ratio if possible</span>
            width <span class="token operator">=</span> widthSpecSize<span class="token punctuation">;</span>
            height <span class="token operator">=</span> width <span class="token operator">*</span> mVideoHeight <span class="token operator">/</span> mVideoWidth<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>heightSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>AT_MOST <span class="token operator">&amp;&amp;</span> height <span class="token operator">&gt;</span> heightSpecSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// couldn&#39;t match aspect ratio within the constraints</span>
                height <span class="token operator">=</span> heightSpecSize<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>heightSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>EXACTLY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// only the height is fixed, adjust the width to match aspect ratio if possible</span>
            height <span class="token operator">=</span> heightSpecSize<span class="token punctuation">;</span>
            width <span class="token operator">=</span> height <span class="token operator">*</span> mVideoWidth <span class="token operator">/</span> mVideoHeight<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>widthSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>AT_MOST <span class="token operator">&amp;&amp;</span> width <span class="token operator">&gt;</span> widthSpecSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// couldn&#39;t match aspect ratio within the constraints</span>
                width <span class="token operator">=</span> widthSpecSize<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// neither the width nor the height are fixed, try to use actual video size</span>
            width <span class="token operator">=</span> mVideoWidth<span class="token punctuation">;</span>
            height <span class="token operator">=</span> mVideoHeight<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>heightSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>AT_MOST <span class="token operator">&amp;&amp;</span> height <span class="token operator">&gt;</span> heightSpecSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// too tall, decrease both width and height</span>
                height <span class="token operator">=</span> heightSpecSize<span class="token punctuation">;</span>
                width <span class="token operator">=</span> height <span class="token operator">*</span> mVideoWidth <span class="token operator">/</span> mVideoHeight<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>widthSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>AT_MOST <span class="token operator">&amp;&amp;</span> width <span class="token operator">&gt;</span> widthSpecSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// too wide, decrease both width and height</span>
                width <span class="token operator">=</span> widthSpecSize<span class="token punctuation">;</span>
                height <span class="token operator">=</span> width <span class="token operator">*</span> mVideoHeight <span class="token operator">/</span> mVideoWidth<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// no size yet, just adopt the given spec sizes</span>
    <span class="token punctuation">}</span>
	<span class="token comment">// end</span>
	
    <span class="token function">setMeasuredDimension</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>附上getDefaultSize()源码<div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Utility to return a default size. Uses the supplied size if the
 * MeasureSpec imposed no constraints. Will get larger if allowed
 * by the MeasureSpec.
 *
 * <span class="token keyword">@param</span> <span class="token parameter">size</span> Default size for this view
 * <span class="token keyword">@param</span> <span class="token parameter">measureSpec</span> Constraints imposed by the parent
 * <span class="token keyword">@return</span> The size this view should be.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">getDefaultSize</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">,</span> <span class="token keyword">int</span> measureSpec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> result <span class="token operator">=</span> size<span class="token punctuation">;</span>
	<span class="token keyword">int</span> specMode <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span>measureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> specSize <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span>measureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">switch</span> <span class="token punctuation">(</span>specMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">case</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>UNSPECIFIED<span class="token operator">:</span>
		result <span class="token operator">=</span> size<span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>AT_MOST<span class="token operator">:</span>
	<span class="token keyword">case</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>EXACTLY<span class="token operator">:</span>
		result <span class="token operator">=</span> specSize<span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>外部进行播放调用</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setVideoPath</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">setVideoURI</span><span class="token punctuation">(</span><span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setVideoURI</span><span class="token punctuation">(</span><span class="token class-name">Uri</span> uri<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">setVideoURI</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * <span class="token keyword">@hide</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setVideoURI</span><span class="token punctuation">(</span><span class="token class-name">Uri</span> uri<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> headers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	mUri <span class="token operator">=</span> uri<span class="token punctuation">;</span>
	mHeaders <span class="token operator">=</span> headers<span class="token punctuation">;</span>
	mSeekWhenPrepared <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	
	<span class="token function">openVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">requestLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>openVide() 源码</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">openVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mUri <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> mSurfaceHolder <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// not ready for playback just yet, will try again later</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// Tell the music playback service to pause</span>
	<span class="token comment">// TODO: these constants need to be published somewhere in the framework.</span>
	<span class="token class-name">Intent</span> i <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token string">&quot;com.android.music.musicservicecommand&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	i<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;command&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mContext<span class="token punctuation">.</span><span class="token function">sendBroadcast</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// we shouldn&#39;t clear the target state, because somebody might have</span>
	<span class="token comment">// called start() previously // 先把已经存在的MediaPlayer释放掉，然后重新创建一个, 不一定只在SetVideoPath() 中调用，在其他地方也会调用</span>
	<span class="token function">release</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">try</span> <span class="token punctuation">{</span>
		<span class="token comment">// 创建一个MediaPlayer</span>
		mMediaPlayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// TODO: create SubtitleController in MediaPlayer, but we need</span>
		<span class="token comment">// a context for the subtitle renderers</span>
		<span class="token keyword">final</span> <span class="token class-name">Context</span> context <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token class-name">SubtitleController</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubtitleController</span><span class="token punctuation">(</span>
				context<span class="token punctuation">,</span> mMediaPlayer<span class="token punctuation">.</span><span class="token function">getMediaTimeProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mMediaPlayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
		controller<span class="token punctuation">.</span><span class="token function">registerRenderer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebVttRenderer</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">setSubtitleAnchor</span><span class="token punctuation">(</span>controller<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>mAudioSession <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mMediaPlayer<span class="token punctuation">.</span><span class="token function">setAudioSessionId</span><span class="token punctuation">(</span>mAudioSession<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			mAudioSession <span class="token operator">=</span> mMediaPlayer<span class="token punctuation">.</span><span class="token function">getAudioSessionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token comment">// 设置一些必要的监听</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnPreparedListener</span><span class="token punctuation">(</span>mPreparedListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnVideoSizeChangedListener</span><span class="token punctuation">(</span>mSizeChangedListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnCompletionListener</span><span class="token punctuation">(</span>mCompletionListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnErrorListener</span><span class="token punctuation">(</span>mErrorListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnInfoListener</span><span class="token punctuation">(</span>mInfoListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnBufferingUpdateListener</span><span class="token punctuation">(</span>mBufferingUpdateListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mCurrentBufferPercentage <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token comment">// 让MediaPlayer进行播放</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>mContext<span class="token punctuation">,</span> mUri<span class="token punctuation">,</span> mHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 让SurfaceView进行画面显示</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">setDisplay</span><span class="token punctuation">(</span>mSurfaceHolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 设置音频类型</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">setAudioStreamType</span><span class="token punctuation">(</span><span class="token class-name">AudioManager</span><span class="token punctuation">.</span>STREAM_MUSIC<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 播放时屏幕常亮</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">setScreenOnWhilePlaying</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// Prepares the player for playback, asynchronously. After setting the datasource and the display surface, you need to either call prepare() or prepareAsync(). For streams, you should call prepareAsync(), </span>
		<span class="token comment">// which returns immediately, rather than blocking until enough data has been buffered.</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">prepareAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">InputStream</span><span class="token punctuation">,</span> <span class="token class-name">MediaFormat</span><span class="token punctuation">&gt;</span></span> pending<span class="token operator">:</span> mPendingSubtitleTracks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">try</span> <span class="token punctuation">{</span>
				mMediaPlayer<span class="token punctuation">.</span><span class="token function">addSubtitleSource</span><span class="token punctuation">(</span>pending<span class="token punctuation">.</span>first<span class="token punctuation">,</span> pending<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalStateException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				mInfoListener<span class="token punctuation">.</span><span class="token function">onInfo</span><span class="token punctuation">(</span>
						mMediaPlayer<span class="token punctuation">,</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">.</span>MEDIA_INFO_UNSUPPORTED_SUBTITLE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// we don&#39;t set the target state here either, but preserve the</span>
		<span class="token comment">// target state that was there before.</span>
		mCurrentState <span class="token operator">=</span> STATE_PREPARING<span class="token punctuation">;</span>
		<span class="token comment">// 如果已经调用过SetMediaController() 方法，这里会直接显示</span>
		<span class="token function">attachMediaController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;Unable to open content: &quot;</span> <span class="token operator">+</span> mUri<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mCurrentState <span class="token operator">=</span> STATE_ERROR<span class="token punctuation">;</span>
		mTargetState <span class="token operator">=</span> STATE_ERROR<span class="token punctuation">;</span>
		mErrorListener<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span>mMediaPlayer<span class="token punctuation">,</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">.</span>MEDIA_ERROR_UNKNOWN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;Unable to open content: &quot;</span> <span class="token operator">+</span> mUri<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mCurrentState <span class="token operator">=</span> STATE_ERROR<span class="token punctuation">;</span>
		mTargetState <span class="token operator">=</span> STATE_ERROR<span class="token punctuation">;</span>
		mErrorListener<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span>mMediaPlayer<span class="token punctuation">,</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">.</span>MEDIA_ERROR_UNKNOWN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
		mPendingSubtitleTracks<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>release() 方法,在开始播放一个视频的时候会先调用该方法，然后重新创建一个，在SurfaceView销毁的时候也会调用该方法</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*
 * release the media player in any state
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> cleartargetstate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mMediaPlayer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		mPendingSubtitleTracks<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mCurrentState <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>cleartargetstate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mTargetState  <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>外部停止播放调用</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stopPlayback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mMediaPlayer<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mMediaPlayer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		mCurrentState <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>
		mTargetState  <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>外部设置控制栏部分</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMediaController</span><span class="token punctuation">(</span><span class="token class-name">MediaController</span> controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mMediaController<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	mMediaController <span class="token operator">=</span> controller<span class="token punctuation">;</span>
	<span class="token function">attachMediaController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">attachMediaController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// setMediaPlayer(MediaPlayerControl player), 让MediaPlayer相应的控制部分调用本类中的实现方法</span>
		mMediaController<span class="token punctuation">.</span><span class="token function">setMediaPlayer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">View</span> anchorView <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">View</span> <span class="token operator">?</span>
				<span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
				
		<span class="token comment">// 创建Controller并且依据AnchorView的位置进行显示</span>
		mMediaController<span class="token punctuation">.</span><span class="token function">setAnchorView</span><span class="token punctuation">(</span>anchorView<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mMediaController<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token function">isInPlaybackState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>MediaPlayer必要监听</p><ul><li><p>OnVideoSizeChangedListener</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnVideoSizeChangedListener</span> mSizeChangedListener <span class="token operator">=</span>
	<span class="token keyword">new</span> <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnVideoSizeChangedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onVideoSizeChanged</span><span class="token punctuation">(</span><span class="token class-name">MediaPlayer</span> mp<span class="token punctuation">,</span> <span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mVideoWidth <span class="token operator">=</span> mp<span class="token punctuation">.</span><span class="token function">getVideoWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			mVideoHeight <span class="token operator">=</span> mp<span class="token punctuation">.</span><span class="token function">getVideoHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mVideoWidth <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> mVideoHeight <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// 这个方法是设置Surface分辨率，而不是设置视频播放窗口的大小，视频播放窗口大小是由SurfaceView的布局控制，要分清Surface与SurfaceView的区别，Surface是Window中整个的一个控件(句柄),</span>
				<span class="token comment">// 而SurfaceView是一个包含Surface的View，SurfaceView覆盖到Surface上(可以这样理解)，我们只能通过SurfaceView来看Surface中的内容,至于在SurfaceView显示之外的Surface我们是不可见的.</span>
				<span class="token function">getHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFixedSize</span><span class="token punctuation">(</span>mVideoWidth<span class="token punctuation">,</span> mVideoHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">requestLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>OnPreparedListener</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnPreparedListener</span> mPreparedListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnPreparedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPrepared</span><span class="token punctuation">(</span><span class="token class-name">MediaPlayer</span> mp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mCurrentState <span class="token operator">=</span> STATE_PREPARED<span class="token punctuation">;</span>

		<span class="token comment">// Get the capabilities of the player for this stream</span>
		<span class="token class-name">Metadata</span> data <span class="token operator">=</span> mp<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token class-name">MediaPlayer</span><span class="token punctuation">.</span>METADATA_ALL<span class="token punctuation">,</span>
								  <span class="token class-name">MediaPlayer</span><span class="token punctuation">.</span>BYPASS_METADATA_FILTER<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mCanPause <span class="token operator">=</span> <span class="token operator">!</span>data<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token class-name">Metadata</span><span class="token punctuation">.</span>PAUSE_AVAILABLE<span class="token punctuation">)</span>
					<span class="token operator">||</span> data<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">Metadata</span><span class="token punctuation">.</span>PAUSE_AVAILABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mCanSeekBack <span class="token operator">=</span> <span class="token operator">!</span>data<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token class-name">Metadata</span><span class="token punctuation">.</span>SEEK_BACKWARD_AVAILABLE<span class="token punctuation">)</span>
					<span class="token operator">||</span> data<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">Metadata</span><span class="token punctuation">.</span>SEEK_BACKWARD_AVAILABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mCanSeekForward <span class="token operator">=</span> <span class="token operator">!</span>data<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token class-name">Metadata</span><span class="token punctuation">.</span>SEEK_FORWARD_AVAILABLE<span class="token punctuation">)</span>
					<span class="token operator">||</span> data<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">Metadata</span><span class="token punctuation">.</span>SEEK_FORWARD_AVAILABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			mCanPause <span class="token operator">=</span> mCanSeekBack <span class="token operator">=</span> mCanSeekForward <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span>mOnPreparedListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mOnPreparedListener<span class="token punctuation">.</span><span class="token function">onPrepared</span><span class="token punctuation">(</span>mMediaPlayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mMediaController<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		mVideoWidth <span class="token operator">=</span> mp<span class="token punctuation">.</span><span class="token function">getVideoWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mVideoHeight <span class="token operator">=</span> mp<span class="token punctuation">.</span><span class="token function">getVideoHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">int</span> seekToPosition <span class="token operator">=</span> mSeekWhenPrepared<span class="token punctuation">;</span>  <span class="token comment">// mSeekWhenPrepared may be changed after seekTo() call</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>seekToPosition <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token function">seekTo</span><span class="token punctuation">(</span>seekToPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mVideoWidth <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> mVideoHeight <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">//Log.i(&quot;@@@@&quot;, &quot;video size: &quot; + mVideoWidth +&quot;/&quot;+ mVideoHeight);</span>
			<span class="token function">getHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFixedSize</span><span class="token punctuation">(</span>mVideoWidth<span class="token punctuation">,</span> mVideoHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mSurfaceWidth <span class="token operator">==</span> mVideoWidth <span class="token operator">&amp;&amp;</span> mSurfaceHeight <span class="token operator">==</span> mVideoHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token comment">// We didn&#39;t actually change the size (it was already at the size</span>
				<span class="token comment">// we need), so we won&#39;t get a &quot;surface changed&quot; callback, so</span>
				<span class="token comment">// start the video here instead of in the callback.</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>mTargetState <span class="token operator">==</span> STATE_PLAYING<span class="token punctuation">)</span> <span class="token punctuation">{</span>
					<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
						mMediaController<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
						   <span class="token punctuation">(</span>seekToPosition <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token function">getCurrentPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				   <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
					   <span class="token comment">// Show the media controls when we&#39;re paused into a video and make &#39;em stick.</span>
					   mMediaController<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				   <span class="token punctuation">}</span>
			   <span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment">// We don&#39;t know the video size yet, but should start anyway.</span>
			<span class="token comment">// The video size might be reported to us later.</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mTargetState <span class="token operator">==</span> STATE_PLAYING<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>OnCompletionListener</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnCompletionListener</span> mCompletionListener <span class="token operator">=</span>
	<span class="token keyword">new</span> <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnCompletionListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCompletion</span><span class="token punctuation">(</span><span class="token class-name">MediaPlayer</span> mp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mCurrentState <span class="token operator">=</span> STATE_PLAYBACK_COMPLETED<span class="token punctuation">;</span>
		mTargetState <span class="token operator">=</span> STATE_PLAYBACK_COMPLETED<span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mMediaController<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mOnCompletionListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mOnCompletionListener<span class="token punctuation">.</span><span class="token function">onCompletion</span><span class="token punctuation">(</span>mMediaPlayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>Touch以及Key的监听</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInPlaybackState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	    <span class="token comment">// 控制MediaController的显示与隐藏</span>
		<span class="token function">toggleMediaControlsVisiblity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>toggleMediaControlsVisiblity</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">toggleMediaControlsVisiblity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaController<span class="token punctuation">.</span><span class="token function">isShowing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mMediaController<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		mMediaController<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>Key</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onKeyDown</span><span class="token punctuation">(</span><span class="token keyword">int</span> keyCode<span class="token punctuation">,</span> <span class="token class-name">KeyEvent</span> event<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
	<span class="token keyword">boolean</span> isKeyCodeSupported <span class="token operator">=</span> keyCode <span class="token operator">!=</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_BACK <span class="token operator">&amp;&amp;</span>
								 keyCode <span class="token operator">!=</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_VOLUME_UP <span class="token operator">&amp;&amp;</span>
								 keyCode <span class="token operator">!=</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_VOLUME_DOWN <span class="token operator">&amp;&amp;</span>
								 keyCode <span class="token operator">!=</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_VOLUME_MUTE <span class="token operator">&amp;&amp;</span>
								 keyCode <span class="token operator">!=</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_MENU <span class="token operator">&amp;&amp;</span>
								 keyCode <span class="token operator">!=</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_CALL <span class="token operator">&amp;&amp;</span>
								 keyCode <span class="token operator">!=</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_ENDCALL<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInPlaybackState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> isKeyCodeSupported <span class="token operator">&amp;&amp;</span> mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_HEADSETHOOK <span class="token operator">||</span>
				keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_MEDIA_PLAY_PAUSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				mMediaController<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
				<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				mMediaController<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_MEDIA_PLAY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mMediaPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				mMediaController<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_MEDIA_STOP
				<span class="token operator">||</span> keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_MEDIA_PAUSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				mMediaController<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token function">toggleMediaControlsVisiblity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onKeyDown</span><span class="token punctuation">(</span>keyCode<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul></li></ul><h1 id="华丽丽的分割线-上源码" tabindex="-1"><a class="header-anchor" href="#华丽丽的分割线-上源码" aria-hidden="true">#</a> 华丽丽的分割线 上源码</h1><hr><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*
 * Copyright (C) 2006 The Android Open Source Project
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="token doc-comment comment">/**
 * Displays a video file.  The VideoView class
 * can load images from various sources (such as resources or content
 * providers), takes care of computing its measurement from the video so that
 * it can be used in any layout manager, and provides various display options
 * such as scaling and tinting.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 *
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">&gt;</span></span>Note: VideoView does not retain its full state when going into the
 * background.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">&gt;</span></span>  In particular, it does not restore the current play state,
 * play position, selected tracks, or any subtitle tracks added via
 * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">addSubtitleSource</span></span> addSubtitleSource()<span class="token punctuation">}</span>.  Applications should
 * save and restore these on their own in
 * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">Activity</span><span class="token punctuation">#</span><span class="token field">onSaveInstanceState</span></span><span class="token punctuation">}</span> and
 * <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token namespace">android<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">Activity</span><span class="token punctuation">#</span><span class="token field">onRestoreInstanceState</span></span><span class="token punctuation">}</span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 * Also note that the audio session id (from <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">getAudioSessionId</span></span><span class="token punctuation">}</span>) may
 * change from its previously returned value when the VideoView is restored.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VideoView</span> <span class="token keyword">extends</span> <span class="token class-name">SurfaceView</span>
        <span class="token keyword">implements</span> <span class="token class-name">MediaPlayerControl</span><span class="token punctuation">,</span> <span class="token class-name">SubtitleController<span class="token punctuation">.</span>Anchor</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> TAG <span class="token operator">=</span> <span class="token string">&quot;VideoView&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// settable by the client</span>
    <span class="token keyword">private</span> <span class="token class-name">Uri</span>         mUri<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> mHeaders<span class="token punctuation">;</span>

    <span class="token comment">// all possible internal states</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATE_ERROR              <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATE_IDLE               <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATE_PREPARING          <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATE_PREPARED           <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATE_PLAYING            <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATE_PAUSED             <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STATE_PLAYBACK_COMPLETED <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token comment">// mCurrentState is a VideoView object&#39;s current state.</span>
    <span class="token comment">// mTargetState is the state that a method caller intends to reach.</span>
    <span class="token comment">// For instance, regardless the VideoView object&#39;s current state,</span>
    <span class="token comment">// calling pause() intends to bring the object to a target state</span>
    <span class="token comment">// of STATE_PAUSED.</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> mCurrentState <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> mTargetState  <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>

    <span class="token comment">// All the stuff we need for playing and showing a video</span>
    <span class="token keyword">private</span> <span class="token class-name">SurfaceHolder</span> mSurfaceHolder <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">MediaPlayer</span> mMediaPlayer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span>         mAudioSession<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span>         mVideoWidth<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span>         mVideoHeight<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span>         mSurfaceWidth<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span>         mSurfaceHeight<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">MediaController</span> mMediaController<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">OnCompletionListener</span> mOnCompletionListener<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnPreparedListener</span> mOnPreparedListener<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span>         mCurrentBufferPercentage<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">OnErrorListener</span> mOnErrorListener<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">OnInfoListener</span>  mOnInfoListener<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span>         mSeekWhenPrepared<span class="token punctuation">;</span>  <span class="token comment">// recording the seek position while preparing</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span>     mCanPause<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span>     mCanSeekBack<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span>     mCanSeekForward<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** Subtitle rendering widget overlaid on top of the video. */</span>
    <span class="token keyword">private</span> <span class="token class-name">RenderingWidget</span> mSubtitleWidget<span class="token punctuation">;</span>

    <span class="token doc-comment comment">/** Listener for changes to subtitle data, used to redraw when needed. */</span>
    <span class="token keyword">private</span> <span class="token class-name">RenderingWidget<span class="token punctuation">.</span>OnChangedListener</span> mSubtitlesChangedListener<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">VideoView</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initVideoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">VideoView</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">AttributeSet</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initVideoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">VideoView</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">AttributeSet</span> attrs<span class="token punctuation">,</span> <span class="token keyword">int</span> defStyle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> defStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initVideoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onMeasure</span><span class="token punctuation">(</span><span class="token keyword">int</span> widthMeasureSpec<span class="token punctuation">,</span> <span class="token keyword">int</span> heightMeasureSpec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//Log.i(&quot;@@@@&quot;, &quot;onMeasure(&quot; + MeasureSpec.toString(widthMeasureSpec) + &quot;, &quot;</span>
        <span class="token comment">//        + MeasureSpec.toString(heightMeasureSpec) + &quot;)&quot;);</span>

        <span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">getDefaultSize</span><span class="token punctuation">(</span>mVideoWidth<span class="token punctuation">,</span> widthMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">getDefaultSize</span><span class="token punctuation">(</span>mVideoHeight<span class="token punctuation">,</span> heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mVideoWidth <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> mVideoHeight <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">int</span> widthSpecMode <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> widthSpecSize <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> heightSpecMode <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span>heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> heightSpecSize <span class="token operator">=</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span>heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>widthSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>EXACTLY <span class="token operator">&amp;&amp;</span> heightSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>EXACTLY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// the size is fixed</span>
                width <span class="token operator">=</span> widthSpecSize<span class="token punctuation">;</span>
                height <span class="token operator">=</span> heightSpecSize<span class="token punctuation">;</span>

                <span class="token comment">// for compatibility, we adjust size based on aspect ratio</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span> mVideoWidth <span class="token operator">*</span> height  <span class="token operator">&lt;</span> width <span class="token operator">*</span> mVideoHeight <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//Log.i(&quot;@@@&quot;, &quot;image too wide, correcting&quot;);</span>
                    width <span class="token operator">=</span> height <span class="token operator">*</span> mVideoWidth <span class="token operator">/</span> mVideoHeight<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> mVideoWidth <span class="token operator">*</span> height  <span class="token operator">&gt;</span> width <span class="token operator">*</span> mVideoHeight <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//Log.i(&quot;@@@&quot;, &quot;image too tall, correcting&quot;);</span>
                    height <span class="token operator">=</span> width <span class="token operator">*</span> mVideoHeight <span class="token operator">/</span> mVideoWidth<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>widthSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>EXACTLY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// only the width is fixed, adjust the height to match aspect ratio if possible</span>
                width <span class="token operator">=</span> widthSpecSize<span class="token punctuation">;</span>
                height <span class="token operator">=</span> width <span class="token operator">*</span> mVideoHeight <span class="token operator">/</span> mVideoWidth<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>heightSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>AT_MOST <span class="token operator">&amp;&amp;</span> height <span class="token operator">&gt;</span> heightSpecSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// couldn&#39;t match aspect ratio within the constraints</span>
                    height <span class="token operator">=</span> heightSpecSize<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>heightSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>EXACTLY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// only the height is fixed, adjust the width to match aspect ratio if possible</span>
                height <span class="token operator">=</span> heightSpecSize<span class="token punctuation">;</span>
                width <span class="token operator">=</span> height <span class="token operator">*</span> mVideoWidth <span class="token operator">/</span> mVideoHeight<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>widthSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>AT_MOST <span class="token operator">&amp;&amp;</span> width <span class="token operator">&gt;</span> widthSpecSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// couldn&#39;t match aspect ratio within the constraints</span>
                    width <span class="token operator">=</span> widthSpecSize<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// neither the width nor the height are fixed, try to use actual video size</span>
                width <span class="token operator">=</span> mVideoWidth<span class="token punctuation">;</span>
                height <span class="token operator">=</span> mVideoHeight<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>heightSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>AT_MOST <span class="token operator">&amp;&amp;</span> height <span class="token operator">&gt;</span> heightSpecSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// too tall, decrease both width and height</span>
                    height <span class="token operator">=</span> heightSpecSize<span class="token punctuation">;</span>
                    width <span class="token operator">=</span> height <span class="token operator">*</span> mVideoWidth <span class="token operator">/</span> mVideoHeight<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>widthSpecMode <span class="token operator">==</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>AT_MOST <span class="token operator">&amp;&amp;</span> width <span class="token operator">&gt;</span> widthSpecSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// too wide, decrease both width and height</span>
                    width <span class="token operator">=</span> widthSpecSize<span class="token punctuation">;</span>
                    height <span class="token operator">=</span> width <span class="token operator">*</span> mVideoHeight <span class="token operator">/</span> mVideoWidth<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// no size yet, just adopt the given spec sizes</span>
        <span class="token punctuation">}</span>
        <span class="token function">setMeasuredDimension</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onInitializeAccessibilityEvent</span><span class="token punctuation">(</span><span class="token class-name">AccessibilityEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onInitializeAccessibilityEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
        event<span class="token punctuation">.</span><span class="token function">setClassName</span><span class="token punctuation">(</span><span class="token class-name">VideoView</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onInitializeAccessibilityNodeInfo</span><span class="token punctuation">(</span><span class="token class-name">AccessibilityNodeInfo</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onInitializeAccessibilityNodeInfo</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
        info<span class="token punctuation">.</span><span class="token function">setClassName</span><span class="token punctuation">(</span><span class="token class-name">VideoView</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">resolveAdjustedSize</span><span class="token punctuation">(</span><span class="token keyword">int</span> desiredSize<span class="token punctuation">,</span> <span class="token keyword">int</span> measureSpec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getDefaultSize</span><span class="token punctuation">(</span>desiredSize<span class="token punctuation">,</span> measureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initVideoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mVideoWidth <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        mVideoHeight <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token function">getHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addCallback</span><span class="token punctuation">(</span>mSHCallback<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token class-name">SurfaceHolder</span><span class="token punctuation">.</span>SURFACE_TYPE_PUSH_BUFFERS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setFocusable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setFocusableInTouchMode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPendingSubtitleTracks <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pair</span><span class="token punctuation">&lt;</span><span class="token class-name">InputStream</span><span class="token punctuation">,</span> <span class="token class-name">MediaFormat</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mCurrentState <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>
        mTargetState  <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setVideoPath</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setVideoURI</span><span class="token punctuation">(</span><span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setVideoURI</span><span class="token punctuation">(</span><span class="token class-name">Uri</span> uri<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setVideoURI</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * <span class="token keyword">@hide</span>
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setVideoURI</span><span class="token punctuation">(</span><span class="token class-name">Uri</span> uri<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> headers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mUri <span class="token operator">=</span> uri<span class="token punctuation">;</span>
        mHeaders <span class="token operator">=</span> headers<span class="token punctuation">;</span>
        mSeekWhenPrepared <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token function">openVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">requestLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Adds an external subtitle source file (from the provided input stream.)
     *
     * Note that a single external subtitle source may contain multiple or no
     * supported tracks in it. If the source contained at least one track in
     * it, one will receive an <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">MediaPlayer</span><span class="token punctuation">#</span><span class="token field">MEDIA_INFO_METADATA_UPDATE</span></span><span class="token punctuation">}</span>
     * info message. Otherwise, if reading the source takes excessive time,
     * one will receive a <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">MediaPlayer</span><span class="token punctuation">#</span><span class="token field">MEDIA_INFO_SUBTITLE_TIMED_OUT</span></span><span class="token punctuation">}</span>
     * message. If the source contained no supported track (including an empty
     * source file or null input stream), one will receive a <span class="token punctuation">{</span><span class="token keyword">@link</span>
     * <span class="token reference"><span class="token class-name">MediaPlayer</span><span class="token punctuation">#</span><span class="token field">MEDIA_INFO_UNSUPPORTED_SUBTITLE</span></span><span class="token punctuation">}</span> message. One can find the
     * total number of available tracks using <span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">MediaPlayer</span><span class="token punctuation">#</span><span class="token function">getTrackInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span>
     * to see what additional tracks become available after this method call.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">is</span>     input stream containing the subtitle data.  It will be
     *               closed by the media framework.
     * <span class="token keyword">@param</span> <span class="token parameter">format</span> the format of the subtitle track(s).  Must contain at least
     *               the mime type (<span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">MediaFormat</span><span class="token punctuation">#</span><span class="token field">KEY_MIME</span></span><span class="token punctuation">}</span>) and the
     *               language (<span class="token punctuation">{</span><span class="token keyword">@link</span> <span class="token reference"><span class="token class-name">MediaFormat</span><span class="token punctuation">#</span><span class="token field">KEY_LANGUAGE</span></span><span class="token punctuation">}</span>) of the file.
     *               If the file itself contains the language information,
     *               specify &quot;und&quot; for the language.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addSubtitleSource</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> is<span class="token punctuation">,</span> <span class="token class-name">MediaFormat</span> format<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mPendingSubtitleTracks<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Pair</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span> format<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                mMediaPlayer<span class="token punctuation">.</span><span class="token function">addSubtitleSource</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span> format<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalStateException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mInfoListener<span class="token punctuation">.</span><span class="token function">onInfo</span><span class="token punctuation">(</span>
                        mMediaPlayer<span class="token punctuation">,</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">.</span>MEDIA_INFO_UNSUPPORTED_SUBTITLE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Vector</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Pair</span><span class="token punctuation">&lt;</span><span class="token class-name">InputStream</span><span class="token punctuation">,</span> <span class="token class-name">MediaFormat</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> mPendingSubtitleTracks<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stopPlayback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaPlayer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            mCurrentState <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>
            mTargetState  <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">openVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mUri <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> mSurfaceHolder <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// not ready for playback just yet, will try again later</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// Tell the music playback service to pause</span>
        <span class="token comment">// TODO: these constants need to be published somewhere in the framework.</span>
        <span class="token class-name">Intent</span> i <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token string">&quot;com.android.music.musicservicecommand&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        i<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">&quot;command&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pause&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mContext<span class="token punctuation">.</span><span class="token function">sendBroadcast</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// we shouldn&#39;t clear the target state, because somebody might have</span>
        <span class="token comment">// called start() previously</span>
        <span class="token function">release</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            mMediaPlayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// TODO: create SubtitleController in MediaPlayer, but we need</span>
            <span class="token comment">// a context for the subtitle renderers</span>
            <span class="token keyword">final</span> <span class="token class-name">Context</span> context <span class="token operator">=</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">final</span> <span class="token class-name">SubtitleController</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SubtitleController</span><span class="token punctuation">(</span>
                    context<span class="token punctuation">,</span> mMediaPlayer<span class="token punctuation">.</span><span class="token function">getMediaTimeProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mMediaPlayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            controller<span class="token punctuation">.</span><span class="token function">registerRenderer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebVttRenderer</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">setSubtitleAnchor</span><span class="token punctuation">(</span>controller<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>mAudioSession <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mMediaPlayer<span class="token punctuation">.</span><span class="token function">setAudioSessionId</span><span class="token punctuation">(</span>mAudioSession<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                mAudioSession <span class="token operator">=</span> mMediaPlayer<span class="token punctuation">.</span><span class="token function">getAudioSessionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnPreparedListener</span><span class="token punctuation">(</span>mPreparedListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnVideoSizeChangedListener</span><span class="token punctuation">(</span>mSizeChangedListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnCompletionListener</span><span class="token punctuation">(</span>mCompletionListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnErrorListener</span><span class="token punctuation">(</span>mErrorListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnInfoListener</span><span class="token punctuation">(</span>mInfoListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnBufferingUpdateListener</span><span class="token punctuation">(</span>mBufferingUpdateListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mCurrentBufferPercentage <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>mContext<span class="token punctuation">,</span> mUri<span class="token punctuation">,</span> mHeaders<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">setDisplay</span><span class="token punctuation">(</span>mSurfaceHolder<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">setAudioStreamType</span><span class="token punctuation">(</span><span class="token class-name">AudioManager</span><span class="token punctuation">.</span>STREAM_MUSIC<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">setScreenOnWhilePlaying</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">prepareAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Pair</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">InputStream</span><span class="token punctuation">,</span> <span class="token class-name">MediaFormat</span><span class="token punctuation">&gt;</span></span> pending<span class="token operator">:</span> mPendingSubtitleTracks<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    mMediaPlayer<span class="token punctuation">.</span><span class="token function">addSubtitleSource</span><span class="token punctuation">(</span>pending<span class="token punctuation">.</span>first<span class="token punctuation">,</span> pending<span class="token punctuation">.</span>second<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalStateException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    mInfoListener<span class="token punctuation">.</span><span class="token function">onInfo</span><span class="token punctuation">(</span>
                            mMediaPlayer<span class="token punctuation">,</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">.</span>MEDIA_INFO_UNSUPPORTED_SUBTITLE<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// we don&#39;t set the target state here either, but preserve the</span>
            <span class="token comment">// target state that was there before.</span>
            mCurrentState <span class="token operator">=</span> STATE_PREPARING<span class="token punctuation">;</span>
            <span class="token function">attachMediaController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;Unable to open content: &quot;</span> <span class="token operator">+</span> mUri<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mCurrentState <span class="token operator">=</span> STATE_ERROR<span class="token punctuation">;</span>
            mTargetState <span class="token operator">=</span> STATE_ERROR<span class="token punctuation">;</span>
            mErrorListener<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span>mMediaPlayer<span class="token punctuation">,</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">.</span>MEDIA_ERROR_UNKNOWN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;Unable to open content: &quot;</span> <span class="token operator">+</span> mUri<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mCurrentState <span class="token operator">=</span> STATE_ERROR<span class="token punctuation">;</span>
            mTargetState <span class="token operator">=</span> STATE_ERROR<span class="token punctuation">;</span>
            mErrorListener<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span>mMediaPlayer<span class="token punctuation">,</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">.</span>MEDIA_ERROR_UNKNOWN<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            mPendingSubtitleTracks<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMediaController</span><span class="token punctuation">(</span><span class="token class-name">MediaController</span> controller<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mMediaController<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        mMediaController <span class="token operator">=</span> controller<span class="token punctuation">;</span>
        <span class="token function">attachMediaController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">attachMediaController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mMediaController<span class="token punctuation">.</span><span class="token function">setMediaPlayer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">View</span> anchorView <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">View</span> <span class="token operator">?</span>
                    <span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
            mMediaController<span class="token punctuation">.</span><span class="token function">setAnchorView</span><span class="token punctuation">(</span>anchorView<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaController<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token function">isInPlaybackState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnVideoSizeChangedListener</span> mSizeChangedListener <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnVideoSizeChangedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onVideoSizeChanged</span><span class="token punctuation">(</span><span class="token class-name">MediaPlayer</span> mp<span class="token punctuation">,</span> <span class="token keyword">int</span> width<span class="token punctuation">,</span> <span class="token keyword">int</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mVideoWidth <span class="token operator">=</span> mp<span class="token punctuation">.</span><span class="token function">getVideoWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                mVideoHeight <span class="token operator">=</span> mp<span class="token punctuation">.</span><span class="token function">getVideoHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mVideoWidth <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> mVideoHeight <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">getHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFixedSize</span><span class="token punctuation">(</span>mVideoWidth<span class="token punctuation">,</span> mVideoHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">requestLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnPreparedListener</span> mPreparedListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnPreparedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPrepared</span><span class="token punctuation">(</span><span class="token class-name">MediaPlayer</span> mp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mCurrentState <span class="token operator">=</span> STATE_PREPARED<span class="token punctuation">;</span>

            <span class="token comment">// Get the capabilities of the player for this stream</span>
            <span class="token class-name">Metadata</span> data <span class="token operator">=</span> mp<span class="token punctuation">.</span><span class="token function">getMetadata</span><span class="token punctuation">(</span><span class="token class-name">MediaPlayer</span><span class="token punctuation">.</span>METADATA_ALL<span class="token punctuation">,</span>
                                      <span class="token class-name">MediaPlayer</span><span class="token punctuation">.</span>BYPASS_METADATA_FILTER<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mCanPause <span class="token operator">=</span> <span class="token operator">!</span>data<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token class-name">Metadata</span><span class="token punctuation">.</span>PAUSE_AVAILABLE<span class="token punctuation">)</span>
                        <span class="token operator">||</span> data<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">Metadata</span><span class="token punctuation">.</span>PAUSE_AVAILABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
                mCanSeekBack <span class="token operator">=</span> <span class="token operator">!</span>data<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token class-name">Metadata</span><span class="token punctuation">.</span>SEEK_BACKWARD_AVAILABLE<span class="token punctuation">)</span>
                        <span class="token operator">||</span> data<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">Metadata</span><span class="token punctuation">.</span>SEEK_BACKWARD_AVAILABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
                mCanSeekForward <span class="token operator">=</span> <span class="token operator">!</span>data<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token class-name">Metadata</span><span class="token punctuation">.</span>SEEK_FORWARD_AVAILABLE<span class="token punctuation">)</span>
                        <span class="token operator">||</span> data<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token class-name">Metadata</span><span class="token punctuation">.</span>SEEK_FORWARD_AVAILABLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                mCanPause <span class="token operator">=</span> mCanSeekBack <span class="token operator">=</span> mCanSeekForward <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>mOnPreparedListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mOnPreparedListener<span class="token punctuation">.</span><span class="token function">onPrepared</span><span class="token punctuation">(</span>mMediaPlayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mMediaController<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            mVideoWidth <span class="token operator">=</span> mp<span class="token punctuation">.</span><span class="token function">getVideoWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mVideoHeight <span class="token operator">=</span> mp<span class="token punctuation">.</span><span class="token function">getVideoHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">int</span> seekToPosition <span class="token operator">=</span> mSeekWhenPrepared<span class="token punctuation">;</span>  <span class="token comment">// mSeekWhenPrepared may be changed after seekTo() call</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>seekToPosition <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">seekTo</span><span class="token punctuation">(</span>seekToPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mVideoWidth <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> mVideoHeight <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">//Log.i(&quot;@@@@&quot;, &quot;video size: &quot; + mVideoWidth +&quot;/&quot;+ mVideoHeight);</span>
                <span class="token function">getHolder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setFixedSize</span><span class="token punctuation">(</span>mVideoWidth<span class="token punctuation">,</span> mVideoHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mSurfaceWidth <span class="token operator">==</span> mVideoWidth <span class="token operator">&amp;&amp;</span> mSurfaceHeight <span class="token operator">==</span> mVideoHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// We didn&#39;t actually change the size (it was already at the size</span>
                    <span class="token comment">// we need), so we won&#39;t get a &quot;surface changed&quot; callback, so</span>
                    <span class="token comment">// start the video here instead of in the callback.</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>mTargetState <span class="token operator">==</span> STATE_PLAYING<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            mMediaController<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                               <span class="token punctuation">(</span>seekToPosition <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token function">getCurrentPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                       <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                           <span class="token comment">// Show the media controls when we&#39;re paused into a video and make &#39;em stick.</span>
                           mMediaController<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                       <span class="token punctuation">}</span>
                   <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// We don&#39;t know the video size yet, but should start anyway.</span>
                <span class="token comment">// The video size might be reported to us later.</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mTargetState <span class="token operator">==</span> STATE_PLAYING<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnCompletionListener</span> mCompletionListener <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnCompletionListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCompletion</span><span class="token punctuation">(</span><span class="token class-name">MediaPlayer</span> mp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mCurrentState <span class="token operator">=</span> STATE_PLAYBACK_COMPLETED<span class="token punctuation">;</span>
            mTargetState <span class="token operator">=</span> STATE_PLAYBACK_COMPLETED<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mMediaController<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mOnCompletionListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mOnCompletionListener<span class="token punctuation">.</span><span class="token function">onCompletion</span><span class="token punctuation">(</span>mMediaPlayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnInfoListener</span> mInfoListener <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnInfoListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span>  <span class="token keyword">boolean</span> <span class="token function">onInfo</span><span class="token punctuation">(</span><span class="token class-name">MediaPlayer</span> mp<span class="token punctuation">,</span> <span class="token keyword">int</span> arg1<span class="token punctuation">,</span> <span class="token keyword">int</span> arg2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mOnInfoListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mOnInfoListener<span class="token punctuation">.</span><span class="token function">onInfo</span><span class="token punctuation">(</span>mp<span class="token punctuation">,</span> arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnErrorListener</span> mErrorListener <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnErrorListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onError</span><span class="token punctuation">(</span><span class="token class-name">MediaPlayer</span> mp<span class="token punctuation">,</span> <span class="token keyword">int</span> framework_err<span class="token punctuation">,</span> <span class="token keyword">int</span> impl_err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">&quot;Error: &quot;</span> <span class="token operator">+</span> framework_err <span class="token operator">+</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">+</span> impl_err<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mCurrentState <span class="token operator">=</span> STATE_ERROR<span class="token punctuation">;</span>
            mTargetState <span class="token operator">=</span> STATE_ERROR<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mMediaController<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">/* If an error handler has been supplied, use it and finish. */</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mOnErrorListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mOnErrorListener<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span>mMediaPlayer<span class="token punctuation">,</span> framework_err<span class="token punctuation">,</span> impl_err<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>

            <span class="token comment">/* Otherwise, pop up an error dialog so the user knows that
             * something bad has happened. Only try and pop up the dialog
             * if we&#39;re attached to a window. When we&#39;re going away and no
             * longer have a window, don&#39;t bother showing the user an error.
             */</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">getWindowToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Resources</span> r <span class="token operator">=</span> mContext<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> messageId<span class="token punctuation">;</span>

                <span class="token keyword">if</span> <span class="token punctuation">(</span>framework_err <span class="token operator">==</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">.</span>MEDIA_ERROR_NOT_VALID_FOR_PROGRESSIVE_PLAYBACK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    messageId <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>VideoView_error_text_invalid_progressive_playback<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    messageId <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>VideoView_error_text_unknown<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">new</span> <span class="token class-name">AlertDialog<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>mContext<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setMessage</span><span class="token punctuation">(</span>messageId<span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setPositiveButton</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>string<span class="token punctuation">.</span>VideoView_error_button<span class="token punctuation">,</span>
                                <span class="token keyword">new</span> <span class="token class-name">DialogInterface<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">DialogInterface</span> dialog<span class="token punctuation">,</span> <span class="token keyword">int</span> whichButton<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                        <span class="token comment">/* If we get here, there is no onError listener, so
                                         * at least inform them that the video is over.
                                         */</span>
                                        <span class="token keyword">if</span> <span class="token punctuation">(</span>mOnCompletionListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                            mOnCompletionListener<span class="token punctuation">.</span><span class="token function">onCompletion</span><span class="token punctuation">(</span>mMediaPlayer<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">}</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setCancelable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnBufferingUpdateListener</span> mBufferingUpdateListener <span class="token operator">=</span>
        <span class="token keyword">new</span> <span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnBufferingUpdateListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onBufferingUpdate</span><span class="token punctuation">(</span><span class="token class-name">MediaPlayer</span> mp<span class="token punctuation">,</span> <span class="token keyword">int</span> percent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mCurrentBufferPercentage <span class="token operator">=</span> percent<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token doc-comment comment">/**
     * Register a callback to be invoked when the media file
     * is loaded and ready to go.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">l</span> The callback that will be run
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOnPreparedListener</span><span class="token punctuation">(</span><span class="token class-name">MediaPlayer<span class="token punctuation">.</span>OnPreparedListener</span> l<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        mOnPreparedListener <span class="token operator">=</span> l<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Register a callback to be invoked when the end of a media file
     * has been reached during playback.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">l</span> The callback that will be run
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOnCompletionListener</span><span class="token punctuation">(</span><span class="token class-name">OnCompletionListener</span> l<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        mOnCompletionListener <span class="token operator">=</span> l<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Register a callback to be invoked when an error occurs
     * during playback or setup.  If no listener is specified,
     * or if the listener returned false, VideoView will inform
     * the user of any errors.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">l</span> The callback that will be run
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOnErrorListener</span><span class="token punctuation">(</span><span class="token class-name">OnErrorListener</span> l<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        mOnErrorListener <span class="token operator">=</span> l<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Register a callback to be invoked when an informational event
     * occurs during playback or setup.
     *
     * <span class="token keyword">@param</span> <span class="token parameter">l</span> The callback that will be run
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOnInfoListener</span><span class="token punctuation">(</span><span class="token class-name">OnInfoListener</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mOnInfoListener <span class="token operator">=</span> l<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">SurfaceHolder<span class="token punctuation">.</span>Callback</span> mSHCallback <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SurfaceHolder<span class="token punctuation">.</span>Callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">surfaceChanged</span><span class="token punctuation">(</span><span class="token class-name">SurfaceHolder</span> holder<span class="token punctuation">,</span> <span class="token keyword">int</span> format<span class="token punctuation">,</span>
                                    <span class="token keyword">int</span> w<span class="token punctuation">,</span> <span class="token keyword">int</span> h<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            mSurfaceWidth <span class="token operator">=</span> w<span class="token punctuation">;</span>
            mSurfaceHeight <span class="token operator">=</span> h<span class="token punctuation">;</span>
            <span class="token keyword">boolean</span> isValidState <span class="token operator">=</span>  <span class="token punctuation">(</span>mTargetState <span class="token operator">==</span> STATE_PLAYING<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">boolean</span> hasValidSize <span class="token operator">=</span> <span class="token punctuation">(</span>mVideoWidth <span class="token operator">==</span> w <span class="token operator">&amp;&amp;</span> mVideoHeight <span class="token operator">==</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> isValidState <span class="token operator">&amp;&amp;</span> hasValidSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mSeekWhenPrepared <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">seekTo</span><span class="token punctuation">(</span>mSeekWhenPrepared<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">surfaceCreated</span><span class="token punctuation">(</span><span class="token class-name">SurfaceHolder</span> holder<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            mSurfaceHolder <span class="token operator">=</span> holder<span class="token punctuation">;</span>
            <span class="token function">openVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">surfaceDestroyed</span><span class="token punctuation">(</span><span class="token class-name">SurfaceHolder</span> holder<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// after we return from this we can&#39;t use the surface any more</span>
            mSurfaceHolder <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> mMediaController<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">release</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">/*
     * release the media player in any state
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> cleartargetstate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaPlayer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            mPendingSubtitleTracks<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mCurrentState <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>cleartargetstate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mTargetState  <span class="token operator">=</span> STATE_IDLE<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInPlaybackState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">toggleMediaControlsVisiblity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTrackballEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInPlaybackState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">toggleMediaControlsVisiblity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onKeyDown</span><span class="token punctuation">(</span><span class="token keyword">int</span> keyCode<span class="token punctuation">,</span> <span class="token class-name">KeyEvent</span> event<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">boolean</span> isKeyCodeSupported <span class="token operator">=</span> keyCode <span class="token operator">!=</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_BACK <span class="token operator">&amp;&amp;</span>
                                     keyCode <span class="token operator">!=</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_VOLUME_UP <span class="token operator">&amp;&amp;</span>
                                     keyCode <span class="token operator">!=</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_VOLUME_DOWN <span class="token operator">&amp;&amp;</span>
                                     keyCode <span class="token operator">!=</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_VOLUME_MUTE <span class="token operator">&amp;&amp;</span>
                                     keyCode <span class="token operator">!=</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_MENU <span class="token operator">&amp;&amp;</span>
                                     keyCode <span class="token operator">!=</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_CALL <span class="token operator">&amp;&amp;</span>
                                     keyCode <span class="token operator">!=</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_ENDCALL<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInPlaybackState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> isKeyCodeSupported <span class="token operator">&amp;&amp;</span> mMediaController <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_HEADSETHOOK <span class="token operator">||</span>
                    keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_MEDIA_PLAY_PAUSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mMediaController<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mMediaController<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_MEDIA_PLAY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mMediaPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mMediaController<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_MEDIA_STOP
                    <span class="token operator">||</span> keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_MEDIA_PAUSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mMediaController<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">toggleMediaControlsVisiblity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onKeyDown</span><span class="token punctuation">(</span>keyCode<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">toggleMediaControlsVisiblity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaController<span class="token punctuation">.</span><span class="token function">isShowing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mMediaController<span class="token punctuation">.</span><span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            mMediaController<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInPlaybackState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mCurrentState <span class="token operator">=</span> STATE_PLAYING<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        mTargetState <span class="token operator">=</span> STATE_PLAYING<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInPlaybackState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mMediaPlayer<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                mCurrentState <span class="token operator">=</span> STATE_PAUSED<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        mTargetState <span class="token operator">=</span> STATE_PAUSED<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">suspend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">release</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">openVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInPlaybackState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> mMediaPlayer<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCurrentPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInPlaybackState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> mMediaPlayer<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">seekTo</span><span class="token punctuation">(</span><span class="token keyword">int</span> msec<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isInPlaybackState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">seekTo</span><span class="token punctuation">(</span>msec<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mSeekWhenPrepared <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            mSeekWhenPrepared <span class="token operator">=</span> msec<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">isInPlaybackState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> mMediaPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getBufferPercentage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> mCurrentBufferPercentage<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isInPlaybackState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>mMediaPlayer <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
                mCurrentState <span class="token operator">!=</span> STATE_ERROR <span class="token operator">&amp;&amp;</span>
                mCurrentState <span class="token operator">!=</span> STATE_IDLE <span class="token operator">&amp;&amp;</span>
                mCurrentState <span class="token operator">!=</span> STATE_PREPARING<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">canPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mCanPause<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">canSeekBackward</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mCanSeekBack<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">canSeekForward</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mCanSeekForward<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getAudioSessionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mAudioSession <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">MediaPlayer</span> foo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mAudioSession <span class="token operator">=</span> foo<span class="token punctuation">.</span><span class="token function">getAudioSessionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            foo<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> mAudioSession<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onAttachedToWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onAttachedToWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mSubtitleWidget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mSubtitleWidget<span class="token punctuation">.</span><span class="token function">onAttachedToWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDetachedFromWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDetachedFromWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mSubtitleWidget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mSubtitleWidget<span class="token punctuation">.</span><span class="token function">onDetachedFromWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onLayout</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> changed<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> top<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span> <span class="token keyword">int</span> bottom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onLayout</span><span class="token punctuation">(</span>changed<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mSubtitleWidget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">measureAndLayoutSubtitleWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">draw</span><span class="token punctuation">(</span><span class="token class-name">Canvas</span> canvas<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mSubtitleWidget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token keyword">int</span> saveCount <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            canvas<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token function">getPaddingLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getPaddingTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mSubtitleWidget<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
            canvas<span class="token punctuation">.</span><span class="token function">restoreToCount</span><span class="token punctuation">(</span>saveCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Forces a measurement and layout pass for all overlaid views.
     *
     * <span class="token keyword">@see</span> <span class="token reference"><span class="token punctuation">#</span><span class="token function">setSubtitleWidget</span><span class="token punctuation">(</span><span class="token class-name">RenderingWidget</span><span class="token punctuation">)</span></span>
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">measureAndLayoutSubtitleWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">getPaddingLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">getPaddingRight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">getPaddingTop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">getPaddingBottom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        mSubtitleWidget<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span>width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/** <span class="token keyword">@hide</span> */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSubtitleWidget</span><span class="token punctuation">(</span><span class="token class-name">RenderingWidget</span> subtitleWidget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mSubtitleWidget <span class="token operator">==</span> subtitleWidget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">final</span> <span class="token keyword">boolean</span> attachedToWindow <span class="token operator">=</span> <span class="token function">isAttachedToWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mSubtitleWidget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>attachedToWindow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mSubtitleWidget<span class="token punctuation">.</span><span class="token function">onDetachedFromWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            mSubtitleWidget<span class="token punctuation">.</span><span class="token function">setOnChangedListener</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        mSubtitleWidget <span class="token operator">=</span> subtitleWidget<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>subtitleWidget <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mSubtitlesChangedListener <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mSubtitlesChangedListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RenderingWidget<span class="token punctuation">.</span>OnChangedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onChanged</span><span class="token punctuation">(</span><span class="token class-name">RenderingWidget</span> renderingWidget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token function">setWillNotDraw</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            subtitleWidget<span class="token punctuation">.</span><span class="token function">setOnChangedListener</span><span class="token punctuation">(</span>mSubtitlesChangedListener<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>attachedToWindow<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                subtitleWidget<span class="token punctuation">.</span><span class="token function">onAttachedToWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">requestLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token function">setWillNotDraw</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/** <span class="token keyword">@hide</span> */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Looper</span> <span class="token function">getSubtitleLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Looper</span><span class="token punctuation">.</span><span class="token function">getMainLooper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mediaplayercontrol" tabindex="-1"><a class="header-anchor" href="#mediaplayercontrol" aria-hidden="true">#</a> MediaPlayerControl</h2><p>通过该接口来打通MediaController以及VideoView</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MediaPlayerControl</span> <span class="token punctuation">{</span>
   <span class="token keyword">void</span>    <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">void</span>    <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span>     <span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span>     <span class="token function">getCurrentPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">void</span>    <span class="token function">seekTo</span><span class="token punctuation">(</span><span class="token keyword">int</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">boolean</span> <span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">int</span>     <span class="token function">getBufferPercentage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">boolean</span> <span class="token function">canPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">boolean</span> <span class="token function">canSeekBackward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">boolean</span> <span class="token function">canSeekForward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token doc-comment comment">/**
    * Get the audio session id for the player used by this VideoView. This can be used to
    * apply audio effects to the audio track of a video.
    * <span class="token keyword">@return</span> The audio session, or 0 if there was an error.
    */</span>
   <span class="token keyword">int</span>     <span class="token function">getAudioSessionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="mediacontroller" tabindex="-1"><a class="header-anchor" href="#mediacontroller" aria-hidden="true">#</a> MediaController</h2><ul><li><p>简介</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
* A view containing controls for a MediaPlayer. Typically contains the
* buttons like &quot;Play/Pause&quot;, &quot;Rewind&quot;, &quot;Fast Forward&quot; and a progress
* slider. It takes care of synchronizing the controls with the state
* of the MediaPlayer.
* <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
* The way to use this class is to instantiate it programatically.
* The MediaController will create a default set of controls
* and put them in a window floating above your application. Specifically,
* the controls will float above the view specified with setAnchorView().
* The window will disappear if left idle for three seconds and reappear
* when the user touches the anchor view.
* <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
* Functions like show() and hide() have no effect when MediaController
* is created in an xml layout.
* 
* MediaController will hide and
* show the buttons according to these rules:
* <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
* <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> The &quot;previous&quot; and &quot;next&quot; buttons are hidden until setPrevNextListeners()
*   has been called
* <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> The &quot;previous&quot; and &quot;next&quot; buttons are visible but disabled if
*   setPrevNextListeners() was called with null listeners
* <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> The &quot;rewind&quot; and &quot;fastforward&quot; buttons are shown unless requested
*   otherwise by using the MediaController(Context, boolean) constructor
*   with the boolean set to false
* <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
*/</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>关系</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MediaController</span> <span class="token keyword">extends</span> <span class="token class-name">FrameLayout</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></li><li><p>成员</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 一些控制功能的接口</span>
<span class="token keyword">private</span> <span class="token class-name">MediaPlayerControl</span>  mPlayer<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">Context</span>             mContext<span class="token punctuation">;</span>
<span class="token comment">// VideoView中调用setAnchorView()设置进来的View，MediaController显示的时候会感觉该AnchorView的位置进行显示</span>
<span class="token keyword">private</span> <span class="token class-name">View</span>                mAnchor<span class="token punctuation">;</span>
<span class="token comment">// MediaController最外层的根布局</span>
<span class="token keyword">private</span> <span class="token class-name">View</span>                mRoot<span class="token punctuation">;</span>

<span class="token comment">// 通过Window的方式来显示MediaController，MediaController是一个填充屏幕的布局，但是背景是透明的</span>
<span class="token keyword">private</span> <span class="token class-name">WindowManager</span>       mWindowManager<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">Window</span>              mWindow<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">View</span>                mDecor<span class="token punctuation">;</span>
<span class="token comment">// 理解为当前整个MediaController的布局</span>
<span class="token keyword">private</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span> mDecorLayoutParams<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">ProgressBar</span>         mProgress<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">TextView</span>            mEndTime<span class="token punctuation">,</span> mCurrentTime<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">boolean</span>             mShowing<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">boolean</span>             mDragging<span class="token punctuation">;</span>
<span class="token comment">// 默认自动消失的时间</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span>    sDefaultTimeout <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span>    FADE_OUT <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span>    SHOW_PROGRESS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">boolean</span>             mUseFastForward<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">boolean</span>             mFromXml<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token keyword">boolean</span>             mListenersSet<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span> mNextListener<span class="token punctuation">,</span> mPrevListener<span class="token punctuation">;</span>
<span class="token class-name">StringBuilder</span>               mFormatBuilder<span class="token punctuation">;</span>
<span class="token class-name">Formatter</span>                   mFormatter<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">ImageButton</span>         mPauseButton<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">ImageButton</span>         mFfwdButton<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">ImageButton</span>         mRewButton<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">ImageButton</span>         mNextButton<span class="token punctuation">;</span>
<span class="token keyword">private</span> <span class="token class-name">ImageButton</span>         mPrevButton<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>构造方法</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">MediaController</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">AttributeSet</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mRoot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    mContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
    mUseFastForward <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    mFromXml <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFinishInflate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mRoot <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token function">initControllerView</span><span class="token punctuation">(</span>mRoot<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">MediaController</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token keyword">boolean</span> useFastForward<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
    mUseFastForward <span class="token operator">=</span> useFastForward<span class="token punctuation">;</span>
	<span class="token comment">// 创建该MediaController的布局</span>
    <span class="token function">initFloatingWindowLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">initFloatingWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token class-name">MediaController</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>initFloatingWindowLayout</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Allocate and initialize the static parts of mDecorLayoutParams. Must</span>
<span class="token comment">// also call updateFloatingWindowLayout() to fill in the dynamic parts</span>
<span class="token comment">// (y and width) before mDecorLayoutParams can be used.</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initFloatingWindowLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	mDecorLayoutParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span> p <span class="token operator">=</span> mDecorLayoutParams<span class="token punctuation">;</span>
	p<span class="token punctuation">.</span>gravity <span class="token operator">=</span> <span class="token class-name">Gravity</span><span class="token punctuation">.</span>TOP <span class="token operator">|</span> <span class="token class-name">Gravity</span><span class="token punctuation">.</span>LEFT<span class="token punctuation">;</span>
	p<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token class-name">LayoutParams</span><span class="token punctuation">.</span>WRAP_CONTENT<span class="token punctuation">;</span>
	p<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	p<span class="token punctuation">.</span>format <span class="token operator">=</span> <span class="token class-name">PixelFormat</span><span class="token punctuation">.</span>TRANSLUCENT<span class="token punctuation">;</span>
	p<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>TYPE_APPLICATION_PANEL<span class="token punctuation">;</span>
	p<span class="token punctuation">.</span>flags <span class="token operator">|=</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>FLAG_ALT_FOCUSABLE_IM
			<span class="token operator">|</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>FLAG_NOT_TOUCH_MODAL
			<span class="token operator">|</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>FLAG_SPLIT_TOUCH<span class="token punctuation">;</span>
	p<span class="token punctuation">.</span>token <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
	p<span class="token punctuation">.</span>windowAnimations <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// android.R.style.DropDownAnimationDown;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>initFloatingWindow</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initFloatingWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Android内核剖析 中有介绍</span>
	mWindowManager <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">WindowManager</span><span class="token punctuation">)</span>mContext<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>WINDOW_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	mWindow <span class="token operator">=</span> <span class="token class-name">PolicyManager</span><span class="token punctuation">.</span><span class="token function">makeNewWindow</span><span class="token punctuation">(</span>mContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
	mWindow<span class="token punctuation">.</span><span class="token function">setWindowManager</span><span class="token punctuation">(</span>mWindowManager<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mWindow<span class="token punctuation">.</span><span class="token function">requestFeature</span><span class="token punctuation">(</span><span class="token class-name">Window</span><span class="token punctuation">.</span>FEATURE_NO_TITLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 通过WindowManager去add该Decor以及remove来实现MediaController的显示与隐藏</span>
	mDecor <span class="token operator">=</span> mWindow<span class="token punctuation">.</span><span class="token function">getDecorView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mDecor<span class="token punctuation">.</span><span class="token function">setOnTouchListener</span><span class="token punctuation">(</span>mTouchListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
	mWindow<span class="token punctuation">.</span><span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	mWindow<span class="token punctuation">.</span><span class="token function">setBackgroundDrawableResource</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>color<span class="token punctuation">.</span>transparent<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// While the media controller is up, the volume control keys should</span>
	<span class="token comment">// affect the media stream type</span>
	mWindow<span class="token punctuation">.</span><span class="token function">setVolumeControlStream</span><span class="token punctuation">(</span><span class="token class-name">AudioManager</span><span class="token punctuation">.</span>STREAM_MUSIC<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">setFocusable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setFocusableInTouchMode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">setDescendantFocusability</span><span class="token punctuation">(</span><span class="token class-name">ViewGroup</span><span class="token punctuation">.</span>FOCUS_AFTER_DESCENDANTS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>mTouchListener</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token class-name">OnTouchListener</span> mTouchListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OnTouchListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouch</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">,</span> <span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>mShowing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
				<span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>setMediaPlayer VideoView调用setMediaController的时候会调用到该方法</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMediaPlayer</span><span class="token punctuation">(</span><span class="token class-name">MediaPlayerControl</span> player<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	mPlayer <span class="token operator">=</span> player<span class="token punctuation">;</span>
	<span class="token function">updatePausePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>setAnchorView VideoView调用setMediaController的时候会调用到该方法</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Set the view that acts as the anchor for the control view.
 * This can for example be a VideoView, or your Activity&#39;s main view.
 * When VideoView calls this method, it will use the VideoView&#39;s parent
 * as the anchor.
 * <span class="token keyword">@param</span> <span class="token parameter">view</span> The view to which to anchor the controller when it is visible.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAnchorView</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mAnchor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mAnchor<span class="token punctuation">.</span><span class="token function">removeOnLayoutChangeListener</span><span class="token punctuation">(</span>mLayoutChangeListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	mAnchor <span class="token operator">=</span> view<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mAnchor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mAnchor<span class="token punctuation">.</span><span class="token function">addOnLayoutChangeListener</span><span class="token punctuation">(</span>mLayoutChangeListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token class-name">FrameLayout<span class="token punctuation">.</span>LayoutParams</span> frameParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FrameLayout<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">(</span>
			<span class="token class-name">ViewGroup<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>MATCH_PARENT<span class="token punctuation">,</span>
			<span class="token class-name">ViewGroup<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>MATCH_PARENT
	<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">removeAllViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">View</span> v <span class="token operator">=</span> <span class="token function">makeControllerView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">addView</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> frameParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>mLayoutChangeListener</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// This is called whenever mAnchor&#39;s layout bound changes</span>
<span class="token keyword">private</span> <span class="token class-name">OnLayoutChangeListener</span> mLayoutChangeListener <span class="token operator">=</span>
		<span class="token keyword">new</span> <span class="token class-name">OnLayoutChangeListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLayoutChange</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> top<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span>
			<span class="token keyword">int</span> bottom<span class="token punctuation">,</span> <span class="token keyword">int</span> oldLeft<span class="token punctuation">,</span> <span class="token keyword">int</span> oldTop<span class="token punctuation">,</span> <span class="token keyword">int</span> oldRight<span class="token punctuation">,</span>
			<span class="token keyword">int</span> oldBottom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 更新布局</span>
		<span class="token function">updateFloatingWindowLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mShowing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			mWindowManager<span class="token punctuation">.</span><span class="token function">updateViewLayout</span><span class="token punctuation">(</span>mDecor<span class="token punctuation">,</span> mDecorLayoutParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>updateFloatingWindowLayout<div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// Update the dynamic parts of mDecorLayoutParams</span>
<span class="token comment">// Must be called with mAnchor != NULL.</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updateFloatingWindowLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">int</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> anchorPos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	mAnchor<span class="token punctuation">.</span><span class="token function">getLocationOnScreen</span><span class="token punctuation">(</span>anchorPos<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// we need to know the size of the controller so we can properly position it</span>
	<span class="token comment">// within its space</span>
	mDecor<span class="token punctuation">.</span><span class="token function">measure</span><span class="token punctuation">(</span><span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">makeMeasureSpec</span><span class="token punctuation">(</span>mAnchor<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>AT_MOST<span class="token punctuation">)</span><span class="token punctuation">,</span>
			<span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">makeMeasureSpec</span><span class="token punctuation">(</span>mAnchor<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>AT_MOST<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span> p <span class="token operator">=</span> mDecorLayoutParams<span class="token punctuation">;</span>
	p<span class="token punctuation">.</span>width <span class="token operator">=</span> mAnchor<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	p<span class="token punctuation">.</span>x <span class="token operator">=</span> anchorPos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>mAnchor<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> p<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
	p<span class="token punctuation">.</span>y <span class="token operator">=</span> anchorPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> mAnchor<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> mDecor<span class="token punctuation">.</span><span class="token function">getMeasuredHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>makeControllerView</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Create the view that holds the widgets that control playback.
 * Derived classes can override this to create their own.
 * <span class="token keyword">@return</span> The controller view.
 * <span class="token keyword">@hide</span> This doesn&#39;t work as advertised
 */</span>
<span class="token keyword">protected</span> <span class="token class-name">View</span> <span class="token function">makeControllerView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token class-name">LayoutInflater</span> inflate <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LayoutInflater</span><span class="token punctuation">)</span> mContext<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>LAYOUT_INFLATER_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	mRoot <span class="token operator">=</span> inflate<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>media_controller<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 对Controller中的一些按钮、功能进行事件设置</span>
	<span class="token function">initControllerView</span><span class="token punctuation">(</span>mRoot<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> mRoot<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p>touch事件处理</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">show</span><span class="token punctuation">(</span>sDefaultTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>进度的处理</p><ul><li><p>seekBar的处理</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// There are two scenarios that can trigger the seekbar listener to trigger:</span>
<span class="token comment">//</span>
<span class="token comment">// The first is the user using the touchpad to adjust the posititon of the</span>
<span class="token comment">// seekbar&#39;s thumb. In this case onStartTrackingTouch is called followed by</span>
<span class="token comment">// a number of onProgressChanged notifications, concluded by onStopTrackingTouch.</span>
<span class="token comment">// We&#39;re setting the field &quot;mDragging&quot; to true for the duration of the dragging</span>
<span class="token comment">// session to avoid jumps in the position in case of ongoing playback.</span>
<span class="token comment">//</span>
<span class="token comment">// The second scenario involves the user operating the scroll ball, in this</span>
<span class="token comment">// case there WON&#39;T BE onStartTrackingTouch/onStopTrackingTouch notifications,</span>
<span class="token comment">// we will simply apply the updated position without suspending regular updates.</span>
<span class="token keyword">private</span> <span class="token class-name">OnSeekBarChangeListener</span> mSeekListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OnSeekBarChangeListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStartTrackingTouch</span><span class="token punctuation">(</span><span class="token class-name">SeekBar</span> bar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">show</span><span class="token punctuation">(</span><span class="token number">3600000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		mDragging <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

		<span class="token comment">// By removing these pending progress messages we make sure</span>
		<span class="token comment">// that a) we won&#39;t update the progress while the user adjusts</span>
		<span class="token comment">// the seekbar and b) once the user is done dragging the thumb</span>
		<span class="token comment">// we will post one of these messages to the queue again and</span>
		<span class="token comment">// this ensures that there will be exactly one message queued up.</span>
		mHandler<span class="token punctuation">.</span><span class="token function">removeMessages</span><span class="token punctuation">(</span>SHOW_PROGRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onProgressChanged</span><span class="token punctuation">(</span><span class="token class-name">SeekBar</span> bar<span class="token punctuation">,</span> <span class="token keyword">int</span> progress<span class="token punctuation">,</span> <span class="token keyword">boolean</span> fromuser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fromuser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// We&#39;re not interested in programmatically generated changes to</span>
			<span class="token comment">// the progress bar&#39;s position.</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">long</span> duration <span class="token operator">=</span> mPlayer<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">long</span> newposition <span class="token operator">=</span> <span class="token punctuation">(</span>duration <span class="token operator">*</span> progress<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000L</span><span class="token punctuation">;</span>
		mPlayer<span class="token punctuation">.</span><span class="token function">seekTo</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> newposition<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>mCurrentTime <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
			mCurrentTime<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">stringForTime</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> newposition<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStopTrackingTouch</span><span class="token punctuation">(</span><span class="token class-name">SeekBar</span> bar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		mDragging <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">updatePausePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">show</span><span class="token punctuation">(</span>sDefaultTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// Ensure that progress is properly updated in the future,</span>
		<span class="token comment">// the call to show() does not guarantee this because it is a</span>
		<span class="token comment">// no-op if we are already showing.</span>
		mHandler<span class="token punctuation">.</span><span class="token function">sendEmptyMessage</span><span class="token punctuation">(</span>SHOW_PROGRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>SetProgress</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mPlayer <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> mDragging<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">int</span> position <span class="token operator">=</span> mPlayer<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> duration <span class="token operator">=</span> mPlayer<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mProgress <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>duration <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token comment">// use long to avoid overflow</span>
			<span class="token keyword">long</span> pos <span class="token operator">=</span> <span class="token number">1000L</span> <span class="token operator">*</span> position <span class="token operator">/</span> duration<span class="token punctuation">;</span>
			mProgress<span class="token punctuation">.</span><span class="token function">setProgress</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">int</span> percent <span class="token operator">=</span> mPlayer<span class="token punctuation">.</span><span class="token function">getBufferPercentage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mProgress<span class="token punctuation">.</span><span class="token function">setSecondaryProgress</span><span class="token punctuation">(</span>percent <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>mEndTime <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
		mEndTime<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">stringForTime</span><span class="token punctuation">(</span>duration<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mCurrentTime <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
		mCurrentTime<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">stringForTime</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> position<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>show</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Show the controller on screen. It will go away
 * automatically after &#39;timeout&#39; milliseconds of inactivity.
 * <span class="token keyword">@param</span> <span class="token parameter">timeout</span> The timeout in milliseconds. Use 0 to show
 * the controller until hide() is called.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token keyword">int</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mShowing <span class="token operator">&amp;&amp;</span> mAnchor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 先去设置一下进度</span>
        <span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mPauseButton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mPauseButton<span class="token punctuation">.</span><span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">disableUnsupportedButtons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">updateFloatingWindowLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mWindowManager<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span>mDecor<span class="token punctuation">,</span> mDecorLayoutParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mShowing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">updatePausePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// cause the progress bar to be updated even if mShowing</span>
    <span class="token comment">// was already true.  This happens, for example, if we&#39;re</span>
    <span class="token comment">// paused with the progress bar showing the user hits play.</span>
	<span class="token comment">// 发送定期更新进度的消息</span>
    mHandler<span class="token punctuation">.</span><span class="token function">sendEmptyMessage</span><span class="token punctuation">(</span>SHOW_PROGRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Message</span> msg <span class="token operator">=</span> mHandler<span class="token punctuation">.</span><span class="token function">obtainMessage</span><span class="token punctuation">(</span>FADE_OUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mHandler<span class="token punctuation">.</span><span class="token function">removeMessages</span><span class="token punctuation">(</span>FADE_OUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mHandler<span class="token punctuation">.</span><span class="token function">sendMessageDelayed</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>hide</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * Remove the controller from the screen.
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>mAnchor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>mShowing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">try</span> <span class="token punctuation">{</span>
			<span class="token comment">// 移除定期更新消息</span>
			mHandler<span class="token punctuation">.</span><span class="token function">removeMessages</span><span class="token punctuation">(</span>SHOW_PROGRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
			mWindowManager<span class="token punctuation">.</span><span class="token function">removeView</span><span class="token punctuation">(</span>mDecor<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token string">&quot;MediaController&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;already removed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		mShowing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li></ul></li></ul><h1 id="上源码" tabindex="-1"><a class="header-anchor" href="#上源码" aria-hidden="true">#</a> 上源码</h1><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/*
 * Copyright (C) 2006 The Android Open Source Project
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="token keyword">package</span> <span class="token namespace">android<span class="token punctuation">.</span>widget</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>content<span class="token punctuation">.</span></span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span></span><span class="token class-name">PixelFormat</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>media<span class="token punctuation">.</span></span><span class="token class-name">AudioManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Handler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Message</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">AttributeSet</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Log</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">Gravity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">KeyEvent</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">LayoutInflater</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">MotionEvent</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">ViewGroup</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">Window</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">WindowManager</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span>accessibility<span class="token punctuation">.</span></span><span class="token class-name">AccessibilityEvent</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span>accessibility<span class="token punctuation">.</span></span><span class="token class-name">AccessibilityNodeInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">SeekBar</span><span class="token punctuation">.</span><span class="token class-name">OnSeekBarChangeListener</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>policy<span class="token punctuation">.</span></span><span class="token class-name">PolicyManager</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Formatter</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Locale</span></span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * A view containing controls for a MediaPlayer. Typically contains the
 * buttons like &quot;Play/Pause&quot;, &quot;Rewind&quot;, &quot;Fast Forward&quot; and a progress
 * slider. It takes care of synchronizing the controls with the state
 * of the MediaPlayer.
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 * The way to use this class is to instantiate it programatically.
 * The MediaController will create a default set of controls
 * and put them in a window floating above your application. Specifically,
 * the controls will float above the view specified with setAnchorView().
 * The window will disappear if left idle for three seconds and reappear
 * when the user touches the anchor view.
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
 * Functions like show() and hide() have no effect when MediaController
 * is created in an xml layout.
 * 
 * MediaController will hide and
 * show the buttons according to these rules:
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> The &quot;previous&quot; and &quot;next&quot; buttons are hidden until setPrevNextListeners()
 *   has been called
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> The &quot;previous&quot; and &quot;next&quot; buttons are visible but disabled if
 *   setPrevNextListeners() was called with null listeners
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span> The &quot;rewind&quot; and &quot;fastforward&quot; buttons are shown unless requested
 *   otherwise by using the MediaController(Context, boolean) constructor
 *   with the boolean set to false
 * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MediaController</span> <span class="token keyword">extends</span> <span class="token class-name">FrameLayout</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">MediaPlayerControl</span>  mPlayer<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Context</span>             mContext<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">View</span>                mAnchor<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">View</span>                mRoot<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">WindowManager</span>       mWindowManager<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Window</span>              mWindow<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">View</span>                mDecor<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span> mDecorLayoutParams<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ProgressBar</span>         mProgress<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">TextView</span>            mEndTime<span class="token punctuation">,</span> mCurrentTime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span>             mShowing<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span>             mDragging<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span>    sDefaultTimeout <span class="token operator">=</span> <span class="token number">3000</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span>    FADE_OUT <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span>    SHOW_PROGRESS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span>             mUseFastForward<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span>             mFromXml<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span>             mListenersSet<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span> mNextListener<span class="token punctuation">,</span> mPrevListener<span class="token punctuation">;</span>
    <span class="token class-name">StringBuilder</span>               mFormatBuilder<span class="token punctuation">;</span>
    <span class="token class-name">Formatter</span>                   mFormatter<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ImageButton</span>         mPauseButton<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ImageButton</span>         mFfwdButton<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ImageButton</span>         mRewButton<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ImageButton</span>         mNextButton<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">ImageButton</span>         mPrevButton<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MediaController</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">AttributeSet</span> attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mRoot <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
        mContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
        mUseFastForward <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        mFromXml <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onFinishInflate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mRoot <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token function">initControllerView</span><span class="token punctuation">(</span>mRoot<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">MediaController</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token keyword">boolean</span> useFastForward<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
        mUseFastForward <span class="token operator">=</span> useFastForward<span class="token punctuation">;</span>
        <span class="token function">initFloatingWindowLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initFloatingWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">MediaController</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initFloatingWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mWindowManager <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">WindowManager</span><span class="token punctuation">)</span>mContext<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>WINDOW_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mWindow <span class="token operator">=</span> <span class="token class-name">PolicyManager</span><span class="token punctuation">.</span><span class="token function">makeNewWindow</span><span class="token punctuation">(</span>mContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mWindow<span class="token punctuation">.</span><span class="token function">setWindowManager</span><span class="token punctuation">(</span>mWindowManager<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mWindow<span class="token punctuation">.</span><span class="token function">requestFeature</span><span class="token punctuation">(</span><span class="token class-name">Window</span><span class="token punctuation">.</span>FEATURE_NO_TITLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mDecor <span class="token operator">=</span> mWindow<span class="token punctuation">.</span><span class="token function">getDecorView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mDecor<span class="token punctuation">.</span><span class="token function">setOnTouchListener</span><span class="token punctuation">(</span>mTouchListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mWindow<span class="token punctuation">.</span><span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mWindow<span class="token punctuation">.</span><span class="token function">setBackgroundDrawableResource</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>color<span class="token punctuation">.</span>transparent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// While the media controller is up, the volume control keys should</span>
        <span class="token comment">// affect the media stream type</span>
        mWindow<span class="token punctuation">.</span><span class="token function">setVolumeControlStream</span><span class="token punctuation">(</span><span class="token class-name">AudioManager</span><span class="token punctuation">.</span>STREAM_MUSIC<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">setFocusable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setFocusableInTouchMode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setDescendantFocusability</span><span class="token punctuation">(</span><span class="token class-name">ViewGroup</span><span class="token punctuation">.</span>FOCUS_AFTER_DESCENDANTS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Allocate and initialize the static parts of mDecorLayoutParams. Must</span>
    <span class="token comment">// also call updateFloatingWindowLayout() to fill in the dynamic parts</span>
    <span class="token comment">// (y and width) before mDecorLayoutParams can be used.</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initFloatingWindowLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mDecorLayoutParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span> p <span class="token operator">=</span> mDecorLayoutParams<span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>gravity <span class="token operator">=</span> <span class="token class-name">Gravity</span><span class="token punctuation">.</span>TOP <span class="token operator">|</span> <span class="token class-name">Gravity</span><span class="token punctuation">.</span>LEFT<span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token class-name">LayoutParams</span><span class="token punctuation">.</span>WRAP_CONTENT<span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>format <span class="token operator">=</span> <span class="token class-name">PixelFormat</span><span class="token punctuation">.</span>TRANSLUCENT<span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>TYPE_APPLICATION_PANEL<span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>flags <span class="token operator">|=</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>FLAG_ALT_FOCUSABLE_IM
                <span class="token operator">|</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>FLAG_NOT_TOUCH_MODAL
                <span class="token operator">|</span> <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>FLAG_SPLIT_TOUCH<span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>token <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>windowAnimations <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// android.R.style.DropDownAnimationDown;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Update the dynamic parts of mDecorLayoutParams</span>
    <span class="token comment">// Must be called with mAnchor != NULL.</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updateFloatingWindowLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> anchorPos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        mAnchor<span class="token punctuation">.</span><span class="token function">getLocationOnScreen</span><span class="token punctuation">(</span>anchorPos<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// we need to know the size of the controller so we can properly position it</span>
        <span class="token comment">// within its space</span>
        mDecor<span class="token punctuation">.</span><span class="token function">measure</span><span class="token punctuation">(</span><span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">makeMeasureSpec</span><span class="token punctuation">(</span>mAnchor<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>AT_MOST<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span><span class="token function">makeMeasureSpec</span><span class="token punctuation">(</span>mAnchor<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">MeasureSpec</span><span class="token punctuation">.</span>AT_MOST<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">WindowManager<span class="token punctuation">.</span>LayoutParams</span> p <span class="token operator">=</span> mDecorLayoutParams<span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>width <span class="token operator">=</span> mAnchor<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>x <span class="token operator">=</span> anchorPos<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>mAnchor<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> p<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>y <span class="token operator">=</span> anchorPos<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> mAnchor<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> mDecor<span class="token punctuation">.</span><span class="token function">getMeasuredHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// This is called whenever mAnchor&#39;s layout bound changes</span>
    <span class="token keyword">private</span> <span class="token class-name">OnLayoutChangeListener</span> mLayoutChangeListener <span class="token operator">=</span>
            <span class="token keyword">new</span> <span class="token class-name">OnLayoutChangeListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onLayoutChange</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> top<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span>
                <span class="token keyword">int</span> bottom<span class="token punctuation">,</span> <span class="token keyword">int</span> oldLeft<span class="token punctuation">,</span> <span class="token keyword">int</span> oldTop<span class="token punctuation">,</span> <span class="token keyword">int</span> oldRight<span class="token punctuation">,</span>
                <span class="token keyword">int</span> oldBottom<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">updateFloatingWindowLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mShowing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mWindowManager<span class="token punctuation">.</span><span class="token function">updateViewLayout</span><span class="token punctuation">(</span>mDecor<span class="token punctuation">,</span> mDecorLayoutParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">OnTouchListener</span> mTouchListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OnTouchListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouch</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">,</span> <span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">MotionEvent</span><span class="token punctuation">.</span>ACTION_DOWN<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mShowing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMediaPlayer</span><span class="token punctuation">(</span><span class="token class-name">MediaPlayerControl</span> player<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mPlayer <span class="token operator">=</span> player<span class="token punctuation">;</span>
        <span class="token function">updatePausePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Set the view that acts as the anchor for the control view.
     * This can for example be a VideoView, or your Activity&#39;s main view.
     * When VideoView calls this method, it will use the VideoView&#39;s parent
     * as the anchor.
     * <span class="token keyword">@param</span> <span class="token parameter">view</span> The view to which to anchor the controller when it is visible.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAnchorView</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mAnchor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mAnchor<span class="token punctuation">.</span><span class="token function">removeOnLayoutChangeListener</span><span class="token punctuation">(</span>mLayoutChangeListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        mAnchor <span class="token operator">=</span> view<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mAnchor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mAnchor<span class="token punctuation">.</span><span class="token function">addOnLayoutChangeListener</span><span class="token punctuation">(</span>mLayoutChangeListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">FrameLayout<span class="token punctuation">.</span>LayoutParams</span> frameParams <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FrameLayout<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">(</span>
                <span class="token class-name">ViewGroup<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>MATCH_PARENT<span class="token punctuation">,</span>
                <span class="token class-name">ViewGroup<span class="token punctuation">.</span>LayoutParams</span><span class="token punctuation">.</span>MATCH_PARENT
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">removeAllViews</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">View</span> v <span class="token operator">=</span> <span class="token function">makeControllerView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">addView</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> frameParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Create the view that holds the widgets that control playback.
     * Derived classes can override this to create their own.
     * <span class="token keyword">@return</span> The controller view.
     * <span class="token keyword">@hide</span> This doesn&#39;t work as advertised
     */</span>
    <span class="token keyword">protected</span> <span class="token class-name">View</span> <span class="token function">makeControllerView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">LayoutInflater</span> inflate <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LayoutInflater</span><span class="token punctuation">)</span> mContext<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span>LAYOUT_INFLATER_SERVICE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mRoot <span class="token operator">=</span> inflate<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>media_controller<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">initControllerView</span><span class="token punctuation">(</span>mRoot<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> mRoot<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initControllerView</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mPauseButton <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ImageButton</span><span class="token punctuation">)</span> v<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>pause<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mPauseButton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mPauseButton<span class="token punctuation">.</span><span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mPauseButton<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>mPauseListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        mFfwdButton <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ImageButton</span><span class="token punctuation">)</span> v<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>ffwd<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mFfwdButton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mFfwdButton<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>mFfwdListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mFromXml<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mFfwdButton<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span>mUseFastForward <span class="token operator">?</span> <span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE <span class="token operator">:</span> <span class="token class-name">View</span><span class="token punctuation">.</span>GONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        mRewButton <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ImageButton</span><span class="token punctuation">)</span> v<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>rew<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mRewButton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mRewButton<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>mRewListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mFromXml<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mRewButton<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span>mUseFastForward <span class="token operator">?</span> <span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE <span class="token operator">:</span> <span class="token class-name">View</span><span class="token punctuation">.</span>GONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// By default these are hidden. They will be enabled when setPrevNextListeners() is called </span>
        mNextButton <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ImageButton</span><span class="token punctuation">)</span> v<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>next<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mNextButton <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mFromXml <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mListenersSet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mNextButton<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span>GONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        mPrevButton <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ImageButton</span><span class="token punctuation">)</span> v<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>prev<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mPrevButton <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mFromXml <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mListenersSet<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mPrevButton<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span>GONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        mProgress <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ProgressBar</span><span class="token punctuation">)</span> v<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>mediacontroller_progress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mProgress <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mProgress <span class="token keyword">instanceof</span> <span class="token class-name">SeekBar</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">SeekBar</span> seeker <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SeekBar</span><span class="token punctuation">)</span> mProgress<span class="token punctuation">;</span>
                seeker<span class="token punctuation">.</span><span class="token function">setOnSeekBarChangeListener</span><span class="token punctuation">(</span>mSeekListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            mProgress<span class="token punctuation">.</span><span class="token function">setMax</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        mEndTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TextView</span><span class="token punctuation">)</span> v<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mCurrentTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TextView</span><span class="token punctuation">)</span> v<span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>time_current<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mFormatBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mFormatter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Formatter</span><span class="token punctuation">(</span>mFormatBuilder<span class="token punctuation">,</span> <span class="token class-name">Locale</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">installPrevNextListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Show the controller on screen. It will go away
     * automatically after 3 seconds of inactivity.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">show</span><span class="token punctuation">(</span>sDefaultTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Disable pause or seek buttons if the stream cannot be paused or seeked.
     * This requires the control interface to be a MediaPlayerControlExt
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">disableUnsupportedButtons</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mPauseButton <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mPlayer<span class="token punctuation">.</span><span class="token function">canPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mPauseButton<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mRewButton <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mPlayer<span class="token punctuation">.</span><span class="token function">canSeekBackward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mRewButton<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mFfwdButton <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mPlayer<span class="token punctuation">.</span><span class="token function">canSeekForward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mFfwdButton<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncompatibleClassChangeError</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// We were given an old version of the interface, that doesn&#39;t have</span>
            <span class="token comment">// the canPause/canSeekXYZ methods. This is OK, it just means we</span>
            <span class="token comment">// assume the media can be paused and seeked, and so we don&#39;t disable</span>
            <span class="token comment">// the buttons.</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token doc-comment comment">/**
     * Show the controller on screen. It will go away
     * automatically after &#39;timeout&#39; milliseconds of inactivity.
     * <span class="token keyword">@param</span> <span class="token parameter">timeout</span> The timeout in milliseconds. Use 0 to show
     * the controller until hide() is called.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token keyword">int</span> timeout<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mShowing <span class="token operator">&amp;&amp;</span> mAnchor <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mPauseButton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mPauseButton<span class="token punctuation">.</span><span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">disableUnsupportedButtons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">updateFloatingWindowLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mWindowManager<span class="token punctuation">.</span><span class="token function">addView</span><span class="token punctuation">(</span>mDecor<span class="token punctuation">,</span> mDecorLayoutParams<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mShowing <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">updatePausePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// cause the progress bar to be updated even if mShowing</span>
        <span class="token comment">// was already true.  This happens, for example, if we&#39;re</span>
        <span class="token comment">// paused with the progress bar showing the user hits play.</span>
        mHandler<span class="token punctuation">.</span><span class="token function">sendEmptyMessage</span><span class="token punctuation">(</span>SHOW_PROGRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Message</span> msg <span class="token operator">=</span> mHandler<span class="token punctuation">.</span><span class="token function">obtainMessage</span><span class="token punctuation">(</span>FADE_OUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>timeout <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mHandler<span class="token punctuation">.</span><span class="token function">removeMessages</span><span class="token punctuation">(</span>FADE_OUT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mHandler<span class="token punctuation">.</span><span class="token function">sendMessageDelayed</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isShowing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mShowing<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Remove the controller from the screen.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mAnchor <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mShowing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                mHandler<span class="token punctuation">.</span><span class="token function">removeMessages</span><span class="token punctuation">(</span>SHOW_PROGRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                mWindowManager<span class="token punctuation">.</span><span class="token function">removeView</span><span class="token punctuation">(</span>mDecor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token string">&quot;MediaController&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;already removed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            mShowing <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Handler</span> mHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleMessage</span><span class="token punctuation">(</span><span class="token class-name">Message</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> pos<span class="token punctuation">;</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>what<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">case</span> FADE_OUT<span class="token operator">:</span>
                    <span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> SHOW_PROGRESS<span class="token operator">:</span>
                    pos <span class="token operator">=</span> <span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mDragging <span class="token operator">&amp;&amp;</span> mShowing <span class="token operator">&amp;&amp;</span> mPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        msg <span class="token operator">=</span> <span class="token function">obtainMessage</span><span class="token punctuation">(</span>SHOW_PROGRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">sendMessageDelayed</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token number">1000</span> <span class="token operator">-</span> <span class="token punctuation">(</span>pos <span class="token operator">%</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">stringForTime</span><span class="token punctuation">(</span><span class="token keyword">int</span> timeMs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> totalSeconds <span class="token operator">=</span> timeMs <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> seconds <span class="token operator">=</span> totalSeconds <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> minutes <span class="token operator">=</span> <span class="token punctuation">(</span>totalSeconds <span class="token operator">/</span> <span class="token number">60</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">60</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> hours   <span class="token operator">=</span> totalSeconds <span class="token operator">/</span> <span class="token number">3600</span><span class="token punctuation">;</span>

        mFormatBuilder<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hours <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> mFormatter<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%d:%02d:%02d&quot;</span><span class="token punctuation">,</span> hours<span class="token punctuation">,</span> minutes<span class="token punctuation">,</span> seconds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> mFormatter<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;%02d:%02d&quot;</span><span class="token punctuation">,</span> minutes<span class="token punctuation">,</span> seconds<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mPlayer <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> mDragging<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> position <span class="token operator">=</span> mPlayer<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> duration <span class="token operator">=</span> mPlayer<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mProgress <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>duration <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// use long to avoid overflow</span>
                <span class="token keyword">long</span> pos <span class="token operator">=</span> <span class="token number">1000L</span> <span class="token operator">*</span> position <span class="token operator">/</span> duration<span class="token punctuation">;</span>
                mProgress<span class="token punctuation">.</span><span class="token function">setProgress</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">int</span> percent <span class="token operator">=</span> mPlayer<span class="token punctuation">.</span><span class="token function">getBufferPercentage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mProgress<span class="token punctuation">.</span><span class="token function">setSecondaryProgress</span><span class="token punctuation">(</span>percent <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mEndTime <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            mEndTime<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">stringForTime</span><span class="token punctuation">(</span>duration<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mCurrentTime <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            mCurrentTime<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">stringForTime</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">show</span><span class="token punctuation">(</span>sDefaultTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTrackballEvent</span><span class="token punctuation">(</span><span class="token class-name">MotionEvent</span> ev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">show</span><span class="token punctuation">(</span>sDefaultTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">dispatchKeyEvent</span><span class="token punctuation">(</span><span class="token class-name">KeyEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> keyCode <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getKeyCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token keyword">boolean</span> uniqueDown <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getRepeatCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>
                <span class="token operator">&amp;&amp;</span> event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>ACTION_DOWN<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span>  <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_HEADSETHOOK
                <span class="token operator">||</span> keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_MEDIA_PLAY_PAUSE
                <span class="token operator">||</span> keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_SPACE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>uniqueDown<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">doPauseResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">show</span><span class="token punctuation">(</span>sDefaultTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mPauseButton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    mPauseButton<span class="token punctuation">.</span><span class="token function">requestFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_MEDIA_PLAY<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>uniqueDown <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mPlayer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">updatePausePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">show</span><span class="token punctuation">(</span>sDefaultTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_MEDIA_STOP
                <span class="token operator">||</span> keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_MEDIA_PAUSE<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>uniqueDown <span class="token operator">&amp;&amp;</span> mPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mPlayer<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">updatePausePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">show</span><span class="token punctuation">(</span>sDefaultTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_VOLUME_DOWN
                <span class="token operator">||</span> keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_VOLUME_UP
                <span class="token operator">||</span> keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_VOLUME_MUTE
                <span class="token operator">||</span> keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_CAMERA<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// don&#39;t show the controls for volume adjustment</span>
            <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispatchKeyEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_BACK <span class="token operator">||</span> keyCode <span class="token operator">==</span> <span class="token class-name">KeyEvent</span><span class="token punctuation">.</span>KEYCODE_MENU<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>uniqueDown<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">hide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">show</span><span class="token punctuation">(</span>sDefaultTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispatchKeyEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span> mPauseListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">doPauseResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">show</span><span class="token punctuation">(</span>sDefaultTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updatePausePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mRoot <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> mPauseButton <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mPauseButton<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_media_pause<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            mPauseButton<span class="token punctuation">.</span><span class="token function">setImageResource</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span></span>R</span><span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>ic_media_play<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">doPauseResume</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mPlayer<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            mPlayer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">updatePausePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// There are two scenarios that can trigger the seekbar listener to trigger:</span>
    <span class="token comment">//</span>
    <span class="token comment">// The first is the user using the touchpad to adjust the posititon of the</span>
    <span class="token comment">// seekbar&#39;s thumb. In this case onStartTrackingTouch is called followed by</span>
    <span class="token comment">// a number of onProgressChanged notifications, concluded by onStopTrackingTouch.</span>
    <span class="token comment">// We&#39;re setting the field &quot;mDragging&quot; to true for the duration of the dragging</span>
    <span class="token comment">// session to avoid jumps in the position in case of ongoing playback.</span>
    <span class="token comment">//</span>
    <span class="token comment">// The second scenario involves the user operating the scroll ball, in this</span>
    <span class="token comment">// case there WON&#39;T BE onStartTrackingTouch/onStopTrackingTouch notifications,</span>
    <span class="token comment">// we will simply apply the updated position without suspending regular updates.</span>
    <span class="token keyword">private</span> <span class="token class-name">OnSeekBarChangeListener</span> mSeekListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OnSeekBarChangeListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStartTrackingTouch</span><span class="token punctuation">(</span><span class="token class-name">SeekBar</span> bar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">show</span><span class="token punctuation">(</span><span class="token number">3600000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            mDragging <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

            <span class="token comment">// By removing these pending progress messages we make sure</span>
            <span class="token comment">// that a) we won&#39;t update the progress while the user adjusts</span>
            <span class="token comment">// the seekbar and b) once the user is done dragging the thumb</span>
            <span class="token comment">// we will post one of these messages to the queue again and</span>
            <span class="token comment">// this ensures that there will be exactly one message queued up.</span>
            mHandler<span class="token punctuation">.</span><span class="token function">removeMessages</span><span class="token punctuation">(</span>SHOW_PROGRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onProgressChanged</span><span class="token punctuation">(</span><span class="token class-name">SeekBar</span> bar<span class="token punctuation">,</span> <span class="token keyword">int</span> progress<span class="token punctuation">,</span> <span class="token keyword">boolean</span> fromuser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fromuser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// We&#39;re not interested in programmatically generated changes to</span>
                <span class="token comment">// the progress bar&#39;s position.</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">long</span> duration <span class="token operator">=</span> mPlayer<span class="token punctuation">.</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">long</span> newposition <span class="token operator">=</span> <span class="token punctuation">(</span>duration <span class="token operator">*</span> progress<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000L</span><span class="token punctuation">;</span>
            mPlayer<span class="token punctuation">.</span><span class="token function">seekTo</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> newposition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mCurrentTime <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                mCurrentTime<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token function">stringForTime</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> newposition<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onStopTrackingTouch</span><span class="token punctuation">(</span><span class="token class-name">SeekBar</span> bar<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mDragging <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">updatePausePlay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">show</span><span class="token punctuation">(</span>sDefaultTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Ensure that progress is properly updated in the future,</span>
            <span class="token comment">// the call to show() does not guarantee this because it is a</span>
            <span class="token comment">// no-op if we are already showing.</span>
            mHandler<span class="token punctuation">.</span><span class="token function">sendEmptyMessage</span><span class="token punctuation">(</span>SHOW_PROGRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> enabled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mPauseButton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mPauseButton<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>enabled<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mFfwdButton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mFfwdButton<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>enabled<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mRewButton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mRewButton<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>enabled<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mNextButton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mNextButton<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>enabled <span class="token operator">&amp;&amp;</span> mNextListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mPrevButton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mPrevButton<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>enabled <span class="token operator">&amp;&amp;</span> mPrevListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mProgress <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mProgress<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>enabled<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">disableUnsupportedButtons</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>enabled<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onInitializeAccessibilityEvent</span><span class="token punctuation">(</span><span class="token class-name">AccessibilityEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onInitializeAccessibilityEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
        event<span class="token punctuation">.</span><span class="token function">setClassName</span><span class="token punctuation">(</span><span class="token class-name">MediaController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onInitializeAccessibilityNodeInfo</span><span class="token punctuation">(</span><span class="token class-name">AccessibilityNodeInfo</span> info<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onInitializeAccessibilityNodeInfo</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
        info<span class="token punctuation">.</span><span class="token function">setClassName</span><span class="token punctuation">(</span><span class="token class-name">MediaController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span> mRewListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> pos <span class="token operator">=</span> mPlayer<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            pos <span class="token operator">-=</span> <span class="token number">5000</span><span class="token punctuation">;</span> <span class="token comment">// milliseconds</span>
            mPlayer<span class="token punctuation">.</span><span class="token function">seekTo</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">show</span><span class="token punctuation">(</span>sDefaultTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span> mFfwdListener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">int</span> pos <span class="token operator">=</span> mPlayer<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            pos <span class="token operator">+=</span> <span class="token number">15000</span><span class="token punctuation">;</span> <span class="token comment">// milliseconds</span>
            mPlayer<span class="token punctuation">.</span><span class="token function">seekTo</span><span class="token punctuation">(</span>pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">setProgress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">show</span><span class="token punctuation">(</span>sDefaultTimeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">installPrevNextListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mNextButton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mNextButton<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>mNextListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mNextButton<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>mNextListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mPrevButton <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mPrevButton<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>mPrevListener<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mPrevButton<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span>mPrevListener <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPrevNextListeners</span><span class="token punctuation">(</span><span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span> next<span class="token punctuation">,</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span> prev<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mNextListener <span class="token operator">=</span> next<span class="token punctuation">;</span>
        mPrevListener <span class="token operator">=</span> prev<span class="token punctuation">;</span>
        mListenersSet <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>mRoot <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">installPrevNextListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mNextButton <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mFromXml<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mNextButton<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mPrevButton <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mFromXml<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mPrevButton<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">View</span><span class="token punctuation">.</span>VISIBLE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MediaPlayerControl</span> <span class="token punctuation">{</span>
        <span class="token keyword">void</span>    <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">void</span>    <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span>     <span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span>     <span class="token function">getCurrentPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">void</span>    <span class="token function">seekTo</span><span class="token punctuation">(</span><span class="token keyword">int</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> <span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span>     <span class="token function">getBufferPercentage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> <span class="token function">canPause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> <span class="token function">canSeekBackward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> <span class="token function">canSeekForward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token doc-comment comment">/**
         * Get the audio session id for the player used by this VideoView. This can be used to
         * apply audio effects to the audio track of a video.
         * <span class="token keyword">@return</span> The audio session, or 0 if there was an error.
         */</span>
        <span class="token keyword">int</span>     <span class="token function">getAudioSessionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><ul><li>邮箱 ：charon.chui@gmail.com</li><li>Good Luck!</li></ul></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 335891510@qq.com">Jungle68</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/android-note/assets/app.e2a3b496.js" defer></script>
  </body>
</html>
